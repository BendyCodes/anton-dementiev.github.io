//Mejdu FrameWork powered by PIXI

var PR=PR||{};
/*!
 SoundJS
 Visit http://createjs.com/ for documentation, updates and examples.

 Copyright (c) 2010 gskinner.com, inc.

 Permission is hereby granted, free of charge, to any person
 obtaining a copy of this software and associated documentation
 files (the "Software"), to deal in the Software without
 restriction, including without limitation the rights to use,
 copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the
 Software is furnished to do so, subject to the following
 conditions:

 The above copyright notice and this permission notice shall be
 included in all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
 OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
 HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
 WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
 OTHER DEALINGS IN THE SOFTWARE.
*/
this.createjs=this.createjs||{};
(function(){
var s=createjs.SoundJS=createjs.SoundJS||{};
s.version="NEXT";
s.buildDate="Thu, 11 Dec 2014 23:16:15 GMT";
})();
this.createjs=this.createjs||{};
createjs.extend=function(subclass,superclass){
"use strict";
function o(){this.constructor=subclass;}
o.prototype=superclass.prototype;
return(subclass.prototype=new o());
};
this.createjs=this.createjs||{};
createjs.promote=function(subclass,prefix){
"use strict";
var subP=subclass.prototype,supP=(Object.getPrototypeOf&&Object.getPrototypeOf(subP))||subP.__proto__;
if(supP){
subP[(prefix+="_")+"constructor"]=supP.constructor;
for(var n in supP){
if(subP.hasOwnProperty(n)&&(typeof supP[n]=="function")){subP[prefix+n]=supP[n];}
}
}
return subclass;
};
this.createjs=this.createjs||{};
createjs.indexOf=function(array,searchElement){
"use strict";
for(var i=0,l=array.length;i<l;i++){
if(searchElement===array[i]){
return i;
}
}
return-1;
};
this.createjs=this.createjs||{};
(function(){
"use strict";
createjs.proxy=function(method,scope){
var aArgs=Array.prototype.slice.call(arguments,2);
return function(){
return method.apply(scope,Array.prototype.slice.call(arguments,0).concat(aArgs));
};
}
}());
this.createjs=this.createjs||{};
(function(){
"use strict";
var t=Object.defineProperty?true:false;
var foo={};
try{
Object.defineProperty(foo,"bar",{
get:function(){
return this._bar;
},
set:function(value){
this._bar=value;
}
});
}catch(e){
t=false;
}
createjs.definePropertySupported=t;
}());
this.createjs=this.createjs||{};
(function(){
"use strict";
function BrowserDetect(){
throw"BrowserDetect cannot be instantiated";
};
var agent=BrowserDetect.agent=window.navigator.userAgent;
BrowserDetect.isWindowPhone=(agent.indexOf("IEMobile")>-1)||(agent.indexOf("Windows Phone")>-1);
BrowserDetect.isFirefox=(agent.indexOf("Firefox")>-1);
BrowserDetect.isOpera=(window.opera!=null);
BrowserDetect.isChrome=(agent.indexOf("Chrome")>-1);
BrowserDetect.isIOS=(agent.indexOf("iPod")>-1||agent.indexOf("iPhone")>-1||agent.indexOf("iPad")>-1)&&!BrowserDetect.isWindowPhone;
BrowserDetect.isAndroid=(agent.indexOf("Android")>-1)&&!BrowserDetect.isWindowPhone;
BrowserDetect.isBlackberry=(agent.indexOf("Blackberry")>-1);
createjs.BrowserDetect=BrowserDetect;
}());
this.createjs=this.createjs||{};
(function(){
"use strict";
function EventDispatcher(){
this._listeners=null;
this._captureListeners=null;
}
var p=EventDispatcher.prototype;
EventDispatcher.initialize=function(target){
target.addEventListener=p.addEventListener;
target.on=p.on;
target.removeEventListener=target.off=p.removeEventListener;
target.removeAllEventListeners=p.removeAllEventListeners;
target.hasEventListener=p.hasEventListener;
target.dispatchEvent=p.dispatchEvent;
target._dispatchEvent=p._dispatchEvent;
target.willTrigger=p.willTrigger;
};
p.addEventListener=function(type,listener,useCapture){
var listeners;
if(useCapture){
listeners=this._captureListeners=this._captureListeners||{};
}else{
listeners=this._listeners=this._listeners||{};
}
var arr=listeners[type];
if(arr){this.removeEventListener(type,listener,useCapture);}
arr=listeners[type];
if(!arr){listeners[type]=[listener];}
else{arr.push(listener);}
return listener;
};
p.on=function(type,listener,scope,once,data,useCapture){
if(listener.handleEvent){
scope=scope||listener;
listener=listener.handleEvent;
}
scope=scope||this;
return this.addEventListener(type,function(evt){
listener.call(scope,evt,data);
once&&evt.remove();
},useCapture);
};
p.removeEventListener=function(type,listener,useCapture){
var listeners=useCapture?this._captureListeners:this._listeners;
if(!listeners){return;}
var arr=listeners[type];
if(!arr){return;}
for(var i=0,l=arr.length;i<l;i++){
if(arr[i]==listener){
if(l==1){delete(listeners[type]);}
else{arr.splice(i,1);}
break;
}
}
};
p.off=p.removeEventListener;
p.removeAllEventListeners=function(type){
if(!type){this._listeners=this._captureListeners=null;}
else{
if(this._listeners){delete(this._listeners[type]);}
if(this._captureListeners){delete(this._captureListeners[type]);}
}
};
p.dispatchEvent=function(eventObj){
if(typeof eventObj=="string"){
var listeners=this._listeners;
if(!listeners||!listeners[eventObj]){return false;}
eventObj=new createjs.Event(eventObj);
}else if(eventObj.target&&eventObj.clone){
eventObj=eventObj.clone();
}
try{eventObj.target=this;}catch(e){}
if(!eventObj.bubbles||!this.parent){
this._dispatchEvent(eventObj,2);
}else{
var top=this,list=[top];
while(top.parent){list.push(top=top.parent);}
var i,l=list.length;
for(i=l-1;i>=0&&!eventObj.propagationStopped;i--){
list[i]._dispatchEvent(eventObj,1+(i==0));
}
for(i=1;i<l&&!eventObj.propagationStopped;i++){
list[i]._dispatchEvent(eventObj,3);
}
}
return eventObj.defaultPrevented;
};
p.hasEventListener=function(type){
var listeners=this._listeners,captureListeners=this._captureListeners;
return!!((listeners&&listeners[type])||(captureListeners&&captureListeners[type]));
};
p.willTrigger=function(type){
var o=this;
while(o){
if(o.hasEventListener(type)){return true;}
o=o.parent;
}
return false;
};
p.toString=function(){
return"[EventDispatcher]";
};
p._dispatchEvent=function(eventObj,eventPhase){
var l,listeners=(eventPhase==1)?this._captureListeners:this._listeners;
if(eventObj&&listeners){
var arr=listeners[eventObj.type];
if(!arr||!(l=arr.length)){return;}
try{eventObj.currentTarget=this;}catch(e){}
try{eventObj.eventPhase=eventPhase;}catch(e){}
eventObj.removed=false;
arr=arr.slice();
for(var i=0;i<l&&!eventObj.immediatePropagationStopped;i++){
var o=arr[i];
if(o.handleEvent){o.handleEvent(eventObj);}
else{o(eventObj);}
if(eventObj.removed){
this.off(eventObj.type,o,eventPhase==1);
eventObj.removed=false;
}
}
}
};
createjs.EventDispatcher=EventDispatcher;
}());
this.createjs=this.createjs||{};
(function(){
"use strict";
function Event(type,bubbles,cancelable){
this.type=type;
this.target=null;
this.currentTarget=null;
this.eventPhase=0;
this.bubbles=!!bubbles;
this.cancelable=!!cancelable;
this.timeStamp=(new Date()).getTime();
this.defaultPrevented=false;
this.propagationStopped=false;
this.immediatePropagationStopped=false;
this.removed=false;
}
var p=Event.prototype;
p.preventDefault=function(){
this.defaultPrevented=this.cancelable&&true;
};
p.stopPropagation=function(){
this.propagationStopped=true;
};
p.stopImmediatePropagation=function(){
this.immediatePropagationStopped=this.propagationStopped=true;
};
p.remove=function(){
this.removed=true;
};
p.clone=function(){
return new Event(this.type,this.bubbles,this.cancelable);
};
p.set=function(props){
for(var n in props){this[n]=props[n];}
return this;
};
p.toString=function(){
return"[Event (type="+this.type+")]";
};
createjs.Event=Event;
}());
this.createjs=this.createjs||{};
(function(){
"use strict";
function ErrorEvent(title,message,data){
this.Event_constructor("error");
this.title=title;
this.message=message;
this.data=data;
}
var p=createjs.extend(ErrorEvent,createjs.Event);
p.clone=function(){
return new createjs.ErrorEvent(this.title,this.message,this.data);
};
createjs.ErrorEvent=createjs.promote(ErrorEvent,"Event");
}());
this.createjs=this.createjs||{};
(function(scope){
"use strict";
function ProgressEvent(loaded,total){
this.Event_constructor("progress");
this.loaded=loaded;
this.total=(total==null)?1:total;
this.progress=(total==0)?0:this.loaded/this.total;
};
var p=createjs.extend(ProgressEvent,createjs.Event);
p.clone=function(){
return new createjs.ProgressEvent(this.loaded,this.total);
};
createjs.ProgressEvent=createjs.promote(ProgressEvent,"Event");
}(window));
this.createjs=this.createjs||{};
(function(){
"use strict";
function LoadItem(){
this.src=null;
this.type=null;
this.id=null;
this.maintainOrder=false;
this.callback=null;
this.data=null;
this.method=createjs.LoadItem.GET;
this.values=null;
this.headers=null;
this.withCredentials=false;
this.mimeType=null;
this.crossOrigin="Anonymous";
this.loadTimeout=8000;
};
var p=LoadItem.prototype={};
var s=LoadItem;
s.create=function(value){
if(typeof value=="string"){
var item=new LoadItem();
item.src=value;
return item;
}else if(value instanceof s){
return value;
}else if(value instanceof Object){
return value;
}else{
throw new Error("Type not recognized.");
}
};
p.set=function(props){
for(var n in props){this[n]=props[n];}
return this;
};
createjs.LoadItem=s;
}());
(function(){
var s={};
s.ABSOLUTE_PATT=/^(?:\w+:)?\/{2}/i;
s.RELATIVE_PATT='';
s.EXTENSION_PATT=/\/?[^/]+\.(\w{1,5})$/i;
s.parseURI=function(path){
var info={absolute:false,relative:false};
if(path==null){return info;}
var queryIndex=path.indexOf("?");
if(queryIndex>-1){
path=path.substr(0,queryIndex);
}
var match;
if(s.ABSOLUTE_PATT.test(path)){
info.absolute=true;
}else if(s.RELATIVE_PATT.test(path)){
info.relative=true;
}
if(match=path.match(s.EXTENSION_PATT)){
info.extension=match[1].toLowerCase();
}
return info;
};
s.formatQueryString=function(data,query){
if(data==null){
throw new Error('You must specify data.');
}
var params=[];
for(var n in data){
params.push(n+'='+escape(data[n]));
}
if(query){
params=params.concat(query);
}
return params.join('&');
};
s.buildPath=function(src,data){
if(data==null){
return src;
}
var query=[];
var idx=src.indexOf('?');
if(idx!=-1){
var q=src.slice(idx+1);
query=query.concat(q.split('&'));
}
if(idx!=-1){
return src.slice(0,idx)+'?'+this._formatQueryString(data,query);
}else{
return src+'?'+this._formatQueryString(data,query);
}
};
s.isCrossDomain=function(item){
var target=document.createElement("a");
target.href=item.src;
var host=document.createElement("a");
host.href=location.href;
var crossdomain=(target.hostname!="")&&
(target.port!=host.port||
target.protocol!=host.protocol||
target.hostname!=host.hostname);
return crossdomain;
};
s.isLocal=function(item){
var target=document.createElement("a");
target.href=item.src;
return target.hostname==""&&target.protocol=="file:";
};
s.isBinary=function(type){
switch(type){
case createjs.AbstractLoader.IMAGE:
case createjs.AbstractLoader.BINARY:
return true;
default:
return false;
}
};
s.isImageTag=function(item){
return item instanceof HTMLImageElement;
};
s.isAudioTag=function(item){
if(window.HTMLAudioElement){
return item instanceof HTMLAudioElement;
}else{
return false;
}
};
s.isVideoTag=function(item){
if(window.HTMLVideoElement){
return item instanceof HTMLVideoElement;
}else{
false;
}
};
s.isText=function(type){
switch(type){
case createjs.AbstractLoader.TEXT:
case createjs.AbstractLoader.JSON:
case createjs.AbstractLoader.MANIFEST:
case createjs.AbstractLoader.XML:
case createjs.AbstractLoader.CSS:
case createjs.AbstractLoader.SVG:
case createjs.AbstractLoader.JAVASCRIPT:
return true;
default:
return false;
}
};
s.getTypeByExtension=function(extension){
if(extension==null){
return createjs.AbstractLoader.TEXT;
}
switch(extension.toLowerCase()){
case"jpeg":
case"jpg":
case"gif":
case"png":
case"webp":
case"bmp":
return createjs.AbstractLoader.IMAGE;
case"ogg":
case"mp3":
case"webm":
return createjs.AbstractLoader.SOUND;
case"mp4":
case"webm":
case"ts":
return createjs.AbstractLoader.VIDEO;
case"json":
return createjs.AbstractLoader.JSON;
case"xml":
return createjs.AbstractLoader.XML;
case"css":
return createjs.AbstractLoader.CSS;
case"js":
return createjs.AbstractLoader.JAVASCRIPT;
case'svg':
return createjs.AbstractLoader.SVG;
default:
return createjs.AbstractLoader.TEXT;
}
};
createjs.RequestUtils=s;
}());
this.createjs=this.createjs||{};
(function(){
"use strict";
function AbstractLoader(loadItem,preferXHR,type){
this.EventDispatcher_constructor();
this.loaded=false;
this.canceled=false;
this.progress=0;
this.type=type;
this.resultFormatter=null;
if(loadItem){
this._item=createjs.LoadItem.create(loadItem);
}else{
this._item=null;
}
this._preferXHR=preferXHR;
this._result=null;
this._rawResult=null;
this._loadedItems=null;
this._tagSrcAttribute=null;
this._tag=null;
};
var p=createjs.extend(AbstractLoader,createjs.EventDispatcher);
var s=AbstractLoader;
s.POST="POST";
s.GET="GET";
s.BINARY="binary";
s.CSS="css";
s.IMAGE="image";
s.JAVASCRIPT="javascript";
s.JSON="json";
s.JSONP="jsonp";
s.MANIFEST="manifest";
s.SOUND="sound";
s.VIDEO="video";
s.SPRITESHEET="spritesheet";
s.SVG="svg";
s.TEXT="text";
s.XML="xml";
p.getItem=function(){
return this._item;
};
p.getResult=function(raw){
return raw?this._rawResult:this._result;
};
p.getTag=function(){
return this._tag;
};
p.setTag=function(tag){
this._tag=tag;
};
p.load=function(){
this._createRequest();
this._request.on("complete",this,this);
this._request.on("progress",this,this);
this._request.on("loadStart",this,this);
this._request.on("abort",this,this);
this._request.on("timeout",this,this);
this._request.on("error",this,this);
var evt=new createjs.Event("initialize");
evt.loader=this._request;
this.dispatchEvent(evt);
this._request.load();
};
p.cancel=function(){
this.canceled=true;
this.destroy();
};
p.destroy=function(){
if(this._request){
this._request.removeAllEventListeners();
this._request.destroy();
}
this._request=null;
this._item=null;
this._rawResult=null;
this._result=null;
this._loadItems=null;
this.removeAllEventListeners();
};
p.getLoadedItems=function(){
return this._loadedItems;
};
p._createRequest=function(){
if(!this._preferXHR){
this._request=new createjs.TagRequest(this._item,this._tag||this._createTag(),this._tagSrcAttribute);
}else{
this._request=new createjs.XHRRequest(this._item);
}
};
p._createTag=function(src){return null;};
p._sendLoadStart=function(){
if(this._isCanceled()){return;}
this.dispatchEvent("loadstart");
};
p._sendProgress=function(value){
if(this._isCanceled()){return;}
var event=null;
if(typeof(value)=="number"){
this.progress=value;
event=new createjs.ProgressEvent(this.progress);
}else{
event=value;
this.progress=value.loaded/value.total;
event.progress=this.progress;
if(isNaN(this.progress)||this.progress==Infinity){this.progress=0;}
}
this.hasEventListener("progress")&&this.dispatchEvent(event);
};
p._sendComplete=function(){
if(this._isCanceled()){return;}
this.loaded=true;
var event=new createjs.Event("complete");
event.rawResult=this._rawResult;
if(this._result!=null){
event.result=this._result;
}
this.dispatchEvent(event);
};
p._sendError=function(event){
if(this._isCanceled()||!this.hasEventListener("error")){return;}
if(event==null){
event=new createjs.ErrorEvent("PRELOAD_ERROR_EMPTY");
}
this.dispatchEvent(event);
};
p._isCanceled=function(){
if(window.createjs==null||this.canceled){
return true;
}
return false;
};
p.resultFormatter=null;
p.handleEvent=function(event){
switch(event.type){
case"complete":
this._rawResult=event.target._response;
var result=this.resultFormatter&&this.resultFormatter(this);
var _this=this;
if(result instanceof Function){
result(function(result){
_this._result=result;
_this._sendComplete();
});
}else{
this._result=result||this._rawResult;
this._sendComplete();
}
break;
case"progress":
this._sendProgress(event);
break;
case"error":
this._sendError(event);
break;
case"loadstart":
this._sendLoadStart();
break;
case"abort":
case"timeout":
if(!this._isCanceled()){
this.dispatchEvent(event.type);
}
break;
}
};
p.buildPath=function(src,data){
return createjs.RequestUtils.buildPath(src,data);
};
p.toString=function(){
return"[PreloadJS AbstractLoader]";
};
createjs.AbstractLoader=createjs.promote(AbstractLoader,"EventDispatcher");
}());
this.createjs=this.createjs||{};
(function(){
"use strict";
function AbstractMediaLoader(loadItem,preferXHR,type){
this.AbstractLoader_constructor(loadItem,preferXHR,type);
this.resultFormatter=this._formatResult;
this._tagSrcAttribute="src";
};
var p=createjs.extend(AbstractMediaLoader,createjs.AbstractLoader);
p.load=function(){
if(!this._tag){
this._tag=this._createTag(this._item.src);
}
this._tag.preload="auto";
this._tag.load();
this.AbstractLoader_load();
};
p._createTag=function(){};
p._createRequest=function(){
if(!this._preferXHR){
this._request=new createjs.MediaTagRequest(this._item,this._tag||this._createTag(),this._tagSrcAttribute);
}else{
this._request=new createjs.XHRRequest(this._item);
}
};
p._formatResult=function(loader){
this._tag.removeEventListener&&this._tag.removeEventListener("canplaythrough",this._loadedHandler);
this._tag.onstalled=null;
if(this._preferXHR){
loader.getTag().src=loader.getResult(true);
}
return loader.getTag();
};
createjs.AbstractMediaLoader=createjs.promote(AbstractMediaLoader,"AbstractLoader");
}());
this.createjs=this.createjs||{};
(function(){
"use strict";
var AbstractRequest=function(item){
this._item=item;
};
var p=createjs.extend(AbstractRequest,createjs.EventDispatcher);
p.load=function(){};
p.destroy=function(){};
p.cancel=function(){};
createjs.AbstractRequest=createjs.promote(AbstractRequest,"EventDispatcher");
}());
this.createjs=this.createjs||{};
(function(){
"use strict";
function TagRequest(loadItem,tag,srcAttribute){
this.AbstractRequest_constructor(loadItem);
this._tag=tag;
this._tagSrcAttribute=srcAttribute;
this._loadedHandler=createjs.proxy(this._handleTagComplete,this);
this._addedToDOM=false;
this._startTagVisibility=null;
};
var p=createjs.extend(TagRequest,createjs.AbstractRequest);
p.load=function(){
if(this._tag.parentNode==null){
window.document.body.appendChild(this._tag);
this._addedToDOM=true;
}
this._tag.onload=createjs.proxy(this._handleTagComplete,this);
this._tag.onreadystatechange=createjs.proxy(this._handleReadyStateChange,this);
var evt=new createjs.Event("initialize");
evt.loader=this._tag;
this.dispatchEvent(evt);
this._hideTag();
this._tag[this._tagSrcAttribute]=this._item.src;
};
p.destroy=function(){
this._clean();
this._tag=null;
this.AbstractRequest_destroy();
};
p._handleReadyStateChange=function(){
clearTimeout(this._loadTimeout);
var tag=this._tag;
if(tag.readyState=="loaded"||tag.readyState=="complete"){
this._handleTagComplete();
}
};
p._handleTagComplete=function(){
this._rawResult=this._tag;
this._result=this.resultFormatter&&this.resultFormatter(this)||this._rawResult;
this._clean();
this._showTag();
this.dispatchEvent("complete");
};
p._clean=function(){
this._tag.onload=null;
this._tag.onreadystatechange=null;
if(this._addedToDOM&&this._tag.parentNode!=null){
this._tag.parentNode.removeChild(this._tag);
}
};
p._hideTag=function(){
this._startTagVisibility=this._tag.style.visibility;
this._tag.style.visibility="hidden";
};
p._showTag=function(){
this._tag.style.visibility=this._startTagVisibility;
};
p._handleStalled=function(){
};
createjs.TagRequest=createjs.promote(TagRequest,"AbstractRequest");
}());
this.createjs=this.createjs||{};
(function(){
"use strict";
function MediaTagRequest(loadItem,tag,srcAttribute){
this.AbstractRequest_constructor(loadItem);
this._tag=tag;
this._tagSrcAttribute=srcAttribute;
this._loadedHandler=createjs.proxy(this._handleTagComplete,this);
};
var p=createjs.extend(MediaTagRequest,createjs.TagRequest);
var s=MediaTagRequest;
p.load=function(){
this._tag.onstalled=createjs.proxy(this._handleStalled,this);
this._tag.onprogress=createjs.proxy(this._handleProgress,this);
this._tag.addEventListener&&this._tag.addEventListener("canplaythrough",this._loadedHandler,false);
this.TagRequest_load();
};
p._handleReadyStateChange=function(){
clearTimeout(this._loadTimeout);
var tag=this._tag;
if(tag.readyState=="loaded"||tag.readyState=="complete"){
this._handleTagComplete();
}
};
p._handleStalled=function(){
};
p._handleProgress=function(event){
if(!event||event.loaded>0&&event.total==0){
return;
}
var newEvent=new createjs.ProgressEvent(event.loaded,event.total);
this.dispatchEvent(newEvent);
};
p._clean=function(){
this._tag.removeEventListener&&this._tag.removeEventListener("canplaythrough",this._loadedHandler);
this._tag.onstalled=null;
this._tag.onprogress=null;
this.TagRequest__clean();
};
createjs.MediaTagRequest=createjs.promote(MediaTagRequest,"TagRequest");
}());
this.createjs=this.createjs||{};
(function(){
"use strict";
function XHRRequest(item){
this.AbstractRequest_constructor(item);
this._request=null;
this._loadTimeout=null;
this._xhrLevel=1;
this._response=null;
this._rawResponse=null;
this._canceled=false;
this._handleLoadStartProxy=createjs.proxy(this._handleLoadStart,this);
this._handleProgressProxy=createjs.proxy(this._handleProgress,this);
this._handleAbortProxy=createjs.proxy(this._handleAbort,this);
this._handleErrorProxy=createjs.proxy(this._handleError,this);
this._handleTimeoutProxy=createjs.proxy(this._handleTimeout,this);
this._handleLoadProxy=createjs.proxy(this._handleLoad,this);
this._handleReadyStateChangeProxy=createjs.proxy(this._handleReadyStateChange,this);
if(!this._createXHR(item)){
}
};
var p=createjs.extend(XHRRequest,createjs.AbstractRequest);
XHRRequest.ACTIVEX_VERSIONS=[
"Msxml2.XMLHTTP.6.0",
"Msxml2.XMLHTTP.5.0",
"Msxml2.XMLHTTP.4.0",
"MSXML2.XMLHTTP.3.0",
"MSXML2.XMLHTTP",
"Microsoft.XMLHTTP"
];
p.getResult=function(raw){
if(raw&&this._rawResponse){
return this._rawResponse;
}
return this._response;
};
p.cancel=function(){
this.canceled=true;
this._clean();
this._request.abort();
};
p.load=function(){
if(this._request==null){
this._handleError();
return;
}
this._request.addEventListener("loadstart",this._handleLoadStartProxy,false);
this._request.addEventListener("progress",this._handleProgressProxy,false);
this._request.addEventListener("abort",this._handleAbortProxy,false);
this._request.addEventListener("error",this._handleErrorProxy,false);
this._request.addEventListener("timeout",this._handleTimeoutProxy,false);
this._request.addEventListener("load",this._handleLoadProxy,false);
this._request.addEventListener("readystatechange",this._handleReadyStateChangeProxy,false);
if(this._xhrLevel==1){
this._loadTimeout=setTimeout(createjs.proxy(this._handleTimeout,this),this._item.loadTimeout);
}
try{
if(!this._item.values||this._item.method==createjs.AbstractLoader.GET){
this._request.send();
}else if(this._item.method==createjs.AbstractLoader.POST){
this._request.send(createjs.RequestUtils.formatQueryString(this._item.values));
}
}catch(error){
this.dispatchEvent(new createjs.ErrorEvent("XHR_SEND",null,error));
}
};
p.setResponseType=function(type){
this._request.responseType=type;
};
p.getAllResponseHeaders=function(){
if(this._request.getAllResponseHeaders instanceof Function){
return this._request.getAllResponseHeaders();
}else{
return null;
}
};
p.getResponseHeader=function(header){
if(this._request.getResponseHeader instanceof Function){
return this._request.getResponseHeader(header);
}else{
return null;
}
};
p._handleProgress=function(event){
if(!event||event.loaded>0&&event.total==0){
return;
}
var newEvent=new createjs.ProgressEvent(event.loaded,event.total);
this.dispatchEvent(newEvent);
};
p._handleLoadStart=function(event){
clearTimeout(this._loadTimeout);
this.dispatchEvent("loadstart");
};
p._handleAbort=function(event){
this._clean();
this.dispatchEvent(new createjs.ErrorEvent("XHR_ABORTED",null,event));
};
p._handleError=function(event){
this._clean();
this.dispatchEvent(new createjs.ErrorEvent(event.message));
};
p._handleReadyStateChange=function(event){
if(this._request.readyState==4){
this._handleLoad();
}
};
p._handleLoad=function(event){
if(this.loaded){
return;
}
this.loaded=true;
var error=this._checkError();
if(error){
this._handleError(error);
return;
}
this._response=this._getResponse();
this._clean();
this.dispatchEvent(new createjs.Event("complete"));
};
p._handleTimeout=function(event){
this._clean();
this.dispatchEvent(new createjs.ErrorEvent("PRELOAD_TIMEOUT",null,event));
};
p._checkError=function(){
var status=parseInt(this._request.status);
switch(status){
case 404:
case 0:
return new Error(status);
}
return null;
};
p._getResponse=function(){
if(this._response!=null){
return this._response;
}
if(this._request.response!=null){
return this._request.response;
}
try{
if(this._request.responseText!=null){
return this._request.responseText;
}
}catch(e){
}
try{
if(this._request.responseXML!=null){
return this._request.responseXML;
}
}catch(e){
}
return null;
};
p._createXHR=function(item){
var crossdomain=createjs.RequestUtils.isCrossDomain(item);
var headers={};
var req=null;
if(window.XMLHttpRequest){
req=new XMLHttpRequest();
if(crossdomain&&req.withCredentials===undefined&&window.XDomainRequest){
req=new XDomainRequest();
}
}else{
for(var i=0,l=s.ACTIVEX_VERSIONS.length;i<l;i++){
var axVersion=s.ACTIVEX_VERSIONS[i];
try{
req=new ActiveXObject(axVersions);
break;
}catch(e){}
}
if(req==null){return false;}
}
if(item.mimeType&&req.overrideMimeType){
req.overrideMimeType(item.mimeType);
}
this._xhrLevel=(typeof req.responseType==="string")?2:1;
var src=null;
if(item.method==createjs.AbstractLoader.GET){
src=createjs.RequestUtils.buildPath(item.src,item.values);
}else{
src=item.src;
}
req.open(item.method||createjs.AbstractLoader.GET,src,true);
if(crossdomain&&req instanceof XMLHttpRequest&&this._xhrLevel==1){
headers["Origin"]=location.origin;
}
if(item.values&&item.method==createjs.AbstractLoader.POST){
headers["Content-Type"]="application/x-www-form-urlencoded";
}
if(!crossdomain&&!headers["X-Requested-With"]){
headers["X-Requested-With"]="XMLHttpRequest";
}
if(item.headers){
for(var n in item.headers){
headers[n]=item.headers[n];
}
}
for(n in headers){
req.setRequestHeader(n,headers[n])
}
if(req instanceof XMLHttpRequest&&item.withCredentials!==undefined){
req.withCredentials=item.withCredentials;
}
this._request=req;
return true;
};
p._clean=function(){
clearTimeout(this._loadTimeout);
this._request.removeEventListener("loadstart",this._handleLoadStartProxy);
this._request.removeEventListener("progress",this._handleProgressProxy);
this._request.removeEventListener("abort",this._handleAbortProxy);
this._request.removeEventListener("error",this._handleErrorProxy);
this._request.removeEventListener("timeout",this._handleTimeoutProxy);
this._request.removeEventListener("load",this._handleLoadProxy);
this._request.removeEventListener("readystatechange",this._handleReadyStateChangeProxy);
};
p.toString=function(){
return"[PreloadJS XHRRequest]";
};
createjs.XHRRequest=createjs.promote(XHRRequest,"AbstractRequest");
}());
this.createjs=this.createjs||{};
(function(){
"use strict";
function SoundLoader(loadItem,preferXHR){
this.AbstractMediaLoader_constructor(loadItem,preferXHR,createjs.AbstractLoader.SOUND);
if(createjs.RequestUtils.isAudioTag(loadItem)){
this._tag=loadItem;
}else if(createjs.RequestUtils.isAudioTag(loadItem.src)){
this._tag=loadItem;
}else if(createjs.RequestUtils.isAudioTag(loadItem.tag)){
this._tag=createjs.RequestUtils.isAudioTag(loadItem)?loadItem:loadItem.src;
}
if(this._tag!=null){
this._preferXHR=false;
}
};
var p=createjs.extend(SoundLoader,createjs.AbstractMediaLoader);
var s=SoundLoader;
s.canLoadItem=function(item){
return item.type==createjs.AbstractLoader.SOUND;
};
p._createTag=function(src){
var tag=document.createElement("audio");
tag.autoplay=false;
tag.preload="none";
tag.src=src;
return tag;
};
createjs.SoundLoader=createjs.promote(SoundLoader,"AbstractMediaLoader");
}());
this.createjs=this.createjs||{};
(function(){
"use strict";
function Sound(){
throw"Sound cannot be instantiated";
}
var s=Sound;
s.INTERRUPT_ANY="any";
s.INTERRUPT_EARLY="early";
s.INTERRUPT_LATE="late";
s.INTERRUPT_NONE="none";
s.PLAY_INITED="playInited";
s.PLAY_SUCCEEDED="playSucceeded";
s.PLAY_INTERRUPTED="playInterrupted";
s.PLAY_FINISHED="playFinished";
s.PLAY_FAILED="playFailed";
s.SUPPORTED_EXTENSIONS=["mp3","ogg","mpeg","wav","m4a","mp4","aiff","wma","mid"];
s.EXTENSION_MAP={
m4a:"mp4"
};
s.FILE_PATTERN=/^(?:(\w+:)\/{2}(\w+(?:\.\w+)*\/?))?([/.]*?(?:[^?]+)?\/)?((?:[^/?]+)\.(\w+))(?:\?(\S+)?)?$/;
s.defaultInterruptBehavior=s.INTERRUPT_NONE;
s.alternateExtensions=[];
s.activePlugin=null;
s._pluginsRegistered=false;
s._lastID=0;
s._masterVolume=1;
s._masterMute=false;
s._instances=[];
s._idHash={};
s._preloadHash={};
s.addEventListener=null;
s.removeEventListener=null;
s.removeAllEventListeners=null;
s.dispatchEvent=null;
s.hasEventListener=null;
s._listeners=null;
createjs.EventDispatcher.initialize(s);
s.getPreloadHandlers=function(){
return{
callback:createjs.proxy(s.initLoad,s),
types:["sound"],
extensions:s.SUPPORTED_EXTENSIONS
};
};
s._handleLoadComplete=function(event){
var src=event.target.getItem().src;
if(!s._preloadHash[src]){return;}
for(var i=0,l=s._preloadHash[src].length;i<l;i++){
var item=s._preloadHash[src][i];
s._preloadHash[src][i]=true;
if(!s.hasEventListener("fileload")){continue;}
var event=new createjs.Event("fileload");
event.src=item.src;
event.id=item.id;
event.data=item.data;
event.sprite=item.sprite;
s.dispatchEvent(event);
}
};
s._handleLoadError=function(event){
var src=event.target.getItem().src;
if(!s._preloadHash[src]){return;}
for(var i=0,l=s._preloadHash[src].length;i<l;i++){
var item=s._preloadHash[src][i];
s._preloadHash[src][i]=false;
if(!s.hasEventListener("fileerror")){continue;}
var event=new createjs.Event("fileerror");
event.src=item.src;
event.id=item.id;
event.data=item.data;
event.sprite=item.sprite;
s.dispatchEvent(event);
}
};
s._registerPlugin=function(plugin){
if(plugin.isSupported()){
s.activePlugin=new plugin();
return true;
}
return false;
};
s.registerPlugins=function(plugins){
s._pluginsRegistered=true;
for(var i=0,l=plugins.length;i<l;i++){
if(s._registerPlugin(plugins[i])){
return true;
}
}
return false;
};
s.initializeDefaultPlugins=function(){
if(s.activePlugin!=null){return true;}
if(s._pluginsRegistered){return false;}
if(s.registerPlugins([createjs.WebAudioPlugin,createjs.HTMLAudioPlugin])){return true;}
return false;
};
s.isReady=function(){
return(s.activePlugin!=null);
};
s.getCapabilities=function(){
if(s.activePlugin==null){return null;}
return s.activePlugin._capabilities;
};
s.getCapability=function(key){
if(s.activePlugin==null){return null;}
return s.activePlugin._capabilities[key];
};
s.initLoad=function(loadItem){
return s._registerSound(loadItem);
};
s._registerSound=function(loadItem){
if(!s.initializeDefaultPlugins()){return false;}
var details=s._parsePath(loadItem.src);
if(details==null){return false;}
loadItem.src=details.src;
loadItem.type="sound";
var data=loadItem.data;
var numChannels=s.activePlugin.defaultNumChannels||null;
if(data!=null){
if(!isNaN(data.channels)){
numChannels=parseInt(data.channels);
}else if(!isNaN(data)){
numChannels=parseInt(data);
}
if(data.audioSprite){
var sp;
for(var i=data.audioSprite.length;i--;){
sp=data.audioSprite[i];
s._idHash[sp.id]={src:loadItem.src,startTime:parseInt(sp.startTime),duration:parseInt(sp.duration)};
}
}
}
if(loadItem.id!=null){s._idHash[loadItem.id]={src:loadItem.src}};
var loader=s.activePlugin.register(loadItem,numChannels);
SoundChannel.create(loadItem.src,numChannels);
if(data==null||!isNaN(data)){
loadItem.data=numChannels||SoundChannel.maxPerChannel();
}else{
loadItem.data.channels=numChannels||SoundChannel.maxPerChannel();
}
if(loader.type){loadItem.type=loader.type;}
return loader;
};
s.registerSound=function(src,id,data,basePath){
var loadItem={src:src,id:id,data:data};
if(src instanceof Object){
basePath=id;
loadItem=src;
}
loadItem=createjs.LoadItem.create(loadItem);
if(basePath!=null){loadItem.src=basePath+src;}
var loader=s._registerSound(loadItem);
if(!loader){return false;}
if(!s._preloadHash[loadItem.src]){s._preloadHash[loadItem.src]=[];}
s._preloadHash[loadItem.src].push(loadItem);
if(s._preloadHash[loadItem.src].length==1){
loader.on("complete",createjs.proxy(this._handleLoadComplete,this));
loader.on("error",createjs.proxy(this._handleLoadError,this));
s.activePlugin.preload(loader);
}else{
if(s._preloadHash[loadItem.src][0]==true){return true;}
}
return loadItem;
};
s.registerSounds=function(sounds,basePath){
var returnValues=[];
if(sounds.path){
if(!basePath){
basePath=sounds.path;
}else{
basePath=basePath+sounds.path;
}
}
for(var i=0,l=sounds.length;i<l;i++){
returnValues[i]=createjs.Sound.registerSound(sounds[i].src,sounds[i].id,sounds[i].data,basePath);
}
return returnValues;
};
s.registerManifest=function(manifest,basePath){
try{
console.log("createjs.Sound.registerManifest is deprecated, please use createjs.Sound.registerSounds.")
}catch(error){
};
return this.registerSounds(manifest,basePath);
};
s.removeSound=function(src,basePath){
if(s.activePlugin==null){return false;}
if(src instanceof Object){src=src.src;}
src=s._getSrcById(src).src;
if(basePath!=null){src=basePath+src;}
var details=s._parsePath(src);
if(details==null){return false;}
src=details.src;
for(var prop in s._idHash){
if(s._idHash[prop].src==src){
delete(s._idHash[prop]);
}
}
SoundChannel.removeSrc(src);
delete(s._preloadHash[src]);
s.activePlugin.removeSound(src);
return true;
};
s.removeSounds=function(sounds,basePath){
var returnValues=[];
if(sounds.path){
if(!basePath){
basePath=sounds.path;
}else{
basePath=basePath+sounds.path;
}
}
for(var i=0,l=sounds.length;i<l;i++){
returnValues[i]=createjs.Sound.removeSound(sounds[i].src,basePath);
}
return returnValues;
};
s.removeManifest=function(manifest,basePath){
try{
console.log("createjs.Sound.removeManifest is deprecated, please use createjs.Sound.removeSounds.");
}catch(error){
};
return s.removeSounds(manifest,basePath);
};
s.removeAllSounds=function(){
s._idHash={};
s._preloadHash={};
SoundChannel.removeAll();
if(s.activePlugin){s.activePlugin.removeAllSounds();}
};
s.loadComplete=function(src){
if(!s.isReady()){return false;}
var details=s._parsePath(src);
if(details){
src=s._getSrcById(details.src).src;
}else{
src=s._getSrcById(src).src;
}
return(s._preloadHash[src][0]==true);
};
s._parsePath=function(value){
if(typeof(value)!="string"){value=value.toString();}
var match=value.match(s.FILE_PATTERN);
if(match==null){return false;}
var name=match[4];
var ext=match[5];
var c=s.getCapabilities();
var i=0;
while(!c[ext]){
ext=s.alternateExtensions[i++];
if(i>s.alternateExtensions.length){return null;}
}
value=value.replace("."+match[5],"."+ext);
var ret={name:name,src:value,extension:ext};
return ret;
};
s.play=function(src,interrupt,delay,offset,loop,volume,pan,startTime,duration){
if(interrupt instanceof Object){
delay=interrupt.delay;
offset=interrupt.offset;
loop=interrupt.loop;
volume=interrupt.volume;
pan=interrupt.pan;
startTime=interrupt.startTime;
duration=interrupt.duration;
interrupt=interrupt.interrupt;
}
var instance=s.createInstance(src,startTime,duration);
var ok=s._playInstance(instance,interrupt,delay,offset,loop,volume,pan);
if(!ok){instance._playFailed();}
return instance;
};
s.createInstance=function(src,startTime,duration){
if(!s.initializeDefaultPlugins()){return new createjs.DefaultSoundInstance(src,startTime,duration);}
src=s._getSrcById(src);
var details=s._parsePath(src.src);
var instance=null;
if(details!=null&&details.src!=null){
SoundChannel.create(details.src);
if(startTime==null){startTime=src.startTime;}
instance=s.activePlugin.create(details.src,startTime,duration||src.duration);
}else{
instance=new createjs.DefaultSoundInstance(src,startTime,duration);;
}
instance.uniqueId=s._lastID++;
return instance;
};
s.setVolume=function(value){
if(Number(value)==null){return false;}
value=Math.max(0,Math.min(1,value));
s._masterVolume=value;
if(!this.activePlugin||!this.activePlugin.setVolume||!this.activePlugin.setVolume(value)){
var instances=this._instances;
for(var i=0,l=instances.length;i<l;i++){
instances[i].setMasterVolume(value);
}
}
};
s.getVolume=function(){
return s._masterVolume;
};
s.setMute=function(value){
if(value==null){return false;}
this._masterMute=value;
if(!this.activePlugin||!this.activePlugin.setMute||!this.activePlugin.setMute(value)){
var instances=this._instances;
for(var i=0,l=instances.length;i<l;i++){
instances[i].setMasterMute(value);
}
}
return true;
};
s.getMute=function(){
return this._masterMute;
};
s.stop=function(){
var instances=this._instances;
for(var i=instances.length;i--;){
instances[i].stop();
}
};
s._playInstance=function(instance,interrupt,delay,offset,loop,volume,pan){
if(interrupt instanceof Object){
delay=interrupt.delay;
offset=interrupt.offset;
loop=interrupt.loop;
volume=interrupt.volume;
pan=interrupt.pan;
interrupt=interrupt.interrupt;
}
interrupt=interrupt||s.defaultInterruptBehavior;
if(delay==null){delay=0;}
if(offset==null){offset=instance.getPosition();}
if(loop==null){loop=instance.loop;}
if(volume==null){volume=instance.volume;}
if(pan==null){pan=instance.pan;}
if(delay==0){
var ok=s._beginPlaying(instance,interrupt,offset,loop,volume,pan);
if(!ok){return false;}
}else{
var delayTimeoutId=setTimeout(function(){
s._beginPlaying(instance,interrupt,offset,loop,volume,pan);
},delay);
instance.delayTimeoutId=delayTimeoutId;
}
this._instances.push(instance);
return true;
};
s._beginPlaying=function(instance,interrupt,offset,loop,volume,pan){
if(!SoundChannel.add(instance,interrupt)){
return false;
}
var result=instance._beginPlaying(offset,loop,volume,pan);
if(!result){
var index=createjs.indexOf(this._instances,instance);
if(index>-1){this._instances.splice(index,1);}
return false;
}
return true;
};
s._getSrcById=function(value){
return s._idHash[value]||{src:value};
};
s._playFinished=function(instance){
SoundChannel.remove(instance);
var index=createjs.indexOf(this._instances,instance);
if(index>-1){this._instances.splice(index,1);}
};
createjs.Sound=Sound;
function SoundChannel(src,max){
this.init(src,max);
}
SoundChannel.channels={};
SoundChannel.create=function(src,max){
var channel=SoundChannel.get(src);
if(channel==null){
SoundChannel.channels[src]=new SoundChannel(src,max);
return true;
}
return false;
};
SoundChannel.removeSrc=function(src){
var channel=SoundChannel.get(src);
if(channel==null){return false;}
channel._removeAll();
delete(SoundChannel.channels[src]);
return true;
};
SoundChannel.removeAll=function(){
for(var channel in SoundChannel.channels){
SoundChannel.channels[channel]._removeAll();
}
SoundChannel.channels={};
};
SoundChannel.add=function(instance,interrupt){
var channel=SoundChannel.get(instance.src);
if(channel==null){return false;}
return channel._add(instance,interrupt);
};
SoundChannel.remove=function(instance){
var channel=SoundChannel.get(instance.src);
if(channel==null){return false;}
channel._remove(instance);
return true;
};
SoundChannel.maxPerChannel=function(){
return p.maxDefault;
};
SoundChannel.get=function(src){
return SoundChannel.channels[src];
};
var p=SoundChannel.prototype;
p.constructor=SoundChannel;
p.src=null;
p.max=null;
p.maxDefault=100;
p.length=0;
p.init=function(src,max){
this.src=src;
this.max=max||this.maxDefault;
if(this.max==-1){this.max=this.maxDefault;}
this._instances=[];
};
p._get=function(index){
return this._instances[index];
};
p._add=function(instance,interrupt){
if(!this._getSlot(interrupt,instance)){return false;}
this._instances.push(instance);
this.length++;
return true;
};
p._remove=function(instance){
var index=createjs.indexOf(this._instances,instance);
if(index==-1){return false;}
this._instances.splice(index,1);
this.length--;
return true;
};
p._removeAll=function(){
for(var i=this.length-1;i>=0;i--){
this._instances[i].stop();
}
};
p._getSlot=function(interrupt,instance){
var target,replacement;
if(interrupt!=Sound.INTERRUPT_NONE){
replacement=this._get(0);
if(replacement==null){
return true;
}
}
for(var i=0,l=this.max;i<l;i++){
target=this._get(i);
if(target==null){
return true;
}
if(target.playState==Sound.PLAY_FINISHED||
target.playState==Sound.PLAY_INTERRUPTED||
target.playState==Sound.PLAY_FAILED){
replacement=target;
break;
}
if(interrupt==Sound.INTERRUPT_NONE){
continue;
}
if((interrupt==Sound.INTERRUPT_EARLY&&target.getPosition()<replacement.getPosition())||
(interrupt==Sound.INTERRUPT_LATE&&target.getPosition()>replacement.getPosition())){
replacement=target;
}
}
if(replacement!=null){
replacement._interrupt();
this._remove(replacement);
return true;
}
return false;
};
p.toString=function(){
return"[Sound SoundChannel]";
};
}());
this.createjs=this.createjs||{};
(function(){
"use strict";
var AbstractSoundInstance=function(src,startTime,duration,playbackResource){
this.EventDispatcher_constructor();
this.src=src;
this.uniqueId=-1;
this.playState=null;
this.delayTimeoutId=null;
this._startTime=Math.max(0,startTime||0);
this._volume=1;
if(createjs.definePropertySupported){
Object.defineProperty(this,"volume",{
get:this.getVolume,
set:this.setVolume
});
}
this._pan=0;
if(createjs.definePropertySupported){
Object.defineProperty(this,"pan",{
get:this.getPan,
set:this.setPan
});
}
this._duration=Math.max(0,duration||0);
if(createjs.definePropertySupported){
Object.defineProperty(this,"duration",{
get:this.getDuration,
set:this.setDuration
});
}
this._playbackResource=null;
if(createjs.definePropertySupported){
Object.defineProperty(this,"playbackResource",{
get:this.getPlaybackResource,
set:this.setPlaybackResource
});
}
if(playbackResource!==false&&playbackResource!==true){this.setPlaybackResource(playbackResource);}
this._position=0;
if(createjs.definePropertySupported){
Object.defineProperty(this,"position",{
get:this.getPosition,
set:this.setPosition
});
}
this._loop=0;
if(createjs.definePropertySupported){
Object.defineProperty(this,"loop",{
get:this.getLoop,
set:this.setLoop
});
}
this._muted=false;
if(createjs.definePropertySupported){
Object.defineProperty(this,"muted",{
get:this.getMuted,
set:this.setMuted
});
}
this._paused=false;
if(createjs.definePropertySupported){
Object.defineProperty(this,"paused",{
get:this.getPaused,
set:this.setPaused
});
}
};
var p=createjs.extend(AbstractSoundInstance,createjs.EventDispatcher);
p.play=function(interrupt,delay,offset,loop,volume,pan){
if(this.playState==createjs.Sound.PLAY_SUCCEEDED){
if(interrupt instanceof Object){
offset=interrupt.offset;
loop=interrupt.loop;
volume=interrupt.volume;
pan=interrupt.pan;
}
if(offset!=null){this.setPosition(offset)}
if(loop!=null){this.setLoop(loop);}
if(volume!=null){this.setVolume(volume);}
if(pan!=null){this.setPan(pan);}
if(this._paused){this.setPaused(false);}
return;
}
this._cleanUp();
createjs.Sound._playInstance(this,interrupt,delay,offset,loop,volume,pan);
return this;
};
p.pause=function(){
if(this._paused||this.playState!=createjs.Sound.PLAY_SUCCEEDED){return false;}
this.setPaused(true);
return true;
};
p.resume=function(){
if(!this._paused){return false;}
this.setPaused(false);
return true;
};
p.stop=function(){
this._position=0;
this._paused=false;
this._handleStop();
this._cleanUp();
this.playState=createjs.Sound.PLAY_FINISHED;
return this;
};
p.destroy=function(){
this._cleanUp();
this.src=null;
this.playbackResource=null;
this.removeAllEventListeners();
};
p.toString=function(){
return"[AbstractSoundInstance]";
};
p.getPaused=function(){
return this._paused;
};
p.setPaused=function(value){
if((value!==true&&value!==false)||this._paused==value){return;}
if(value==true&&this.playState!=createjs.Sound.PLAY_SUCCEEDED){return;}
this._paused=value;
if(value){
this._pause();
}else{
this._resume();
}
clearTimeout(this.delayTimeoutId);
return this;
};
p.setVolume=function(value){
if(value==this._volume){return this;}
this._volume=Math.max(0,Math.min(1,value));
if(!this._muted){
this._updateVolume();
}
return this;
};
p.getVolume=function(){
return this._volume;
};
p.setMute=function(value){
this.setMuted(value);
};
p.getMute=function(){
return this._muted;
};
p.setMuted=function(value){
if(value!==true&&value!==false){return;}
this._muted=value;
this._updateVolume();
return this;
};
p.getMuted=function(){
return this._muted;
};
p.setPan=function(value){
if(value==this._pan){return this;}
this._pan=Math.max(-1,Math.min(1,value));
this._updatePan();
return this;
};
p.getPan=function(){
return this._pan;
};
p.getPosition=function(){
if(!this._paused&&this.playState==createjs.Sound.PLAY_SUCCEEDED){
return this._calculateCurrentPosition();
}
return this._position;
};
p.setPosition=function(value){
this._position=Math.max(0,value);
if(this.playState==createjs.Sound.PLAY_SUCCEEDED){
this._updatePosition();
}
return this;
};
p.getDuration=function(){
return this._duration;
};
p.setDuration=function(value){
if(value==this._duration){return this;}
this._duration=Math.max(0,value||0);
this._updateDuration();
return this;
};
p.setPlaybackResource=function(value){
this._playbackResource=value;
if(this._duration==0){this._setDurationFromSource();}
return this;
};
p.getPlaybackResource=function(){
return this._playbackResource;
};
p.getLoop=function(){
return this._loop;
};
p.setLoop=function(value){
if(this._playbackResource!=null){
if(this._loop!=0&&value==0){
this._removeLooping(value);
}
if(this._loop==0&&value!=0){
this._addLooping(value);
}
}
this._loop=value;
};
p._sendEvent=function(type){
var event=new createjs.Event(type);
this.dispatchEvent(event);
};
p._cleanUp=function(){
clearTimeout(this.delayTimeoutId);
this._handleCleanUp();
this._paused=false;
createjs.Sound._playFinished(this);
};
p._interrupt=function(){
this._cleanUp();
this.playState=createjs.Sound.PLAY_INTERRUPTED;
this._sendEvent("interrupted");
};
p._beginPlaying=function(offset,loop,volume,pan){
this.setPosition(offset);
this.setLoop(loop);
this.setVolume(volume);
this.setPan(pan);
if(this._playbackResource!=null&&this._position<this._duration){
this._paused=false;
this._handleSoundReady();
this.playState=createjs.Sound.PLAY_SUCCEEDED;
this._sendEvent("succeeded");
return true;
}else{
this._playFailed();
return false;
}
};
p._playFailed=function(){
this._cleanUp();
this.playState=createjs.Sound.PLAY_FAILED;
this._sendEvent("failed");
};
p._handleSoundComplete=function(event){
this._position=0;
if(this._loop!=0){
this._loop--;
this._handleLoop();
this._sendEvent("loop");
return;
}
this._cleanUp();
this.playState=createjs.Sound.PLAY_FINISHED;
this._sendEvent("complete");
};
p._handleSoundReady=function(){
};
p._updateVolume=function(){
};
p._updatePan=function(){
};
p._updateDuration=function(){
};
p._setDurationFromSource=function(){
};
p._calculateCurrentPosition=function(){
};
p._updatePosition=function(){
};
p._removeLooping=function(){
};
p._addLooping=function(){
};
p._pause=function(){
};
p._resume=function(){
};
p._handleStop=function(){
};
p._handleCleanUp=function(){
};
p._handleLoop=function(){
};
createjs.AbstractSoundInstance=createjs.promote(AbstractSoundInstance,"EventDispatcher");
createjs.DefaultSoundInstance=createjs.AbstractSoundInstance;
}());
this.createjs=this.createjs||{};
(function(){
"use strict";
var AbstractPlugin=function(){
this._capabilities=null;
this._loaders={};
this._audioSources={};
this._soundInstances={};
this._loaderClass;
this._soundInstanceClass;
};
var p=AbstractPlugin.prototype;
AbstractPlugin._capabilities=null;
AbstractPlugin.isSupported=function(){
return true;
};
p.register=function(loadItem,instances){
this._audioSources[loadItem.src]=true;
this._soundInstances[loadItem.src]=[];
if(this._loaders[loadItem.src]){return this._loaders[loadItem.src];}
var loader=new this._loaderClass(loadItem);
loader.on("complete",createjs.proxy(this._handlePreloadComplete,this));
this._loaders[loadItem.src]=loader;
return loader;
};
p.preload=function(loader){
loader.on("error",createjs.proxy(this._handlePreloadError,this));
loader.load();
};
p.isPreloadStarted=function(src){
return(this._audioSources[src]!=null);
};
p.isPreloadComplete=function(src){
return(!(this._audioSources[src]==null||this._audioSources[src]==true));
};
p.removeSound=function(src){
if(!this._soundInstances[src]){return;}
for(var i=this._soundInstances[src].length;i--;){
var item=this._soundInstances[src][i];
item.destroy();
}
delete(this._soundInstances[src]);
delete(this._audioSources[src]);
if(this._loaders[src]){this._loaders[src].destroy();}
delete(this._loaders[src]);
};
p.removeAllSounds=function(){
for(var key in this._audioSources){
this.removeSound(key);
}
};
p.create=function(src,startTime,duration){
if(!this.isPreloadStarted(src)){
this.preload(this.register(src));
}
var si=new this._soundInstanceClass(src,startTime,duration,this._audioSources[src]);
this._soundInstances[src].push(si);
return si;
};
p.setVolume=function(value){
this._volume=value;
this._updateVolume();
return true;
};
p.getVolume=function(){
return this._volume;
};
p.setMute=function(value){
this._updateVolume();
return true;
};
p.toString=function(){
return"[AbstractPlugin]";
};
p._handlePreloadComplete=function(event){
var src=event.target.getItem().src;
this._audioSources[src]=event.result;
for(var i=0,l=this._soundInstances[src].length;i<l;i++){
var item=this._soundInstances[src][i];
item.setPlaybackResource(this._audioSources[src]);
}
};
p._handlePreloadError=function(event){
};
p._updateVolume=function(){
};
createjs.AbstractPlugin=AbstractPlugin;
}());
this.createjs=this.createjs||{};
(function(){
"use strict";
function Loader(loadItem){
this.AbstractLoader_constructor(loadItem,true,createjs.AbstractLoader.SOUND);
};
var p=createjs.extend(Loader,createjs.AbstractLoader);
Loader.context=null;
p.toString=function(){
return"[WebAudioLoader]";
};
p._createRequest=function(){
this._request=new createjs.XHRRequest(this._item,false);
this._request.setResponseType("arraybuffer");
};
p._sendComplete=function(event){
Loader.context.decodeAudioData(this._rawResult,
createjs.proxy(this._handleAudioDecoded,this),
createjs.proxy(this._handleError,this));
};
p._handleAudioDecoded=function(decodedAudio){
this._result=decodedAudio;
this.AbstractLoader__sendComplete();
};
createjs.WebAudioLoader=createjs.promote(Loader,"AbstractLoader");
}());
this.createjs=this.createjs||{};
(function(){
"use strict";
function WebAudioSoundInstance(src,startTime,duration,playbackResource){
this.AbstractSoundInstance_constructor(src,startTime,duration,playbackResource);
this.gainNode=s.context.createGain();
this.panNode=s.context.createPanner();
this.panNode.panningModel=s._panningModel;
this.panNode.connect(this.gainNode);
this.sourceNode=null;
this._soundCompleteTimeout=null;
this._sourceNodeNext=null;
this._playbackStartTime=0;
this._endedHandler=createjs.proxy(this._handleSoundComplete,this);
};
var p=createjs.extend(WebAudioSoundInstance,createjs.AbstractSoundInstance);
var s=WebAudioSoundInstance;
s.context=null;
s.destinationNode=null;
s._panningModel="equalpower";
p.destroy=function(){
this.AbstractSoundInstance_destroy();
this.panNode.disconnect(0);
this.panNode=null;
this.gainNode.disconnect(0);
this.gainNode=null;
};
p.toString=function(){
return"[WebAudioSoundInstance]";
};
p._updatePan=function(){
this.panNode.setPosition(this._pan,0,-0.5);
};
p._removeLooping=function(){
this._sourceNodeNext=this._cleanUpAudioNode(this._sourceNodeNext);
};
p._addLooping=function(){
if(this.playState!=createjs.Sound.PLAY_SUCCEEDED){return;}
this._sourceNodeNext=this._createAndPlayAudioNode(this._playbackStartTime,0);
};
p._setDurationFromSource=function(){
this._duration=this.playbackResource.duration*1000;
};
p._handleCleanUp=function(){
if(this.sourceNode&&this.playState==createjs.Sound.PLAY_SUCCEEDED){
this.sourceNode=this._cleanUpAudioNode(this.sourceNode);
this._sourceNodeNext=this._cleanUpAudioNode(this._sourceNodeNext);
}
if(this.gainNode.numberOfOutputs!=0){this.gainNode.disconnect(0);}
clearTimeout(this._soundCompleteTimeout);
this._playbackStartTime=0;
};
p._cleanUpAudioNode=function(audioNode){
if(audioNode){
audioNode.stop(0);
audioNode.disconnect(0);
audioNode=null;
}
return audioNode;
};
p._handleSoundReady=function(event){
this.gainNode.connect(s.destinationNode);
var dur=this._duration*0.001;
var pos=this._position*0.001;
this.sourceNode=this._createAndPlayAudioNode((s.context.currentTime-dur),pos);
this._playbackStartTime=this.sourceNode.startTime-pos;
this._soundCompleteTimeout=setTimeout(this._endedHandler,(dur-pos)*1000);
if(this._loop!=0){
this._sourceNodeNext=this._createAndPlayAudioNode(this._playbackStartTime,0);
}
};
p._createAndPlayAudioNode=function(startTime,offset){
var audioNode=s.context.createBufferSource();
audioNode.buffer=this.playbackResource;
audioNode.connect(this.panNode);
var dur=this._duration*0.001;
audioNode.startTime=startTime+dur;
audioNode.start(audioNode.startTime,offset+(this._startTime*0.001),dur-offset);
return audioNode;
};
p._pause=function(){
this._position=(s.context.currentTime-this._playbackStartTime)*1000;
this.sourceNode=this._cleanUpAudioNode(this.sourceNode);
this._sourceNodeNext=this._cleanUpAudioNode(this._sourceNodeNext);
if(this.gainNode.numberOfOutputs!=0){this.gainNode.disconnect(0);}
clearTimeout(this._soundCompleteTimeout);
};
p._resume=function(){
this._handleSoundReady();
};
p._updateVolume=function(){
var newVolume=this._muted?0:this._volume;
if(newVolume!=this.gainNode.gain.value){
this.gainNode.gain.value=newVolume;
}
};
p._calculateCurrentPosition=function(){
return((s.context.currentTime-this._playbackStartTime)*1000);
};
p._updatePosition=function(){
this.sourceNode=this._cleanUpAudioNode(this.sourceNode);
this._sourceNodeNext=this._cleanUpAudioNode(this._sourceNodeNext);
clearTimeout(this._soundCompleteTimeout);
if(!this._paused){this._handleSoundReady();}
};
p._handleLoop=function(){
this._cleanUpAudioNode(this.sourceNode);
this.sourceNode=this._sourceNodeNext;
this._playbackStartTime=this.sourceNode.startTime;
this._sourceNodeNext=this._createAndPlayAudioNode(this._playbackStartTime,0);
this._soundCompleteTimeout=setTimeout(this._endedHandler,this._duration);
};
p._updateDuration=function(){
this._pause();
this._resume();
};
createjs.WebAudioSoundInstance=createjs.promote(WebAudioSoundInstance,"AbstractSoundInstance");
}());
this.createjs=this.createjs||{};
(function(){
"use strict";
function WebAudioPlugin(){
this.AbstractPlugin_constructor();
this._panningModel=s._panningModel;;
this._volume=1;
this.context=s.context;
this.dynamicsCompressorNode=this.context.createDynamicsCompressor();
this.dynamicsCompressorNode.connect(this.context.destination);
this.gainNode=this.context.createGain();
this.gainNode.connect(this.dynamicsCompressorNode);
createjs.WebAudioSoundInstance.destinationNode=this.gainNode;
this._capabilities=s._capabilities;
this._loaderClass=createjs.WebAudioLoader;
this._soundInstanceClass=createjs.WebAudioSoundInstance;
this._addPropsToClasses();
}
var p=createjs.extend(WebAudioPlugin,createjs.AbstractPlugin);
var s=WebAudioPlugin;
s._capabilities=null;
s._panningModel="equalpower";
s.context=null;
s.isSupported=function(){
var isMobilePhoneGap=createjs.BrowserDetect.isIOS||createjs.BrowserDetect.isAndroid||createjs.BrowserDetect.isBlackberry;
if(location.protocol=="file:"&&!isMobilePhoneGap&&!this._isFileXHRSupported()){return false;}
s._generateCapabilities();
if(s.context==null){return false;}
return true;
};
s.playEmptySound=function(){
var source=s.context.createBufferSource();
source.buffer=s.context.createBuffer(1,1,22050);
source.connect(s.context.destination);
source.start(0,0,0);
};
s._isFileXHRSupported=function(){
var supported=true;
var xhr=new XMLHttpRequest();
try{
xhr.open("GET","WebAudioPluginTest.fail",false);
}catch(error){
supported=false;
return supported;
}
xhr.onerror=function(){supported=false;};
xhr.onload=function(){supported=this.status==404||(this.status==200||(this.status==0&&this.response!=""));};
try{
xhr.send();
}catch(error){
supported=false;
}
return supported;
};
s._generateCapabilities=function(){
if(s._capabilities!=null){return;}
var t=document.createElement("audio");
if(t.canPlayType==null){return null;}
if(s.context==null){
if(window.AudioContext){
s.context=new AudioContext();
}else if(window.webkitAudioContext){
s.context=new webkitAudioContext();
}else{
return null;
}
}
s._compatibilitySetUp();
s.playEmptySound();
s._capabilities={
panning:true,
volume:true,
tracks:-1
};
var supportedExtensions=createjs.Sound.SUPPORTED_EXTENSIONS;
var extensionMap=createjs.Sound.EXTENSION_MAP;
for(var i=0,l=supportedExtensions.length;i<l;i++){
var ext=supportedExtensions[i];
var playType=extensionMap[ext]||ext;
s._capabilities[ext]=(t.canPlayType("audio/"+ext)!="no"&&t.canPlayType("audio/"+ext)!="")||(t.canPlayType("audio/"+playType)!="no"&&t.canPlayType("audio/"+playType)!="");
}
if(s.context.destination.numberOfChannels<2){
s._capabilities.panning=false;
}
};
s._compatibilitySetUp=function(){
s._panningModel="equalpower";
if(s.context.createGain){return;}
s.context.createGain=s.context.createGainNode;
var audioNode=s.context.createBufferSource();
audioNode.__proto__.start=audioNode.__proto__.noteGrainOn;
audioNode.__proto__.stop=audioNode.__proto__.noteOff;
s._panningModel=0;
};
p.toString=function(){
return"[WebAudioPlugin]";
};
p._addPropsToClasses=function(){
var c=this._soundInstanceClass;
c.context=this.context;
c.destinationNode=this.gainNode;
c._panningModel=this._panningModel;
this._loaderClass.context=this.context;
};
p._updateVolume=function(){
var newVolume=createjs.Sound._masterMute?0:this._volume;
if(newVolume!=this.gainNode.gain.value){
this.gainNode.gain.value=newVolume;
}
};
createjs.WebAudioPlugin=createjs.promote(WebAudioPlugin,"AbstractPlugin");
}());
this.createjs=this.createjs||{};
(function(){
"use strict";
function TagPool(src){
this.src=src;
this.length=0;
this.available=0;
this.tags=[];
this.duration=0;
};
var p=TagPool.prototype;
p.constructor=TagPool;
var s=TagPool;
s.tags={};
s.get=function(src){
var channel=s.tags[src];
if(channel==null){
channel=s.tags[src]=new TagPool(src);
}
return channel;
};
s.remove=function(src){
var channel=s.tags[src];
if(channel==null){return false;}
channel.removeAll();
delete(s.tags[src]);
return true;
};
s.getInstance=function(src){
var channel=s.tags[src];
if(channel==null){return null;}
return channel.get();
};
s.setInstance=function(src,tag){
var channel=s.tags[src];
if(channel==null){return null;}
return channel.set(tag);
};
s.getDuration=function(src){
var channel=s.tags[src];
if(channel==null){return 0;}
return channel.getDuration();
};
p.add=function(tag){
this.tags.push(tag);
this.length++;
this.available++;
};
p.removeAll=function(){
var tag;
while(this.length--){
tag=this.tags[this.length];
if(tag.parentNode){
tag.parentNode.removeChild(tag);
}
delete(this.tags[this.length]);
}
this.src=null;
this.tags.length=0;
};
p.get=function(){
if(this.tags.length==0){return null;}
this.available=this.tags.length;
var tag=this.tags.pop();
if(tag.parentNode==null){document.body.appendChild(tag);}
return tag;
};
p.set=function(tag){
var index=createjs.indexOf(this.tags,tag);
if(index==-1){this.tags.push(tag);}
this.available=this.tags.length;
};
p.getDuration=function(){
if(!this.duration){this.duration=this.tags[this.tags.length-1].duration*1000;}
return this.duration;
};
p.toString=function(){
return"[HTMLAudioTagPool]";
};
createjs.HTMLAudioTagPool=TagPool;
}());
this.createjs=this.createjs||{};
(function(){
"use strict";
function HTMLAudioSoundInstance(src,startTime,duration,playbackResource){
this.AbstractSoundInstance_constructor(src,startTime,duration,playbackResource);
this._audioSpriteStopTime=null;
this._delayTimeoutId=null;
this._endedHandler=createjs.proxy(this._handleSoundComplete,this);
this._readyHandler=createjs.proxy(this._handleTagReady,this);
this._stalledHandler=createjs.proxy(this.playFailed,this);
this._audioSpriteEndHandler=createjs.proxy(this._handleAudioSpriteLoop,this);
this._loopHandler=createjs.proxy(this._handleSoundComplete,this);
if(duration){
this._audioSpriteStopTime=(startTime+duration)*0.001;
}else{
this._duration=createjs.HTMLAudioTagPool.getDuration(this.src);
}
}
var p=createjs.extend(HTMLAudioSoundInstance,createjs.AbstractSoundInstance);
p.setMasterVolume=function(value){
this._updateVolume();
};
p.setMasterMute=function(isMuted){
this._updateVolume();
};
p.toString=function(){
return"[HTMLAudioSoundInstance]";
};
p._removeLooping=function(){
if(this._playbackResource==null){return;}
this._playbackResource.loop=false;
this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,false);
};
p._addLooping=function(){
if(this._playbackResource==null||this._audioSpriteStopTime){return;}
this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,false);
this._playbackResource.loop=true;
};
p._handleCleanUp=function(){
var tag=this._playbackResource;
if(tag!=null){
tag.pause();
tag.loop=false;
tag.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_ENDED,this._endedHandler,false);
tag.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_READY,this._readyHandler,false);
tag.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_STALLED,this._stalledHandler,false);
tag.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,false);
tag.removeEventListener(createjs.HTMLAudioPlugin._TIME_UPDATE,this._audioSpriteEndHandler,false);
try{
tag.currentTime=this._startTime;
}catch(e){
}
createjs.HTMLAudioTagPool.setInstance(this.src,tag);
this._playbackResource=null;
}
};
p._beginPlaying=function(offset,loop,volume,pan){
this._playbackResource=createjs.HTMLAudioTagPool.getInstance(this.src);
return this.AbstractSoundInstance__beginPlaying(offset,loop,volume,pan);
};
p._handleSoundReady=function(event){
if(this._playbackResource.readyState!==4){
var tag=this._playbackResource;
tag.addEventListener(createjs.HTMLAudioPlugin._AUDIO_READY,this._readyHandler,false);
tag.addEventListener(createjs.HTMLAudioPlugin._AUDIO_STALLED,this._stalledHandler,false);
tag.preload="auto";
tag.load();
return;
}
this._updateVolume();
this._playbackResource.currentTime=(this._startTime+this._position)*0.001;
if(this._audioSpriteStopTime){
this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._TIME_UPDATE,this._audioSpriteEndHandler,false);
}else{
this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._AUDIO_ENDED,this._endedHandler,false);
if(this._loop!=0){
this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,false);
this._playbackResource.loop=true;
}
}
this._playbackResource.play();
};
p._handleTagReady=function(event){
this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_READY,this._readyHandler,false);
this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_STALLED,this._stalledHandler,false);
this._handleSoundReady();
};
p._pause=function(){
this._playbackResource.pause();
};
p._resume=function(){
this._playbackResource.play();
};
p._updateVolume=function(){
if(this._playbackResource!=null){
var newVolume=(this._muted||createjs.Sound._masterMute)?0:this._volume*createjs.Sound._masterVolume;
if(newVolume!=this._playbackResource.volume){this._playbackResource.volume=newVolume;}
}
};
p._calculateCurrentPosition=function(){
return(this._playbackResource.currentTime*1000)-this._startTime;
};
p._updatePosition=function(){
this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,false);
this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._handleSetPositionSeek,false);
try{
this._playbackResource.currentTime=(this._position+this._startTime)*0.001;
}catch(error){
this._handleSetPositionSeek(null);
}
};
p._handleSetPositionSeek=function(event){
if(this._playbackResource==null){return;}
this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._handleSetPositionSeek,false);
this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,false);
};
p._handleAudioSpriteLoop=function(event){
if(this._playbackResource.currentTime<=this._audioSpriteStopTime){return;}
this._playbackResource.pause();
if(this._loop==0){
this._handleSoundComplete(null);
}else{
this._position=0;
this._loop--;
this._playbackResource.currentTime=this._startTime*0.001;
if(!this._paused){this._playbackResource.play();}
this._sendEvent("loop");
}
};
p._handleLoop=function(event){
if(this._loop==0){
this._playbackResource.loop=false;
this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,false);
}
};
p._updateDuration=function(){
this._audioSpriteStopTime=(startTime+duration)*0.001;
if(this.playState==createjs.Sound.PLAY_SUCCEEDED){
this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_ENDED,this._endedHandler,false);
this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._TIME_UPDATE,this._audioSpriteEndHandler,false);
}
};
createjs.HTMLAudioSoundInstance=createjs.promote(HTMLAudioSoundInstance,"AbstractSoundInstance");
}());
this.createjs=this.createjs||{};
(function(){
"use strict";
function HTMLAudioPlugin(){
this.AbstractPlugin_constructor();
this.defaultNumChannels=2;
this._capabilities=s._capabilities;
this._loaderClass=createjs.SoundLoader;
this._soundInstanceClass=createjs.HTMLAudioSoundInstance;
}
var p=createjs.extend(HTMLAudioPlugin,createjs.AbstractPlugin);
var s=HTMLAudioPlugin;
s.MAX_INSTANCES=30;
s._AUDIO_READY="canplaythrough";
s._AUDIO_ENDED="ended";
s._AUDIO_SEEKED="seeked";
s._AUDIO_STALLED="stalled";
s._TIME_UPDATE="timeupdate";
s._capabilities=null;
s.enableIOS=false;
s.isSupported=function(){
s._generateCapabilities();
if(s._capabilities==null){return false;}
return true;
};
s._generateCapabilities=function(){
if(s._capabilities!=null){return;}
var t=document.createElement("audio");
if(t.canPlayType==null){return null;}
s._capabilities={
panning:true,
volume:true,
tracks:-1
};
var supportedExtensions=createjs.Sound.SUPPORTED_EXTENSIONS;
var extensionMap=createjs.Sound.EXTENSION_MAP;
for(var i=0,l=supportedExtensions.length;i<l;i++){
var ext=supportedExtensions[i];
var playType=extensionMap[ext]||ext;
s._capabilities[ext]=(t.canPlayType("audio/"+ext)!="no"&&t.canPlayType("audio/"+ext)!="")||(t.canPlayType("audio/"+playType)!="no"&&t.canPlayType("audio/"+playType)!="");
}
};
p.register=function(loadItem,instances){
var channel=createjs.HTMLAudioTagPool.get(loadItem.src);
var tag=null;
for(var i=0;i<instances;i++){
tag=this._createTag(loadItem.src);
channel.add(tag);
}
var loader=this.AbstractPlugin_register(loadItem,instances);
loader.setTag(tag);
return loader;
};
p.removeSound=function(src){
this.AbstractPlugin_removeSound(src);
createjs.HTMLAudioTagPool.remove(src);
};
p.create=function(src,startTime,duration){
var si=this.AbstractPlugin_create(src,startTime,duration);
si.setPlaybackResource(null);
return si;
};
p.toString=function(){
return"[HTMLAudioPlugin]";
};
p.setVolume=p.getVolume=p.setMute=null;
p._createTag=function(src){
var tag=document.createElement("audio");
tag.autoplay=false;
tag.preload="none";
tag.src=src;
return tag;
};
createjs.HTMLAudioPlugin=createjs.promote(HTMLAudioPlugin,"AbstractPlugin");
}());
GodStep.LocalStorage=function(){
GodStep.LocalStorage.instance=this;
try{
if('localStorage'in window&&window['localStorage']!==null){
this.storage=window['localStorage'];
window.addEventListener("storage",this.h_storage,false);
this.isAvailable=true;
}
}catch(e){
GodStep.LocalStorage.instance.isAvailable=false;
alert('LocalStorage CATCH');
}
};
extend(GodStep.LocalStorage,Object);
pro.getData=function(slot){
if(!this.isAvailable){
return null;
}
var data=this.storage.getItem(slot||"data");
if(data!=null)return JSON.parse(data);
else{
trace('no data');
return null;
}
};
pro.setData=function(data,slot){
var d=JSON.stringify(data);
trace('local storage ['+(slot||'data')+']');
trace(d);
try{
this.storage.setItem(slot||"data",d);
}catch(e){
trace('LOCAL STORAGE ERROR');
}
};
GodStep.Clear=function(slot){
GodStep.LocalStorage.instance.setData(null,slot);
};
GodStep.SaveLocal=function(data,slot){
GodStep.LocalStorage.instance.setData(data,slot);
};
GodStep.LoadText=function(text){
return JSON.parse(text);
};
GodStep.LoadLocal=function(slot){
return GodStep.LocalStorage.instance.getData(slot);
};
pro.h_storage=function(e){
trace('storage'+e);
};
GodStep.Preloader=function(soul){
this.preloadState=0;
GodStep.Preloader.textures=[];
this.startS=soul.startS;
this.soul=soul;
this.isAudioTag=soul.AUDIOTAG;
this.isOnlyOneView=true;
GodStep.Frame.call(this,'Preloader',soul.W,soul.H);
PIXI.EventTarget.call(this);
};
extend(GodStep.Preloader,GodStep.Frame);
GodStep.ASSETS_LOADED='assets loaded';
GodStep.SOUNDS_LOADED='sounds loaded';
pro.loadAll=function(pathImages,pngs,jpgs,pathSounds,sounds,assets){
this.textures=[];
this.pathImages=pathImages;
var i,img;
this.images=pngs;
this.assets=assets;
this.exts=[];
for(i=0;i<this.images.length;i++){
this.exts.push('.png');
}
for(i=0;i<jpgs.length;i++){
this.images.push(jpgs[i]);
this.exts.push('.jpg');
}
this.imagesCount=this.images.length;
if(this.images.length>0){
img=GodStep.Image.fromImage(this.pathImages+this.images[0]+this.exts[0]);
img.p=this;
img.texName=this.images[0];
this.textures[img.texName]=img.texture;
}
this.initSounds(pathSounds,sounds);
this.soundsCount=sounds.length;
if(this.images.length==0){
this.isImagesComplete=true;
this.loadSounds();
}
};
pro.trace=function(v){
trace(v);
};
pro.initSounds=function(soundPath,arr){
this.trace('init sounds');
GodStep.Game.instance.sound={};
var sounds=[];
var isLoop=false;
for(var i=0;i<arr.length;i++){
var name=arr[i];isLoop=false;
if(name.length>4){
if(name.substr(0,4)=='loop'){
isLoop=true;
name=name.substr(5,name.length-5);
}
}
sounds.push({src:name,id:name,loop:isLoop});
}
this.soundPath=soundPath;
GodStep.Game.instance.sound.needLoaded=this.needLoaded=this.sounds=sounds;
};
pro.loadSound=function(url,vol,loop){
var audio=new Audio();
if(loop){
audio.addEventListener('ended',function(){
audio.currentTime=0;
audio.play();
},false);
}
this.sounds.push(audio);
audio.src=url;
audio.preload="auto";
audio.volume=vol;
audio.preloader=this;
audio.onloadeddata=this.launchApp;
audio.load();
return audio;
};
pro.launchApp=function(launch){
var preloader=this.preloader;
preloader.audio_preload++;
if(preloader.audio_preload==preloader.needLoaded.length||launch==1){
preloader.startSounds();
}else{
preloader.loadSound(GodPath+preloader.soundPath+preloader.needLoaded[preloader.audio_preload].src+"."+preloader.support.audio,1,preloader.needLoaded[preloader.audio_preload].loop);
}
};
pro.startSounds=function(){
this.loadAssets();
};
pro.loadSounds=function(){
if(this.soul.DISABLE_SOUND){
this.loadAssets();
return;
}
if(this.isAudioTag){
this.support={};
this.audio_preload=0;
GodStep.Game.instance.sound.sounds=this.sounds=[];
GodStep.Game.instance.sound.AVAILABLE=true;
var a=document.createElement('audio');
var ogg=!!(a.canPlayType&&a.canPlayType('audio/ogg; codecs="vorbis"').replace(/no/,''));
var mp3=!!(a.canPlayType&&a.canPlayType('audio/mpeg;').replace(/no/,''));
if(ogg){
trace('AUDIOTAG: '+'ogg');
this.support.audio='ogg';
}else
if(mp3){
trace('AUDIOTAG: '+'mp3');
this.support.audio='mp3';
}
else{
trace('no sound supported');
this.support.audio='no';
GodStep.Game.instance.sound.AVAILABLE=false;
this.startSounds();
return 0;
}
this.loadSound(GodPath+this.soundPath+this.needLoaded[0].src+"."+this.support.audio,1,this.needLoaded[0].loop);
}else{
this.trace('loadSounds');
var sound=GodStep.Game.instance.sound={preloader:this};
sound.AVAILABLE=true;
if(window['createjs']){
if(createjs.BrowserDetect.isIOS||createjs.BrowserDetect.isAndroid||createjs.BrowserDetect.isBlackberry){
this.ISMOBILE=true;
}
}else{
sound.AVAILABLE=false;
GodStep.Game.instance.sound={};
this.loadAssets();
return;
}
if(sound.AVAILABLE){}
if(!this.soul.isNativeAndroid){
if(!createjs.Sound.initializeDefaultPlugins()){
sound.AVAILABLE=false;
this.loadAssets();
return;
}
if(sound.AVAILABLE){
for(var i=0;i<this.sounds.length;i++){
this.sounds[i].src+='.ogg';
}
createjs.Sound.alternateExtensions=["mp3"];
createjs.Sound.addEventListener("fileload",this.h_loadedSound);
sound.countLoaded=this.sounds.length;
createjs.Sound.addEventListener("fileload",createjs.proxy(this.h_loadedSound,this));
createjs.Sound.registerSounds(this.sounds,GodPath+this.soundPath);
}else{
GodStep.Game.instance.sound={};
this.loadAssets();
}
}else{
sound.AVAILABLE=false;
GodStep.Game.instance.sound={};
this.loadAssets();
}
}
};
pro.update=function(){
if(!this.isImagesComplete){
var img;
if(this.images){
for(var im in this.images){
var tex=this.textures[this.images[im]];
if(tex){
if(tex.baseTexture.hasLoaded){
this.exts.splice(this.images.indexOf(this.images[im]),1);
this.images.splice(this.images.indexOf(this.images[im]),1);
if(GodStep.loadingCallback){
GodStep.loadingCallback((1-this.images.length/this.imagesCount)*.5);
}
if(this.images.length>0){
img=GodStep.Image.fromImage(this.pathImages+this.images[0]+this.exts[0]);
img.p=this;
img.texName=this.images[0];
this.textures[img.texName]=img.texture;
}
if(this.images.length>0){
for(var i=0;i<10;i++){
if(this.images[i]){
img=GodStep.Image.fromImage(this.pathImages+this.images[i]+this.exts[i]);
img.p=this;
img.texName=this.images[i];
this.textures[img.texName]=img.texture;
}
}
}
}
}
}
if(this.images.length==0){
this.isImagesComplete=true;
GodStep.textures=this.textures;
if(GodStep.IMAGE_RESOLUTION!=null&&GodStep.IMAGE_RESOLUTION!=1){
this.resizeImages(GodStep.IMAGE_RESOLUTION);
}
this.loadSounds();
}
}
}
};
pro.resizeImages=function(res){
var i;
for(var img in GodStep.textures){
var isFound=false;
if(GodStep.DONT_RESIZE!=null){
for(i=0;i<GodStep.DONT_RESIZE.length;i++){
if(img==GodStep.DONT_RESIZE[i]){
isFound=true;
}
}
}
if(!isFound){
var tex=GodStep.textures[img];
var newTex=new PIXI.RenderTexture(parseInt(tex.width*res),parseInt(tex.height*res));
this.addChild(this.spr=new PIXI.Sprite(tex));
newTex.render(this.spr,new PIXI.Matrix(res,0,0,res,0,0));
this.removeChild(this.spr);
GodStep.textures[img]=newTex;
if(newTex.width==0||newTex.height==0){
}
}
}
for(var bt in PIXI.BaseTextureCache){
if(GodStep.DONT_RESIZE!=null){
isFound=false;
for(i=0;i<GodStep.DONT_RESIZE.length;i++){
var id=bt.search(GodStep.DONT_RESIZE[i]);
if(id>=0){
isFound=true;
}
}
}
if(!isFound){
if(!PIXI.BaseTextureCache[bt].isLoader){
PIXI.BaseTextureCache[bt].destroy();
}
}
}
};
pro.loadAssets=function(){
this.trace('loading assets');
var fontClasses=[];
if(!this.fontLoaderClass.slice){
fontClasses=[this.fontLoaderClass];
}else{
fontClasses=this.fontLoaderClass;
}
if(this.assets){
while(this.assets.length){
var assetsToLoader;
if(window['GodAssetsPath']!=undefined){
assetsToLoader=[window['GodAssetsPath']+this.assets[0]];
}else{
assetsToLoader=[this.pathImages+this.assets[0]];
}
var loader;
this.assets.splice(0,1);
if(fontClasses[0]){
loader=new fontClasses[0](assetsToLoader);
this.soul.startS*=this.Scale;
if(this.assets.length==0){
dispatch(this,GodStep.ASSETS_LOADED);
}
}else{
loader=new PIXI.AssetLoader(assetsToLoader);
loader.onComplete=this.h_loadedAssets;
loader.preloader=this;
loader.load();
}
fontClasses.splice(0,1);
}
}else{
dispatch(this,GodStep.ASSETS_LOADED);
}
};
pro.h_loadedSound=function(e){
var sound=GodStep.Game.instance.sound;
if(GodStep.loadingCallback){
if(sound.countLoaded>=0){
GodStep.loadingCallback((1-sound.countLoaded/sound.preloader.soundsCount)*.5+.5);
}
}
sound.countLoaded--;
if(sound.countLoaded==0){
this.trace('sound loaded');
sound.preloader.loadAssets();
}
};
pro.h_loadedAssets=function(e){
this.preloader.trace('sound game');
if(this.soul){
this.soul.startS*=this.Scale;
}
dispatch(this.preloader,GodStep.ASSETS_LOADED);
};
GodStep.LFrame=function(soul,name){
GodStep.Frame.call(this,name||('LFrame '+GodStep.Frame.frameCount++),soul.W,soul.H);
this.OH=soul.OH;
this.OW=soul.OW;
this.S=soul;
this.s=soul.startS;
this.soul=soul;
this.visible=false;
};extend(GodStep.LFrame,GodStep.Frame);
pro.init=function(){
this.visible=true;
};
pro.initLiquid=function(w,h,d){
this.isLiquid=true;
if(!GodStep.lqobjects){
GodStep.lqobjects=[];
GodStep.lqobjects[0]=[];
}
if(!GodStep.lqobjects[this.name]){
GodStep.lqobjects[0].push(this);
this.isTemplate=true;
this.addChild(this.view=new PIXI.Sprite(this.source=new PIXI.RenderTexture(w,h)));
GodStep.lqobjects[this.name]=this;
this.template=this;
this.brothers=[];
this.passes=[new LQ.Pass(LQ.PASS_LOOP,[1],[new LQ.Pass(LQ.PASS_FILL,[0,0]),new LQ.Pass(LQ.PASS_CIRCLE,[0,0]),new LQ.Pass(LQ.PASS_DRAW,[0])])];
this.states=[new GodStep.State()];
this.colors=[];
this.points=[];
this.params=[];
}else{
GodStep.lqobjects[this.name].brothers.push(this);
this.template=GodStep.lqobjects[this.name];
this.addChild(this.view=new PIXI.Sprite(this.source=this.template.source));
}
this.view.anchor=new PIXI.Point(.5,.5);
this.w=w;
this.h=h;
this.d=d||0;
};
pro.applyToState=function(s){
};
pro.applyState=function(s){
var cur=0;
var i;
var points=this.points;
var colors=this.colors;
var params=this.params;
var values=s.values;
var w=this.w;
var h=this.h;
var d=this.d;
for(i=0;i<points.length;i++){
var p=points[i];
p.x=w*values[cur];
p.y=h*values[cur+1];
p.z=d*values[cur+2];
cur+=3;
}
for(i=0;i<colors.length;i++){
var c=colors[i];
c.r=parseInt(255*values[cur]);
c.g=parseInt(255*values[cur+1]);
c.b=parseInt(255*values[cur+2]);
c.calcHex();
cur+=3;
}
for(i=0;i<params.length;i++){
params[i]=values[cur];
cur++;
}
};
pro.pushParam=function(){
var states=this.states;
var sl=states.length;
var cur=this.points.length*3+this.colors.length*3+this.params.length;
for(var s=0;s<sl;s++){
states[s].values.splice(cur,0,0);
}
this.params.push(0);
};
pro.pushColor=function(c){
var states=this.states;
var sl=states.length;
var cur=this.points.length*3+this.colors.length*3;
var values;
for(var s=0;s<sl;s++){
values=states[s].values;
if(c){
values.splice(cur,0,c.r/255);
values.splice(cur+1,c.g/255);
values.splice(cur+2,0,c.b/255);
}else{
values.splice(cur,0,0);
values.splice(cur+1,0,0);
values.splice(cur+2,0,0);
}
}
if(c){
this.colors.push(c);
}else{
this.colors.push(new GodStep.Color());
}
};
pro.removeColor=function(c){
var id=this.colors.indexOf(c);
var states=this.states;
var sl=states.length;
var values;
var cur=this.points.length*3;
for(var s=0;s<sl;s++){
values=states[s].values;
values.splice(cur+id*3,3);
}
this.colors.splice(id,1);
};
pro.removeParam=function(){
if(this.params.length>0){
this.params.splice(this.params.length-1,1);
}
var states=this.states;
var sl=states.length;
var cur=this.points.length*3+this.colors.length*3+this.params.length-1;
for(var s=0;s<sl;s++){
states[s].values.splice(cur,1);
}
};
pro.pushPoint=function(){
var states=this.states;
var sl=states.length;
var cur=this.points.length*3;
var values;
for(var s=0;s<sl;s++){
values=states[s].values;
values.splice(cur,0,0);
values.splice(cur+1,0,0);
values.splice(cur+2,0,0);
}
this.points.push(new GodStep.Point());
};
pro.pushState=function(s){
if(s){
this.states.push(s);
}
else{
this.states.push(this.states[0].clone());
}
};
pro.passAll=function(){
LQ.Liquid.passAll(this);
};
pro.getAllValues=function(){
var states=this.states;
var sl=states.length;
var values=[];
for(var i=0;i<sl;i++){
values=values.concat(states[i].values);
}
return values;
};
pro.setData=function(d){
if(this.isTemplate){
this.name=d.name;
this.passes=[];
for(var i=0;i<d.passes.length;i++){
this.passes.push(LQ.Pass.parse(d.passes[i]));
}
this.states=[];
this.colors=[];
this.params=[];
this.points=[];
var state;
var values=d.values;
var sl=values.length/d.sc;
for(var id=0;id<d.dc;id++){
this.points.push(new GodStep.Point());
}
for(var ic=0;ic<d.cc;ic++){
this.colors.push(new GodStep.Color());
}
for(var p=0;p<d.pc;p++){
this.params.push(0);
}
for(var s=0;s<d.sc;s++){
this.states.push(state=new GodStep.State());
state.pushValues(values,sl);
values.splice(0,sl);
}
}
};
pro.getData=function(){
var d={};
d.name=this.name;
d.passes=[];
d.values=this.getAllValues();
d.sc=this.states.length;
d.cc=this.colors.length;
d.dc=this.points.length;
d.pc=this.params.length;
for(var i=0;i<this.passes.length;i++){
var passData=this.passes[i].getData();
d.passes.push(passData);
}
return d;
};
GodStep.Text=function(t,size,font,align,color){
this.font=font||'Arial';
this.size=size||15;
this.align=(align||"center");
PIXI.Text.call(this,t,{font:this.size+"px "+this.font,align:this.align,fill:(color)?('#'+color.toString(16)):'#000000'});
};
extend(GodStep.Text,PIXI.Text);
pro.place=function(x,y){
this.x=x;
this.y=y;
};
pro.centerX=function(w,y){
this.y=y;
this.x=w/2-this.width/2;
};
pro.setColor=function(color){
this.style.fill='#'+color.toString(16);
};
pro.setFont=function(font){
this.font=font;
this.style.font=this.size+'px '+this.font;
this.updateText();
};
pro.setSize=function(size){
this.size=size;
this.style.font=this.size+'px '+this.font;
this.updateText();
};
Games.Img=function(name,scale,px,py,anchor){
GodStep.Image.call(this,GodStep.textures[name]);
this.name=name;
this.Scale=scale/GodStep.IMAGE_RESOLUTION*GodStep.SCALE;
if(anchor==0.5){
this.anchor=new PIXI.Point(.5,.5);
}else{
if(anchor){
this.anchor=anchor;
}
}
this.place(px,py);
};
extend(Games.Img,GodStep.Image);
pro.setTexture=function(name){
PIXI.Sprite.prototype.setTexture.call(this,GodStep.textures[name]);
};
Games.ImgButton=function(img,parent,px,py,text,textSize,tdx,tdy,font){
var tex=GodStep.textures[img];
if(tex==undefined||tex==null)trace('TEXTURE NOT FOUND - '+img);
var startS=this.startS=parent.s*Games.SCALE;
GodStep.Frame.call(this,null,tex.width*startS/GodStep.IMAGE_RESOLUTION,tex.height*startS/GodStep.IMAGE_RESOLUTION);
GodStep.IOverOut.call(this,this.W,this.H);
GodStep.IDownUp.call(this,this.W,this.H);
this.imgName=img;
this.p=parent;
this.scaleble=true;
this.addChild(this.img=new GodStep.Image(tex));this.img.Scale=startS/GodStep.IMAGE_RESOLUTION;
if(text){
this.addChild(this.label=new GodStep.BitmapText(text,(textSize||100)*startS/Games.SCALE,0,0,'center',font));
this.label.x-=this.label.width/2+(tdx||0);
this.label.y-=this.label.height/2+(tdy||0);
this.label.tdx=tdx||0;
this.label.tdy=tdy||0;
this.label.HW=-this.label.width/2;
this.label.HH=-this.label.height/2;
}
this.img.anchor=new PIXI.Point(0.5,0.5);
this.setHitArea(-this.W/2,-this.H/2,this.W,this.H);
this.addChild(this.over=new GodStep.Frame('over'));this.over.p=this;
GodStep.IDownUp.call(this.over,this.W,this.H);
this.place(px,py);
addEvent(this,GodStep.FRAME_DOWN,this.h_mouse);
addEvent(this,GodStep.FRAME_OUT,this.h_mouse);
addEvent(this,GodStep.FRAME_OVER,this.h_mouse);
addEvent(this.over,GodStep.FRAME_UP,this.h_mouse);
};
extend(Games.ImgButton,GodStep.Frame);
Games.ImgButton.CLICK='clickImg';
pro.setTexture=function(name){
var tex=GodStep.textures[name];
this.img.setTexture(tex);
};
pro.rescale=function(s){
if(this.no_scale)return;
if(this.label){
this.label.scale.y=this.label.scale.x=s;
this.label.x=(this.label.HW-(this.label.tdx||0))*this.label.scale.y;
this.label.y=(this.label.HH-(this.label.tdy||0))*this.label.scale.y;
}
this.img.scale.y=this.img.scale.x=s*this.startS;
};
pro.h_mouse=function(e){
var t=e.content.t;
switch(e.type){
case GodStep.FRAME_DOWN:
if(this.scaleble){
this.rescale(1.1/GodStep.IMAGE_RESOLUTION);
}
this.over.visible=true;
this.over.interactive=true;
this.over.hitArea=new PIXI.Rectangle(-this.p.W*.2,-this.p.W*.2,this.p.W*.4,this.p.W*.4);
this.isClicked=true;
this.isOvered=true;
var p=e.content.getLocalPosition(this);
this.over.x=p.x;
this.over.y=p.y;
addEvent(this,GodStep.FRAME_MOVE,this.h_move);
break;
case GodStep.FRAME_UP:
if(this.p.isClicked&&this.p.isOvered){
dispatch(t.parent,Games.ImgButton.CLICK);
}
this.visible=false;
this.p.isOvered=false;
this.p.rescale(1/GodStep.IMAGE_RESOLUTION);
this.p.isDown=false;
delEvent(this.p,GodStep.FRAME_MOVE,this.h_move);
this.p.isClicked=false;
break;
case GodStep.FRAME_OUT:
this.isOvered=false;
this.rescale(1/GodStep.IMAGE_RESOLUTION);
break;
case GodStep.FRAME_OVER:
if(this.isClicked){
this.isOvered=true;
if(this.scaleble){
this.rescale(1.1/GodStep.IMAGE_RESOLUTION);
}
}
break;
}
};
pro.h_move=function(e){
var p=e.content.getLocalPosition(this);
this.over.x=p.x;
this.over.y=p.y;
};
Object.defineProperty(pro,'Scale',{
get:function(){
return this.scale.x;
},
set:function(value){
this.scale.x=
this.scale.y=value;
this.rescale(1/GodStep.IMAGE_RESOLUTION);
}
});
GodStep.BitmapText=function(text,size,x,y,align,tint,font){
PIXI.BitmapText.call(this,text,{font:parseInt(size)+"px "+(font?font:"Font"),align:align||"left"});
this.x=x;
this.y=y;
if(tint)this.tint=tint;
this.updateText();
};
extend(GodStep.BitmapText,PIXI.BitmapText);
GodStep.MovieClip=function(frames,scale,px,py,anchor){
this.frames=frames;
this.animTime=6;
this.animTimer=6;
this.cycle=0;
var tex=GodStep.textures[this.frames[0]];
GodStep.Image.call(this,tex);
this.Scale=this.startS=scale/GodStep.IMAGE_RESOLUTION*GodStep.SCALE;
this.currentFrame=0;
this.totalFrames=frames.length;
if(anchor==0.5){
this.anchor=new PIXI.Point(.5,.5);
}else{
if(anchor){
this.anchor=anchor;
}
}
this.place(px,py);
};
extend(GodStep.MovieClip,GodStep.Image);
pro.animate=function(){
if(this.isAnimate())this.nextFrame();
};
pro.isAnimate=function(){
if(this.animTimer>0){
if(--this.animTimer==0){
this.animTimer=this.animTime;
return true;
}
}
return false;
};
pro.setToFrame=function(frame){
this.currentFrame=frame;
this.setTexture(GodStep.textures[this.frames[frame]]);
};
pro.nextFrame=function(){
this.currentFrame++;
if(this.currentFrame==this.frames.length){
this.currentFrame=0;
this.cycle++;
}
this.setTexture(GodStep.textures[this.frames[this.currentFrame]]);
return this.currentFrame;
};
Games.TextButton=function(text,size,color,px,py,a){
GodStep.Frame.call(this,null,0,0);
this.color=color;
this.size=size;
this.addChild(this.back=new PIXI.Graphics());
this.addChild(this.text=new GodStep.Text(text,size*2,'Arial','left',0xffffff));
this.text.x=-this.text.width/2;
this.text.y=-this.text.height/2;
this.W=this.text.width*1.5;
this.H=this.text.height*1.5;
GodStep.IOverOut.call(this,this.W,this.H);
GodStep.IDownUp.call(this,this.W,this.H);
this.setHitArea(-this.W/2,-this.H/2,this.W,this.H);
this.isSelected=false;
this.redraw();
if(a){
this.x=px+this.W*a.x-this.W/2;
this.y=py+this.H*a.y-this.H/2;
}else{
this.x=px;
this.y=py;
}
addEvent(this,GodStep.FRAME_DOWN,this.h_mouse);
addEvent(this,GodStep.FRAME_OUT,this.h_mouse);
addEvent(this,GodStep.FRAME_OVER,this.h_mouse);
addEvent(this,GodStep.FRAME_OUTSIDE,this.h_mouse);
addEvent(this,GodStep.FRAME_UP,this.h_mouse);
};
extend(Games.TextButton,GodStep.Frame);
pro.destroy=function(){
this.removeChild(this.back);
this.removeChild(this.text);
return this;
};
pro.redraw=function(){
var g=this.back;
g.clear();
g.beginFill(this.color,1);
if(this.isSelected){
g.lineStyle(2,0xffffff,1);
}
g.drawRect(-this.W/2,-this.H/2,this.W,this.H,parseInt(this.size*.5),parseInt(this.size*.5));
g.endFill();
};
pro.rescale=function(s){
this.Scale=s;
};
pro.h_mouse=function(e){
var t=e.content.t;
switch(e.type){
case GodStep.FRAME_DOWN:
if(t.text){
this.rescale(1.1);
this.isClicked=true;
this.isOvered=true;
var p=e.content.getLocalPosition(this);
}
break;
case GodStep.FRAME_OUTSIDE:
this.rescale(1);
this.isClicked=false;
this.isOvered=false;
break;
case GodStep.FRAME_UP:
this.isClicked=false;
this.rescale(1);
dispatch(t,Games.ImgButton.CLICK);
break;
case GodStep.FRAME_OUT:
this.isOvered=false;
this.rescale(1);
break;
case GodStep.FRAME_OVER:
if(this.isClicked){
this.isOvered=true;
this.rescale(1.1);
}
break;
}
};
Object.defineProperty(pro,'Text',{
get:function(){
return this.text.text;
},
set:function(value){
this.text.setText(value);
this.text.updateText();
this.text.x=-this.text.width/2;
}
});
Object.defineProperty(pro,'Selected',{
get:function(){
return this.isSelected;
},
set:function(value){
this.isSelected=value;
this.redraw();
}
});
Games.CellField=function(xc,yc,w,h,cellClass,startS){
GodStep.Frame.call(this,'CellField',w,h);
GodStep.IDownUp.call(this,w,h);
this.startS=startS;
this.cellCountX=xc;
this.cellCountY=yc;
this.cellClass=cellClass;
this.addChild(this.cellContainer=new PIXI.DisplayObjectContainer());
this.addChild(this.objectContainer=new PIXI.DisplayObjectContainer());
this.initField();
};extend(Games.CellField,GodStep.Frame);
pro.initField=function(countX,countY,cW,cH){
var row;
this.cells=[];
this.cellsXY=[];
var cellW=this.cellW=cW||this.W/this.cellCountX;
var cellH=this.cellH=cH||this.H/this.cellCountY;
this.cellCountX=countX||this.cellCountX;
this.cellCountY=countY||this.cellCountY;
var maxW=0,maxH=0;
for(var i=0;i<this.cellCountY;i++){
this.cellsXY.push(row=[]);
for(var j=0;j<this.cellCountX;j++){
if(this.cellClass){
var cell=new this.cellClass(j,i,cellW,cellH,this.startS);
this.addCell(cell,cellW,cellH);
maxW=Math.max(cell.x,maxW);
maxH=Math.max(cell.y,maxH);
addEvent(cell,Games.CELL_UP,this.h_cells);
addEvent(cell,Games.CELL_DOWN,this.h_cells);
}
}
}
};
pro.addCell=function(cell,cellW,cellH){
this.cells.push(cell);this.cellsXY[cell.yi][cell.xi]=cell;
this.addFrame(cell,this.cellContainer);
cell.x=cell.xi*cellW;
cell.y=cell.yi*cellH;
};
pro.getCell=function(xi,yi){
return this.cells[xi+yi*this.cellCountX];
};
pro.h_cells=function(e){
var t=e.target;
var p=t.parent.parent;
switch(e.type){
case Games.CELL_DOWN:
dispatch(p,Games.CELL_DOWN,t);
break;
case Games.CELL_UP:
dispatch(p,Games.CELL_UP,t);
break;
}
};
Games.Cell=function(xi,yi,w,h){
this.xi=xi;
this.yi=yi;
this.guests=[];
GodStep.Frame.call(this,'Cell['+xi+", "+yi+']',w,h);
GodStep.IDownUp.call(this,w,h);
addEvent(this,GodStep.FRAME_UP,this.h_mouse);
addEvent(this,GodStep.FRAME_DOWN,this.h_mouse);
};
Games.CELL_UP='cellup';
Games.CELL_DOWN='celldown';
Games.CELL_CLICK='cellclick';
extend(Games.Cell,GodStep.Frame);
pro.h_mouse=function(e){
var t=e.target;
switch(e.type){
case GodStep.FRAME_UP:
dispatch(t,Games.CELL_UP);
break;
case GodStep.FRAME_DOWN:
dispatch(t,Games.CELL_DOWN);
break;
}
};
Games.Transmission=function(soul,speed,color){
this.soul=soul;
this.color=color||GodStep.COLOR_STAGE;
GodStep.Frame.call(this,'Transmission',soul.SW,soul.SH);
this.startS=this.soul.startS;
this.create();
this.timerCache=-1;
this.speed=speed||0.1;
this.cacheAsBitmap=true;
this.visible=false;
this.graphics.scale.y=this.graphics.oS=this.soul.SH/this.graphics.height*soul.assets.Scale;
};
extend(Games.Transmission,GodStep.Frame);
pro.create=function(){
this.createGraphics();
this.rect(this.W,this.H,this.color,1,0,0);
};
pro.start=function(screenArr,outScreen){
if(!this.isStarted){
this.screens=screenArr;
this.outScreen=outScreen;
this.isStarted=true;
this.isGoesUp=true;
this.alpha=0;
this.visible=true;
}
};
pro.update=function(){
if(this.timerCache--==0){
this.timerCache=-1;
var vis=this.visible;
var a=this.alpha;
this.cacheAsBitmap=false;
this.visible=true;
this.alpha=1;
this.cacheAsBitmap=true;
this.visible=vis;
this.alpha=a;
}
if(this.isStarted){
if(this.isGoesUp){
this.alpha+=this.speed;
if(this.alpha>1){
this.alpha=1;
this.isGoesUp=false;
if(this.outScreen.isOnlyOneView){
this.outScreen.destrukt();
}
this.outScreen.visible=false;
for(var s in this.screens){
this.screens[s].init();
}
}
}else{
this.alpha-=this.speed;
if(this.alpha<=0){
this.alpha=0;
this.visible=false;
this.isStarted=false;
}
}
}
};
pro.reskin=function(c){
this.cacheAsBitmap=false;
var vis=this.visible;
this.visible=true;
var a=this.alpha;
this.alpha=1;
this.graphics.clear();
this.rect(this.W,this.H,c,1,0,0);
this.cacheAsBitmap=true;
this.visible=vis;
this.alpha=a;
};
Object.defineProperty(pro,'Scale',{
get:function(){
return this.scale.x;
},
set:function(value){
this.scale.x=this.scale.y=value;
this.cacheAsBitmap=false;
this.graphics.y=-(this.soul.OH-this.soul.H)/2/value;
if(this.soul.FULLRESIZE){
this.graphics.y=this.graphics.x=0;
}
this.graphics.scale.y=this.graphics.oS*this.soul.OH/this.soul.H;
this.graphics.scale.x=this.graphics.oS*(this.soul.FULLRESIZE?(this.soul.OW/this.soul.W):1);
}
});
GodStep.FPS=function(soul,color,alpha,x,y){
GodStep.Frame.call(this,'FPS',soul.W,soul.H);
this.size=20;
this.addChild(this.text=new GodStep.Text('0',this.size,'Arial','left',color||0x000000));
this.startTime=Date.now();
this.addString((soul.CANVAS)?'C':'W');
this.alpha=alpha;
this.soul=soul;
this.prevTime=this.startTime;
this.msMin=Infinity;
this.msMax=0;
this.fpsMin=Infinity;
this.fpsMax=0;
this.frames=0;
this.lastValue=0;
this.dx=x||0;
this.dy=y||0;
if(alpha==0)this.visible=false;
};
extend(GodStep.FPS,GodStep.Frame);
pro.addString=function(v){
this.plusString=v;
};
pro.end=function(){
var time=Date.now();
var ms=time-this.startTime;
this.msMin=Math.min(this.msMin,ms);
this.msMax=Math.max(this.msMax,ms);
if(time>this.prevTime+100){
var fps=Math.round((this.frames*1000)/(time-this.prevTime));
this.lastValue+=(fps-this.lastValue)*.5;
this.fpsMin=Math.min(this.fpsMin,this.lastValue);
this.fpsMax=Math.max(this.fpsMax,this.lastValue);
this.text.setText(Math.round(this.lastValue)+" "+this.plusString);
this.prevTime=time;
this.frames=0;
}
this.frames++;
};
pro.begin=function(){
this.startTime=Date.now();
};
Object.defineProperty(pro,'Scale',{
get:function(){
return this.scale.x;
},
set:function(value){
this.scale.x=this.scale.y=1;
this.text.updateText();
this.y=this.soul.H-this.text.height+(this.soul.OH-this.soul.H)+this.soul.H*.015*this.soul.startS+this.dy;
this.x=this.soul.W*.02*this.soul.startS+this.dx;
}
});
PR.Lang=function(lang){
var l=lang||'en';
PR.langs=this;
switch(l.toUpperCase()){
case'EN':
this.lang=0;
break;
case'FR':
this.lang=1;
break;
case'PT':
this.lang=2;
break;
case'ES':
this.lang=3;
break;
case'DE':
this.lang=4;
break;
case'NL':
this.lang=5;
break;
case'IT':
this.lang=6;
break;
case'PL':
this.lang=7;
break;
case'RU':
this.lang=8;
break;
case'TR':
this.lang=9;
break;
default:
this.lang=0;
break;
}
switch(l.toUpperCase()){
case'EN':
this.loadingPos=2;
break;
case'DE':
this.loadingPos=3;
break;
case'ES':
this.loadingPos=4;
break;
case'FR':
this.loadingPos=5;
break;
case'IT':
this.loadingPos=6;
break;
case'PT':
this.loadingPos=7;
break;
case'RU':
this.loadingPos=8;
break;
case'TR':
this.loadingPos=9;
break;
case'NL':
this.loadingPos=10;
break;
case'PL':
this.loadingPos=11;
break;
default:
this.loadingPos=0;
break;
}
var s=this.S=[];
var newSymbols=''+''+'';
s['try again']=['Try again!'];
s['no moves']=['No Moves!'];
s['you win']=['You Win!'];
s['tutorial']=['Tutorial'];
s['options']=['Options'];
s['on']=['on'];
s['pause']=['PAUSE'];
s['off']=['off'];
s['victory']=['victory'];
s['new record']=['New Record'];
s['score']=['score'];
s['level']=['level'];
s['levels']=['levels'];
s['save']=['save'];
s['move']=['move'];
s['in']=['in'];
s['moves']=['moves'];
s['critter']=['critter'];
s['critters']=['critters'];
s['game over']=['GAME\nOVER'];
};extend(PR.Lang,Object);
PR.S=function(v){
return PR.langs.S[v][PR.langs.lang];
};
PR.Assets=function(soul){
GodStep.DONT_RESIZE=['Font2'];
GodStep.Preloader.call(this,soul);
this.fontLoaderClass=PR.Font;
};
extend(PR.Assets,GodStep.Preloader);
pro.load=function(){
this.addChild(this.back=GodStep.Image.fromImage(PR.IMAGE_PATH+'back_fundemic1.jpg',this.h_preload));
this.addChild(this.logo=GodStep.Image.fromImage(PR.IMAGE_PATH+'fundemic_logo.png',this.h_preload));
this.addChild(this.loading=GodStep.Image.fromImage(PR.IMAGE_PATH+'loading.png',this.h_preload));
var countLoaded=0;
if(this.back.texture.baseTexture.hasLoaded){
this.back.Scale=this.startS;
this.back.anchor=new PIXI.Point(0.5,0.5);
this.back.place(this.W/2,this.H*.5);
this.back.scale.y=this.soul.OH/this.soul.H*this.startS;
this.back.texture.baseTexture.isLoader=true;
countLoaded++;
}
if(this.logo.texture.baseTexture.hasLoaded){
this.logo.Scale=this.startS;
this.logo.anchor=new PIXI.Point(0.5,0.5);
this.logo.place(this.W/2,this.H*.3);
this.logo.texture.baseTexture.isLoader=true;
countLoaded++;
}
if(this.loading.texture.baseTexture.hasLoaded){
this.loading.Scale=this.startS;
this.loading.anchor=new PIXI.Point(0.5,0.5);
this.loading.place(this.W/2,this.H*.65);
var d=parseInt(this.loading.texture.height/10);
this.loading.texture.setFrame(new PIXI.Rectangle(0,d*(this.soul.lang.lang-2),this.loading.texture.width,d));
countLoaded++;
if(countLoaded==2){
this.init();
}
}
};
pro.init=function(){
var pngs=[
'Font','b_back','lock','lock','hero','hero2','back_menu','cube_lock_1','cube_lock_2','pers_win_1','pers_win_2','pers_win_3','pers_win_4','pers_win_5',
'yellow','red','purple','green','blue','cellBack','back_up','block','delete','dirt','s_blue','s_red','s_green','s_purple','s_yellow','s_bonus','bomb',
'd_green','d_red','d_yellow','d_purple','d_blue','b_1','b_2','b_3','b_4','b_5',
'h_green','h_red','h_yellow','h_purple','h_blue','cube_1s','cube_2s',
'cube_1','down','field_button_m','logo','pers_m_1','pers_m_1_0','b_pause',
'pers_m_2','pers_m_2_0','b_more','b_options','b_play','b_back','b_music','b_sound',
'back_options','pers_1','pers_2','slider_on','slider_off','tutorial_on','tutorial_off',
'slider_off_pause','slider_on_pause','pers_2o','pers_1o','pers_1_0','pers_2_0','back_pause','field_button',
'b_replay','b_menu','pers_l','pers_l1','lock','unlock_1_1','unlock_1_2','unlock_2_1','unlock_2_2','back_levels',
'arm_1','arm_2','b_down','back_game','block','bomb','bonus','cage_1','cage_2','cage_3','cage_4','cage_5',
'cube_1','cube_2','cube_3','cube_4','cube_5','cube_back_1','cube_back_2','field_down','field_fin','field_start','field_up','icon_save','line_right','line_left','star',
'b_next_1','b_next_2','back_fin_animation','back_fail','back_win','field_button2','field_score_fail','field_score_win','field_record',
'fin_animation_1','fin_animation_2','fin_animation_3',
'pers_f_1','pers_f_1_0','pers_f_2','pers_f_2_0','pers_fg_1','pers_fg_1_0','pers_fg_2','pers_fg_2_0','pers_v_1','pers_v_1_0',
'boom_1','boom_2','boom_3','boom_4','boom_5',
];
for(var i=0;i<5;i++){
pngs.push('cage_1_'+(i+1));
pngs.push('cage_2_'+(i+1));
pngs.push('cage_3_'+(i+1));
pngs.push('cage_4_'+(i+1));
pngs.push('cage_5_'+(i+1));
pngs.push('cube_1_'+(i+1));
pngs.push('cube_2_'+(i+1));
pngs.push('cube_3_'+(i+1));
pngs.push('cube_4_'+(i+1));
pngs.push('cube_5_'+(i+1));
pngs.push('net_'+(i+1));
pngs.push('pers_'+(i+1)+'_1');
pngs.push('pers_'+(i+1)+'_2');
pngs.push('pers_'+(i+1)+'_3');
pngs.push('disappear_'+(i+1));
}
var j;
GodStep.Preloader.prototype.loadAll.call(this,
PR.IMAGE_PATH,pngs,[],
PR.SOUND_PATH,['button','miss_tap','bomb','cage','cageout','lose','petard','pop','rescue','start','tap','theme','win'],['Font']);
};
pro.h_preload=function(e){
var img=this.image;
var p=img.parent;
img.Scale=p.startS;
img.anchor=new PIXI.Point(0.5,0.5);
p.preloadState++;
switch(img){
case p.back:
p.back.scale.y=p.soul.OH/p.soul.H*p.startS
p.back.place(p.W/2,p.H*.5);
p.back.texture.baseTexture.isLoader=true;
break;
case p.logo:
p.logo.place(p.W/2,p.H*.3);
p.logo.texture.baseTexture.isLoader=true;
break;
case p.loading:
var d=parseInt(p.loading.texture.height/10);
p.loading.texture.setFrame(new PIXI.Rectangle(0,d*(p.soul.lang.loadingPos-2),p.loading.texture.width,d));
p.loading.place(p.W/2,p.H*.65);
break;
}
if(p.preloadState==2){
p.init();
}
};
PR.Font=function(){
new PR.BitmapFontLoader();
};
extend(PR.Font,PIXI.AssetLoader);
PR.FontString='<font>'+
'<info face="Font" size="59" />'+
'<common lineHeight="59" scaleW="529" scaleH="531" pages="1" />'+
'<pages>'+
'<page id="0" file="Fontt.png" />'+
'</pages>'+
'<chars count="190">'+
'<char id="35" x="261" y="487" width="36" height="41" xoffset="0" yoffset="18" xadvance="40" /><!-- # -->'+
'<char id="33" x="508" y="373" width="11" height="42" xoffset="0" yoffset="17" xadvance="15" /><!-- ! -->'+
'<char id="36" x="261" y="391" width="36" height="51" xoffset="0" yoffset="13" xadvance="40" /><!-- $ -->'+
'<char id="37" x="0" y="347" width="51" height="43" xoffset="0" yoffset="17" xadvance="55" /><!-- % -->'+
'<char id="38" x="143" y="376" width="41" height="42" xoffset="0" yoffset="17" xadvance="45" /><!-- & -->'+
'<char id="39" x="64" y="372" width="9" height="18" xoffset="0" yoffset="18" xadvance="13" /><!-- -->'+
'<char id="40" x="507" y="0" width="16" height="52" xoffset="0" yoffset="17" xadvance="20" /><!-- ( -->'+
'<char id="41" x="507" y="53" width="16" height="52" xoffset="0" yoffset="17" xadvance="20" /><!-- ) -->'+
'<char id="42" x="209" y="507" width="23" height="22" xoffset="0" yoffset="17" xadvance="27" /><!-- * -->'+
'<char id="43" x="365" y="246" width="32" height="32" xoffset="0" yoffset="27" xadvance="36" /><!-- + -->'+
'<char id="44" x="56" y="240" width="11" height="21" xoffset="0" yoffset="48" xadvance="15" /><!-- , -->'+
'<char id="45" x="186" y="218" width="18" height="9" xoffset="0" yoffset="39" xadvance="22" /><!-- - -->'+
'<char id="46" x="52" y="372" width="11" height="11" xoffset="0" yoffset="48" xadvance="15" /><!-- . -->'+
'<char id="47" x="458" y="168" width="25" height="42" xoffset="0" yoffset="17" xadvance="29" /><!-- / -->'+
'<char id="48" x="332" y="119" width="33" height="41" xoffset="0" yoffset="18" xadvance="37" /><!-- 0 -->'+
'<char id="49" x="486" y="434" width="21" height="41" xoffset="0" yoffset="18" xadvance="25" /><!-- 1 -->'+
'<char id="50" x="299" y="161" width="33" height="41" xoffset="0" yoffset="18" xadvance="37" /><!-- 2 -->'+
'<char id="51" x="262" y="306" width="34" height="41" xoffset="0" yoffset="18" xadvance="38" /><!-- 3 -->'+
'<char id="52" x="298" y="119" width="33" height="41" xoffset="0" yoffset="18" xadvance="37" /><!-- 4 -->'+
'<char id="53" x="298" y="255" width="33" height="41" xoffset="0" yoffset="18" xadvance="37" /><!-- 5 -->'+
'<char id="54" x="298" y="77" width="33" height="41" xoffset="0" yoffset="18" xadvance="37" /><!-- 6 -->'+
'<char id="55" x="399" y="317" width="30" height="41" xoffset="0" yoffset="18" xadvance="34" /><!-- 7 -->'+
'<char id="56" x="298" y="213" width="33" height="41" xoffset="0" yoffset="18" xadvance="37" /><!-- 8 -->'+
'<char id="57" x="332" y="77" width="33" height="41" xoffset="0" yoffset="18" xadvance="37" /><!-- 9 -->'+
'<char id="58" x="399" y="43" width="11" height="30" xoffset="0" yoffset="29" xadvance="15" /><!-- : -->'+
'<char id="59" x="485" y="84" width="11" height="40" xoffset="0" yoffset="29" xadvance="15" /><!-- ; -->'+
'<char id="60" x="366" y="431" width="32" height="34" xoffset="0" yoffset="25" xadvance="36" /><!-- < -->'+
'<char id="61" x="176" y="507" width="32" height="23" xoffset="0" yoffset="32" xadvance="36" /><!-- = -->'+
'<char id="62" x="366" y="353" width="32" height="34" xoffset="0" yoffset="25" xadvance="36" /><!-- > -->'+
'<char id="63" x="398" y="117" width="31" height="42" xoffset="0" yoffset="17" xadvance="35" /><!-- ? -->'+
'<char id="89" x="102" y="196" width="42" height="42" xoffset="0" yoffset="17" xadvance="46" /><!-- Y -->'+
'<char id="64" x="60" y="98" width="44" height="43" xoffset="0" yoffset="17" xadvance="48" /><!-- @ -->'+
'<char id="65" x="110" y="44" width="42" height="42" xoffset="0" yoffset="17" xadvance="46" /><!-- A -->'+
'<char id="66" x="224" y="348" width="37" height="42" xoffset="0" yoffset="17" xadvance="41" /><!-- B -->'+
'<char id="67" x="147" y="132" width="40" height="42" xoffset="0" yoffset="17" xadvance="44" /><!-- C -->'+
'<char id="68" x="186" y="175" width="38" height="42" xoffset="0" yoffset="17" xadvance="42" /><!-- D -->'+
'<char id="69" x="297" y="306" width="34" height="42" xoffset="0" yoffset="17" xadvance="38" /><!-- E -->'+
'<char id="70" x="398" y="242" width="31" height="42" xoffset="0" yoffset="17" xadvance="35" /><!-- F -->'+
'<char id="71" x="145" y="185" width="40" height="42" xoffset="0" yoffset="17" xadvance="44" /><!-- G -->'+
'<char id="72" x="262" y="213" width="35" height="42" xoffset="0" yoffset="17" xadvance="39" /><!-- H -->'+
'<char id="73" x="508" y="330" width="11" height="42" xoffset="0" yoffset="17" xadvance="15" /><!-- I -->'+
'<char id="74" x="430" y="317" width="29" height="42" xoffset="0" yoffset="17" xadvance="33" /><!-- J -->'+
'<char id="75" x="144" y="239" width="40" height="42" xoffset="0" yoffset="17" xadvance="44" /><!-- K -->'+
'<char id="76" x="405" y="0" width="30" height="42" xoffset="0" yoffset="17" xadvance="34" /><!-- L -->'+
'<char id="77" x="52" y="329" width="47" height="42" xoffset="0" yoffset="17" xadvance="51" /><!-- M -->'+
'<char id="78" x="262" y="170" width="36" height="42" xoffset="0" yoffset="17" xadvance="40" /><!-- N -->'+
'<char id="79" x="113" y="0" width="41" height="42" xoffset="0" yoffset="17" xadvance="45" /><!-- O -->'+
'<char id="80" x="298" y="458" width="34" height="42" xoffset="0" yoffset="17" xadvance="38" /><!-- P -->'+
'<char id="81" x="143" y="328" width="41" height="47" xoffset="0" yoffset="17" xadvance="45" /><!-- Q -->'+
'<char id="82" x="188" y="84" width="38" height="42" xoffset="0" yoffset="17" xadvance="42" /><!-- R -->'+
'<char id="83" x="226" y="127" width="36" height="42" xoffset="0" yoffset="17" xadvance="40" /><!-- S -->'+
'<char id="84" x="224" y="218" width="37" height="42" xoffset="0" yoffset="17" xadvance="41" /><!-- T -->'+
'<char id="85" x="224" y="261" width="37" height="42" xoffset="0" yoffset="17" xadvance="41" /><!-- U -->'+
'<char id="86" x="155" y="0" width="39" height="42" xoffset="0" yoffset="17" xadvance="43" /><!-- V -->'+
'<char id="87" x="0" y="186" width="56" height="42" xoffset="0" yoffset="17" xadvance="60" /><!-- W -->'+
'<char id="88" x="104" y="142" width="42" height="42" xoffset="0" yoffset="17" xadvance="46" /><!-- X -->'+
'<char id="90" x="224" y="391" width="36" height="42" xoffset="0" yoffset="17" xadvance="40" /><!-- Z -->'+
'<char id="91" x="486" y="277" width="17" height="52" xoffset="0" yoffset="17" xadvance="21" /><!-- [ -->'+
'<char id="92" x="458" y="125" width="25" height="42" xoffset="0" yoffset="17" xadvance="29" /><!-- \ -->'+
'<char id="93" x="504" y="277" width="17" height="52" xoffset="0" yoffset="17" xadvance="21" /><!-- ] -->'+
'<char id="94" x="143" y="419" width="29" height="26" xoffset="0" yoffset="18" xadvance="33" /><!-- ^ -->'+
'<char id="34" x="224" y="434" width="24" height="24" xoffset="0" yoffset="12" xadvance="28" /><!-- " -->'+
'<char id="95" x="0" y="521" width="29" height="3" xoffset="0" yoffset="63" xadvance="33" /><!-- _ -->'+
'<char id="96" x="205" y="218" width="17" height="9" xoffset="0" yoffset="17" xadvance="21" /><!-- ` -->'+
'<char id="97" x="373" y="0" width="31" height="31" xoffset="0" yoffset="28" xadvance="35" /><!-- a -->'+
'<char id="98" x="366" y="388" width="32" height="42" xoffset="0" yoffset="17" xadvance="36" /><!-- b -->'+
'<char id="99" x="398" y="160" width="31" height="31" xoffset="0" yoffset="28" xadvance="35" /><!-- c -->'+
'<char id="100" x="398" y="74" width="31" height="42" xoffset="0" yoffset="17" xadvance="35" /><!-- d -->'+
'<char id="101" x="340" y="0" width="32" height="31" xoffset="0" yoffset="28" xadvance="36" /><!-- e -->'+
'<char id="102" x="485" y="347" width="22" height="43" xoffset="0" yoffset="16" xadvance="26" /><!-- f -->'+
'<char id="103" x="366" y="32" width="32" height="41" xoffset="0" yoffset="28" xadvance="36" /><!-- g -->'+
'<char id="104" x="399" y="359" width="30" height="42" xoffset="0" yoffset="17" xadvance="34" /><!-- h -->'+
'<char id="105" x="508" y="416" width="10" height="42" xoffset="0" yoffset="17" xadvance="14" /><!-- i -->'+
'<char id="106" x="508" y="106" width="15" height="52" xoffset="0" yoffset="17" xadvance="19" /><!-- j -->'+
'<char id="107" x="366" y="466" width="32" height="42" xoffset="0" yoffset="17" xadvance="36" /><!-- k -->'+
'<char id="108" x="508" y="459" width="10" height="42" xoffset="0" yoffset="17" xadvance="14" /><!-- l -->'+
'<char id="109" x="52" y="297" width="47" height="31" xoffset="0" yoffset="28" xadvance="51" /><!-- m -->'+
'<char id="110" x="399" y="477" width="30" height="31" xoffset="0" yoffset="28" xadvance="34" /><!-- n -->'+
'<char id="111" x="366" y="321" width="32" height="31" xoffset="0" yoffset="28" xadvance="36" /><!-- o -->'+
'<char id="112" x="365" y="279" width="32" height="41" xoffset="0" yoffset="28" xadvance="36" /><!-- p -->'+
'<char id="113" x="366" y="107" width="31" height="41" xoffset="0" yoffset="28" xadvance="35" /><!-- q -->'+
'<char id="114" x="457" y="497" width="21" height="31" xoffset="0" yoffset="28" xadvance="25" /><!-- r -->'+
'<char id="115" x="398" y="285" width="30" height="31" xoffset="0" yoffset="28" xadvance="34" /><!-- s -->'+
'<char id="116" x="464" y="0" width="22" height="41" xoffset="0" yoffset="18" xadvance="26" /><!-- t -->'+
'<char id="117" x="399" y="445" width="30" height="31" xoffset="0" yoffset="28" xadvance="34" /><!-- u -->'+
'<char id="118" x="333" y="161" width="32" height="31" xoffset="0" yoffset="28" xadvance="36" /><!-- v -->'+
'<char id="119" x="0" y="391" width="49" height="31" xoffset="0" yoffset="27" xadvance="53" /><!-- w -->'+
'<char id="120" x="333" y="460" width="32" height="31" xoffset="0" yoffset="27" xadvance="36" /><!-- x -->'+
'<char id="121" x="333" y="418" width="32" height="41" xoffset="0" yoffset="27" xadvance="36" /><!-- y -->'+
'<char id="122" x="429" y="285" width="29" height="31" xoffset="0" yoffset="27" xadvance="33" /><!-- z -->'+
'<char id="123" x="484" y="171" width="23" height="52" xoffset="0" yoffset="16" xadvance="27" /><!-- { -->'+
'<char id="124" x="519" y="416" width="9" height="58" xoffset="0" yoffset="12" xadvance="13" /><!-- | -->'+
'<char id="125" x="485" y="224" width="22" height="52" xoffset="0" yoffset="16" xadvance="26" /><!-- } -->'+
'<char id="323" x="332" y="236" width="32" height="49" xoffset="0" yoffset="10" xadvance="36" /><!--  -->'+
'<char id="199" x="365" y="193" width="32" height="52" xoffset="0" yoffset="18" xadvance="36" /><!--  -->'+
'<char id="213" x="185" y="363" width="38" height="49" xoffset="0" yoffset="10" xadvance="42" /><!--  -->'+
'<char id="211" x="195" y="0" width="38" height="49" xoffset="0" yoffset="10" xadvance="42" /><!--  -->'+
'<char id="231" x="461" y="42" width="24" height="41" xoffset="0" yoffset="29" xadvance="28" /><!--  -->'+
'<char id="237" x="508" y="203" width="13" height="42" xoffset="0" yoffset="17" xadvance="17" /><!--  -->'+
'<char id="227" x="460" y="305" width="25" height="41" xoffset="0" yoffset="18" xadvance="29" /><!--  -->'+
'<char id="243" x="399" y="402" width="30" height="42" xoffset="0" yoffset="17" xadvance="34" /><!--  -->'+
'<char id="234" x="430" y="84" width="27" height="42" xoffset="0" yoffset="17" xadvance="31" /><!--  -->'+
'<char id="233" x="430" y="127" width="27" height="42" xoffset="0" yoffset="17" xadvance="31" /><!--  -->'+
'<char id="228" x="458" y="211" width="25" height="40" xoffset="0" yoffset="19" xadvance="29" /><!--  -->'+
'<char id="223" x="430" y="213" width="27" height="43" xoffset="0" yoffset="16" xadvance="31" /><!--  -->'+
'<char id="246" x="430" y="43" width="30" height="40" xoffset="0" yoffset="19" xadvance="34" /><!--  -->'+
'<char id="252" x="458" y="84" width="26" height="40" xoffset="0" yoffset="19" xadvance="30" /><!--  -->'+
'<char id="241" x="430" y="455" width="27" height="41" xoffset="0" yoffset="18" xadvance="31" /><!--  -->'+
'<char id="161" x="487" y="0" width="9" height="41" xoffset="0" yoffset="29" xadvance="13" /><!--  -->'+
'<char id="191" x="486" y="42" width="20" height="41" xoffset="0" yoffset="29" xadvance="24" /><!--  -->'+
'<char id="200" x="460" y="347" width="24" height="49" xoffset="0" yoffset="10" xadvance="28" /><!--  -->'+
'<char id="195" x="262" y="256" width="35" height="49" xoffset="0" yoffset="10" xadvance="39" /><!--  -->'+
'<char id="350" x="459" y="402" width="26" height="52" xoffset="0" yoffset="18" xadvance="30" /><!--  -->'+
'<char id="220" x="398" y="192" width="31" height="49" xoffset="0" yoffset="10" xadvance="35" /><!--  -->'+
'<char id="351" x="486" y="476" width="21" height="41" xoffset="0" yoffset="29" xadvance="25" /><!--  -->'+
'<char id="287" x="430" y="402" width="28" height="52" xoffset="0" yoffset="18" xadvance="32" /><!--  -->'+
'<char id="280" x="459" y="252" width="25" height="52" xoffset="0" yoffset="18" xadvance="29" /><!--  -->'+
'<char id="281" x="458" y="455" width="27" height="41" xoffset="0" yoffset="29" xadvance="31" /><!--  -->'+
'<char id="261" x="436" y="0" width="27" height="41" xoffset="0" yoffset="29" xadvance="31" /><!--  -->'+
'<char id="321" x="430" y="360" width="29" height="41" xoffset="0" yoffset="18" xadvance="33" /><!--  -->'+
'<char id="322" x="508" y="159" width="15" height="43" xoffset="0" yoffset="16" xadvance="19" /><!--  -->'+
'<char id="324" x="430" y="170" width="27" height="42" xoffset="0" yoffset="17" xadvance="31" /><!--  -->'+
'<char id="126" x="50" y="512" width="35" height="14" xoffset="0" yoffset="36" xadvance="39" /><!-- ~ -->'+
'<char id="347" x="486" y="391" width="21" height="42" xoffset="0" yoffset="17" xadvance="25" /><!--  -->'+
'<char id="1072" x="332" y="319" width="32" height="32" xoffset="0" yoffset="27" xadvance="36" /><!--  -->'+
'<char id="1073" x="263" y="94" width="34" height="44" xoffset="0" yoffset="15" xadvance="38" /><!--  -->'+
'<char id="1074" x="332" y="203" width="32" height="32" xoffset="0" yoffset="27" xadvance="36" /><!--  -->'+
'<char id="1075" x="430" y="497" width="26" height="32" xoffset="0" yoffset="27" xadvance="30" /><!--  -->'+
'<char id="1076" x="153" y="43" width="39" height="40" xoffset="0" yoffset="27" xadvance="43" /><!--  -->'+
'<char id="1077" x="227" y="94" width="34" height="32" xoffset="0" yoffset="27" xadvance="38" /><!--  -->'+
'<char id="1078" x="0" y="229" width="55" height="32" xoffset="0" yoffset="27" xadvance="59" /><!--  -->'+
'<char id="1079" x="333" y="385" width="32" height="32" xoffset="0" yoffset="27" xadvance="36" /><!--  -->'+
'<char id="1080" x="333" y="492" width="32" height="32" xoffset="0" yoffset="27" xadvance="36" /><!--  -->'+
'<char id="1082" x="264" y="44" width="34" height="32" xoffset="0" yoffset="27" xadvance="38" /><!--  -->'+
'<char id="1083" x="271" y="0" width="34" height="32" xoffset="0" yoffset="27" xadvance="38" /><!--  -->'+
'<char id="1084" x="99" y="493" width="41" height="32" xoffset="0" yoffset="27" xadvance="45" /><!--  -->'+
'<char id="1085" x="333" y="33" width="32" height="32" xoffset="0" yoffset="27" xadvance="36" /><!--  -->'+
'<char id="1086" x="298" y="425" width="34" height="32" xoffset="0" yoffset="27" xadvance="38" /><!--  -->'+
'<char id="1087" x="333" y="352" width="32" height="32" xoffset="0" yoffset="27" xadvance="36" /><!--  -->'+
'<char id="1088" x="298" y="382" width="34" height="42" xoffset="0" yoffset="27" xadvance="38" /><!--  -->'+
'<char id="1089" x="193" y="50" width="33" height="32" xoffset="0" yoffset="27" xadvance="37" /><!--  -->'+
'<char id="1090" x="332" y="286" width="32" height="32" xoffset="0" yoffset="27" xadvance="36" /><!--  -->'+
'<char id="1091" x="262" y="348" width="34" height="42" xoffset="0" yoffset="27" xadvance="38" /><!--  -->'+
'<char id="1092" x="0" y="423" width="49" height="53" xoffset="0" yoffset="16" xadvance="53" /><!--  -->'+
'<char id="1093" x="141" y="493" width="34" height="32" xoffset="0" yoffset="27" xadvance="38" /><!--  -->'+
'<char id="1094" x="225" y="171" width="36" height="40" xoffset="0" yoffset="27" xadvance="40" /><!--  -->'+
'<char id="1095" x="366" y="74" width="31" height="32" xoffset="0" yoffset="27" xadvance="35" /><!--  -->'+
'<char id="1096" x="50" y="479" width="48" height="32" xoffset="0" yoffset="27" xadvance="52" /><!--  -->'+
'<char id="1097" x="0" y="306" width="51" height="40" xoffset="0" yoffset="27" xadvance="55" /><!--  -->'+
'<char id="1100" x="366" y="149" width="31" height="32" xoffset="0" yoffset="27" xadvance="35" /><!--  -->'+
'<char id="1099" x="99" y="372" width="43" height="32" xoffset="0" yoffset="27" xadvance="47" /><!--  -->'+
'<char id="1101" x="306" y="0" width="33" height="32" xoffset="0" yoffset="27" xadvance="37" /><!--  -->'+
'<char id="1102" x="52" y="262" width="48" height="34" xoffset="0" yoffset="26" xadvance="52" /><!--  -->'+
'<char id="1103" x="297" y="349" width="34" height="32" xoffset="0" yoffset="27" xadvance="38" /><!--  -->'+
'<char id="1052" x="0" y="477" width="49" height="43" xoffset="0" yoffset="16" xadvance="53" /><!--  -->'+
'<char id="1040" x="65" y="44" width="44" height="43" xoffset="0" yoffset="16" xadvance="48" /><!--  -->'+
'<char id="1043" x="299" y="33" width="33" height="43" xoffset="0" yoffset="16" xadvance="37" /><!--  -->'+
'<char id="1047" x="185" y="228" width="38" height="43" xoffset="0" yoffset="16" xadvance="42" /><!--  -->'+
'<char id="1048" x="184" y="463" width="38" height="43" xoffset="0" yoffset="16" xadvance="42" /><!--  -->'+
'<char id="1053" x="188" y="127" width="37" height="43" xoffset="0" yoffset="16" xadvance="41" /><!--  -->'+
'<char id="1051" x="142" y="449" width="41" height="43" xoffset="0" yoffset="16" xadvance="45" /><!--  -->'+
'<char id="1062" x="100" y="297" width="42" height="53" xoffset="0" yoffset="16" xadvance="46" /><!--  -->'+
'<char id="1059" x="68" y="0" width="44" height="43" xoffset="0" yoffset="16" xadvance="48" /><!--  -->'+
'<char id="1050" x="105" y="88" width="42" height="43" xoffset="0" yoffset="16" xadvance="46" /><!--  -->'+
'<char id="1041" x="148" y="87" width="39" height="43" xoffset="0" yoffset="16" xadvance="43" /><!--  -->'+
'<char id="1061" x="57" y="196" width="44" height="43" xoffset="0" yoffset="16" xadvance="48" /><!--  -->'+
'<char id="1063" x="223" y="463" width="37" height="43" xoffset="0" yoffset="16" xadvance="41" /><!--  -->'+
'<char id="1044" x="57" y="142" width="46" height="53" xoffset="0" yoffset="16" xadvance="50" /><!--  -->'+
'<char id="1042" x="184" y="419" width="39" height="43" xoffset="0" yoffset="16" xadvance="43" /><!--  -->'+
'<char id="1055" x="224" y="304" width="37" height="43" xoffset="0" yoffset="16" xadvance="41" /><!--  -->'+
'<char id="1057" x="99" y="449" width="42" height="43" xoffset="0" yoffset="16" xadvance="46" /><!--  -->'+
'<char id="1056" x="234" y="0" width="36" height="43" xoffset="0" yoffset="16" xadvance="40" /><!--  -->'+
'<char id="1058" x="185" y="272" width="38" height="43" xoffset="0" yoffset="16" xadvance="42" /><!--  -->'+
'<char id="1054" x="99" y="405" width="43" height="43" xoffset="0" yoffset="16" xadvance="47" /><!--  -->'+
'<char id="304" x="519" y="475" width="8" height="49" xoffset="0" yoffset="10" xadvance="12" /><!--  -->'+
'<char id="1068" x="261" y="443" width="36" height="43" xoffset="0" yoffset="16" xadvance="40" /><!--  -->'+
'<char id="1046" x="0" y="0" width="67" height="43" xoffset="0" yoffset="16" xadvance="71" /><!--  -->'+
'<char id="1045" x="227" y="50" width="36" height="43" xoffset="0" yoffset="16" xadvance="40" /><!--  -->'+
'<char id="224" x="185" y="316" width="38" height="46" xoffset="0" yoffset="13" xadvance="42" /><!--  -->'+
'<char id="236" x="484" y="125" width="23" height="45" xoffset="0" yoffset="13" xadvance="27" /><!--  -->'+
'<char id="1060" x="50" y="435" width="48" height="43" xoffset="0" yoffset="16" xadvance="52" /><!--  -->'+
'<char id="1064" x="0" y="98" width="59" height="43" xoffset="0" yoffset="16" xadvance="63" /><!--  -->'+
'<char id="1065" x="0" y="44" width="64" height="53" xoffset="0" yoffset="16" xadvance="68" /><!--  -->'+
'<char id="1066" x="50" y="391" width="48" height="43" xoffset="0" yoffset="16" xadvance="52" /><!--  -->'+
'<char id="1067" x="0" y="262" width="51" height="43" xoffset="0" yoffset="16" xadvance="55" /><!--  -->'+
'<char id="1069" x="101" y="240" width="42" height="43" xoffset="0" yoffset="16" xadvance="46" /><!--  -->'+
'<char id="1070" x="0" y="142" width="56" height="43" xoffset="0" yoffset="16" xadvance="60" /><!--  -->'+
'<char id="1071" x="143" y="284" width="41" height="43" xoffset="0" yoffset="16" xadvance="45" /><!--  -->'+
'<char id="32" x="0" y="0" width="0" height="0" xoffset="0" yoffset="0" xadvance="25" /><!--   -->'+
'<char id="9" x="0" y="0" width="0" height="0" xoffset="0" yoffset="0" xadvance="200" /><!--   -->'+
'</chars>'+
'<kernings count="0">'+
'</kernings>'+
'</font>';
PR.BitmapFontLoader=function(){
var xmlDoc;
if(window.DOMParser){
var parser=new DOMParser();
xmlDoc=parser.parseFromString(PR.FontString,"text/xml");
}
else{
xmlDoc=new ActiveXObject("Microsoft.XMLDOM");
xmlDoc.async=false;
xmlDoc.loadXML(PR.FontString);
}
var responseXML=xmlDoc;
var textureUrl=this.baseUrl+responseXML.getElementsByTagName('page')[0].getAttribute('file');
this.texture=GodStep.textures['Font'].baseTexture;
var data={};
var info=responseXML.getElementsByTagName('info')[0];
var common=responseXML.getElementsByTagName('common')[0];
data.font=info.getAttribute('face');
data.size=parseInt(info.getAttribute('size'),10);
data.lineHeight=parseInt(common.getAttribute('lineHeight'),10);
data.chars={};
var letters=responseXML.getElementsByTagName('char');
for(var i=0;i<letters.length;i++)
{
var charCode=parseInt(letters[i].getAttribute('id'),10);
var textureRect=new PIXI.Rectangle(
parseInt(letters[i].getAttribute('x'),10),
parseInt(letters[i].getAttribute('y'),10),
parseInt(letters[i].getAttribute('width'),10),
parseInt(letters[i].getAttribute('height'),10)
);
data.chars[charCode]={
xOffset:parseInt(letters[i].getAttribute('xoffset'),10),
yOffset:parseInt(letters[i].getAttribute('yoffset'),10)+20,
xAdvance:parseInt(letters[i].getAttribute('xadvance'),10),
kerning:{},
texture:PIXI.TextureCache[charCode]=new PIXI.Texture(this.texture,textureRect)
};
}
var kernings=responseXML.getElementsByTagName('kerning');
for(i=0;i<kernings.length;i++)
{
var first=parseInt(kernings[i].getAttribute('first'),10);
var second=parseInt(kernings[i].getAttribute('second'),10);
var amount=parseInt(kernings[i].getAttribute('amount'),10);
data.chars[second].kerning[first]=amount;
}
PIXI.BitmapText.fonts[data.font]=data;
};
extend(PR.BitmapFontLoader,PIXI.BitmapFontLoader);
PR.Text=function(text,size,x,y,align,tint){
PIXI.BitmapText.call(this,text,{font:parseInt(size)+"px Font",align:align||"left"});
this.x=x;
this.y=y;
if(tint)this.tint=tint;
this.updateText();
};
extend(PR.Text,PIXI.BitmapText);
GodStep.Slider=function(w,h,s,type,min,max,val,n,cw){
GodStep.Frame.call(this,'Slider');
GodStep.IOverOut.call(this);
GodStep.IDownUp.call(this);
this.CW=cw||20;
this.min=min||0;
this.max=max||1;
this.delta=this.max-this.min;
this.W=w;
this.H=h*s;
this.type=type;
this.isFloat=(type>0&&type<1);
this.back=this.createGraphics('back');
this.cursor=this.createGraphics('cursor');
this.label=this.addFrame(new GodStep.Text(n||'',h*s,'Arial','left',0x0));
this.valueText=this.addFrame(new GodStep.Text(val||'',h*s,'Arial','left',0x0));
this.valueText.y=this.label.y=-this.H;
GodStep.IDownUp.call(this.cursor);
GodStep.addEvent(this,GodStep.FRAME_OUT,this.h_back);
GodStep.addEvent(this,GodStep.FRAME_OVER,this.h_back);
GodStep.addEvent(this,GodStep.FRAME_UP,this.h_cursor);
GodStep.addEvent(this,GodStep.FRAME_MOVE,this.h_move);
GodStep.addEvent(this.cursor,GodStep.FRAME_DOWN,this.h_cursor);
this.setHitArea(0,0,this.W,this.H);
this.setHitArea(0,0,this.CW,this.H,this.cursor);
this.redrawBack();
this.redraw();
this.Value=val;
};
extend(GodStep.Slider,GodStep.Frame);
pro.redrawBack=function(){
if(!this.cursor.IsDown){
this.back.clear();
this.rect(this.W,this.H,(this.IsOver)?0xff4444:0xffaaaa,.8,0,0,this.back);
}
};
pro.redraw=function(){
this.cursor.clear();
this.rect(this.CW,this.H,(this.cursor.IsDown)?0x00ff00:0xffffff,.8,0,0,this.cursor);
};
pro.h_back=function(e){
e.target.redrawBack();
};
pro.h_move=function(e){
var t=e.content.t;
var power;
var dv;
if(e.content.getLocalPosition){
var point=e.content.getLocalPosition(t);
if(t.cursor.IsDown){
power=1;
t.cursor.position.x=Math.max(0,Math.min(point.x-t.cursor.downPoint.x,t.W-t.CW));
dv=(t.cursor.position.x/(t.W-t.CW))*(t.delta)+t.min-t.lastValue;
t.value=t.lastValue+dv*power;
GodStep.dispatch(t,GodStep.FRAME_CHANGED);
if(t.type=='int'){
t.value=parseInt(t.value);
}else{
if(t.isFloat){
t.value=parseInt(t.value/t.type)*t.type;
}else{
t.value=parseInt(t.value/t.type)*t.type;
}
}
t.valueText.setText(t.value);
t.valueText.updateText();
t.valueText.x=t.W-t.valueText.width;
t.updateCursor();
}
}
};
pro.h_cursor=function(e){
if(e.content.t instanceof GodStep.Slider){
e.content.t.cursor.IsDown=false;
e.content.t.redraw();
e.content.t.lastValue=e.content.t.value;
}else{
e.content.t.parent.redraw();
e.content.t.lastValue=e.content.t.value;
}
};
pro.updateCursor=function(){
this.cursor.x=((this.value-this.min)/(this.delta))*(this.W-this.CW);
};
Object.defineProperty(GodStep.Slider.prototype,'IsDown',{
set:function(value){
this.cursor.IsDown=false;
this.redraw();
this.redrawBack();
}
});
Object.defineProperty(GodStep.Slider.prototype,'Value',{
get:function(){
return this.value;
},
set:function(value){
this.value=value;
if(this.type=='int'){
this.value=parseInt(this.value);
}else{
if(this.isFloat){
this.value=parseInt(this.value/this.type)*this.type;
}else{
this.value=parseInt(this.value/this.type)*this.type;
}
}
this.lastValue=this.value;
this.valueText.setText(this.value);
this.valueText.updateText();
this.valueText.x=this.W-this.valueText.width;
this.updateCursor();
}
});
PR.Dev=function(soul){
GodStep.LFrame.call(this,soul,'Dev');
GodStep.IDownUp.call(this,soul.W,soul.H);
this.addFrame(this.back=new PR.Background(this));
this.addChild(this.container=new PIXI.DisplayObjectContainer());
this.addChild(this.fieldContainer=new PIXI.DisplayObjectContainer());
this.fieldContainer.addChild(this.field=new PR.Field(soul,9,9,.85));
this.container.addChild(this.b_back=new Games.TextButton('back',30*this.s,0x562466,soul.W*.1,soul.H*.05));
this.container.addChild(this.b_test=new Games.TextButton('[test]',30*this.s,0x567766,soul.W*.1,soul.H*.05));
this.container.addChild(this.b_save=new Games.TextButton('save',30*this.s,0x882466,soul.W*.1,soul.H*.05));
this.container.addChild(this.b_add=new Games.TextButton('add row',30*this.s,0x889966,soul.W*.1,soul.H*.05));
this.container.addChild(this.b_del=new Games.TextButton('del row',30*this.s,0x889966,soul.W*.1,soul.H*.05));
addEvent(this,GodStep.FRAME_UP,this.h_mouse_up);
addEvent(this.b_back,Games.ImgButton.CLICK,this.h_buttons);
addEvent(this.b_test,Games.ImgButton.CLICK,this.h_buttons);
addEvent(this.b_save,Games.ImgButton.CLICK,this.h_buttons);
addEvent(this.b_add,Games.ImgButton.CLICK,this.h_buttons);
addEvent(this.b_del,Games.ImgButton.CLICK,this.h_buttons);
this.container.addChild(this.rowsText=new PR.Text('',150*this.s,this.W*.5,-this.H*.025,'left',0xffffff));
var S=this.s;
this.standart=[];
var cell;
this.s*=.6;
var dy=.072;
for(var i=0;i<PR.Cell.STANDART.length;i++){
cell=new Games.ImgButton(PR.Cell.STANDART[i],this,this.W*.88,this.H*dy*i+this.H*.15);
this.container.addChild(cell);
this.standart.push(cell);
addEvent(cell,Games.ImgButton.CLICK,this.h_colors);
this.container.addChild(this['s_'+i]=new Games.ImgButton(PR.Cell.STANDART[i],this,this.W*.1+i*.1*this.W,this.H*.95));
this.container.addChild(this['b_'+i]=new Games.ImgButton(PR.Cell.STANDART[i],this,this.W*.96,this.H*dy*i+this.H*.15));
addEvent(this['b_'+i],Games.ImgButton.CLICK,this.h_buttons);
addEvent(this['s_'+i],Games.ImgButton.CLICK,this.h_selectors);
this['b_'+i].alpha=.2;
this['s_'+i].alpha=.2;
}
this.container.addChild(this.b_block=new Games.ImgButton('block',this,this.W*.91,this.H*dy*5+this.H*.15));
this.container.addChild(this.b_delete=new Games.ImgButton('delete',this,this.W*.91,this.H*dy*6+this.H*.15));
this.container.addChild(this.b_setka=new Games.ImgButton('dirt',this,this.W*.91,this.H*dy*7+this.H*.15));
this.container.addChild(this.b_bonus=new Games.ImgButton('s_bonus',this,this.W*.91,this.H*dy*8+this.H*.15));
this.container.addChild(this.b_bomb=new Games.ImgButton('bomb',this,this.W*.91,this.H*dy*9+this.H*.15));
this.container.addChild(this.b_hero=new Games.ImgButton('hero',this,this.W*.91,this.H*dy*10+this.H*.15));
this.container.addChild(this.b_hero2=new Games.ImgButton('hero2',this,this.W*.91,this.H*dy*11+this.H*.15));
this['s_'+0].alpha=1;
var sliderW=soul.W*.6;
var sliderH=35;
this.container.addChild(this.s_stepLimit=new GodStep.Slider(sliderW,sliderH,S,'int',0,150,0,'steps target'));
this.s_stepLimit.y=this.H*.82;
this.s_stepLimit.x=this.W*.04;
this.selector=0;
this.container.addChild(this.b_bonus_disable=new Games.ImgButton('s_bonus',this,this.W*.2,this.H*.88));
this.container.addChild(this.b_bomb_disable=new Games.ImgButton('bomb',this,this.W*.3,this.H*.88));
this.s=S;
addEvent(this.b_bonus_disable,Games.ImgButton.CLICK,this.h_buttons);
addEvent(this.b_bomb_disable,Games.ImgButton.CLICK,this.h_buttons);
addEvent(this.b_setka,Games.ImgButton.CLICK,this.h_buttons);
addEvent(this.b_delete,Games.ImgButton.CLICK,this.h_buttons);
addEvent(this.b_block,Games.ImgButton.CLICK,this.h_buttons);
addEvent(this.b_bonus,Games.ImgButton.CLICK,this.h_buttons);
addEvent(this.b_bomb,Games.ImgButton.CLICK,this.h_buttons);
addEvent(this.b_hero,Games.ImgButton.CLICK,this.h_buttons);
addEvent(this.b_hero2,Games.ImgButton.CLICK,this.h_buttons);
addEvent(this.field,Games.CELL_DOWN,this.h_cells);
addEvent(this.field,GodStep.FRAME_DOWN,this.h_field);
addEvent(this.field,GodStep.FRAME_MOVE,this.h_field);
addEvent(this.field,GodStep.FRAME_UP,this.h_field);
this.addChild(this.maska=new PIXI.Graphics());
this.addChild(this.top=new PIXI.Graphics());
var fw=this.field.W*PR.CELLW_SCALE*this.field.scale.x;
var fd=-this.W*.005;
this.maska.beginFill(0,1);
this.maska.drawRect(fd,fd,fw-fd*2,fw-fd*2);
this.maska.endFill();
this.top.lineStyle(2,0,1);
this.top.drawRect(fd,fd,fw-fd*2,fw-fd*2);
this.top.endFill();
this.field.mask=this.maska;
this.instrument='';
this.colors=[0,1,2,3,4];
};
extend(PR.Dev,GodStep.Frame);
pro.update=function(){
if(this.visible){
}
};
pro.init=function(){
this.visible=true;
this.updateRowText();
this.clearInstruments();
GodStep.ISEDITMODE=true;
var level=GodStep.TEST_DATA||PR.PetResque.instance.SETTINGS.levels[PR.LAST_LEVEL_SELECTED];
if(level){
this.field.setData(level);
this.s_stepLimit.Value=level.params.steps||0;
} else {
 this.field.clear();
}
this.b_bonus_disable.alpha=(this.field.isBonus)?1:.2;
this.b_bomb_disable.alpha=(this.field.isBomb)?1:.2;
var i;
for(i=0;i<this.standart.length;i++){
this.standart[i].alpha=.2;
}
this.colors=[];
for(i=0;i<this.field.colors.length;i++){
this.standart[this.field.colors[i]].alpha=1;
this.colors.push(this.field.colors[i]);
}
GodStep.TEST_DATA=null;
};
pro.clearInstruments=function(){
this.b_setka.alpha=
this.b_delete.alpha=
this.b_block.alpha=
this.b_bonus.alpha=
this.b_hero2.alpha=
this.b_hero.alpha=
this.b_bomb.alpha=.2;
for(var i=0;i<5;i++){
this['b_'+i].alpha=.2;
}
this.instrument='';
};
pro.updateRowText=function(){
this.rowsText.setText(''+this.field.cellCountY);
this.rowsText.updateText();
this.rowsText.x=this.W*.98-this.rowsText.width;
};
pro.h_field=function(e){
var t=e.target;
var p;
switch(e.type){
case GodStep.FRAME_DOWN:
t.isFieldDown=true;
t.down=e.content.getLocalPosition(t.parent);
break;
case GodStep.FRAME_UP:
t.isFieldDown=false;
break;
case GodStep.FRAME_MOVE:
if(t.isFieldDown){
p=e.content.getLocalPosition(t.parent.parent);
t.parent.y=Math.min(0,Math.max((t.SH-t.H)*t.scale.x,p.y-t.down.y));
}
break;
}
};
pro.h_cells=function(e){
var t=e.target;
var p=t.parent.parent;
var cell=e.content.data;
trace(cell.xi+" "+cell.yi);
switch(e.type){
case Games.CELL_DOWN:
if(p.instrument!=''){
p.field.addCellObject(new PR.CellObject(p.instrument,p.s,cell,null,null,p.selector+1));
}else{
cell.clear();
}
break;
}
};
pro.h_buttons=function(e){
var t=e.content.t;
var p=t.parent.parent;
var s=p.soul;
var data;
switch(t){
case p.b_bonus_disable:
case p.b_bomb_disable:
t.alpha=(t.alpha==1)?.2:1;
break;
case p.b_0:
case p.b_1:
case p.b_2:
case p.b_3:
case p.b_4:
case p.b_bonus:
case p.b_delete:
case p.b_block:
case p.b_bomb:
case p.b_hero2:
case p.b_hero:
case p.b_setka:
if(t.alpha==1){
p.clearInstruments();
}else{
p.clearInstruments();
p.instrument=t.imgName;
t.alpha=1;
}
p.field.isBomb=(p.b_bomb_disable.alpha==1);
p.field.isBonus=(p.b_bonus_disable.alpha==1);
break;
case p.b_del:
p.field.delLine();
p.updateRowText();
break;
case p.b_add:
p.field.addLine();
p.updateRowText();
break;
case p.b_test:
GodStep.DEVMODE=true;
data=GodStep.TEST_DATA=p.field.getData();
data.params={colors:p.colors,steps:p.s_stepLimit.Value,isBomb:p.b_bomb_disable.alpha==1,isBonus:p.b_bonus_disable.alpha==1};
s.screenTo([s.gameplay],p);
break;
case p.b_save:
var settings=PR.PetResque.instance.SETTINGS;
PR.LAST_LEVEL_SELECTED;
data=settings.levels[PR.LAST_LEVEL_SELECTED]=p.field.getData();
data.params={colors:p.colors,steps:p.s_stepLimit.Value,isBomb:p.b_bomb_disable.alpha==1,isBonus:p.b_bonus_disable.alpha==1};
p.soul.saveSettings();
break;
case p.b_back:
GodStep.ISEDITMODE=false;
GodStep.DEVMODE=false;
s.screenTo([s.startmenu],p);
break;
}
};
pro.h_mouse_up=function(e){
var t=e.content.target;
if(t.standart){
for(var i=0;i<t.standart.length;i++){
t.standart[i].Scale=1;
t.standart[i].isDown=false;
}
t.s_stepLimit.IsDown=false;
t.b_bomb.isDown=t.b_bonus.isDown=t.b_add.isDown=t.b_del.isDown=t.b_test.isDown=t.b_back.isDown=t.b_save.isDown=false;
t.b_bomb.Scale=t.b_bonus.Scale=t.b_add.Scale=t.b_del.Scale=t.b_test.Scale=t.b_back.Scale=t.b_save.Scale=1;
}
};
pro.h_selectors=function(e){
var t=e.target;
var p=t.parent.parent;
var id;
for(var i=0;i<5;i++){
if(t==p['s_'+i]){
id=i;
}
p['s_'+i].alpha=0.2;
}
p.selector=id;
t.alpha=1;
};
pro.h_colors=function(e){
var t=e.target;
t.alpha=(t.alpha==1)?.2:1;
var p=t.parent.parent;
p.colors=[];
for(var i=0;i<p.standart.length;i++){
if(p.standart[i].alpha==1){
p.colors.push(i);
}
}
};
Object.defineProperty(pro,'Scale',{
get:function(){
return this.scale.x;
},
set:function(value){
this.scale.x=this.scale.y=value;
this.back.rescale(value);
this.b_back.x=this.W*.1;
this.b_save.x=this.b_back.x+this.b_back.width*1.1;
this.b_test.x=this.b_save.x+this.b_save.width*1.1;
this.b_add.x=this.b_test.x+this.b_test.width*1.4;
this.b_del.x=this.b_add.x+this.b_add.width*1.05;
this.top.x=this.maska.x=this.field.x=(this.W-this.field.W*PR.CELLW_SCALE)*.5;
this.container.y=-this.soul.DOH/2/value;
this.top.y=this.maska.y=this.field.y=(this.soul.H*.11-this.soul.DOH/2)/value;
}
});
PR.Field=function(soul,xc,yc,s,p){
Games.CellField.call(this,xc,yc,soul.W*.95,soul.W*.95,PR.Cell,soul.startS);
this.cellObjects=[];
this.soul=soul;
this.lines=[];
this.heroes=[];
this.scale.x=this.scale.y=s;
this.SH=this.H;
this.addChild(this.heroContainer=new PIXI.DisplayObjectContainer());
this.isTutorial=false;
if(p){
p.topSprite.addChild(this.arm=new GodStep.MovieClip(['arm_1','arm_2'],soul.startS,this.W*.51,-this.H*.5,new PIXI.Point(0,0)));
this.arm.sy=this.H*.045;
this.arm.sx=this.W*.51;
this.arm.animTime=20;
}
this.colors=[0,1,2,3,4];
};extend(PR.Field,Games.CellField);
pro.delLine=function(){
if(this.cellCountY>3){
for(var i=0;i<this.cellCountX;i++){
var cell=this.cells[(this.cellCountY-1)*this.cellCountX+i];
this.clearCell(cell);
this.cellContainer.removeChild(cell);
delEvent(cell,Games.CELL_UP,this.h_cells);
delEvent(cell,Games.CELL_DOWN,this.h_cells);
}
this.cells.splice((this.cellCountY-1)*this.cellCountX,this.cellCountX);
this.cellsXY.splice(this.cellCountY-1,1);
this.cellCountY--;
}
this.H=cell.y;
this.setHitArea(0,0,this.W,this.H);
};
pro.addLine=function(){
var cellW=this.W/this.cellCountX*PR.CELLW_SCALE;
var cellH=this.W/this.cellCountX*PR.CELLW_SCALE;
this.cellsXY[this.cellCountY]=[];
var maxW=0,maxH=0;
for(var i=0;i<this.cellCountX;i++){
var cell=new this.cellClass(i,this.cellCountY,cellW,cellH,this.startS);
this.addCell(cell,cellW,cellH);
maxW=Math.max(cell.x,maxW);
maxH=Math.max(cell.y,maxH);
addEvent(cell,Games.CELL_UP,this.h_cells);
addEvent(cell,Games.CELL_DOWN,this.h_cells);
}
this.cellCountY++;
this.H=maxH+cellW;
this.setHitArea(0,0,this.W,this.H);
};
pro.initTutorial=function(v){
var p=this.arm.parent;
p.removeChild(this.arm);
p.addChildAt(this.arm,p.children.length-2);
this.animPhase=0;
this.arm.visible=this.isTutorial=(v&&(PR.LAST_LEVEL_SELECTED==0|PR.LAST_LEVEL_SELECTED==4||PR.LAST_LEVEL_SELECTED==11));
};
pro.update=function(){
if(this.isTutorial){
this.arm.animate();
var s=1;
var y=this.y+this.soul.DOH/2/this.soul.gameplay.scale.x;
switch(PR.LAST_LEVEL_SELECTED){
case 0:
this.arm.x+=((this.cellW*0*this.scale.x+this.arm.sx)*s-this.arm.x)*.3;
switch(this.animPhase){
case 0:
this.completeCell=new PIXI.Point(4,2);
this.arm.y+=((y+this.cellW*2*this.scale.x+this.arm.sy)*s-this.arm.y)*.3;
break;
case 1:
this.completeCell=new PIXI.Point(4,5);
this.arm.y+=((y+this.cellW*5*this.scale.x+this.arm.sy)*s-this.arm.y)*.3;
break;
case 2:
this.completeCell=new PIXI.Point(4,8);
this.arm.y+=((y+this.cellW*8*this.scale.x+this.arm.sy)*s-this.arm.y)*.3;
break;
case 3:
this.arm.visible=false;
this.completeCell=null;
break;
}
break;
case 4:
switch(this.animPhase){
case 0:
this.arm.x+=((this.cellW*0*this.scale.x+this.arm.sx)*s-this.arm.x)*.3;
this.completeCell=new PIXI.Point(0,4);
this.arm.y+=((y+this.cellW*6*this.scale.x+this.arm.sy)*s-this.arm.y)*.3;
break;
case 1:
this.arm.x+=((this.cellW*-4*this.scale.x+this.arm.sx)*s-this.arm.x)*.3;
this.completeCell=new PIXI.Point(0,8);
this.arm.y+=((y+this.cellW*8*this.scale.x+this.arm.sy)*s-this.arm.y)*.3;
break;
case 2:
this.arm.visible=false;
this.completeCell=null;
break;
}
break;
case 11:
switch(this.animPhase){
case 0:
this.arm.x+=((this.cellW*-3*this.scale.x+this.arm.sx)*s-this.arm.x)*.3;
this.completeCell=new PIXI.Point(1,0);
this.arm.y+=((y+this.cellW*0*this.scale.x+this.arm.sy)*s-this.arm.y)*.3;
break;
case 1:
this.arm.x+=((this.cellW*3*this.scale.x+this.arm.sx)*s-this.arm.x)*.3;
this.completeCell=new PIXI.Point(7,3);
this.arm.y+=((y+this.cellW*3*this.scale.x+this.arm.sy)*s-this.arm.y)*.3;
break;
case 2:
this.arm.visible=false;
this.completeCell=null;
break;
}
break;
}
}
};
pro.reskin=function(skin){
var v=1;
for(var i=0;i<this.cells.length;i++){
this.cells[i].img.setTexture('sq'+skin+'_'+v);
this.cells[i].v=v;
v=(v==1)?2:1;
}
};
pro.initField=function(countX,countY,cW,cH){
var cellW=this.cellW=this.W/this.cellCountX*PR.CELLW_SCALE;
Games.CellField.prototype.initField.call(this,countX,countY,cellW,cellW);
};
pro.fill=function(){
var cells=this.cells;
};
pro.clear=function(){
while(this.cellObjects.length){
this.delFrame(this.cellObjects[0].destroy());
this.cellObjects.splice(0,1);
}
for(var i=0;i<this.cells.length;i++){
this.cells[i].clear();
this.cells[i].Selected=false;
}
};
pro.getRandomColors=function(){
var randomColors=[];
var colors=[];
for(var j=0;j<this.colors.length;j++){
colors.push(this.colors[j]);
}
while(colors.length){
var id=parseInt(Math.random()*colors.length);
randomColors.push(colors[id]);
colors.splice(id,1);
}
return randomColors;
};
pro.setData=function(d){
this.clear();
this.heroes=[];
while(!(this.cellCountY==d.cellCountY)){
if(this.cellCountY>d.cellCountY){
this.delLine();
}else{
this.addLine();
}
}
var objeccts=d.objects;
var params=d.params;
this.colors=params.colors;
this.isBonus=params.isBonus;
this.isBomb=params.isBomb;
var object;
if(objeccts){
if(!GodStep.ISEDITMODE){
PR.Field.IS_FILL_DATA=true;
}
var randomColors=this.getRandomColors();
for(var i=0;i<objeccts.length;i++){
var o=objeccts[i];
if(o.id){
}else{
this.addCellObject(object=new PR.CellObject(o.n,this.soul.startS,this.cells[o.xi+o.yi*this.cellCountX],this.colors,randomColors,o.s));
if(object.isHero||object.isHeroTrap){
this.heroes.push(object);
}
}
}
PR.Field.IS_FILL_DATA=false;
}
};
pro.getData=function(){
var data={};
data.cellCountX=this.cellCountX;
data.cellCountY=this.cellCountY;
var objects=data.objects=[];
for(var i=0;i<this.cellObjects.length;i++){
var o=this.cellObjects[i];
var od={n:o.typeName,xi:o.cell.xi,yi:o.cell.yi};
if(o.selector){
od.s=o.selector;
}
objects.push(od);
}
return data;
};
pro.getCellByCoord=function(x,y){
var xi=parseInt(x/this.cellW);
var yi=parseInt(y/this.cellW);
trace(xi+" "+yi);
var cellRow=this.cellsXY[yi];
var cell;
if(cellRow){
cell=cellRow=cellRow[xi];
}
return cell;
};
pro.delCellObject=function(obj){
if(obj){
this.delFrame(obj);
this.cellObjects.splice(this.cellObjects.indexOf(obj),1);
if(obj.isHero||obj.isHeroTrap){
this.heroes.splice(this.heroes.indexOf(obj),1);
}
return true;
}
return false;
};
pro.addCellObject=function(ob){
var o;
var isFound=false;
for(var i=0;i<this.cellObjects.length;i++){
o=this.cellObjects[i];
if(o.isObject){
if(!o.cell||!ob.cell){
trace(1);
}
if(o.cell.name==ob.cell.name){
isFound=true;
}
}
}
if(!isFound){
ob.cell.pushGuest(ob);
this.cellObjects.push(ob);
if(ob.typeName=='hero'){
this.addFrameAt(ob,this.heroContainer,this.heroContainer.children.length);
}else{
this.addFrameAt(ob,this.objectContainer,this.objectContainer.children.length);
}
}
};
pro.getCellByPoint=function(p,isOver){
var w=this.cellW;
var dw=w*(isOver?.125:0);
var i=Math.max(0,Math.min(this.cellCountX-1,parseInt((p.x-dw*2)/w)));
var j=Math.max(0,Math.min(this.cellCountY-1,parseInt((p.y-dw)/w)));
var cell=this.cellsXY[j][i];
if(GodStep.Point.distance(new PIXI.Point(cell.x,cell.y),new PIXI.Point(p.x,p.y))<w*(isOver?1:1)){
return cell;
}
return null;
};
pro.clearCell=function(cell){
};
pro.getEmptyCount=function(){
var c=0;
for(var i=0;i<this.cells.length;i++){
if(this.cells[i].isEmpty()){
c++;
}
}
return c;
};
pro.getDynamicCount=function(){
var c=0;
for(var i=0;i<this.cells.length;i++){
if(this.cells[i].isDynamic()){
c++;
}
}
return c;
};
pro.randomizeArea=function(colors,x,y,w,h,deleteColor){
var trueColors=[];
for(var c=0;c<colors.length;c++){
if(deleteColor!=null){
if(colors[c]!=deleteColor)trueColors.push(colors[c]);
}else{
trueColors.push(colors[c]);
}
}
var cells=this.cellsXY;
var line=[];
for(var i=x;i<x+w;i++){
for(var j=y;j<y+h;j++){
line.push(cells[j][i]);
cells[j][i].replaceColored(PR.Cell.STANDART[trueColors[parseInt(Math.random()*trueColors.length)]]);
}
}
return line;
};
pro.replaceCells=function(cell1,cell2){
var g1=cell1.guests[0];
var g2=cell2.guests[0];
cell1.guests[0]=g2;
cell2.guests[0]=g1;
g1.cell=cell2;
g2.cell=cell1;
g1.applyCellPostion(true);
g2.applyCellPostion(true);
};
PR.Cell=function(xi,yi,w,h,s){
Games.Cell.call(this,xi,yi,w,h);
this.xi=xi;
this.yi=yi;
this.guests=[];
var id=(((yi*9+xi)%2==0)?'2':'1');
this.addChild(this.img=new Games.Img('cube_back_'+id,s*PR.CELL_SCALE_BACK*1.18,this.W*.5,this.H*.5,.5));
this.addFrame(this.label=new PR.Text('100',75*s,0,0,'left',0x100000));
this.label.visible=false;
};
PR.Cell.STANDART=['red','yellow','blue','purple','green'];
extend(PR.Cell,Games.Cell);
pro.clear=function(){
for(var i=0;i<this.guests.length;i++){
this.guests[i].parent.parent.delCellObject(this.guests[i]);
}
this.guests=[];
this.isSelected=false;
};
pro.isEmpty=function(){
return this.guests.length==0;
};
pro.isDynamic=function(){
for(var i=0;i<this.guests.length;i++){
if(this.guests[i].isDynamic){
return true;
}
}
return false;
};
pro.getColored=function(){
for(var i=0;i<this.guests.length;i++){
if(this.guests[i].isColored){
return this.guests[i];
}
}
return null;
};
pro.replaceColored=function(color){
var guest=this.getColored();
if(guest){
if(guest.isColored){
var field=guest.parent.parent;
field.delCellObject(guest);
this.guests.splice(this.guests.indexOf(guest),1);
var co;
field.addCellObject(co=new PR.CellObject(color,guest.S,this));
co.applyCellPostion(true);
}
}
};
pro.replaceCellObjects=function(cell){
var c1=this.guests[0];
var c2=cell.guests[0];
this.guests[0]=c2;
cell.guests[0]=c1;
c1.cell=cell;
c2.cell=this;
c1.applyCellPostion(true);
c2.applyCellPostion(true);
};
pro.isBusy=function(){
for(var i=0;i<this.guests.length;i++){
if(this.guests[i].isObject){
return true;
}
}
return false;
};
pro.pushGuest=function(o){
this.guests.push(o);
};
pro.delGuest=function(o){
this.guests.splice(this.guests.indexOf(o),1);
};
pro.setAsGuest=function(o){
if(o.name=='player'){
this.guests.push(o);
}else{
this.guests.splice(0,0,o);
}
o.cell.guests.splice(o.cell.guests.indexOf(o),1);
o.cell=this;
};
pro.setAsSelected=function(ok){
var guests=this.guests;
var length=guests.length;
var guest;
for(var i=0;i<length;i++){
guest=guests[i];
if(guest.isColored){
guest.setAsSelected(ok);
this.isSelected=ok;
}
}
return this.isSelected;
};
pro.isEqual=function(cell){
var object,i,object2;
for(i=0;i<this.guests.length;i++){
if(this.guests[i].isDynamic){
object=this.guests[i];
}
}
for(i=0;i<cell.guests.length;i++){
if(cell.guests[i].isDynamic){
object2=cell.guests[i];
}
}
return(object.typeName==object2.typeName);
};
pro.getBonus=function(){
var g;
for(var i=0;i<this.guests.length;i++){
g=this.guests[i];
if(g.isBomb){
return g;
}
if(g.isBonus){
return g;
}
}
return null;
};
pro.removeDirt=function(){
var i,obj;
var guests=this.guests;
for(i=0;i<guests.length;i++){
obj=guests[i];
if(obj.isDirt){
if(PR.JUST_DIRT_DELETE==0){
PR.JUST_DIRT_DELETE=5;
GodStep.playSound('dirt',0,PR.SOUND);
}
obj.isKill=true;
this.setCost(500);
return obj;
}
}
return null;
};
pro.getObject=function(){
return this.guests[0];
};
pro.animate=function(){
if(this.label.visible){
this.label.alpha+=(0-this.label.alpha)*.04;
this.label.y-=this.W*.007;
if(this.label.alpha<0.05){
this.label.visible=false;
}
}
};
pro.setCost=function(c){
this.cost=c;
this.label.alpha=1;
this.label.visible=true;
this.label.setText(c+'');
this.label.updateText();
this.label.x=this.W/2-this.label.width/2;
this.label.y=this.label.height/2;
};
Object.defineProperty(pro,'Selected',{
get:function(){
return isSelected;
},
set:function(value){
var obj=this.getObject();
if(obj){
obj.scale.x=obj.scale.y=(value)?1.1:1;
obj.applyCellPostion(true);
obj.deltaXY=-this.W*(1-obj.scale.x)*.5;
this.isSelected=value;
}
}
});
PR.CellObject=function(name,S,cell,colors,randomColors,selector){
var type=name;
GodStep.Frame.call(this,type);
this.typeName=name;
this.S=S;
this.startS=S*PR.CELL_SCALE;
this.sy=0;
var id;
this.deltaXY=0;
var cid,ctype,t;
switch(name){
case's_bonus':
this.phase=Math.random();
this.isObject=true;
this.animTimer=0;
this.isDynamic=true;
this.isBonus=true;
this.selector=selector;
if(isNaN(selector)||selector==undefined){
this.selector=1;
}
switch(this.selector){
case 1:t=1;ctype='red';break;
case 2:t=5;ctype='yellow';break;
case 3:t=4;ctype='blue';break;
case 4:t=3;ctype='purple';break;
case 5:t=2;ctype='green';break;
}
if(!GodStep.ISEDITMODE){
if(colors){
switch(ctype){
case'red':t=0;break;
case'yellow':t=1;break;
case'blue':t=2;break;
case'purple':t=3;break;
case'green':t=4;break;
}
id=colors.indexOf(t);
if(!randomColors){
trace(1);
}
if(id==-1)id=0;
switch(randomColors[id]){
case 0:
this.ctype='red';
break;
case 1:
this.ctype='yellow';
break;
case 2:
this.ctype='blue';
break;
case 3:
this.ctype='purple';
break;
case 4:
this.ctype='green';
break;
}
switch(this.ctype){
case'red':
t=1;
break;
case'yellow':
t=5;
break;
case'blue':
t=4;
break;
case'purple':
t=3;
break;
case'green':
t=2;
break;
}
}
}
this.addFrame(this.img=new Games.Img('b_'+t,this.S/PR.CELL_SCALE*PR.CELL_SCALE_BACK*.67,cell.W/2,cell.H/2,new PIXI.Point(.5,.44)));
this.startS=this.img.scale.x;
break;
case'bomb':
this.phase=Math.random();
this.isDynamic=true;
this.isObject=true;
this.animTimer=0;
this.isBomb=true;
this.addFrame(this.img=new GodStep.MovieClip(['bomb','boom_1','boom_2','boom_3','boom_4','boom_5'],this.S/PR.CELL_SCALE*PR.CELL_SCALE_BACK*.95,cell.W/2,cell.H/2,new PIXI.Point(.5,.5)));
this.startS=this.img.scale.x;
break;
case'hero2':
this.isDynamic=true;
this.isObject=true;
this.animTimer=0;
this.isColored=true;
this.isHeroTrap=true;
this.selector=selector;
if(isNaN(selector)||selector==undefined){
this.selector=1;
}
switch(this.selector){
case 1:t=1;ctype='red';break;
case 2:t=5;ctype='yellow';break;
case 3:t=4;ctype='blue';break;
case 4:t=3;ctype='purple';break;
case 5:t=2;ctype='green';break;
}
this.ctype=ctype;
if(!GodStep.ISEDITMODE){
if(colors){
switch(ctype){
case'red':t=0;break;
case'yellow':t=1;break;
case'blue':t=2;break;
case'purple':t=3;break;
case'green':t=4;break;
}
id=colors.indexOf(t);
if(id==-1)id=0;
switch(randomColors[id]){
case 0:
this.ctype='red';
break;
case 1:
this.ctype='yellow';
break;
case 2:
this.ctype='blue';
break;
case 3:
this.ctype='purple';
break;
case 4:
this.ctype='green';
break;
}
switch(this.ctype){
case'red':
t=1;
break;
case'yellow':
t=5;
break;
case'blue':
t=4;
break;
case'purple':
t=3;
break;
case'green':
t=2;
break;
}
this.t=t;
}
}
this.addFrame(this.img=new GodStep.MovieClip(['cage_'+t,'cage_'+t+'_1','cage_'+t+'_2','cage_'+t+'_2','cage_'+t+'_3','cage_'+t+'_4','cage_'+t+'_5'],this.S/PR.CELL_SCALE*PR.CELL_SCALE_BACK*.95,cell.W/2,cell.H/2,new PIXI.Point(.5,.5)));
break;
case'hero':
this.phaseAnim=0;
this.isDynamic=true;
this.isObject=true;
this.animTimer=0;
this.isHero=true;
var pt=selector;
if(isNaN(selector)||selector==undefined){
pt=1;
}
pt=PR.GamePlay.HERO_RANDOMS[PR.CellObject.HERO_LAST_TYPE]+1;
PR.CellObject.HERO_LAST_TYPE++;
if(PR.CellObject.HERO_LAST_TYPE==PR.GamePlay.HERO_RANDOMS.length){
PR.CellObject.HERO_LAST_TYPE=0;
}
this.selector=pt;
this.addFrame(this.img=new GodStep.MovieClip(['pers_'+pt+'_1','pers_'+pt+'_3','pers_'+pt+'_1','pers_'+pt+'_3','pers_'+pt+'_2','pers_'+pt+'_2','pers_win_'+pt],this.S/PR.CELL_SCALE*PR.CELL_SCALE_BACK*.95,cell.W/2,cell.H/2,new PIXI.Point(.5,.5)));
this.addFrame(this.dis=new GodStep.MovieClip(['disappear_1','disappear_2','disappear_3','disappear_4','disappear_5'],this.S/PR.CELL_SCALE*PR.CELL_SCALE_BACK*.95,cell.W/2,cell.H/2,new PIXI.Point(.5,.5)));
this.dis.visible=false;
this.img.animTime=50;
this.img.animTimer=parseInt(Math.random()*40);
this.img.setToFrame(parseInt(Math.random()*this.img.totalFrames));
break;
case'dirt':
this.isDynamic=true;
this.animTimer=0;
this.isObject=true;
this.isColored=true;
this.isDirt=true;
if(GodStep.ISEDITMODE){
this.addFrame(this.img=new Games.Img(name,this.S/PR.CELL_SCALE*PR.CELL_SCALE_BACK*.7,cell.W/2,cell.H/2,new PIXI.Point(.5,.44)));
}else{
cid=colors[parseInt(Math.random()*colors.length)];
ctype=PR.Cell.STANDART[cid];
this.ctype=ctype;
switch(ctype){
case'red':t=1;break;
case'green':t=2;break;
case'purple':t=3;break;
case'blue':t=4;break;
case'yellow':t=5;break;
}
this.t=t;
this.addFrame(this.img=new GodStep.MovieClip(['cube_'+t,'cube_'+t+'_1','cube_'+t+'_2','cube_'+t+'_3','cube_'+t+'_4','cube_'+t+'_5'],this.S/PR.CELL_SCALE*PR.CELL_SCALE_BACK*.95,cell.W/2,cell.H/2,new PIXI.Point(.5,.5)));
this.addFrame(this.dirt=new GodStep.MovieClip(['net_1','net_2','net_3','net_4','net_5'],this.S/PR.CELL_SCALE*PR.CELL_SCALE_BACK*.95,cell.W/2,cell.H/2,new PIXI.Point(.5,.5)));
}
break;
case'block':
this.isGround=true;
this.isBlock=true;
this.isObject=true;
this.addFrame(this.img=new Games.Img(name,this.S/PR.CELL_SCALE*PR.CELL_SCALE_BACK,cell.W/2,cell.H/2,new PIXI.Point(.5,.44)));
break;
case'delete':
this.isBlock=true;
this.isGround=true;
this.isObject=true;
var texID=(((cell.yi*9+cell.xi)%2==0)?'2':'1');
this.addFrame(this.img=new Games.Img('cube_lock_'+texID,this.S/PR.CELL_SCALE*PR.CELL_SCALE_BACK,cell.W/2,cell.H/2,new PIXI.Point(.5,.5)));
break;
case'red':
case'green':
case'purple':
case'blue':
case'yellow':
if(PR.Field.IS_FILL_DATA){
switch(name){
case'red':t=0;break;
case'yellow':t=1;break;
case'blue':t=2;break;
case'purple':t=3;break;
case'green':t=4;break;
}
id=colors.indexOf(t);
if(id==-1)id=0;
switch(randomColors[id]){
case 0:this.ctype='red';break;
case 1:this.ctype='yellow';break;
case 2:this.ctype='blue';break;
case 3:this.ctype='purple';break;
case 4:this.ctype='green';break;
}
}else{
this.ctype=name;
}
switch(this.ctype){
case'red':t=1;break;
case'green':t=2;break;
case'purple':t=3;break;
case'blue':t=4;break;
case'yellow':t=5;break;
}
this.animTimer=parseInt(Math.random()*55);
this.isColored=true;
this.isObject=true;
this.isDynamic=true;
this.t=t;
this.addFrame(this.img=new GodStep.MovieClip(['cube_'+t,'cube_'+t+'_1','cube_'+t+'_2','cube_'+t+'_2','cube_'+t+'_3','cube_'+t+'_4','cube_'+t+'_5'],this.S/PR.CELL_SCALE*PR.CELL_SCALE_BACK*.95,cell.W/2,cell.H/2,new PIXI.Point(.5,.5)));
this.img.animTime=4;
break;
}
this.startS=this.img.scale.x;
this.cell=cell;
this.applyCellPostion(true);
};
extend(PR.CellObject,GodStep.Frame);
PR.CellObject.HERO_LAST_TYPE=0;
PR.CellObject.COLORS=[0x0000ff,0xff0000,0x00ff00,0xffff88,0xff00ff];
pro.move=function(){
if(this.img){
var container=this.img.parent.parent;
var field=container.parent;
var gameplay=field.parent.parent;
var killArray=gameplay.killed;
if(this.isKilled){
gameplay.moveDownTimer=10;
if(this.isHero){
if(this.phaseAnim++==30){
this.phaseAnim--;
this.dis.visible=true;
this.dis.animate();
this.img.setToFrame(this.img.totalFrames-1);
if(this.dis.currentFrame==2&&this.dis.cycle==0){
this.img.visible=false;
}
if(this.dis.currentFrame==0&&this.dis.cycle>0){
field.delCellObject(this.destroy());
killArray.splice(killArray.indexOf(this),1);
gameplay.heroLabel.setText((gameplay.heroesCount-field.heroes.length)+'/'+gameplay.heroesCount);
if(field.heroes.length==0){
gameplay.win();
}
gameplay.heroLabel.scale.x=gameplay.heroLabel.scale.y*=1.2;
}
}else{
if(!this.isSounded){
this.isSounded=true;
GodStep.playSound('rescue',0,PR.SOUND);
}
this.img.setToFrame(this.img.totalFrames-1);
}
}else
if(this.isHeroTrap){
this.img.animate();
if(this.img.currentFrame==0){
field.delCellObject(this.destroy());
killArray.splice(killArray.indexOf(this),1);
GodStep.playSound('cageout',0,PR.SOUND);
var cell=this.cell;
var cells=field.cellsXY;
field.addCellObject(gameplay.hero=new PR.CellObject('hero',gameplay.s,cell,gameplay.colors,null,this.selector));
cell.delGuest(gameplay.hero);
gameplay.hero.cell=null;
gameplay.field.heroes.push(gameplay.hero);
for(var hy=cell.yi;hy>=0;hy--){
var o=cells[hy][cell.xi].getObject();
if(o){
if(o.isGround){
gameplay.hero.targetCell=cells[hy+1][cell.xi];
gameplay.hero.setCell(cells[hy+1][cell.xi]);
gameplay.hero=null;
return;
}
}
}
if(!gameplay.hero.targetCell){
gameplay.hero.targetCell=cells[0][cell.xi];
gameplay.hero.setCell(cells[0][cell.xi]);
}
}
}else
if(this.dirt){
this.dirt.animate();
if(this.dirt.currentFrame==0){
this.removeChild(this.dirt);
this.dirt=null;
this.isDirt=false;
this.isKilled=false;
this.typeName=this.ctype;
killArray.splice(killArray.indexOf(this),1);
}
}else
if(this.img){
this.img.animate();
if(this.img.currentFrame==0){
field.delCellObject(this.destroy());
killArray.splice(killArray.indexOf(this),1);
}
}
}
}
};
pro.update=function(){
if(this.isBomb||this.isBonus){
this.phase+=0.075;
this.img.scale.x=this.img.scale.y+=(this.startS+Math.sin(this.phase)*.05-this.img.scale.y)*.1;
}else
if(this.isHero){
this.img.animate();
if(this.img.currentFrame==this.img.totalFrames-1){
this.img.setToFrame(0);
}
}
};
pro.setAsBonus=function(){
this.isBonus=true;
this.bonusanim=0;
this.isVertical=Math.random()>.5;
if(this.isVertical){
this.addChildAt(this.bonus=new PR.MovieClip(['bonus_2_1','bonus_2_2','bonus_2_3','bonus_2_4','bonus_2_5','bonus_2_6'],this.startS*GodStep.IMAGE_RESOLUTION,this.cell.W/2,this.cell.H/2,.5),0);
}else{
this.addChildAt(this.bonus=new PR.MovieClip(['bonus_1_1','bonus_1_2','bonus_1_3','bonus_1_4','bonus_1_5','bonus_1_6'],this.startS*GodStep.IMAGE_RESOLUTION,this.cell.W/2,this.cell.H/2,.5),0);
}
var parent=this.parent;
parent.removeChild(this);
parent.addChild(this);
};
pro.removeBonus=function(){
if(this.bonus){
this.removeChild(this.bonus);this.bonus=null;
}
};
pro.setCell=function(cell){
if(this.cell){
this.cell.delGuest(this);
}
this.cell=cell;
cell.pushGuest(this);
this.applyCellPostion(false);
};
pro.applyCellPostion=function(now){
this.nextPlace=new PIXI.Point(this.cell.x,this.cell.y);
if(now){
this.Place=this.nextPlace;
}
};
pro.destroy=function(){
this.cell.guests.splice(this.cell.guests.indexOf(this),1);
this.removeChild(this.img);
if(this.label){
this.removeChild(this.label);
}
if(this.bonus){
this.removeChild(this.bonus);
}
if(this.dirt){
this.removeChild(this.dirt);
}
if(this.dis){
this.removeChild(this.dis);
}
if(this.img1){
this.removeChild(this.img1);
this.img1=null;
}
this.img=null;
return this;
};
pro.setAsSelected=function(ok){
this.animTimer=0;
this.isColorSelected=ok;
this.img.setToFrame(ok?3:0);
};
PR.Pause=function(soul){
GodStep.LFrame.call(this,soul,'Pause');
this.addChild(this.back=new PR.Background(this,'back_pause'));
this.addChild(this.top=new PIXI.DisplayObjectContainer());
this.top.addChild(this.field_button=new Games.Img('field_button',this.s,this.W*.5,this.H*.4,.5));
this.top.addChild(this.label=new PR.Text(PR.S('pause'),170*this.s,this.W*.33,this.H*.01,'center',0xffffff));
this.top.addChild(this.b_menu=new Games.ImgButton('b_menu',this,this.W*.5,this.H*.4,.5));
this.top.addChild(this.b_back=new Games.ImgButton('b_back',this,this.W*.25,this.H*.4,.5));
this.top.addChild(this.b_replay=new Games.ImgButton('b_replay',this,this.W*.75,this.H*.4,.5));
this.top.addChild(this.pers1=new GodStep.MovieClip(['pers_1','pers_1_0'],this.s,this.W*.15,this.H*.15,.5));
this.top.addChild(this.pers2=new GodStep.MovieClip(['pers_2','pers_2_0'],this.s,this.W*.85,this.H*.15,.5));
this.top.addChild(this.b_music=new Games.ImgButton('slider_on_pause',this,this.W*.6,this.H*.66));
this.top.addChild(this.b_sound=new Games.ImgButton('slider_on_pause',this,this.W*.6,this.H*.84));
this.top.addChild(this.b_music_img=new Games.Img('b_music',this.s,this.W*.25,this.H*.66,.5));
this.top.addChild(this.b_sound_img=new Games.Img('b_sound',this.s,this.W*.25,this.H*.84,.5));
this.b_music.scaleble=this.b_sound.scaleble=false;
this.b_music.addChild(this.b_music.lab=new PR.Text('ON',140*this.s,-this.W*.08,-this.H*.075,'center',0x007ec2));
this.b_sound.addChild(this.b_sound.lab=new PR.Text('ON',140*this.s,-this.W*.08,-this.H*.075,'center',0x007ec2));
this.pers1.animTime=100;
this.pers2.animTime=111;
this.pers2.animTimer=66;
addEvent(this.b_back,Games.ImgButton.CLICK,this.h_buttons);
addEvent(this.b_menu,Games.ImgButton.CLICK,this.h_buttons);
addEvent(this.b_replay,Games.ImgButton.CLICK,this.h_buttons);
addEvent(this.b_music,Games.ImgButton.CLICK,this.h_buttons);
addEvent(this.b_sound,Games.ImgButton.CLICK,this.h_buttons);
};
extend(PR.Pause,GodStep.LFrame);
pro.update=function(){
if(this.visible){
this.pers1.animate();
this.pers2.animate();
}
};
pro.updateLabels=function(){
this.b_music.lab.updateText();
this.b_sound.lab.updateText();
this.b_music.lab.x=-this.b_music.lab.width/2;
this.b_sound.lab.x=-this.b_sound.lab.width/2;
};
pro.init=function(){
this.visible=true;
var p=this;
if(!PR.SOUND){
p.b_sound.setTexture('slider_off_pause');
p.b_sound.lab.tint=0x122b33;
p.b_sound.lab.setText(PR.S('off'));
}else{
p.b_sound.setTexture('slider_on_pause');
p.b_sound.lab.tint=0x0092e0;
p.b_sound.lab.setText(PR.S('on'));
}
if(!PR.MUSIC){
p.b_music.setTexture('slider_off_pause');
p.b_music.lab.tint=0x122b33;
p.b_music.lab.setText(PR.S('off'));
}else{
p.b_music.setTexture('slider_on_pause');
p.b_music.lab.tint=0x0092e0;
p.b_music.lab.setText(PR.S('on'));
}
p.updateLabels();
};
pro.h_buttons=function(e){
var t=e.content.t;
var p=t.parent.parent;
GodStep.playSound('button',0,PR.SOUND);
switch(t){
case p.b_sound:
if(PR.SOUND){
p.b_sound.setTexture('slider_off_pause');
p.b_sound.lab.tint=0x122b33;
p.b_sound.lab.setText(PR.S('off'));
}else{
p.b_sound.setTexture('slider_on_pause');
p.b_sound.lab.tint=0x0092e0;
p.b_sound.lab.setText(PR.S('on'));
}
p.b_sound.lab.updateText();
PR.SOUND=!PR.SOUND;
p.soul.savePlayer();
break;
case p.b_music:
if(PR.MUSIC){
p.b_music.setTexture('slider_off_pause');
p.b_music.lab.tint=0x122b33;
p.b_music.lab.setText(PR.S('off'));
GodStep.volumeSound('theme',!PR.MUSIC);
}else{
p.b_music.setTexture('slider_on_pause');
p.b_music.lab.tint=0x0092e0;
p.b_music.lab.setText(PR.S('on'));
GodStep.volumeSound('theme',!PR.MUSIC);
GodStep.playSound('theme',-1,!PR.MUSIC);
}
p.b_music.lab.updateText();
PR.MUSIC=!PR.MUSIC;
p.soul.savePlayer();
break;
case p.b_menu:
p.parent.soul.screenTo([p.parent.soul.levelselect],p.parent);
break;
case p.b_replay:
p.parent.soul.screenTo([p.parent.soul.gameplay],p.parent);
break;
case p.b_back:
p.visible=false;
break;
}
p.updateLabels();
};
Object.defineProperty(pro,'Scale',{
get:function(){
return this.scale.x;
},
set:function(value){
var s=this.soul;
this.back.rescale(value);
this.back.y=0;
this.scale.x=this.scale.y=1;
}
});
PR.StartMenu=function(soul){
GodStep.LFrame.call(this,soul,'StartMenu');
GodStep.IDownUp.call(this,soul.SW,soul.SH);
this.addChild(this.back=new PR.Background(this,'back_menu'));
this.addChild(this.title=new Games.Img('logo',this.s,this.W*.5,this.H*.16,new PIXI.Point(.5,0)));
this.title.phase=0;
this.addChild(this.cube_2=new Games.Img('cube_2s',this.s,this.W*.61,this.H*.41,.5));
this.addChild(this.cube_1=new Games.Img('cube_1s',this.s,this.W*.11,this.H*.35,.5));
this.addChild(this.footer=new PIXI.DisplayObjectContainer());
this.footer.addChild(this.down=new Games.Img('down',this.s,this.W*.5,0,new PIXI.Point(.5,1)));
this.footer.addChild(this.pers_1=new GodStep.MovieClip(['pers_m_1','pers_m_1_0'],this.s,this.W*.25,-this.H*.18,new PIXI.Point(.5,1)));
this.footer.addChild(this.pers_2=new GodStep.MovieClip(['pers_m_2','pers_m_2_0'],this.s,this.W*.75,-this.H*.21,new PIXI.Point(.5,1)));
this.footer.addChild(this.field=new Games.Img('field_button_m',this.s,this.W*.5,-this.H*.03,new PIXI.Point(.5,1)));
this.footer.addChild(this.b_play=new Games.ImgButton('b_play',this,this.W*.5,-this.H*.19));
this.b_play.phase=0;
this.footer.addChild(this.b_more=new Games.ImgButton('b_more',this,this.W*.24,-this.H*.11));
this.footer.addChild(this.b_settings=new Games.ImgButton('b_options',this,this.W*.76,-this.H*.11));
this.pers_1.animTime=100;
this.pers_2.animTime=129;
this.pers_2.animTimer=55;
this.footer.addChild(this.b_dev=new Games.TextButton('dev',33*this.s,0xfa66400,this.W*.9,-this.H*.55));
this.footer.addChild(this.maska=new PIXI.Graphics());this.field.mask=this.maska;
this.maska.y=this.field.y-this.field.height;
this.maska.beginFill(0,1);
this.maska.drawRect(0,0,this.field.width,this.field.height*2);
this.maska.endFill();
this.b_dev.visible=false;
addEvent(this.b_dev,Games.ImgButton.CLICK,this.h_buttons);
addEvent(this.b_play,Games.ImgButton.CLICK,this.h_buttons);
addEvent(this.b_settings,Games.ImgButton.CLICK,this.h_buttons);
addEvent(this.b_more,Games.ImgButton.CLICK,this.h_buttons);
};
extend(PR.StartMenu,GodStep.LFrame);
pro.init=function(){
this.b_play.phase=0;
this.title.phase=0;
this.b_play.scale.x=this.b_play.scale.y=
this.b_settings.scale.x=this.b_settings.scale.y=0;
this.b_more.scale.x=this.b_more.scale.y=0;
this.visible=true;
this.field.x=this.W*2;
this.b_play.y=this.soul.OH*3.5;
this.b_more.y=this.soul.OH*2;
this.b_more.y=this.soul.OH*2;
this.b_settings.y=this.soul.OH*2.7;
};
pro.update=function(){
if(this.visible){
this.pers_1.animate();
this.pers_2.animate();
var s=this.soul;
var scale=this.scale.x;
this.b_play.scale.x=this.b_play.scale.y+=(1-this.b_play.scale.x)*.03;
this.b_settings.scale.x=this.b_settings.scale.y+=(1-this.b_settings.scale.x)*.07;
this.b_more.scale.x=this.b_more.scale.y+=(1-this.b_more.scale.x)*.05;
this.title.phase+=0.025;
this.b_play.phase+=0.045;
this.title.y+=((s.OH*.03-s.DOH/2)/scale+Math.sin(this.title.phase)*s.H*.01-this.title.y)*.3;
this.b_play.y+=Math.max(-this.W*.1,(-this.H*.19+Math.sin(this.b_play.phase)*s.H*.01-this.b_play.y)*.3);
this.b_more.y+=Math.max(-this.W*.1,(-this.H*.11-this.b_more.y)*.3);
this.b_settings.y+=Math.max(-this.W*.1,(-this.H*.11-this.b_settings.y)*.3);
this.field.x+=Math.max(-this.W*.1,(this.W*.5-this.field.x)*.3);
}
};
pro.h_buttons=function(e){
var t=e.content.t;
var p=t.parent.parent;
var s=p.soul;
GodStep.playSound('button',0,PR.SOUND);
switch(t){
case p.b_dev:
PR.DEVMODE=true;
s.screenTo([s.levelselect],p);
break;
case p.b_settings:
s.screenTo([s.settings],p);
break;
case p.b_more:
break;
case p.b_play:
PR.DEVMODE=false;
s.screenTo([s.levelselect],p);
break;
}
};
Object.defineProperty(pro,'Scale',{
get:function(){
return this.scale.x;
},
set:function(value){
var s=this.soul;
this.scale.x=this.scale.y=value;
this.back.rescale(value);
this.footer.y=(s.OH-s.DOH/2)/value;
this.title.y=(s.OH*.03-s.DOH/2)/value;
}
});
PR.LevelSelect=function(soul){
this.soul=soul;
var S=this.startS=soul.startS;
GodStep.LFrame.call(this,soul,'LevelSelect');
GodStep.IDownUp.call(this,soul.W,soul.H);
this.addChild(this.back=new PR.Background(this,'back_levels'));
this.addChild(this.maska=new PIXI.Graphics());
this.addChild(this.container=new GodStep.Frame('Container',soul.W,soul.H));
this.addChild(this.top=new GodStep.Frame('top',soul.W,soul.H*.2));
this.top.addChild(this.label=new PR.Text(PR.S('levels'),170*this.s,this.W*.3,this.H*.01,'center',0xffffff));
GodStep.IDownUp.call(this.container,this.soul.W,this.soul.H);
this.top.addChild(this.b_back=new Games.ImgButton('b_back',this,this.W*.15,this.H*.1));
this.top.addChild(this.pers=new GodStep.MovieClip(['pers_l','pers_l1','pers_l'],this.s,this.W*.85,this.H*.15,.5));
this.pers.animTime=110;
addEvent(this.b_back,Games.ImgButton.CLICK,this.h_buttons);
this.visible=false;
this.levels=[];
this.container.MY=this.container.y=soul.H*.25;
this.maska.beginFill(0,.1);
this.maska.drawRect(0,this.container.y,this.W,this.H);
this.container.mask=this.maska;
addEvent(this.container,GodStep.FRAME_MOVE,this.h_container);
addEvent(this.container,GodStep.FRAME_DOWN,this.h_container);
addEvent(this,GodStep.FRAME_UP,this.h_mouse);
};
extend(PR.LevelSelect,GodStep.LFrame);
pro.h_m=function(e){
trace(e);
};
pro.init=function(data){
this.visible=true;
GodStep.volumeSound('theme',0);
var settings=PR.PetResque.instance.SETTINGS;
while(this.levels.length){
this.container.removeChild(this.levels[0].destroy());
this.levels.splice(0,1);
}
PR.LEVELS=this.levels=[];
var S=this.startS;
var w=this.W/4.6;
var x,y;
var maxY=0;
var levels=settings.levels;
var plevels=PR.PetResque.instance.PLAYER.levels;
var isActivate=false;
var lastCompleted;
for(var i=0;i<levels.length;i++){
y=parseInt(i/4);
x=i-y*4;
var level=new PR.LevButton('lock',S,x*w+w*.82,y*w*.95+w/2,''+(i+1),160*S,this.W*.002,this.H*.058,0xff3b45);
maxY=Math.max(maxY,level.y+level.H/2);
this.container.addChild(level);
level.ID=i;
level.isDisabled=true;
if(plevels.length){
if(plevels[i]){
if(plevels[i][0]==1){
level.isDisabled=false;
level.setAsComplete();
lastCompleted=level;
}else{
if(!isActivate){
isActivate=true;
level.isDisabled=false;
level.setAsActive();
}
}
}
}
this.levels.push(level);
level.levelData=levels[i];
addEvent(level,Games.ImgButton.CLICK,this.h_levels);
}
if(lastCompleted==null){
this.levels[0].isDisabled=false;
this.levels[0].setAsActive();
}else{
}
if(this.newLevel){
this.container.addChild(this.newLevel.destroy());
this.newLevel=null;
}
if(PR.DEVMODE){
if(!this.b_loadDef){
this.top.addChild(this.b_loadDef=new Games.TextButton('Load Default',35*S,0x562466,this.soul.W*.5,this.soul.H*.05));
addEvent(this.b_loadDef,Games.ImgButton.CLICK,this.h_buttons);
}
this.b_loadDef.visible=true;
this.b_loadDef.y=(-this.soul.DOH/2+this.soul.H*.07)/this.scale.x;
y=parseInt(this.levels.length/4);
x=this.levels.length-y*4;
var newLevel=this.newLevel=new Games.TextButton('add',60*S,0x555555,x*w+w/2,y*w);
newLevel.ID=this.levels.length;
addEvent(newLevel,GodStep.FRAME_DOWN,this.h_newLevels);
this.container.addChild(newLevel);
}else{
if(this.b_loadDef){
this.b_loadDef.visible=false;
}
}
this.container.setHitArea(0,0,this.W,maxY);
this.container.MH=maxY+this.H*.1;
this.container.LH=(level)?level.H:0;
};
pro.update=function(){
this.pers.animate();
};
pro.h_levels=function(e){
var t=e.target;
var p=t.parent.parent;
var point=t.y+t.parent.y+p.soul.DOH/2;
if(point<p.H*.25)return;
var s=p.soul;
switch(e.type){
case Games.ImgButton.CLICK:
GodStep.playSound('button',0,PR.SOUND);
PR.LAST_LEVEL_SELECTED=t.ID;
PR.LAST_LEVEL_DATA=t.levelData;
if(PR.DEVMODE){
s.screenTo([s.dev],p);
}else{
s.screenTo([s.gameplay],p);
}
break;
}
};
pro.h_newLevels=function(e){
var t=e.target;
var p=t.parent.parent;
var s=p.soul;
switch(e.type){
case GodStep.FRAME_DOWN:
PR.LAST_LEVEL_SELECTED=t.ID;
s.screenTo([s.dev],p);
break;
}
};
pro.h_container=function(e){
var t=e.target;
var parent=t.parent;
var s=parent.soul;
if(t.name=='Container'){
switch(e.type){
case GodStep.FRAME_MOVE:
if(t.isDown){
var p=e.content.getLocalPosition(t.parent);
var hy=(s.OH-s.H)*.5;
t.y=p.y-t.downPoint.y;
t.y=Math.min(t.MY-hy/parent.scale.x,Math.max(t.y,(s.OH-hy)/parent.scale.x-t.MH));
}
break;
}
}
};
pro.h_mouse=function(e){
var t=e.content.target;
switch(e.type){
case GodStep.FRAME_UP:
if(e.content.target.soul){
t.b_back.Scale=1;
t.b_back.isDown=false;
if(t.b_loadDef){
t.b_loadDef.isDown=false;
t.b_loadDef.Scale=1;
}
for(var i=0;i<t.levels.length;i++){
t.levels[i].Scale=1;
t.levels[i].isDown=false;
}
}
break;
}
};
pro.h_buttons=function(e){
GodStep.playSound('button',0,PR.SOUND);
var t=e.content.t;
var p=t.parent.parent;
var s=p.soul;
switch(t){
case p.b_loadDef:
p.init(GodStep.LoadText(PR.DEFAULT_SETTINGS));
PR.PetResque.instance.saveSettings();
break;
case p.b_back:
GodStep.playSound('button',0,PR.SOUND);
s.screenTo([s.startmenu],p);
break;
}
};
Object.defineProperty(pro,'Scale',{
get:function(){
return this.scale.x;
},
set:function(value){
var s=this.soul;
this.back.rescale(value);
this.scale.x=this.scale.y=value;
this.maska.y=this.container.y=-(this.soul.OH-this.soul.H)*.5/value+this.soul.H*.2/value;
this.container.y-=-this.container.MY+this.soul.H*.2/value;
this.maska.y+=this.soul.H*.07/value;
if(this.b_loadDef){
this.b_loadDef.y=(-this.soul.DOH/2+this.soul.H*.07)/this.scale.x;
}
this.maska.clear();
this.maska.beginFill(0,.1);
this.maska.drawRect(0,0,this.W,this.soul.OH*1.1/value-this.container.y);
var dy=this.soul.OH-this.soul.H;
this.top.y=-s.DOH/2/value;
}
});
PR.LevButton=function(img,scaleS,px,py,text,textSize,tdx,tdy,tint){
var tex=GodStep.textures[img];
var startS=scaleS;
GodStep.Frame.call(this,null,tex.width*startS/GodStep.IMAGE_RESOLUTION*GodStep.SCALE,tex.height*startS/GodStep.IMAGE_RESOLUTION*GodStep.SCALE);
GodStep.IOverOut.call(this,this.W,this.H);
GodStep.IDownUp.call(this,this.W,this.H);
this.addChild(this.img=new GodStep.Image(tex));this.img.Scale=startS/GodStep.IMAGE_RESOLUTION*GodStep.SCALE;
this.img.anchor=new PIXI.Point(0.5,0.5);
this.setHitArea(-this.W/2,-this.H/2,this.W,this.H);
if(text){
this.addChild(this.label=new PR.Text(text,(textSize||100),0,0,'center',tint));
this.label.x-=this.label.width/2+(tdx||0);
this.label.y-=this.label.height/2+(tdy||0);
this.label.tdx=tdx||0;
this.label.tdy=tdy||0;
this.label.HW=-this.label.width/2;
this.label.HH=-this.label.height/2;
}
this.downScale=.95;
this.place(px,py);
addEvent(this,GodStep.FRAME_DOWN,this.h_mouse);
addEvent(this,GodStep.FRAME_OUT,this.h_mouse);
addEvent(this,GodStep.FRAME_OVER,this.h_mouse);
addEvent(this,GodStep.FRAME_UP,this.h_mouse);
};
extend(PR.LevButton,GodStep.Frame);
PR.LevButton.COLORS=[0xe77719,0xb1321e,0x608b28,0xc22929,0xc1282c];
pro.setAsComplete=function(){
var id=this.ID;
var type=(id%2==0)?1:2;
this.img.setTexture(GodStep.textures['unlock_'+type+'_1']);
this.label.tint=(type==1)?0xff7903:0xffbc11;
this.isDisabled=false;
this.label.updateText();
};
pro.setAsActive=function(){
var id=this.ID;
var type=(id%2==0)?1:2;
this.img.setTexture(GodStep.textures['unlock_'+type+'_2']);
this.label.tint=0x76dbfa;
this.label.updateText();
this.isDisabled=false;
};
pro.destroy=function(){
this.removeChild(this.img);
delEvent(this,GodStep.FRAME_DOWN,this.h_mouse);
delEvent(this,GodStep.FRAME_OUT,this.h_mouse);
delEvent(this,GodStep.FRAME_OVER,this.h_mouse);
delEvent(this,GodStep.FRAME_UP,this.h_mouse);
if(this.label)this.removeChild(this.label);
return this;
};
pro.h_mouse=function(e){
var t=e.content.t;
switch(e.type){
case GodStep.FRAME_DOWN:
this.Scale=this.downScale;
this.isClicked=true;
break;
case GodStep.FRAME_UP:
if(this.isClicked){
dispatch(t,Games.ImgButton.CLICK);
}
this.isClicked=false;
break;
case GodStep.FRAME_OUT:
this.Scale=1;
break;
case GodStep.FRAME_OVER:
if(this.isDown){
this.Scale=this.downScale;
}
break;
}
};
PR.Background=function(parent,name){
this.soul=parent.soul;
this.p=parent;
GodStep.Frame.call(this,'Background',parent.W,parent.H);
this.addChild(this.img=new Games.Img(name||'back_menu',parent.s,this.W*.5,this.H*.5,.5));
};
extend(PR.Background,GodStep.Frame);
pro.rescale=function(s){
this.scale.x=this.scale.y=this.soul.OH/this.soul.H;
this.x=+(this.soul.W-this.soul.W*this.scale.x)/2;
this.y=-(this.soul.DOH)*.5/s;
};
PR.Win=function(soul){
GodStep.LFrame.call(this,soul,'Win');
this.addChild(this.back=new PR.Background(this,'back_fin_animation'));
this.addChild(this.bot=new PIXI.DisplayObjectContainer());
this.addChild(this.top=new PIXI.DisplayObjectContainer());
this.top.addChild(this.anim=new GodStep.MovieClip(['fin_animation_1','fin_animation_2','fin_animation_3'],this.s,this.W*.5,this.H*.32,.5));
this.bot.addChild(this.field_button=new Games.Img('field_button2',this.s,this.W*.5,this.H*-.22,.5));
this.bot.addChild(this.b_next=new Games.ImgButton('b_next_2',this,this.W*.5,-this.H*.22));
this.anim.animTime=20;
addEvent(this.b_next,Games.ImgButton.CLICK,this.h_buttons);
};extend(PR.Win,GodStep.LFrame);
pro.update=function(){
if(this.visible){
this.anim.animate();
}
};
pro.init=function(){
this.visible=true;
};
pro.h_buttons=function(e){
GodStep.playSound('button',0,PR.SOUND);
var p=e.target.parent.parent;
var s=p.soul;
switch(e.target){
case p.b_next:
 if(PR.DEVMODE) {
  s.screenTo([s.dev], p);
 } else {
  s.screenTo([s.startmenu], p);
 }
break;
}
};
Object.defineProperty(pro,'Scale',{
get:function(){
return this.scale.x;
},
set:function(value){
var s=this.soul;
this.back.rescale(value);
this.scale.x=this.scale.y=value;
this.top.y=(-s.DOH/2)/value;
this.bot.y=(s.OH-s.DOH/2)/value;
}
});
PR.Fail=function(soul){
GodStep.LFrame.call(this,soul,'Fail');
this.addChild(this.back=new PR.Background(this,'back_fail'));
this.addChild(this.bot=new PIXI.DisplayObjectContainer());
this.addChild(this.top=new PIXI.DisplayObjectContainer());
this.top.addChild(this.field_score_win=new Games.Img('field_score_fail',this.s,this.W*.5,this.H*.13,.5));
this.top.addChild(this.pers1=new GodStep.MovieClip(['pers_f_1','pers_f_1_0'],this.s,this.W*.16,this.H*.2,.5));
this.top.addChild(this.pers2=new GodStep.MovieClip(['pers_f_2','pers_f_2_0'],this.s,this.W*.84,this.H*.2,.5));
this.top.addChild(this.label_score=new PR.Text('12313',160*this.s,this.W*.32,this.H*.08,'center',0xffffff));
this.bot.addChild(this.label=new PR.Text(PR.S('try again'),240*this.s,this.W*.12,-this.H*.68,'center',0xffffff));
this.bot.addChild(this.label_level=new PR.Text('LEVEL 1',140*this.s,this.W*.32,-this.H*.73,'center',0x6f3873));
this.bot.addChild(this.field_record=new Games.Img('field_record',this.s,this.W*.5,this.H*-.42,.5));
this.bot.addChild(this.label_record=new PR.Text('New Record    12323',130*this.s,this.W*.32,-this.H*.488,'center',0xffffff));
this.bot.addChild(this.star=new Games.Img('star',this.s,this.W*.5,this.H*-.42,.5));
this.star.pos=new PIXI.Point(this.star.x,this.star.y);
this.bot.addChild(this.field_button=new Games.Img('field_button2',this.s,this.W*.5,this.H*-.22,.5));
this.bot.addChild(this.b_replay=new Games.ImgButton('b_replay',this,this.W*.38,-this.H*.22));
this.bot.addChild(this.b_menu=new Games.ImgButton('b_menu',this,this.W*.62,-this.H*.22));
this.field_score_win.phase=0;
this.pers1.animTime=100;
this.pers2.animTime=111;
this.pers2.animTimer=66;
addEvent(this.b_menu,Games.ImgButton.CLICK,this.h_buttons);
addEvent(this.b_replay,Games.ImgButton.CLICK,this.h_buttons);
this.bot.addChild(this.maska=new PIXI.Graphics());
this.field_record.mask=this.maska;
this.field_button.mask=this.maska;
this.maska.y=this.field_button.y-this.field_button.height;
this.maska.beginFill(0,1);
this.maska.drawRect(0,-this.field_button.height*2,this.field_button.width,this.field_button.height*5);
this.maska.endFill();
};extend(PR.Fail,GodStep.LFrame);
pro.update=function(){
if(this.visible){
var w=this.W*.005;
this.star.x=Math.random()*w+this.star.pos.x-w*2;
this.star.y=Math.random()*w+this.star.pos.y-w*2;
this.field_score_win.phase+=.05;
this.field_score_win.y+=Math.min(this.H*.05,(this.H*.13-this.field_score_win.y+Math.sin(this.field_score_win.phase)*.01*this.W)*.3);
this.field_button.x+=Math.min(this.W*.1,(this.W*.5-this.field_button.x)*.3);
this.field_record.x+=Math.max(-this.W*.1,(this.W*.5-this.field_record.x)*.3);
this.label_score.y=this.field_score_win.y-this.H*.05;
this.label.x+=Math.max(-this.W*.1,((this.W-this.label.width)/2-this.label.x)*.3);
this.pers1.animate();
this.pers2.animate();
this.b_menu.scale.x=this.b_menu.scale.y+=(1-this.b_menu.scale.x)*.03;
this.b_replay.scale.x=this.b_replay.scale.y+=(1-this.b_replay.scale.x)*.05;
}
};
pro.init=function(){
GodStep.playSound('lose',0,PR.SOUND);
this.visible=true;
this.field_score_win.phase=0;
this.field_button.x=-this.W*2;
this.field_score_win.y=-this.H*1.5;
this.field_record.x=this.W*2;
this.b_menu.scale.x=this.b_menu.scale.y=
this.b_replay.scale.x=this.b_replay.scale.y=0;
this.label_record.setText((this.soul.gameplay.isNewRecord?PR.S('new record'):PR.S('score'))+'    '+this.soul.gameplay.points);
this.label_level.setText(PR.S('level')+' '+(PR.LAST_LEVEL_SELECTED+1));
this.label_score.setText(this.soul.gameplay.points+'');
this.label.updateText();
this.label_record.updateText();
this.label_score.updateText();
this.label_level.updateText();
this.label_level.x=(this.W-this.label_level.width)/2;
this.label.x=-(this.W);
this.label_record.x=(this.W-this.label_record.width)/2;
this.label_score.x=(this.W-this.label_score.width)/2;
this.star.x=this.label_record.x+this.W*.585;
this.star.pos=new PIXI.Point(this.star.x,this.star.pos.y);
this.star.visible=this.soul.gameplay.isNewRecord;
};
pro.h_buttons=function(e){
GodStep.playSound('button',0,PR.SOUND);
var p=e.target.parent.parent;
var s=p.soul;
switch(e.target){
case p.b_menu:
s.screenTo([s.levelselect],p);
break;
case p.b_replay:
s.screenTo([s.gameplay],p);
break;
}
};
Object.defineProperty(pro,'Scale',{
get:function(){
return this.scale.x;
},
set:function(value){
var s=this.soul;
this.back.rescale(value);
this.scale.x=this.scale.y=value;
this.top.y=(-s.DOH/2)/value;
this.bot.y=(s.OH-s.DOH/2)/value;
}
});
PR.Victory=function(soul){
GodStep.LFrame.call(this,soul,'Victory');
this.addChild(this.back=new PR.Background(this,'back_win'));
this.addChild(this.bot=new PIXI.DisplayObjectContainer());
this.addChild(this.top=new PIXI.DisplayObjectContainer());
this.top.addChild(this.field_score_win=new Games.Img('field_score_win',this.s,this.W*.5,this.H*.13,.5));
this.top.addChild(this.pers1=new GodStep.MovieClip(['pers_fg_1','pers_fg_1_0'],this.s,this.W*.18,this.H*.2,.5));
this.top.addChild(this.pers2=new GodStep.MovieClip(['pers_v_1','pers_v_1_0'],this.s,this.W*.82,this.H*.2,.5));
this.top.addChild(this.label_score=new PR.Text('12313',160*this.s,this.W*.32,this.H*.08,'center',0xffffff));
this.bot.addChild(this.label=new PR.Text(PR.S('victory').toUpperCase(),240*this.s,this.W*.12,-this.H*.68,'center',0xffffff));
this.bot.addChild(this.label_level=new PR.Text('LEVEL 1',140*this.s,this.W*.32,-this.H*.73,'center',0x6f3873));
this.bot.addChild(this.field_record=new Games.Img('field_record',this.s,this.W*.5,this.H*-.42,.5));
this.bot.addChild(this.label_record=new PR.Text('New Record    12323',130*this.s,this.W*.32,-this.H*.488,'center',0xffffff));
this.bot.addChild(this.star=new Games.Img('star',this.s,this.W*.5,this.H*-.414,.5));
this.pers1.animTime=100;
this.pers2.animTime=111;
this.pers2.animTimer=66;
this.field_score_win.phase=0;
this.bot.addChild(this.field_button=new Games.Img('field_button2',this.s,this.W*.5,this.H*-.22,.5));
this.bot.addChild(this.b_replay=new Games.ImgButton('b_replay',this,this.W*.25,-this.H*.22));
this.bot.addChild(this.b_menu=new Games.ImgButton('b_menu',this,this.W*.5,-this.H*.22));
this.bot.addChild(this.b_next=new Games.ImgButton('b_next_1',this,this.W*.75,-this.H*.22));
this.star.pos=new PIXI.Point(this.star.x,this.star.y);
this.bot.addChild(this.maska=new PIXI.Graphics());
this.field_record.mask=this.maska;
this.field_button.mask=this.maska;
this.maska.y=this.field_button.y-this.field_button.height;
this.maska.beginFill(0,1);
this.maska.drawRect(0,-this.field_button.height*2,this.field_button.width,this.field_button.height*5);
this.maska.endFill();
addEvent(this.b_next,Games.ImgButton.CLICK,this.h_buttons);
addEvent(this.b_menu,Games.ImgButton.CLICK,this.h_buttons);
addEvent(this.b_replay,Games.ImgButton.CLICK,this.h_buttons);
};extend(PR.Victory,GodStep.LFrame);
pro.update=function(){
if(this.visible){
var w=this.W*.005;
this.star.x=Math.random()*w+this.star.pos.x-w*2;
this.star.y=Math.random()*w+this.star.pos.y-w*2;
this.field_score_win.phase+=.05;
this.field_score_win.y+=Math.min(this.H*.05,(this.H*.13-this.field_score_win.y+Math.sin(this.field_score_win.phase)*.01*this.W)*.3);
this.field_button.x+=Math.min(this.W*.1,(this.W*.5-this.field_button.x)*.3);
this.field_record.x+=Math.max(-this.W*.1,(this.W*.5-this.field_record.x)*.3);
this.label_score.y=this.field_score_win.y-this.H*.05;
this.label.x+=Math.max(-this.W*.1,((this.W-this.label.width)/2-this.label.x)*.3);
this.pers1.animate();
this.pers2.animate();
this.b_menu.scale.x=this.b_menu.scale.y+=(1-this.b_menu.scale.x)*.03;
this.b_next.scale.x=this.b_next.scale.y+=(1-this.b_next.scale.x)*.07;
this.b_replay.scale.x=this.b_replay.scale.y+=(1-this.b_replay.scale.x)*.05;
}
};
pro.init=function(){
GodStep.playSound('win',0,PR.SOUND);
this.visible=true;
this.b_menu.scale.x=this.b_menu.scale.y=
this.b_next.scale.x=this.b_next.scale.y=0;
this.b_replay.scale.x=this.b_replay.scale.y=0;
this.field_score_win.phase=0;
this.field_button.x=-this.W*2;
this.field_score_win.y=-this.H*1.5;
this.field_record.x=this.W*2;
this.label_record.setText((this.soul.gameplay.isNewRecord?PR.S('new record'):PR.S('score'))+'    '+this.soul.gameplay.points);
this.label_level.setText(PR.S('level')+' '+(PR.LAST_LEVEL_SELECTED+1));
this.label_score.setText(this.soul.gameplay.points+'');
this.label_record.updateText();
this.label_score.updateText();
this.label.updateText();
this.label_level.updateText();
this.label.x=-(this.W);
this.label_level.x=(this.W-this.label_level.width)/2;
this.label_record.x=(this.W-this.label_record.width)/2;
this.label_score.x=(this.W-this.label_score.width)/2;
this.star.visible=this.soul.gameplay.isNewRecord;
this.star.x=this.label_record.x+this.W*.582;
this.star.pos=new PIXI.Point(this.star.x,this.star.pos.y);
};
pro.h_buttons=function(e){
var p=e.target.parent.parent;
var s=p.soul;
GodStep.playSound('button',0,PR.SOUND);
switch(e.target){
case p.b_menu:
s.screenTo([s.levelselect],p);
break;
case p.b_next:
PR.LAST_LEVEL_SELECTED++;
PR.LAST_LEVEL_DATA=PR.LEVELS[PR.LAST_LEVEL_SELECTED];
s.screenTo([s.gameplay],p);
break;
case p.b_replay:
s.screenTo([s.gameplay],p);
break;
}
};
Object.defineProperty(pro,'Scale',{
get:function(){
return this.scale.x;
},
set:function(value){
var s=this.soul;
this.back.rescale(value);
this.scale.x=this.scale.y=value;
this.top.y=(-s.DOH/2)/value;
this.bot.y=(s.OH-s.DOH/2)/value;
}
});
PR.Settings=function(soul){
PR.TUTORIAL=true;
GodStep.LFrame.call(this,soul,'Settings');
GodStep.IDownUp.call(this,this.W,this.H);
this.addChild(this.back=new PR.Background(this,'back_options'));
this.addChild(this.top=new PIXI.DisplayObjectContainer());
this.addChild(this.center=new PIXI.DisplayObjectContainer());
this.top.addChild(this.b_back=new Games.ImgButton('b_back',this,this.W*.15,this.H*.1));
this.top.addChild(this.label=new PR.Text(PR.S('options'),170*this.s,this.W*.3,this.H*.01,'center',0xffffff));
this.center.addChild(this.b_music=new Games.ImgButton('slider_on',this,this.W*.6,this.H*.3));
this.center.addChild(this.b_sound=new Games.ImgButton('slider_on',this,this.W*.6,this.H*.48));
this.center.addChild(this.b_tutorial=new Games.ImgButton('tutorial_on',this,this.W*.36,this.H*.70));
this.b_music.addChild(this.b_music.lab=new PR.Text(PR.S('on'),140*this.s,-this.W*.08,-this.H*.075,'center',0x0092e0));
this.b_sound.addChild(this.b_sound.lab=new PR.Text(PR.S('on'),140*this.s,-this.W*.08,-this.H*.075,'center',0x0092e0));
this.b_tutorial.addChild(this.b_tutorial.lab=new PR.Text(PR.S('tutorial'),140*this.s,-this.W*.12,-this.H*.075,'center',0x0092e0));
this.center.addChild(this.b_music_img=new Games.Img('b_music',this.s,this.W*.25,this.H*.3,.5));
this.center.addChild(this.b_sound_img=new Games.Img('b_sound',this.s,this.W*.25,this.H*.48,.5));
this.center.addChild(this.b_tutor_pers=new Games.Img('pers_2o',this.s,this.W*.73,this.H*.81,.5));
this.b_tutorial.phase=0;
this.b_tutorial.scaleble=this.b_music.scaleble=this.b_sound.scaleble=false;
addEvent(this.b_music,Games.ImgButton.CLICK,this.h_buttons);
addEvent(this.b_sound,Games.ImgButton.CLICK,this.h_buttons);
addEvent(this.b_tutorial,Games.ImgButton.CLICK,this.h_buttons);
addEvent(this.b_back,Games.ImgButton.CLICK,this.h_buttons);
addEvent(this,GodStep.FRAME_UP,this.h_mouse_up);
};
extend(PR.Settings,GodStep.LFrame);
pro.update=function(){
if(this.visible){
var s=this.soul;
this.b_tutorial.phase+=0.025;
this.b_tutorial.y+=(this.H*.70+Math.sin(this.b_tutorial.phase)*s.H*.01-this.b_tutorial.y)*.3;
}
};
pro.updateLabels=function(){
this.b_music.lab.updateText();
this.b_sound.lab.updateText();
this.b_tutorial.lab.updateText();
this.b_music.lab.x=-this.b_music.lab.width/2;
this.b_sound.lab.x=-this.b_sound.lab.width/2;
this.b_tutorial.lab.x=-this.b_tutorial.lab.width/2+this.W*.05;
};
pro.init=function(){
this.visible=true;
this.b_tutorial.phase=9;
var p=this;
if(!PR.MUSIC){
p.b_music.setTexture('slider_off');
p.b_music.lab.tint=0x2b6578;
p.b_music.lab.setText(PR.S('off'));
}else{
p.b_music.setTexture('slider_on');
p.b_music.lab.tint=0x0092e0;
p.b_music.lab.setText(PR.S('on'));
}
if(!PR.TUTORIAL){
p.b_tutorial.setTexture('tutorial_off');
p.b_tutorial.lab.tint=0x2b6578;
p.b_tutor_pers.setTexture('pers_1o');
p.b_tutorial.lab.updateText();
}else{
p.b_tutorial.setTexture('tutorial_on');
p.b_tutorial.lab.tint=0x0092e0;
p.b_tutor_pers.setTexture('pers_2o');
p.b_tutorial.lab.updateText();
}
if(!PR.SOUND){
p.b_sound.setTexture('slider_off');
p.b_sound.lab.tint=0x2b6578;
p.b_sound.lab.setText(PR.S('off'));
}else{
p.b_sound.setTexture('slider_on');
p.b_sound.lab.tint=0x0092e0;
p.b_sound.lab.setText(PR.S('on'));
}
this.updateLabels();
};
pro.h_mouse_up=function(e){
var t=e.content.target;
t.b_back.isDown=false;
t.b_back.Scale=1;
};
pro.h_buttons=function(e){
var t=e.content.t;
var p=t.parent.parent;
var s=p.soul;
GodStep.playSound('button',0,PR.SOUND);
switch(t){
case p.b_tutorial:
if(PR.TUTORIAL){
p.b_tutorial.setTexture('tutorial_off');
p.b_tutorial.lab.tint=0x2b6578;
p.b_tutor_pers.setTexture('pers_1o');
}else{
p.b_tutorial.setTexture('tutorial_on');
p.b_tutorial.lab.tint=0x0092e0;
p.b_tutor_pers.setTexture('pers_2o');
}
p.b_tutorial.lab.updateText();
PR.TUTORIAL=!PR.TUTORIAL;
p.soul.savePlayer();
break;
case p.b_music:
if(PR.MUSIC){
p.b_music.setTexture('slider_off');
p.b_music.lab.tint=0x2b6578;
p.b_music.lab.setText(PR.S('off'));
GodStep.volumeSound('theme',!PR.MUSIC);
}else{
p.b_music.setTexture('slider_on');
p.b_music.lab.tint=0x0092e0;
p.b_music.lab.setText(PR.S('on'));
GodStep.volumeSound('theme',!PR.MUSIC);
}
p.b_music.lab.updateText();
PR.MUSIC=!PR.MUSIC;
p.soul.savePlayer();
break;
case p.b_sound:
if(PR.SOUND){
p.b_sound.setTexture('slider_off');
p.b_sound.lab.tint=0x2b6578;
p.b_sound.lab.setText(PR.S('off'));
}else{
p.b_sound.setTexture('slider_on');
p.b_sound.lab.tint=0x0092e0;
p.b_sound.lab.setText(PR.S('on'));
}
p.b_sound.lab.updateText();
PR.SOUND=!PR.SOUND;
p.soul.savePlayer();
break;
case p.b_back:
s.screenTo([s.startmenu],p);
break;
}
p.updateLabels();
};
Object.defineProperty(pro,'Scale',{
get:function(){
return this.scale.x;
},
set:function(value){
var s=this.soul;
this.back.rescale(value);
this.scale.x=this.scale.y=value;
this.top.y=-s.DOH/2/value;
}
});
PR.GamePlay=function(soul){
GodStep.volumeSound('theme',PR.MUSIC);
GodStep.playSound('theme',-1,PR.MUSIC);
GodStep.playSound('start',0,PR.SOUND);
GodStep.LFrame.call(this,soul,'GamePlay');
GodStep.IDownUp.call(this,this.W,this.H);
this.addChild(this.back=new PR.Background(this,'back_game'));
this.addChild(this.fieldContainer=new PIXI.DisplayObjectContainer());
this.addChild(this.footer=new PIXI.DisplayObjectContainer());
this.addChild(this.topSprite=new PIXI.DisplayObjectContainer());
this.topSprite.addChild(this.field_up=new Games.Img('field_up',this.s,this.W*.5,0,new PIXI.Point(0.5,0)));
this.footer.addChild(this.field_down=new Games.Img('field_down',this.s,this.W*.5,0,new PIXI.Point(0.5,1)));
this.addChild(this.container=new PIXI.DisplayObjectContainer());
this.topSprite.addChild(this.lineLeft=new Games.Img('line_left',this.s,0,this.field_up.height,new PIXI.Point(1,0)));
this.topSprite.addChild(this.lineRight=new Games.Img('line_right',this.s,0,this.field_up.height,new PIXI.Point(0,0)));
this.topSprite.addChild(this.icon_save=new Games.Img('icon_save',this.s,this.W*.08,-this.H*.00,new PIXI.Point(0,0)));
this.topSprite.addChild(this.star=new Games.Img('star',this.s,this.W*.72,this.H*.06,new PIXI.Point(0.5,0.5)));
this.fieldContainer.addChild(this.field=new PR.Field(soul,9,9,.9,this));
this.addChild(this.maska=new PIXI.Graphics());
this.star.startS=this.star.scale.x;
this.oS=this.lineRight.scale.x;
this.footer.addChild(this.stepLabel=new PR.Text('124214',110*this.s,this.W*.5,-this.H*.14,'left',0xcbeffa));this.stepLabel.posY=this.stepLabel.y;
this.topSprite.addChild(this.pointLabel=new PR.Text('0',100*this.s,this.W*.8,this.H*.01,'left',0xcbeffa));
this.topSprite.addChild(this.heroLabel=new PR.Text('0',100*this.s,this.W*.46,this.H*.01,'left',0xcbeffa));
this.heroLabel.startS=this.heroLabel.scale.x;
this.heroLabel.pos=new PIXI.Point(this.heroLabel.x,this.heroLabel.y);
this.points=0;
var fw=this.field.W*PR.CELLW_SCALE*this.field.scale.x;
var fd=-this.W*.005;
this.maska.beginFill(0,1);
this.maska.drawRect(fd,fd+2,fw-fd*2,fw-fd*2-4);
this.maska.endFill();
this.field.mask=this.maska;
this.killed=[];
this.container.addChild(this.b_back=new Games.TextButton('back',30*this.s,0x562466,soul.W*.9,soul.H*.05));
this.footer.addChild(this.b_pause=new Games.ImgButton('b_pause',this,this.W*.86,-this.H*.06));
this.footer.addChild(this.b_down=new Games.ImgButton('b_down',this,this.W*.14,-this.H*.06));this.b_down.scaleble=false;
this.b_down.addChild(this.row_label=new PR.Text('0',80*this.s,-this.W*.017,-this.H*.060,'left',0xffffff));
this.addFrame(this.pause=new PR.Pause(soul));
addEvent(this.b_pause,Games.ImgButton.CLICK,this.h_buttons);
addEvent(this.b_back,Games.ImgButton.CLICK,this.h_buttons);
this.topSprite.addChild(this.field_start=new Games.Img('field_start',this.s,this.W*.5,this.H*.5,.5));
this.topSprite.addChild(this.field_fin=new Games.Img('field_fin',this.s,this.W*.5,this.H*.5,.5));
this.field_start.addChild(this.start_label=new PR.Text('12525\nfgjfgjh0',100/GodStep.SCALE,-this.W*.15/this.s,this.H*.037/this.s/GodStep.SCALE,'center',0xffffff));
this.field_fin.addChild(this.fin_label=new PR.Text('12525\nfgjfgjh0',100/GodStep.SCALE,-this.W*.15/this.s,this.H*.09/this.s/GodStep.SCALE,'center',0xffffff));
this.fin_label.pos=new PIXI.Point(this.fin_label.x,this.fin_label.y);
this.field_start.pos=new PIXI.Point(this.W*.5,this.H*.5);
this.field_fin.pos=new PIXI.Point(this.W*.5,this.H*.5);
addEvent(this,GodStep.FRAME_DOWN,this.h_mouse);
addEvent(this,GodStep.FRAME_UP,this.h_mouse);
addEvent(this.field,Games.CELL_UP,this.h_cells);
addEvent(this.field,Games.CELL_DOWN,this.h_cells);
addEvent(this.field,GodStep.FRAME_UP,this.h_field);
this.canMoveTimer=0;
};
extend(PR.GamePlay,GodStep.LFrame);
PR.CANMOVEDELAY=10;
PR.BOMB_DROP=50;
PR.BONUS_DROP=90;
PR.MOVEWAITTIMER=10;
PR.GamePlay.HERO_RANDOMS=[0,1,2,3,4];
pro.init=function(){
GodStep.volumeSound('theme',PR.MUSIC);
GodStep.playSound('theme',-1,PR.MUSIC);
GodStep.playSound('start',0,PR.SOUND);
this.heroRandom=[0,1,2];
if(PR.LAST_LEVEL_SELECTED>9)this.heroRandom.push(3);
if(PR.LAST_LEVEL_SELECTED>19)this.heroRandom.push(4);
var hrc=this.heroRandom.length;
var hra=[];
for(var h=0;h<hrc;h++){
var hid=parseInt(Math.random()*this.heroRandom.length);
hra.push(this.heroRandom[hid]);
this.heroRandom.splice(hid,1);
}
PR.GamePlay.HERO_RANDOMS=hra;
this.lastPoints=0;
this.field_start.vis=true;
this.field_fin.vis=false;
this.field_fin.y=this.H*2;
this.isNewRecord=false;
this.field_start.y=-this.H*.2;
this.isFirstClick=true;
this.initTimer=130;
this.fin_label.setText(PR.S('game over'));
this.fin_label.updateText();
this.fin_label.x=-this.W*.0/this.s-this.fin_label.width/2;
this.fin_label.y=this.fin_label.pos.y-this.fin_label.height/2;
this.field_fin.visible=true;
this.field_start.visible=true;
this.killed=[];
this.isGameStarted=true;
this.topCell=0;
GodStep.ISEDITMODE=false;
this.isFinished=false;
this.moveDownTimer=PR.MOVEWAITTIMER;
this.visible=true;
this.isOver=false;
this.isWin=false;
this.winTimer=-1;
this.overTimer=-1;
this.pause.visible=false;
var level;
this.selected=[];
this.points=0;
this.b_back.visible=GodStep.DEVMODE;
if(GodStep.DEVMODE){
this.field.setData(level=GodStep.TEST_DATA);
}else{
level=PR.PetResque.instance.SETTINGS.levels[PR.LAST_LEVEL_SELECTED];
this.field.initTutorial(PR.TUTORIAL);
this.field.setData(level);
this.field.completeCell=null;
}
this.steps=level.params.steps;
this.noSteps=this.steps==0;
this.bombDrop=30;
this.bonusDrop=70;
this.heroesCount=this.field.heroes.length;
this.pointLabel.setText(0+'');
this.stepLabel.setText(level.params.steps+' '+(level.params.steps==1?PR.S('move'):PR.S('moves')));
this.stepLabel.visible=(this.steps!=0);
this.heroLabel.setText(0+'/'+this.heroesCount);
this.heroLabel.scale.x=this.heroLabel.scale.y*=1.3;
this.colors=this.field.colors;
this.stepLabel.updateText();
this.stepLabel.x=(this.W-this.stepLabel.width)/2;
this.generateInstant();
this.updateRowLabel();
this.start_label.setText(PR.S('save')+' '+this.heroesCount+' '+((this.heroesCount==1)?PR.S('critter'):PR.S('critters'))+'!'+(this.steps==0?'':'\n'+PR.S('in')+' '+this.steps+" "+PR.S('moves')));
this.start_label.updateText();
this.start_label.x=-this.W*.0/this.s-this.start_label.width/2;
this.start_label.y=this.fin_label.pos.y-this.start_label.height/2;
this.b_down.visible=(this.field.cellCountY-9>0);
this.Scale=this.scale.x;
};
pro.moveCellsLeft=function(cell,cells){
var c=cell;
var leftCell;
if(c.xi!=0){
var y=c.yi;
while(1){
if(!cells[y]){
return;
}else{
c=cells[y][cell.xi];
}
var obj=c.getObject();
if(obj){
if(!obj.isBlock){
leftCell=cells[y][cell.xi-1];
if(!leftCell.isBusy()){
obj.setCell(leftCell);
}else{
return;
}
}else{
return;
}
y--;
}else{
return;
}
}
}
};
pro.update=function(){
if(this.visible){
this.pause.update();
this.field.update();
this.field_start.y+=((this.field_start.vis?this.field_start.pos.y:this.H*2)-this.field_start.y)*.06;
this.field_fin.y+=((this.field_fin.vis?this.field_fin.pos.y:this.H*2)-this.field_fin.y)*.06;
this.heroLabel.scale.x=this.heroLabel.scale.y+=(this.heroLabel.startS-this.heroLabel.scale.x)*.1;
this.heroLabel.x=this.heroLabel.pos.x+this.heroLabel.width/2*(this.heroLabel.startS-this.heroLabel.scale.x);
this.heroLabel.y=this.heroLabel.pos.y+this.heroLabel.height/2*(this.heroLabel.startS-this.heroLabel.scale.x);
this.stepLabel.y+=(this.stepLabel.posY-this.stepLabel.y)*.1;
this.star.scale.x=this.star.scale.y+=(this.star.startS-this.star.scale.x)*.05;
var j,i,o;
var fcx=this.field.cellCountX;
var fcy=this.field.cellCountY;
var cells=this.field.cellsXY;
var cell,cellRow,guests,obj,dy,downCellRow,downCell,isMovedDown;
var t=this.W*.020;
var d=this.W*.020;
var dddy=0;
var justDroped=this.justDroped=false;
var isAllNotInPlace=false;
var countEmpty=0;
for(j=0;j<fcx;j++){
for(i=fcy-1;i>=0;i--){
cellRow=cells[i];
cell=cellRow[j];
cell.animate();
guests=cell.guests;
if(i==this.topCell){
if(guests.length==0){
countEmpty++;
}else{
if(guests[0].isGround){
countEmpty++;
}
}
}
if(i==0){
if(!cell.isBusy()){
this.generate(cell);
}
}
for(o=0;o<guests.length;o++){
obj=guests[o];
obj.update();
if(obj.isDynamic){
dy=obj.nextPlace.y-obj.y-obj.deltaXY;
if(dy<-1){
obj.sy+=.17;
downCellRow=cells[cell.yi+1];
if(downCellRow){
downCell=downCellRow[cell.xi];
if(!downCell.isBusy()){
obj.cell.delGuest(obj);
obj.cell=downCell;
downCell.pushGuest(obj);
obj.applyCellPostion();
this.isCanMove=false;
this.canMoveTimer=PR.CANMOVEDELAY;
}
}
}else
if(dy<t){
downCellRow=cells[cell.yi+1];
if(downCellRow){
downCell=downCellRow[cell.xi];
if(!downCell.isBusy()){
obj.setCell(downCell);
isMovedDown=true;
justDroped=true;
this.moveDownTimer=PR.MOVEWAITTIMER;
this.isCanMove=false;
this.canMoveTimer=PR.CANMOVEDELAY;
}
}
obj.sy*=.8;
}else{
this.moveDownTimer=PR.MOVEWAITTIMER;
isAllNotInPlace=true;
this.isCanMove=false;
this.canMoveTimer=PR.CANMOVEDELAY;
dy+=obj.sy;
obj.sy+=.17;
}
var ddy=0;
obj.x+=Math.min(Math.max(-d,(obj.nextPlace.x-obj.deltaXY-obj.x)*.5),d);
obj.y+=ddy=Math.min(Math.max(-d*1.7,(dy*obj.sy)*.5),d*1.7);
dddy=Math.max(ddy,dddy);
}
}
}
}
if(countEmpty==fcx&&fcy>9){
this.topCell++;
this.topCell=Math.min(this.topCell,fcy-9);
this.updateRowLabel();
}
this.fieldContainer.y+=(-this.topCell*this.field.cellW*this.field.scale.x-this.fieldContainer.y)*.1;
for(var k=0;k<this.killed.length;k++){
var killed=this.killed[k];
killed.move();
}
if(this.moveDownTimer>0){
this.moveDownTimer--;
var gObj,leftCell;
if(this.moveDownTimer<5){
for(i=0;i<fcx;i++){
for(j=0;j<fcy;j++){
cell=cells[j][i];
obj=cell.getObject();
if(obj){
if(obj.isDynamic){
leftCell=cells[j][i-1];
if(leftCell){
if(!leftCell.isBusy()){
var canMoveLeft=false;
if(j==fcy-1){
canMoveLeft=true;
}else{
downCellRow=cells[j+1];
if(downCellRow){
downCell=downCellRow[i];
gObj=downCell.getObject();
if(gObj){
if(gObj.isGround){
canMoveLeft=true;
}
}
}
}
if(canMoveLeft){
this.canMoveTimer+=5;
this.isCanMove=false;
this.moveDownTimer=PR.MOVEWAITTIMER;
this.moveCellsLeft(cell,cells);
}
}
}
}
}
}
}
}
}
if(!this.isCanMove){
if(this.canMoveTimer==0){
this.isCanMove=true;
if(!this.findCombo()){
this.over();
trace('OVER');
}else{
trace('NO COMBO');
}
}
this.canMoveTimer--;
}
for(var h=0;h<fcx;h++){
cell=cells[fcy-1][h];
obj=cell.getObject();
if(obj){
if(obj.isHero){
if(!obj.isKilled){
this.destroyCell(obj.cell);
obj.cell.setCost(1000);
this.isCanMove=false;
this.canMoveTimer=this.moveDownTimer=PR.MOVEWAITTIMER*10;
this.points+=1000;
this.updatePoints();
}
}
}
}
if(this.initTimer>-1){
if(this.initTimer--==0){
this.field_start.vis=false;
this.isFirstClick=false;
}
}
if(this.winTimer>-1){
if(this.winTimer--==0){
if(PR.LAST_LEVEL_SELECTED==this.soul.PLAYER.levels.length-1){
this.soul.screenTo([this.soul.win],this);
}else{
this.soul.screenTo([this.soul.victory],this);
}
}
}
if(this.overTimer>-1){
if(this.overTimer==80){
this.field_fin.y=-this.H*2;
this.field_fin.vis=true;
}
if(this.overTimer--==0){
this.soul.screenTo([this.soul.fail],this);
}
}
}
};
pro.updateRowLabel=function(){
this.row_label.setText((this.field.cellCountY-9-this.topCell)+'');
this.row_label.updateText();
this.row_label.x=-this.W*.003-this.row_label.width/2;
};
pro.findCombo=function(){
var cells=this.field.cellsXY;
var i,j,cell;
var fcx=this.field.cellCountX;
var fcy=Math.min(cells.length,9)+this.topCell;
var left,right,top,bot;
var isHaveColored=false;
var bonus=false;
for(i=0;i<fcx;i++){
for(j=this.topCell;j<fcy;j++){
cell=cells[j][i].getColored();
bonus=cells[j][i].getBonus();
if(bonus)return true;
if(cell){
isHaveColored=true;
if(cells[j-1]){
top=cells[j-1][i].getColored();
if(top){
if(top.t==cell.t){
return true;
}
}
}
if(cells[j+1]&&j+1<fcy){
bot=cells[j+1][i].getColored();
if(bot){
if(bot.t==cell.t){
return true;
}
}
}
left=cells[j][i-1];
right=cells[j][i+1];
if(left){
left=left.getColored();
if(left){
if(left.t==cell.t){
return true;
}
}
}
if(right){
right=right.getColored();
if(right){
if(right.t==cell.t){
return true;
}
}
}
}
}
}
if(isHaveColored)return false;
return true;
};
pro.win=function(){
this.isWin=true;
this.winTimer=100;
this.overTimer=-1;
this.isOver=false;
if(!this.soul.PLAYER.levels[PR.LAST_LEVEL_SELECTED]){
this.soul.PLAYER.levels[PR.LAST_LEVEL_SELECTED]=[0,0];
}
var level=this.soul.PLAYER.levels[PR.LAST_LEVEL_SELECTED];
level[0]=1;
if(level[1]<this.points){
level[1]=this.points;
this.isNewRecord=true;
}
this.fin_label.setText(PR.S('you win'));
this.fin_label.updateText();
this.fin_label.x=-this.W*.0/this.s-this.fin_label.width/2;
this.fin_label.y=this.fin_label.pos.y-this.fin_label.height/2;
this.field_fin.vis=true;
this.field_fin.y=-this.H*2;
this.soul.savePlayer();
};
pro.over=function(text){
if(!this.isWin){
this.isOver=true;
this.fin_label.setText(text?text:PR.S('no moves'));
this.fin_label.updateText();
this.fin_label.x=-this.W*.0/this.s-this.fin_label.width/2;
this.fin_label.y=this.fin_label.pos.y-this.fin_label.height/2;
this.overTimer=170;
var level=this.soul.PLAYER.levels[PR.LAST_LEVEL_SELECTED];
if(level[1]<this.points){
level[1]=this.points;
this.isNewRecord=true;
this.soul.savePlayer();
}
}
};
pro.generateInstant=function(){
var cells=this.field.cellsXY;
var cell;
for(var i=0;i<this.field.cellCountX;i++){
for(var j=0;j<this.field.cellCountY;j++){
cell=cells[j][i];
if(cell.guests.length==0){
var cid=this.colors[parseInt(Math.random()*this.colors.length)];
var type=PR.Cell.STANDART[cid];
this.field.addCellObject(new PR.CellObject(type,this.s,cell,this.colors));
this.emptyCount++;
}
}
}
};
pro.generate=function(cell){
if(this.hero){
if(cell.xi==this.hero.targetCell.xi){
this.hero.cell.delGuest(this.hero);
cell.pushGuest(this.hero);
this.hero.cell=cell;
this.hero.applyCellPostion();
this.hero=null;
return;
}
}
if(this.noSteps){
}else{
var cid=this.colors[parseInt(Math.random()*this.colors.length)];
var type=PR.Cell.STANDART[cid];
var obj;
if(!this.noSteps){
if(this.field.isBomb){
if(this.bombDrop--==0){
obj=new PR.CellObject('bomb',this.s,cell,this.colors,this.field.getRandomColors());
this.bombDrop=PR.BOMB_DROP-parseInt(Math.random()*10);
}
}
if(this.field.isBonus){
if(!obj){
if(this.bonusDrop--==0){
obj=new PR.CellObject('s_bonus',this.s,cell,this.colors,this.field.getRandomColors());
this.bonusDrop=PR.BONUS_DROP-parseInt(Math.random()*20);
}
}
}
}
if(!obj){
obj=new PR.CellObject(type,this.s,cell,this.colors,this.field.getRandomColors());
}
this.field.addCellObject(obj);
obj.y-=cell.H;
this.emptyCount++;
}
};
pro.selectCell=function(cell){
if(cell.yi-this.topCell>8){
return;
}
var obj=cell.getObject();
var object;
cell.Selected=true;
this.selected.push(cell);
var cells=this.field.cellsXY;
var arr=[];
if(cell.yi<this.field.cellCountY-1){
arr.push(cells[cell.yi+1][cell.xi]);
}
if(cell.yi>0){
arr.push(cells[cell.yi-1][cell.xi]);
}
if(cell.xi<this.field.cellCountX-1){
arr.push(cells[cell.yi][cell.xi+1]);
}
if(cell.xi>0){
arr.push(cells[cell.yi][cell.xi-1]);
}
var a;
for(var i=0;i<arr.length;i++){
a=arr[i];
if(!a.isSelected){
object=a.getObject();
if(object){
if(object.isColored){
if(object.t==obj.t){
this.selectCell(a);
}
}
}
}
}
};
pro.updatePoints=function(){
this.pointLabel.setText(this.points+'');
this.pointLabel.updateText();
if(this.points%100==0||this.points%1000==0){
this.star.scale.x=this.star.scale.y*=1.3;
}
this.lastPoints=this.points;
};
pro.selectCells=function(cell){
var selected=this.selected;
while(selected.length){
selected[0].Selected=false;
selected.splice(0,1);
}
if(cell){
this.selectCell(cell);
if(this.selected.length==1){
cell.Selected=false;
this.selected=[];
GodStep.playSound('miss_tap',0,PR.SOUND);
}else{
GodStep.playSound('tap',0,PR.SOUND);
}
}
};
pro.destroyBonuses=function(cell){
var cells=this.field.cells;
var obj=cell.getObject();
var type=obj.ctype;
this.field.delCellObject(obj.destroy());
GodStep.playSound('petard',0,PR.SOUND);
var arr=[];
for(var i=0;i<cells.length;i++){
obj=cells[i].getObject();
if(obj){
if(obj.isColored){
if(obj.ctype==type){
arr.push(cells[i]);
}
}
}
}
var cost=arr.length*10;
var points=arr.length*10*arr.length;
this.points+=points;
this.updatePoints();
for(var c in arr){
this.destroyCell(arr[c]);
arr[c].setCost(cost);
}
};
pro.destroyBomb=function(cell){
var cells=this.field.cellsXY;
var obj=cell.getObject();
var arr=[];
var p=obj.parent;
p.removeChild(obj);
p.addChild(obj);
GodStep.playSound('bomb',0,PR.SOUND);
obj.isDestroyed=true;
if(cell.xi<this.field.cellCountX-1){
arr.push(cells[cell.yi][cell.xi+1]);
if(cells[cell.yi-1]){
arr.push(cells[cell.yi-1][cell.xi+1]);
}
if(cells[cell.yi+1]){
arr.push(cells[cell.yi+1][cell.xi+1]);
}
}
if(cell.xi>0){
arr.push(cells[cell.yi][cell.xi-1]);
if(cells[cell.yi-1]){
arr.push(cells[cell.yi-1][cell.xi-1]);
}
if(cells[cell.yi+1]){
arr.push(cells[cell.yi+1][cell.xi-1]);
}
}
if(cell.yi<this.field.cellCountY-1){
arr.push(cells[cell.yi+1][cell.xi]);
}
if(cell.yi>0){
arr.push(cells[cell.yi-1][cell.xi]);
}
var points=0;
var count=0;
for(var o=0;o<arr.length;o++){
obj=arr[o].getObject();
if(obj){
if(obj.isColored){
count++;
}
}
}
var cost=count*10;
for(var i=0;i<arr.length;i++){
obj=arr[i].getObject();
if(obj){
if(obj.isBomb){
if(!obj.isDestroyed){
this.destroyBomb(obj.cell);
}
}else
if(obj.isHero||obj.isGround||obj.isBonus){
}else{
this.destroyCell(arr[i]);
arr[i].setCost(cost);
}
}
}
points+=cost*count;
this.destroyCell(cell);
cell.setCost(300);
this.points+=300+points;
this.updatePoints();
};
pro.destroyCell=function(cell){
var obj=cell.getObject();
if(obj){
cell.Selected=false;
this.killed.push(obj);obj.isKilled=true;obj.cell.Selected=false;
if(obj.typeName=='dirt'){
obj.dirt.nextFrame();
}else
if(obj.typeName=='hero'){
}
else{
obj.img.nextFrame();
}
}
};
pro.destroyCells=function(){
var cost=this.selected.length*10;
var points=cost*this.selected.length;
this.points+=points;
GodStep.playSound('pop',0,PR.SOUND);
this.updatePoints();
var isCageSound=true;
while(this.selected.length){
var cell=this.selected[0];
this.destroyCell(cell);
this.selected.splice(0,1);
cell.setCost(cost);
cell.isKilled=true;
var object=(cell.guests.length>0)?cell.guests[0]:null;
if(object){
if(object.isHeroTrap&&isCageSound){
isCageSound=false;
GodStep.playSound('cage',0,PR.SOUND);
}
}
}
this.isCanMove=false;
this.canMoveTimer=PR.CANMOVEDELAY*6;
this.moveDownTimer=PR.MOVEWAITTIMER*6;
};
pro.step=function(){
if(!this.noSteps){
this.steps--;
this.stepLabel.setText(this.steps+' '+(this.steps==1?'move':'moves'));
this.stepLabel.updateText();
this.stepLabel.x=(this.W-this.stepLabel.width)/2;
if(this.steps%10==0){
this.stepLabel.y=this.stepLabel.posY-this.H*.01;
}
if(this.steps==0){
this.over(PR.S('no moves'));
}
}
};
pro.mouseUp=function(cell){
var p=this;
var object=(cell)?cell.getObject():null;
var type=-1;
if(this.isCanMove&&this.field.isTutorial&&!this.isFirstClick&&(this.selected.length>0||object.isBonus||object.isBomb)){
if(this.field.completeCell){
var ccell=this.field.cellsXY[this.field.completeCell.y][this.field.completeCell.x];
var color=ccell.getColored();
var cellColor=cell.getColored();
if(cell==ccell){
this.field.animPhase++;
}else{
if((!color||!cellColor))return;
if(color.t==cellColor.t){
this.field.animPhase++;
}else{
return;
}
}
}
}
if(object){
type=object.t;
}
if(cell){
if(cell.yi-p.topCell>8){
p.selectCells(null);
return;
}
}
var isFound=false;
if(p.selected.length>0){
for(var s=0;s<p.selected.length;s++){
if(p.selected[s]==cell){
isFound=true;
}
}
var obj=p.selected[0].getObject();
if(obj&&isFound){
if(obj.t==type){
p.step();
p.destroyCells();
}else{
p.selectCells(null);
}
}else{
p.selectCells(null);
}
}else{
if(object){
if(p.bonusCell==object.cell){
p.bonusCell.Selected=false;
if(object.isBonus){
p.step();
p.destroyBonuses(p.bonusCell);
}else if(object.isBomb){
if(p.isCanMove){
p.step();
p.destroyBomb(p.bonusCell);
}
}
}else{
if(p.bonusCell){
p.bonusCell.Selected=false;
}
}
p.bonusCell=null;
}else{
if(p.bonusCell){
p.bonusCell.Selected=false;
p.bonusCell=null;
}
}
}
};
pro.h_field=function(e){
var t=e.target;
if(e.content.getLocalPosition){
var p=e.content.getLocalPosition(t);
var cell=t.getCellByCoord(p.x,p.y);
t.parent.parent.mouseUp(cell);
}
};
pro.h_cells=function(e){
var t=e.target;
var p=t.parent.parent;
var cell=e.content.data;
var object;
if(!p.isOver&&!p.pause.visible&&p.isCanMove&&!p.isWaitAnimations&&!p.isFirstClick&&!p.isWin){
switch(e.type){
case Games.CELL_UP:
break;
case Games.CELL_DOWN:
object=cell.getObject();
if(object){
if(object.isColored&&!object.isDirt){
p.selectCells(cell);
}else{
if(object.isBonus||object.isBomb){
p.bonusCell=cell;
cell.Selected=true;
}
}
}
break;
}
}
p.isFirstClick=false;
};
pro.h_buttons=function(e){
var t=e.content.t;
var p=t.parent.parent;
var s=p.soul;
GodStep.playSound('button',0,PR.SOUND);
switch(t){
case p.b_back:
GodStep.ISEDITMODE=true;
s.screenTo([s.dev],p);
break;
case p.b_pause:
p.pause.init();
break;
}
};
pro.h_mouse=function(e){
var t=e.content.target;
switch(e.type){
case GodStep.FRAME_DOWN:
if(t.isGameStarted&&!t.isFail){
t.field_start.vis=false;
}
break;
case GodStep.FRAME_UP:
break;
}
};
Object.defineProperty(pro,'Scale',{
get:function(){
return this.scale.x;
},
set:function(value){
var s=this.soul;
this.scale.x=this.scale.y=value;
this.pause.Scale=value;
this.pause.y=-(this.soul.DOH/2)/value;
this.container.y=-(this.soul.DOH/2)/value;
this.back.rescale(value);
var fx=(this.W-this.field.W*PR.CELLW_SCALE*this.field.scale.x)*.5;
this.lineLeft.x=fx;
this.lineRight.x=this.W-fx;
this.maska.x=this.field.x=fx;
this.maska.y=this.field.y=(s.OH-s.DOH/2-s.H*.13)/value-Math.min(9,this.field.cellCountY)*this.field.cellW*this.field.scale.x;
this.topSprite.y=-s.DOH/2/value;
this.footer.y=(s.DOH/2+s.H)/value;
var dy=(this.lineLeft.y+this.field_down.height)*value;
this.lineLeft.scale.y=this.lineRight.scale.y=.75*this.oS*((s.OH-this.lineLeft.y-this.field_down.height)/(s.H-this.lineLeft.y-this.field_down.height));
this.lineLeft.scale.y=this.lineRight.scale.y=1*this.oS*((s.OH-dy)/(s.H-dy));
}
});
PR.Transmission=function(soul){
this.soul=soul;
Games.Transmission.call(this,soul,.09,0xa11655);
};
extend(PR.Transmission,Games.Transmission);
GodStep.Keyboard=function(soul){
this.soul=soul;
if(!GodStep.Keyboard.instance){
GodStep.Keyboard.instance=this;
PIXI.EventTarget.call(this);
document.addEventListener('keydown',this.h_keydown);
document.addEventListener('keyup',this.h_keyup);
this.keys=[];
GodStep.KEY_CONSOLE=192;
GodStep.KEY_1=49;
GodStep.KEY_2=50;
GodStep.KEY_3=51;
GodStep.KEY_4=52;
GodStep.KEY_SPACE=32;
GodStep.KEY_SHIFT=16;
GodStep.KEY_CTRL=17;
GodStep.KEY_ALT=18;
GodStep.KEY_F3=114;
GodStep.KEY_W=87;
GodStep.KEY_A=65;
GodStep.KEY_S=83;
GodStep.KEY_D=68;
GodStep.KEY_LEFT=37;
GodStep.KEY_RIGHT=39;
GodStep.KEY_TOP=38;
GodStep.KEY_BOT=40;
}
};
pro=GodStep.Keyboard.prototype=Object.create(Object.prototype);
pro.h_keyup=function(e){
var inst=GodStep.Keyboard.instance;
inst.keys[e.keyCode]=0;
GodStep.dispatch(inst,GodStep.KEYUP,e.keyCode);
};
pro.h_keydown=function(e){
var inst=GodStep.Keyboard.instance;
if(!inst.keys[e.keyCode]){
inst.keys[e.keyCode]=1;
dispatch(inst,GodStep.KEYPRESS,e.keyCode);
}
else{
inst.keys[e.keyCode]++;
GodStep.dispatch(inst,GodStep.KEYDOWN,e.keyCode);
}
};
pro.focus=function(){
trace('canvas focused');
this.soul.soulview.setAttribute('tabindex','0');
this.soul.soulview.focus();
};
GodStep.IsKeyDown=function(key){
return GodStep.Keyboard.instance.keys[key]>0;
};
GodStep.IsKeyPressed=function(key){
var old=GodStep.Keyboard.instance.keys[key];
if(old==1){
GodStep.Keyboard.instance.keys[key]=2;
}
return old==1;
};
PR.PetResque=function(lang){
this.lang=new PR.Lang(lang);
GodStep.Game.TRANSPARENT=true;
PR.PetResque.instance=this;
PR.PetResque.instance.PLAYER={};
GodStep.Game.call(this,'PetResque',0x101010,PR.Assets,'pr_set111','pr_pl11',PR.DEFAULT_SETTINGS,'auto');
PR.SOUND=PR.MUSIC=true;
this.MW=1536;
this.MH=1854;
};
extend(PR.PetResque,GodStep.Game);
PR.IMAGE_PATH='src/petresque/img/';
PR.SOUND_PATH='src/petresque/sound/';
{
PR.DEFAULT_SETTINGS='{"levels":[{"cellCountX":9,"cellCountY":9,"objects":[{"n":"delete","xi":0,"yi":0},{"n":"delete","xi":2,"yi":0},{"n":"delete","xi":3,"yi":0},{"n":"delete","xi":5,"yi":0},{"n":"delete","xi":6,"yi":0},{"n":"delete","xi":8,"yi":0},{"n":"delete","xi":7,"yi":0},{"n":"delete","xi":1,"yi":0},{"n":"hero","xi":4,"yi":0,"s":1},{"n":"red","xi":2,"yi":1},{"n":"red","xi":3,"yi":1},{"n":"red","xi":4,"yi":1},{"n":"red","xi":5,"yi":1},{"n":"red","xi":6,"yi":1},{"n":"red","xi":2,"yi":2},{"n":"red","xi":3,"yi":2},{"n":"red","xi":4,"yi":2},{"n":"red","xi":5,"yi":2},{"n":"red","xi":6,"yi":2},{"n":"red","xi":2,"yi":3},{"n":"red","xi":3,"yi":3},{"n":"red","xi":4,"yi":3},{"n":"red","xi":5,"yi":3},{"n":"red","xi":6,"yi":3},{"n":"yellow","xi":2,"yi":4},{"n":"yellow","xi":4,"yi":4},{"n":"yellow","xi":3,"yi":4},{"n":"yellow","xi":5,"yi":4},{"n":"yellow","xi":6,"yi":4},{"n":"yellow","xi":6,"yi":5},{"n":"yellow","xi":6,"yi":6},{"n":"yellow","xi":5,"yi":6},{"n":"yellow","xi":5,"yi":5},{"n":"yellow","xi":4,"yi":5},{"n":"yellow","xi":4,"yi":6},{"n":"yellow","xi":3,"yi":6},{"n":"yellow","xi":3,"yi":5},{"n":"yellow","xi":2,"yi":5},{"n":"yellow","xi":2,"yi":6},{"n":"blue","xi":2,"yi":7},{"n":"blue","xi":2,"yi":8},{"n":"blue","xi":3,"yi":7},{"n":"blue","xi":3,"yi":8},{"n":"blue","xi":5,"yi":7},{"n":"blue","xi":4,"yi":8},{"n":"blue","xi":4,"yi":7},{"n":"blue","xi":5,"yi":8},{"n":"blue","xi":6,"yi":7},{"n":"blue","xi":6,"yi":8},{"n":"delete","xi":0,"yi":1},{"n":"delete","xi":1,"yi":1},{"n":"delete","xi":1,"yi":2},{"n":"delete","xi":0,"yi":2},{"n":"delete","xi":0,"yi":3},{"n":"delete","xi":1,"yi":3},{"n":"delete","xi":1,"yi":4},{"n":"delete","xi":0,"yi":4},{"n":"delete","xi":0,"yi":5},{"n":"delete","xi":1,"yi":5},{"n":"delete","xi":1,"yi":6},{"n":"delete","xi":0,"yi":6},{"n":"delete","xi":0,"yi":7},{"n":"delete","xi":1,"yi":7},{"n":"delete","xi":1,"yi":8},{"n":"delete","xi":0,"yi":8},{"n":"delete","xi":7,"yi":1},{"n":"delete","xi":8,"yi":1},{"n":"delete","xi":7,"yi":2},{"n":"delete","xi":8,"yi":2},{"n":"delete","xi":8,"yi":3},{"n":"delete","xi":7,"yi":3},{"n":"delete","xi":7,"yi":4},{"n":"delete","xi":8,"yi":4},{"n":"delete","xi":8,"yi":5},{"n":"delete","xi":7,"yi":5},{"n":"delete","xi":7,"yi":6},{"n":"delete","xi":8,"yi":6},{"n":"delete","xi":8,"yi":7},{"n":"delete","xi":7,"yi":7},{"n":"delete","xi":7,"yi":8},{"n":"delete","xi":8,"yi":8}],"params":{"colors":[0,1,2,3,4],"steps":0,"isBomb":false,"isBonus":false}},{"cellCountX":9,"cellCountY":9,"objects":[{"n":"delete","xi":0,"yi":0},{"n":"delete","xi":1,"yi":0},{"n":"delete","xi":7,"yi":0},{"n":"delete","xi":8,"yi":0},{"n":"hero","xi":4,"yi":0,"s":1},{"n":"hero","xi":0,"yi":1,"s":1},{"n":"hero","xi":8,"yi":1,"s":1},{"n":"delete","xi":2,"yi":0},{"n":"delete","xi":6,"yi":0},{"n":"red","xi":3,"yi":0},{"n":"red","xi":3,"yi":1},{"n":"red","xi":5,"yi":0},{"n":"red","xi":5,"yi":1},{"n":"red","xi":0,"yi":2},{"n":"red","xi":0,"yi":3},{"n":"red","xi":8,"yi":2},{"n":"red","xi":8,"yi":3},{"n":"red","xi":6,"yi":4},{"n":"red","xi":6,"yi":5},{"n":"red","xi":6,"yi":6},{"n":"red","xi":2,"yi":4},{"n":"red","xi":2,"yi":5},{"n":"red","xi":2,"yi":6},{"n":"red","xi":0,"yi":7},{"n":"red","xi":0,"yi":8},{"n":"red","xi":8,"yi":7},{"n":"red","xi":8,"yi":8},{"n":"yellow","xi":1,"yi":2},{"n":"yellow","xi":1,"yi":3},{"n":"yellow","xi":2,"yi":3},{"n":"yellow","xi":2,"yi":2},{"n":"yellow","xi":7,"yi":3},{"n":"yellow","xi":6,"yi":3},{"n":"yellow","xi":6,"yi":2},{"n":"yellow","xi":7,"yi":2},{"n":"yellow","xi":7,"yi":1},{"n":"yellow","xi":6,"yi":1},{"n":"yellow","xi":2,"yi":1},{"n":"yellow","xi":1,"yi":1},{"n":"blue","xi":4,"yi":3},{"n":"blue","xi":4,"yi":4},{"n":"blue","xi":4,"yi":5},{"n":"blue","xi":4,"yi":6},{"n":"blue","xi":4,"yi":7},{"n":"blue","xi":4,"yi":8},{"n":"yellow","xi":6,"yi":7},{"n":"yellow","xi":7,"yi":8},{"n":"yellow","xi":7,"yi":7},{"n":"yellow","xi":6,"yi":8},{"n":"yellow","xi":5,"yi":8},{"n":"yellow","xi":5,"yi":7},{"n":"yellow","xi":1,"yi":7},{"n":"yellow","xi":2,"yi":7},{"n":"yellow","xi":3,"yi":7},{"n":"yellow","xi":3,"yi":8},{"n":"yellow","xi":2,"yi":8},{"n":"yellow","xi":1,"yi":8},{"n":"blue","xi":1,"yi":4},{"n":"blue","xi":1,"yi":5},{"n":"blue","xi":1,"yi":6},{"n":"blue","xi":7,"yi":4},{"n":"blue","xi":7,"yi":5},{"n":"blue","xi":7,"yi":6},{"n":"green","xi":8,"yi":4},{"n":"green","xi":8,"yi":5},{"n":"green","xi":8,"yi":6},{"n":"green","xi":0,"yi":4},{"n":"green","xi":0,"yi":5},{"n":"green","xi":0,"yi":6},{"n":"green","xi":3,"yi":4},{"n":"green","xi":3,"yi":5},{"n":"green","xi":3,"yi":6},{"n":"green","xi":5,"yi":4},{"n":"green","xi":5,"yi":5},{"n":"green","xi":5,"yi":6},{"n":"green","xi":5,"yi":3},{"n":"green","xi":5,"yi":2},{"n":"green","xi":3,"yi":3},{"n":"green","xi":3,"yi":2},{"n":"blue","xi":4,"yi":2},{"n":"blue","xi":4,"yi":1}],"params":{"colors":[0,1,2,3,4],"steps":0,"isBomb":false,"isBonus":false}},{"cellCountX":9,"cellCountY":9,"objects":[{"n":"delete","xi":8,"yi":0},{"n":"delete","xi":8,"yi":1},{"n":"delete","xi":8,"yi":2},{"n":"delete","xi":8,"yi":3},{"n":"delete","xi":7,"yi":3},{"n":"delete","xi":7,"yi":2},{"n":"delete","xi":7,"yi":1},{"n":"delete","xi":7,"yi":0},{"n":"hero","xi":0,"yi":0},{"n":"hero","xi":6,"yi":0},{"n":"hero","xi":3,"yi":0},{"n":"yellow","xi":0,"yi":1},{"n":"yellow","xi":0,"yi":2},{"n":"red","xi":3,"yi":1},{"n":"red","xi":3,"yi":2},{"n":"blue","xi":6,"yi":1},{"n":"blue","xi":6,"yi":2},{"n":"green","xi":4,"yi":1},{"n":"green","xi":4,"yi":2},{"n":"green","xi":5,"yi":2},{"n":"green","xi":5,"yi":1},{"n":"red","xi":0,"yi":3},{"n":"red","xi":0,"yi":4},{"n":"red","xi":1,"yi":4},{"n":"red","xi":6,"yi":3},{"n":"red","xi":6,"yi":4},{"n":"red","xi":7,"yi":4},{"n":"blue","xi":8,"yi":4},{"n":"blue","xi":8,"yi":5},{"n":"blue","xi":8,"yi":6},{"n":"yellow","xi":7,"yi":5},{"n":"yellow","xi":7,"yi":6},{"n":"yellow","xi":6,"yi":6},{"n":"yellow","xi":6,"yi":5},{"n":"red","xi":6,"yi":7},{"n":"red","xi":5,"yi":7},{"n":"red","xi":4,"yi":7},{"n":"red","xi":4,"yi":8},{"n":"red","xi":3,"yi":8},{"n":"red","xi":3,"yi":7},{"n":"yellow","xi":5,"yi":8},{"n":"yellow","xi":6,"yi":8},{"n":"blue","xi":5,"yi":3},{"n":"blue","xi":5,"yi":4},{"n":"blue","xi":4,"yi":3},{"n":"blue","xi":5,"yi":5},{"n":"yellow","xi":3,"yi":3},{"n":"yellow","xi":3,"yi":4},{"n":"yellow","xi":4,"yi":4},{"n":"yellow","xi":4,"yi":5},{"n":"green","xi":5,"yi":6},{"n":"green","xi":4,"yi":6},{"n":"green","xi":3,"yi":6},{"n":"blue","xi":3,"yi":5},{"n":"blue","xi":2,"yi":5},{"n":"yellow","xi":2,"yi":4},{"n":"green","xi":1,"yi":5},{"n":"green","xi":0,"yi":5},{"n":"delete","xi":7,"yi":7},{"n":"delete","xi":7,"yi":8},{"n":"delete","xi":8,"yi":8},{"n":"delete","xi":8,"yi":7},{"n":"yellow","xi":0,"yi":6},{"n":"yellow","xi":0,"yi":7},{"n":"yellow","xi":0,"yi":8},{"n":"red","xi":1,"yi":6},{"n":"red","xi":1,"yi":7},{"n":"red","xi":1,"yi":8},{"n":"blue","xi":2,"yi":8},{"n":"blue","xi":2,"yi":7},{"n":"green","xi":2,"yi":6},{"n":"delete","xi":1,"yi":0},{"n":"delete","xi":1,"yi":1},{"n":"delete","xi":1,"yi":3},{"n":"delete","xi":1,"yi":2},{"n":"delete","xi":2,"yi":3},{"n":"delete","xi":2,"yi":2},{"n":"delete","xi":2,"yi":1},{"n":"delete","xi":2,"yi":0}],"params":{"colors":[0,1,2,4],"steps":0}},{"cellCountX":9,"cellCountY":9,"objects":[{"n":"delete","xi":4,"yi":0},{"n":"delete","xi":3,"yi":0},{"n":"delete","xi":3,"yi":1},{"n":"delete","xi":2,"yi":0},{"n":"delete","xi":2,"yi":1},{"n":"delete","xi":2,"yi":2},{"n":"delete","xi":1,"yi":0},{"n":"delete","xi":1,"yi":1},{"n":"delete","xi":1,"yi":2},{"n":"delete","xi":1,"yi":3},{"n":"delete","xi":0,"yi":0},{"n":"delete","xi":0,"yi":1},{"n":"delete","xi":0,"yi":2},{"n":"delete","xi":0,"yi":3},{"n":"delete","xi":0,"yi":4},{"n":"delete","xi":4,"yi":8},{"n":"delete","xi":5,"yi":8},{"n":"delete","xi":7,"yi":8},{"n":"delete","xi":6,"yi":8},{"n":"delete","xi":8,"yi":8},{"n":"delete","xi":5,"yi":7},{"n":"delete","xi":6,"yi":7},{"n":"delete","xi":7,"yi":7},{"n":"delete","xi":8,"yi":7},{"n":"delete","xi":6,"yi":6},{"n":"delete","xi":7,"yi":6},{"n":"delete","xi":8,"yi":6},{"n":"delete","xi":7,"yi":5},{"n":"delete","xi":8,"yi":5},{"n":"delete","xi":8,"yi":4},{"n":"hero","xi":5,"yi":0},{"n":"hero","xi":7,"yi":0},{"n":"hero","xi":8,"yi":0},{"n":"delete","xi":6,"yi":0},{"n":"red","xi":8,"yi":1},{"n":"red","xi":8,"yi":2},{"n":"yellow","xi":7,"yi":1},{"n":"yellow","xi":7,"yi":2},{"n":"blue","xi":6,"yi":1},{"n":"blue","xi":6,"yi":2},{"n":"red","xi":4,"yi":1},{"n":"red","xi":5,"yi":1},{"n":"red","xi":5,"yi":2},{"n":"yellow","xi":4,"yi":2},{"n":"yellow","xi":4,"yi":3},{"n":"blue","xi":3,"yi":2},{"n":"blue","xi":3,"yi":3},{"n":"blue","xi":2,"yi":3},{"n":"green","xi":5,"yi":3},{"n":"green","xi":6,"yi":3},{"n":"green","xi":6,"yi":4},{"n":"green","xi":6,"yi":5},{"n":"green","xi":5,"yi":6},{"n":"green","xi":5,"yi":5},{"n":"green","xi":5,"yi":4},{"n":"blue","xi":8,"yi":3},{"n":"blue","xi":7,"yi":3},{"n":"blue","xi":7,"yi":4},{"n":"red","xi":0,"yi":7},{"n":"red","xi":1,"yi":7},{"n":"red","xi":1,"yi":8},{"n":"red","xi":2,"yi":5},{"n":"red","xi":2,"yi":6},{"n":"red","xi":3,"yi":8},{"n":"red","xi":3,"yi":7},{"n":"red","xi":0,"yi":5},{"n":"yellow","xi":2,"yi":7},{"n":"yellow","xi":2,"yi":8},{"n":"yellow","xi":0,"yi":8},{"n":"yellow","xi":0,"yi":6},{"n":"yellow","xi":1,"yi":6},{"n":"yellow","xi":1,"yi":5},{"n":"yellow","xi":1,"yi":4},{"n":"yellow","xi":4,"yi":7},{"n":"yellow","xi":4,"yi":6},{"n":"blue","xi":3,"yi":6},{"n":"blue","xi":3,"yi":5},{"n":"blue","xi":4,"yi":5},{"n":"blue","xi":4,"yi":4},{"n":"yellow","xi":3,"yi":4},{"n":"yellow","xi":2,"yi":4}],"params":{"colors":[0,1,2,4],"steps":0}},{"cellCountX":9,"cellCountY":9,"objects":[{"n":"delete","xi":4,"yi":0},{"n":"delete","xi":3,"yi":0},{"n":"delete","xi":3,"yi":1},{"n":"delete","xi":2,"yi":0},{"n":"delete","xi":2,"yi":1},{"n":"delete","xi":2,"yi":2},{"n":"delete","xi":1,"yi":0},{"n":"delete","xi":1,"yi":1},{"n":"delete","xi":1,"yi":2},{"n":"delete","xi":1,"yi":3},{"n":"delete","xi":0,"yi":0},{"n":"delete","xi":0,"yi":1},{"n":"delete","xi":0,"yi":2},{"n":"delete","xi":0,"yi":3},{"n":"delete","xi":6,"yi":0},{"n":"delete","xi":5,"yi":0},{"n":"delete","xi":6,"yi":1},{"n":"delete","xi":5,"yi":1},{"n":"delete","xi":4,"yi":1},{"n":"delete","xi":6,"yi":2},{"n":"delete","xi":6,"yi":3},{"n":"delete","xi":5,"yi":3},{"n":"delete","xi":5,"yi":2},{"n":"delete","xi":4,"yi":2},{"n":"delete","xi":4,"yi":3},{"n":"delete","xi":2,"yi":3},{"n":"delete","xi":3,"yi":2},{"n":"delete","xi":3,"yi":3},{"n":"yellow","xi":7,"yi":1},{"n":"yellow","xi":7,"yi":3},{"n":"yellow","xi":7,"yi":4},{"n":"yellow","xi":6,"yi":4},{"n":"yellow","xi":3,"yi":4},{"n":"yellow","xi":2,"yi":4},{"n":"yellow","xi":0,"yi":4},{"n":"yellow","xi":1,"yi":4},{"n":"yellow","xi":4,"yi":4},{"n":"yellow","xi":1,"yi":5},{"n":"yellow","xi":2,"yi":5},{"n":"yellow","xi":0,"yi":5},{"n":"yellow","xi":3,"yi":5},{"n":"yellow","xi":4,"yi":5},{"n":"yellow","xi":5,"yi":5},{"n":"yellow","xi":7,"yi":6},{"n":"yellow","xi":6,"yi":6},{"n":"yellow","xi":3,"yi":6},{"n":"yellow","xi":0,"yi":6},{"n":"yellow","xi":1,"yi":6},{"n":"yellow","xi":2,"yi":6},{"n":"yellow","xi":4,"yi":6},{"n":"yellow","xi":5,"yi":6},{"n":"yellow","xi":7,"yi":8},{"n":"yellow","xi":7,"yi":7},{"n":"yellow","xi":6,"yi":8},{"n":"yellow","xi":4,"yi":8},{"n":"yellow","xi":4,"yi":7},{"n":"yellow","xi":5,"yi":8},{"n":"yellow","xi":5,"yi":7},{"n":"yellow","xi":3,"yi":7},{"n":"yellow","xi":3,"yi":8},{"n":"yellow","xi":2,"yi":8},{"n":"yellow","xi":2,"yi":7},{"n":"yellow","xi":1,"yi":8},{"n":"yellow","xi":1,"yi":7},{"n":"yellow","xi":0,"yi":7},{"n":"yellow","xi":7,"yi":5},{"n":"yellow","xi":6,"yi":7},{"n":"yellow","xi":7,"yi":2},{"n":"hero","xi":8,"yi":0,"s":1},{"n":"yellow","xi":8,"yi":5},{"n":"blue","xi":8,"yi":1},{"n":"yellow","xi":5,"yi":4},{"n":"yellow","xi":6,"yi":5},{"n":"yellow","xi":8,"yi":6},{"n":"yellow","xi":8,"yi":8},{"n":"yellow","xi":8,"yi":7},{"n":"bomb","xi":0,"yi":8},{"n":"yellow","xi":8,"yi":2},{"n":"yellow","xi":8,"yi":3},{"n":"yellow","xi":8,"yi":4},{"n":"delete","xi":7,"yi":0}],"params":{"colors":[0,2,4],"steps":0,"isBomb":false,"isBonus":false}},{"cellCountX":9,"cellCountY":9,"objects":[{"n":"yellow","xi":3,"yi":4},{"n":"yellow","xi":2,"yi":4},{"n":"yellow","xi":0,"yi":4},{"n":"yellow","xi":1,"yi":4},{"n":"yellow","xi":4,"yi":4},{"n":"yellow","xi":1,"yi":5},{"n":"yellow","xi":0,"yi":5},{"n":"yellow","xi":3,"yi":5},{"n":"yellow","xi":4,"yi":5},{"n":"yellow","xi":3,"yi":6},{"n":"yellow","xi":4,"yi":6},{"n":"yellow","xi":7,"yi":8},{"n":"yellow","xi":5,"yi":8},{"n":"yellow","xi":3,"yi":7},{"n":"blue","xi":8,"yi":4},{"n":"hero","xi":0,"yi":7},{"n":"hero","xi":4,"yi":7},{"n":"hero","xi":8,"yi":7},{"n":"delete","xi":2,"yi":0},{"n":"delete","xi":1,"yi":0},{"n":"delete","xi":0,"yi":0},{"n":"delete","xi":6,"yi":0},{"n":"delete","xi":7,"yi":0},{"n":"delete","xi":8,"yi":0},{"n":"delete","xi":0,"yi":1},{"n":"delete","xi":1,"yi":1},{"n":"delete","xi":7,"yi":1},{"n":"delete","xi":8,"yi":1},{"n":"delete","xi":0,"yi":2},{"n":"delete","xi":8,"yi":2},{"n":"red","xi":3,"yi":0},{"n":"red","xi":3,"yi":1},{"n":"red","xi":2,"yi":1},{"n":"red","xi":1,"yi":2},{"n":"red","xi":0,"yi":3},{"n":"yellow","xi":2,"yi":2},{"n":"yellow","xi":3,"yi":2},{"n":"yellow","xi":3,"yi":3},{"n":"yellow","xi":2,"yi":3},{"n":"yellow","xi":1,"yi":3},{"n":"red","xi":0,"yi":6},{"n":"red","xi":1,"yi":7},{"n":"red","xi":2,"yi":8},{"n":"blue","xi":0,"yi":8},{"n":"yellow","xi":1,"yi":6},{"n":"yellow","xi":2,"yi":6},{"n":"yellow","xi":2,"yi":7},{"n":"yellow","xi":1,"yi":8},{"n":"blue","xi":4,"yi":8},{"n":"blue","xi":8,"yi":8},{"n":"green","xi":8,"yi":6},{"n":"green","xi":8,"yi":5},{"n":"green","xi":7,"yi":5},{"n":"green","xi":7,"yi":6},{"n":"green","xi":6,"yi":5},{"n":"green","xi":6,"yi":6},{"n":"green","xi":5,"yi":6},{"n":"green","xi":5,"yi":5},{"n":"green","xi":5,"yi":4},{"n":"blue","xi":6,"yi":8},{"n":"blue","xi":6,"yi":7},{"n":"blue","xi":7,"yi":7},{"n":"green","xi":5,"yi":7},{"n":"blue","xi":8,"yi":3},{"n":"red","xi":7,"yi":4},{"n":"red","xi":6,"yi":4},{"n":"red","xi":6,"yi":3},{"n":"red","xi":7,"yi":3},{"n":"red","xi":7,"yi":2},{"n":"red","xi":6,"yi":2},{"n":"red","xi":6,"yi":1},{"n":"red","xi":5,"yi":0},{"n":"red","xi":5,"yi":1},{"n":"red","xi":5,"yi":3},{"n":"green","xi":4,"yi":3},{"n":"green","xi":4,"yi":2},{"n":"blue","xi":4,"yi":1},{"n":"blue","xi":4,"yi":0},{"n":"blue","xi":3,"yi":8},{"n":"red","xi":5,"yi":2},{"n":"yellow","xi":2,"yi":5}],"params":{"colors":[0,1,2,4],"steps":0}},{"cellCountX":9,"cellCountY":20,"objects":[{"n":"delete","xi":2,"yi":3},{"n":"delete","xi":7,"yi":4},{"n":"delete","xi":7,"yi":3},{"n":"hero","xi":7,"yi":2,"s":1},{"n":"hero","xi":2,"yi":2,"s":1},{"n":"hero","xi":0,"yi":1,"s":1},{"n":"delete","xi":0,"yi":0},{"n":"delete","xi":1,"yi":0},{"n":"delete","xi":7,"yi":0},{"n":"delete","xi":8,"yi":0},{"n":"hero","xi":4,"yi":0,"s":1},{"n":"bomb","xi":0,"yi":5},{"n":"bomb","xi":8,"yi":5},{"n":"red","xi":2,"yi":0},{"n":"red","xi":2,"yi":1},{"n":"red","xi":1,"yi":1},{"n":"red","xi":3,"yi":0},{"n":"red","xi":3,"yi":1},{"n":"red","xi":4,"yi":1},{"n":"red","xi":5,"yi":1},{"n":"red","xi":5,"yi":0},{"n":"red","xi":6,"yi":0},{"n":"red","xi":6,"yi":1},{"n":"red","xi":7,"yi":1},{"n":"hero","xi":8,"yi":1,"s":1},{"n":"blue","xi":0,"yi":9},{"n":"blue","xi":1,"yi":9},{"n":"blue","xi":1,"yi":10},{"n":"blue","xi":3,"yi":9},{"n":"blue","xi":2,"yi":9},{"n":"blue","xi":0,"yi":10},{"n":"bomb","xi":2,"yi":5},{"n":"bomb","xi":6,"yi":5},{"n":"yellow","xi":8,"yi":19},{"n":"yellow","xi":7,"yi":19},{"n":"yellow","xi":5,"yi":19},{"n":"yellow","xi":6,"yi":19},{"n":"yellow","xi":6,"yi":18},{"n":"yellow","xi":7,"yi":18},{"n":"yellow","xi":8,"yi":18},{"n":"green","xi":0,"yi":19},{"n":"green","xi":1,"yi":19},{"n":"green","xi":2,"yi":19},{"n":"green","xi":2,"yi":18},{"n":"green","xi":1,"yi":18},{"n":"red","xi":3,"yi":19},{"n":"red","xi":4,"yi":19},{"n":"bomb","xi":0,"yi":14},{"n":"bomb","xi":4,"yi":14},{"n":"bomb","xi":8,"yi":14},{"n":"bomb","xi":2,"yi":10},{"n":"bomb","xi":4,"yi":10}],"params":{"colors":[0,1,2,4],"steps":0,"isBomb":false,"isBonus":false}},{"cellCountX":9,"cellCountY":9,"objects":[{"n":"hero","xi":7,"yi":2},{"n":"hero","xi":4,"yi":0},{"n":"hero","xi":1,"yi":2},{"n":"yellow","xi":3,"yi":0},{"n":"yellow","xi":3,"yi":1},{"n":"yellow","xi":4,"yi":1},{"n":"yellow","xi":5,"yi":1},{"n":"yellow","xi":5,"yi":0},{"n":"blue","xi":2,"yi":1},{"n":"blue","xi":2,"yi":2},{"n":"blue","xi":2,"yi":3},{"n":"blue","xi":1,"yi":3},{"n":"blue","xi":3,"yi":3},{"n":"blue","xi":3,"yi":2},{"n":"blue","xi":4,"yi":2},{"n":"blue","xi":5,"yi":2},{"n":"blue","xi":6,"yi":2},{"n":"blue","xi":6,"yi":1},{"n":"blue","xi":7,"yi":3},{"n":"blue","xi":8,"yi":3},{"n":"blue","xi":0,"yi":3},{"n":"blue","xi":6,"yi":3},{"n":"blue","xi":5,"yi":3},{"n":"delete","xi":8,"yi":0},{"n":"delete","xi":7,"yi":0},{"n":"delete","xi":0,"yi":0},{"n":"delete","xi":1,"yi":0},{"n":"yellow","xi":0,"yi":8},{"n":"yellow","xi":1,"yi":8},{"n":"yellow","xi":2,"yi":8},{"n":"yellow","xi":2,"yi":7},{"n":"yellow","xi":1,"yi":7},{"n":"yellow","xi":0,"yi":7},{"n":"red","xi":6,"yi":8},{"n":"red","xi":6,"yi":7},{"n":"red","xi":7,"yi":7},{"n":"red","xi":8,"yi":7},{"n":"red","xi":8,"yi":8},{"n":"red","xi":7,"yi":8}],"params":{"colors":[0,1,2,4],"steps":26}},{"cellCountX":9,"cellCountY":11,"objects":[{"n":"delete","xi":8,"yi":0},{"n":"delete","xi":7,"yi":0},{"n":"delete","xi":7,"yi":1},{"n":"delete","xi":8,"yi":1},{"n":"delete","xi":8,"yi":2},{"n":"delete","xi":7,"yi":3},{"n":"delete","xi":8,"yi":3},{"n":"delete","xi":8,"yi":4},{"n":"delete","xi":7,"yi":4},{"n":"delete","xi":8,"yi":5},{"n":"delete","xi":8,"yi":6},{"n":"delete","xi":7,"yi":6},{"n":"delete","xi":7,"yi":7},{"n":"delete","xi":8,"yi":7},{"n":"delete","xi":8,"yi":8},{"n":"delete","xi":7,"yi":8},{"n":"hero","xi":7,"yi":2},{"n":"hero","xi":7,"yi":5},{"n":"red","xi":6,"yi":1},{"n":"yellow","xi":6,"yi":2},{"n":"green","xi":6,"yi":4},{"n":"red","xi":6,"yi":5},{"n":"delete","xi":6,"yi":6},{"n":"delete","xi":6,"yi":3},{"n":"delete","xi":5,"yi":6},{"n":"delete","xi":6,"yi":7},{"n":"delete","xi":6,"yi":8},{"n":"delete","xi":5,"yi":8},{"n":"delete","xi":5,"yi":7}],"params":{"colors":[0,1,2,4],"steps":0}},{"cellCountX":9,"cellCountY":9,"objects":[{"n":"delete","xi":0,"yi":1},{"n":"delete","xi":8,"yi":1},{"n":"delete","xi":8,"yi":8},{"n":"delete","xi":8,"yi":7},{"n":"delete","xi":8,"yi":6},{"n":"delete","xi":8,"yi":5},{"n":"delete","xi":0,"yi":5},{"n":"delete","xi":0,"yi":6},{"n":"delete","xi":0,"yi":7},{"n":"delete","xi":0,"yi":8},{"n":"delete","xi":3,"yi":0},{"n":"delete","xi":4,"yi":0},{"n":"delete","xi":5,"yi":0},{"n":"delete","xi":3,"yi":4},{"n":"delete","xi":3,"yi":3},{"n":"delete","xi":6,"yi":3},{"n":"delete","xi":6,"yi":4},{"n":"hero","xi":4,"yi":2,"s":1},{"n":"hero","xi":2,"yi":2,"s":1},{"n":"hero","xi":7,"yi":2,"s":1},{"n":"green","xi":4,"yi":7},{"n":"green","xi":4,"yi":6},{"n":"green","xi":4,"yi":5},{"n":"green","xi":4,"yi":3},{"n":"green","xi":7,"yi":8},{"n":"green","xi":7,"yi":7},{"n":"green","xi":6,"yi":7},{"n":"green","xi":6,"yi":6},{"n":"green","xi":6,"yi":5},{"n":"green","xi":7,"yi":5},{"n":"green","xi":1,"yi":8},{"n":"green","xi":1,"yi":7},{"n":"green","xi":2,"yi":7},{"n":"green","xi":2,"yi":6},{"n":"green","xi":2,"yi":4},{"n":"green","xi":2,"yi":3},{"n":"green","xi":1,"yi":3},{"n":"green","xi":0,"yi":3},{"n":"green","xi":0,"yi":2},{"n":"green","xi":8,"yi":2},{"n":"green","xi":6,"yi":0},{"n":"green","xi":2,"yi":0},{"n":"blue","xi":7,"yi":0},{"n":"blue","xi":6,"yi":1},{"n":"blue","xi":5,"yi":1},{"n":"blue","xi":5,"yi":2},{"n":"blue","xi":0,"yi":0},{"n":"blue","xi":1,"yi":1},{"n":"blue","xi":1,"yi":2},{"n":"blue","xi":2,"yi":1},{"n":"blue","xi":3,"yi":1},{"n":"blue","xi":0,"yi":4},{"n":"blue","xi":1,"yi":4},{"n":"blue","xi":1,"yi":5},{"n":"blue","xi":7,"yi":6},{"n":"blue","xi":5,"yi":5},{"n":"blue","xi":5,"yi":6},{"n":"blue","xi":5,"yi":7},{"n":"blue","xi":5,"yi":8},{"n":"yellow","xi":6,"yi":8},{"n":"blue","xi":2,"yi":8},{"n":"blue","xi":3,"yi":8},{"n":"blue","xi":3,"yi":6},{"n":"blue","xi":3,"yi":5},{"n":"yellow","xi":2,"yi":5},{"n":"yellow","xi":1,"yi":6},{"n":"purple","xi":4,"yi":4},{"n":"yellow","xi":7,"yi":4},{"n":"yellow","xi":7,"yi":3},{"n":"yellow","xi":8,"yi":3},{"n":"yellow","xi":5,"yi":3},{"n":"yellow","xi":5,"yi":4},{"n":"yellow","xi":6,"yi":2},{"n":"yellow","xi":7,"yi":1},{"n":"yellow","xi":3,"yi":2},{"n":"yellow","xi":1,"yi":0},{"n":"purple","xi":4,"yi":1},{"n":"green","xi":4,"yi":8},{"n":"blue","xi":3,"yi":7}],"params":{"colors":[0,1,2,4],"steps":20,"isBomb":false,"isBonus":false}},{"cellCountX":9,"cellCountY":9,"objects":[{"n":"delete","xi":0,"yi":0},{"n":"delete","xi":4,"yi":0},{"n":"delete","xi":8,"yi":0},{"n":"delete","xi":0,"yi":2},{"n":"delete","xi":0,"yi":4},{"n":"delete","xi":8,"yi":2},{"n":"delete","xi":8,"yi":4},{"n":"hero","xi":1,"yi":0},{"n":"hero","xi":3,"yi":0},{"n":"hero","xi":5,"yi":0},{"n":"hero","xi":7,"yi":0},{"n":"bomb","xi":2,"yi":0},{"n":"bomb","xi":6,"yi":0},{"n":"yellow","xi":8,"yi":8},{"n":"yellow","xi":7,"yi":8},{"n":"yellow","xi":7,"yi":7},{"n":"blue","xi":0,"yi":8},{"n":"blue","xi":1,"yi":8},{"n":"blue","xi":2,"yi":8}],"params":{"colors":[0,1,2,3,4],"steps":25,"isBomb":true,"isBonus":false}},{"cellCountX":9,"cellCountY":8,"objects":[{"n":"hero","xi":2,"yi":0,"s":2},{"n":"hero","xi":6,"yi":0,"s":2},{"n":"delete","xi":4,"yi":0},{"n":"delete","xi":4,"yi":1},{"n":"delete","xi":4,"yi":2},{"n":"delete","xi":4,"yi":3},{"n":"delete","xi":4,"yi":4},{"n":"delete","xi":4,"yi":5},{"n":"delete","xi":4,"yi":6},{"n":"delete","xi":4,"yi":7},{"n":"s_bonus","xi":1,"yi":0,"s":1},{"n":"s_bonus","xi":7,"yi":0,"s":2},{"n":"red","xi":0,"yi":1},{"n":"red","xi":2,"yi":1},{"n":"red","xi":1,"yi":2},{"n":"red","xi":0,"yi":3},{"n":"red","xi":2,"yi":3},{"n":"red","xi":3,"yi":2},{"n":"red","xi":1,"yi":4},{"n":"red","xi":0,"yi":5},{"n":"red","xi":2,"yi":5},{"n":"red","xi":3,"yi":4},{"n":"red","xi":0,"yi":7},{"n":"red","xi":1,"yi":6},{"n":"red","xi":2,"yi":7},{"n":"red","xi":3,"yi":6},{"n":"yellow","xi":5,"yi":1},{"n":"yellow","xi":7,"yi":1},{"n":"yellow","xi":8,"yi":2},{"n":"yellow","xi":6,"yi":2},{"n":"yellow","xi":5,"yi":3},{"n":"yellow","xi":7,"yi":3},{"n":"yellow","xi":8,"yi":4},{"n":"yellow","xi":6,"yi":4},{"n":"yellow","xi":5,"yi":5},{"n":"yellow","xi":7,"yi":5},{"n":"yellow","xi":8,"yi":6},{"n":"yellow","xi":7,"yi":7},{"n":"yellow","xi":6,"yi":6},{"n":"yellow","xi":5,"yi":7},{"n":"yellow","xi":1,"yi":1},{"n":"yellow","xi":3,"yi":1},{"n":"yellow","xi":2,"yi":2},{"n":"yellow","xi":0,"yi":2},{"n":"yellow","xi":1,"yi":3},{"n":"yellow","xi":3,"yi":3},{"n":"yellow","xi":2,"yi":4},{"n":"yellow","xi":0,"yi":4},{"n":"yellow","xi":1,"yi":5},{"n":"yellow","xi":0,"yi":6},{"n":"yellow","xi":1,"yi":7},{"n":"yellow","xi":2,"yi":6},{"n":"yellow","xi":3,"yi":5},{"n":"yellow","xi":3,"yi":7},{"n":"red","xi":5,"yi":2},{"n":"red","xi":6,"yi":1},{"n":"red","xi":8,"yi":1},{"n":"red","xi":7,"yi":2},{"n":"red","xi":8,"yi":3},{"n":"red","xi":6,"yi":3},{"n":"red","xi":5,"yi":4},{"n":"red","xi":7,"yi":4},{"n":"red","xi":6,"yi":5},{"n":"red","xi":8,"yi":5},{"n":"red","xi":7,"yi":6},{"n":"red","xi":5,"yi":6},{"n":"red","xi":6,"yi":7},{"n":"red","xi":8,"yi":7},{"n":"delete","xi":5,"yi":0},{"n":"delete","xi":8,"yi":0},{"n":"delete","xi":0,"yi":0},{"n":"delete","xi":3,"yi":0}],"params":{"colors":[0,1,2,3,4],"steps":0,"isBomb":false,"isBonus":false}},{"cellCountX":9,"cellCountY":12,"objects":[{"n":"hero","xi":1,"yi":2,"s":2},{"n":"hero","xi":7,"yi":2,"s":2},{"n":"hero","xi":4,"yi":0,"s":2},{"n":"delete","xi":1,"yi":3},{"n":"delete","xi":1,"yi":1},{"n":"s_bonus","xi":3,"yi":2,"s":2},{"n":"delete","xi":7,"yi":3},{"n":"delete","xi":7,"yi":1},{"n":"yellow","xi":2,"yi":11},{"n":"yellow","xi":3,"yi":10},{"n":"yellow","xi":4,"yi":9},{"n":"yellow","xi":4,"yi":11},{"n":"yellow","xi":5,"yi":10},{"n":"yellow","xi":6,"yi":9},{"n":"yellow","xi":6,"yi":11},{"n":"yellow","xi":7,"yi":10},{"n":"yellow","xi":8,"yi":11},{"n":"yellow","xi":8,"yi":9},{"n":"red","xi":0,"yi":10},{"n":"red","xi":1,"yi":9},{"n":"red","xi":1,"yi":11},{"n":"red","xi":3,"yi":11},{"n":"red","xi":4,"yi":10},{"n":"red","xi":5,"yi":9},{"n":"red","xi":5,"yi":11},{"n":"red","xi":6,"yi":10},{"n":"red","xi":7,"yi":11},{"n":"red","xi":8,"yi":10},{"n":"red","xi":7,"yi":9},{"n":"yellow","xi":1,"yi":8},{"n":"yellow","xi":2,"yi":7},{"n":"yellow","xi":0,"yi":7},{"n":"yellow","xi":3,"yi":8},{"n":"yellow","xi":5,"yi":8},{"n":"yellow","xi":6,"yi":7},{"n":"yellow","xi":7,"yi":8},{"n":"yellow","xi":7,"yi":7},{"n":"red","xi":0,"yi":8},{"n":"red","xi":1,"yi":7},{"n":"red","xi":2,"yi":8},{"n":"red","xi":4,"yi":8},{"n":"red","xi":5,"yi":7},{"n":"red","xi":6,"yi":8},{"n":"red","xi":8,"yi":7},{"n":"red","xi":8,"yi":8},{"n":"purple","xi":4,"yi":6},{"n":"purple","xi":5,"yi":6},{"n":"purple","xi":6,"yi":6},{"n":"purple","xi":7,"yi":6},{"n":"green","xi":8,"yi":6},{"n":"green","xi":8,"yi":5},{"n":"green","xi":8,"yi":1},{"n":"green","xi":8,"yi":0},{"n":"yellow","xi":7,"yi":4},{"n":"yellow","xi":6,"yi":4},{"n":"yellow","xi":5,"yi":4},{"n":"yellow","xi":4,"yi":4},{"n":"yellow","xi":6,"yi":2},{"n":"yellow","xi":5,"yi":2},{"n":"blue","xi":5,"yi":1},{"n":"blue","xi":6,"yi":1},{"n":"blue","xi":5,"yi":0},{"n":"blue","xi":6,"yi":0},{"n":"blue","xi":7,"yi":0},{"n":"red","xi":0,"yi":2},{"n":"red","xi":2,"yi":2},{"n":"red","xi":3,"yi":1},{"n":"red","xi":2,"yi":1},{"n":"red","xi":0,"yi":1},{"n":"yellow","xi":0,"yi":0},{"n":"yellow","xi":1,"yi":0},{"n":"yellow","xi":2,"yi":0},{"n":"yellow","xi":3,"yi":0},{"n":"delete","xi":4,"yi":1},{"n":"yellow","xi":4,"yi":2},{"n":"yellow","xi":4,"yi":7},{"n":"yellow","xi":1,"yi":10},{"n":"red","xi":2,"yi":10},{"n":"red","xi":3,"yi":7},{"n":"bomb","xi":0,"yi":11}],"params":{"colors":[0,1,2,3,4],"steps":0,"isBomb":false,"isBonus":false}},{"cellCountX":9,"cellCountY":9,"objects":[{"n":"block","xi":4,"yi":0},{"n":"block","xi":4,"yi":1},{"n":"block","xi":4,"yi":2},{"n":"block","xi":4,"yi":3},{"n":"block","xi":4,"yi":4},{"n":"block","xi":4,"yi":5},{"n":"block","xi":4,"yi":8},{"n":"block","xi":5,"yi":8},{"n":"block","xi":6,"yi":8},{"n":"block","xi":7,"yi":8},{"n":"block","xi":8,"yi":8},{"n":"hero","xi":0,"yi":0,"s":1},{"n":"hero","xi":2,"yi":0,"s":1},{"n":"hero","xi":6,"yi":0,"s":1},{"n":"hero","xi":8,"yi":0,"s":1}],"params":{"colors":[0,1,2],"steps":0,"isBomb":true,"isBonus":true}},{"cellCountX":9,"cellCountY":12,"objects":[{"n":"hero","xi":8,"yi":0,"s":1},{"n":"block","xi":8,"yi":1},{"n":"block","xi":8,"yi":2},{"n":"block","xi":7,"yi":2},{"n":"block","xi":7,"yi":3},{"n":"block","xi":6,"yi":3},{"n":"block","xi":6,"yi":4},{"n":"block","xi":5,"yi":4},{"n":"block","xi":5,"yi":5},{"n":"block","xi":4,"yi":5},{"n":"block","xi":4,"yi":6},{"n":"block","xi":3,"yi":6},{"n":"block","xi":3,"yi":7},{"n":"block","xi":2,"yi":7},{"n":"hero","xi":6,"yi":2,"s":1},{"n":"hero","xi":4,"yi":4,"s":1},{"n":"bomb","xi":8,"yi":3},{"n":"bomb","xi":8,"yi":7},{"n":"bomb","xi":2,"yi":6}],"params":{"colors":[0,1,2],"steps":0,"isBomb":false,"isBonus":true}},{"cellCountX":9,"cellCountY":9,"objects":[{"n":"hero","xi":4,"yi":4,"s":1},{"n":"dirt","xi":3,"yi":4},{"n":"dirt","xi":3,"yi":3},{"n":"dirt","xi":4,"yi":3},{"n":"dirt","xi":5,"yi":3},{"n":"dirt","xi":5,"yi":4},{"n":"dirt","xi":5,"yi":5},{"n":"dirt","xi":4,"yi":5},{"n":"dirt","xi":3,"yi":5}],"params":{"colors":[0,1,2,3],"steps":12,"isBomb":true,"isBonus":true}},{"cellCountX":9,"cellCountY":9,"objects":[{"n":"dirt","xi":0,"yi":7},{"n":"dirt","xi":0,"yi":8},{"n":"dirt","xi":2,"yi":8},{"n":"dirt","xi":3,"yi":7},{"n":"dirt","xi":4,"yi":8},{"n":"dirt","xi":3,"yi":8},{"n":"dirt","xi":6,"yi":7},{"n":"dirt","xi":6,"yi":6},{"n":"dirt","xi":7,"yi":7},{"n":"dirt","xi":8,"yi":7},{"n":"dirt","xi":7,"yi":8},{"n":"dirt","xi":5,"yi":8},{"n":"dirt","xi":1,"yi":6},{"n":"delete","xi":0,"yi":4},{"n":"delete","xi":0,"yi":3},{"n":"delete","xi":0,"yi":2},{"n":"delete","xi":8,"yi":2},{"n":"delete","xi":8,"yi":3},{"n":"delete","xi":8,"yi":4},{"n":"bomb","xi":2,"yi":3},{"n":"bomb","xi":5,"yi":2},{"n":"hero","xi":2,"yi":1,"s":1},{"n":"hero","xi":6,"yi":1,"s":1},{"n":"delete","xi":0,"yi":1},{"n":"delete","xi":8,"yi":1}],"params":{"colors":[0,1,2,3],"steps":23,"isBomb":true,"isBonus":true}},{"cellCountX":9,"cellCountY":9,"objects":[{"n":"delete","xi":2,"yi":0},{"n":"delete","xi":1,"yi":0},{"n":"delete","xi":0,"yi":0},{"n":"delete","xi":6,"yi":0},{"n":"delete","xi":7,"yi":0},{"n":"delete","xi":8,"yi":0},{"n":"delete","xi":1,"yi":1},{"n":"delete","xi":0,"yi":1},{"n":"delete","xi":7,"yi":1},{"n":"delete","xi":8,"yi":1},{"n":"delete","xi":0,"yi":2},{"n":"delete","xi":8,"yi":2},{"n":"delete","xi":6,"yi":8},{"n":"block","xi":4,"yi":0},{"n":"block","xi":4,"yi":1},{"n":"block","xi":4,"yi":2},{"n":"block","xi":4,"yi":4},{"n":"block","xi":4,"yi":3},{"n":"hero","xi":5,"yi":2,"s":1},{"n":"hero","xi":6,"yi":2,"s":1},{"n":"delete","xi":5,"yi":8},{"n":"delete","xi":7,"yi":8},{"n":"delete","xi":8,"yi":8},{"n":"delete","xi":8,"yi":7},{"n":"delete","xi":8,"yi":6},{"n":"delete","xi":7,"yi":7},{"n":"delete","xi":6,"yi":7},{"n":"red","xi":0,"yi":8},{"n":"red","xi":0,"yi":7},{"n":"red","xi":0,"yi":6},{"n":"yellow","xi":1,"yi":6},{"n":"yellow","xi":1,"yi":7},{"n":"yellow","xi":1,"yi":8},{"n":"delete","xi":0,"yi":3},{"n":"delete","xi":0,"yi":4},{"n":"delete","xi":0,"yi":5},{"n":"delete","xi":8,"yi":3},{"n":"delete","xi":8,"yi":4},{"n":"delete","xi":8,"yi":5},{"n":"red","xi":2,"yi":6},{"n":"red","xi":2,"yi":7},{"n":"red","xi":2,"yi":8},{"n":"yellow","xi":3,"yi":6},{"n":"yellow","xi":3,"yi":7},{"n":"yellow","xi":3,"yi":8},{"n":"red","xi":4,"yi":8},{"n":"red","xi":4,"yi":7},{"n":"red","xi":4,"yi":6},{"n":"yellow","xi":5,"yi":7},{"n":"yellow","xi":5,"yi":6},{"n":"red","xi":6,"yi":6},{"n":"red","xi":6,"yi":5},{"n":"yellow","xi":7,"yi":6},{"n":"yellow","xi":7,"yi":5},{"n":"yellow","xi":7,"yi":4}],"params":{"colors":[0,1,2,3,4],"steps":8,"isBomb":false,"isBonus":false}},{"cellCountX":9,"cellCountY":9,"objects":[{"n":"hero","xi":0,"yi":0,"s":1},{"n":"hero","xi":8,"yi":0,"s":1},{"n":"hero","xi":3,"yi":0,"s":1},{"n":"dirt","xi":0,"yi":1},{"n":"dirt","xi":1,"yi":1},{"n":"dirt","xi":2,"yi":1},{"n":"dirt","xi":3,"yi":1},{"n":"dirt","xi":4,"yi":1},{"n":"dirt","xi":5,"yi":1},{"n":"dirt","xi":6,"yi":1},{"n":"dirt","xi":7,"yi":1},{"n":"dirt","xi":8,"yi":1},{"n":"dirt","xi":0,"yi":6},{"n":"dirt","xi":1,"yi":6},{"n":"dirt","xi":3,"yi":6},{"n":"dirt","xi":4,"yi":6},{"n":"dirt","xi":5,"yi":6},{"n":"dirt","xi":7,"yi":6},{"n":"dirt","xi":6,"yi":6},{"n":"dirt","xi":8,"yi":6},{"n":"hero","xi":5,"yi":0,"s":1},{"n":"blue","xi":0,"yi":5},{"n":"blue","xi":1,"yi":5},{"n":"blue","xi":2,"yi":5},{"n":"blue","xi":5,"yi":5},{"n":"blue","xi":3,"yi":5},{"n":"blue","xi":4,"yi":5},{"n":"blue","xi":6,"yi":5},{"n":"blue","xi":7,"yi":5},{"n":"blue","xi":8,"yi":5},{"n":"dirt","xi":2,"yi":6}],"params":{"colors":[0,1,2],"steps":22,"isBomb":true,"isBonus":true}},{"cellCountX":9,"cellCountY":11,"objects":[{"n":"block","xi":7,"yi":3},{"n":"block","xi":6,"yi":3},{"n":"block","xi":5,"yi":4},{"n":"block","xi":4,"yi":4},{"n":"blue","xi":4,"yi":3},{"n":"purple","xi":3,"yi":2},{"n":"purple","xi":3,"yi":3},{"n":"blue","xi":1,"yi":3},{"n":"blue","xi":1,"yi":4},{"n":"block","xi":3,"yi":5},{"n":"block","xi":2,"yi":5},{"n":"block","xi":1,"yi":5},{"n":"block","xi":8,"yi":2},{"n":"block","xi":8,"yi":5},{"n":"block","xi":8,"yi":6},{"n":"block","xi":7,"yi":6},{"n":"block","xi":6,"yi":7},{"n":"block","xi":5,"yi":8},{"n":"block","xi":4,"yi":9},{"n":"block","xi":2,"yi":9},{"n":"block","xi":1,"yi":9},{"n":"block","xi":3,"yi":8},{"n":"block","xi":7,"yi":7},{"n":"yellow","xi":7,"yi":5},{"n":"red","xi":6,"yi":6},{"n":"red","xi":6,"yi":5},{"n":"red","xi":6,"yi":4},{"n":"blue","xi":5,"yi":5},{"n":"blue","xi":5,"yi":6},{"n":"purple","xi":4,"yi":5},{"n":"purple","xi":4,"yi":6},{"n":"purple","xi":4,"yi":7},{"n":"red","xi":3,"yi":6},{"n":"red","xi":3,"yi":7},{"n":"yellow","xi":2,"yi":6},{"n":"yellow","xi":2,"yi":8},{"n":"yellow","xi":2,"yi":7},{"n":"purple","xi":1,"yi":6},{"n":"purple","xi":1,"yi":7},{"n":"purple","xi":1,"yi":8},{"n":"block","xi":5,"yi":7},{"n":"yellow","xi":0,"yi":2},{"n":"yellow","xi":0,"yi":3},{"n":"yellow","xi":0,"yi":4},{"n":"yellow","xi":0,"yi":5},{"n":"yellow","xi":0,"yi":6},{"n":"hero","xi":7,"yi":2,"s":1},{"n":"block","xi":0,"yi":0},{"n":"block","xi":2,"yi":0},{"n":"block","xi":3,"yi":0},{"n":"block","xi":5,"yi":0},{"n":"block","xi":8,"yi":0},{"n":"block","xi":7,"yi":0},{"n":"block","xi":6,"yi":0},{"n":"block","xi":4,"yi":0},{"n":"blue","xi":4,"yi":1},{"n":"blue","xi":1,"yi":1},{"n":"yellow","xi":0,"yi":1},{"n":"block","xi":6,"yi":1},{"n":"block","xi":7,"yi":1},{"n":"block","xi":8,"yi":1},{"n":"block","xi":8,"yi":3},{"n":"red","xi":2,"yi":3},{"n":"red","xi":2,"yi":4},{"n":"red","xi":0,"yi":7},{"n":"red","xi":0,"yi":8},{"n":"red","xi":8,"yi":9},{"n":"red","xi":8,"yi":8},{"n":"blue","xi":1,"yi":2},{"n":"red","xi":2,"yi":2},{"n":"blue","xi":4,"yi":2},{"n":"yellow","xi":7,"yi":4},{"n":"dirt","xi":0,"yi":9},{"n":"yellow","xi":5,"yi":1},{"n":"yellow","xi":5,"yi":2},{"n":"yellow","xi":5,"yi":3},{"n":"hero","xi":6,"yi":2,"s":1},{"n":"purple","xi":3,"yi":1},{"n":"red","xi":0,"yi":10},{"n":"yellow","xi":1,"yi":10},{"n":"yellow","xi":2,"yi":10},{"n":"red","xi":3,"yi":10},{"n":"purple","xi":5,"yi":10},{"n":"yellow","xi":8,"yi":10},{"n":"yellow","xi":7,"yi":10},{"n":"yellow","xi":6,"yi":10},{"n":"blue","xi":7,"yi":9},{"n":"blue","xi":7,"yi":8},{"n":"red","xi":6,"yi":8},{"n":"red","xi":6,"yi":9},{"n":"red","xi":5,"yi":9},{"n":"hero","xi":8,"yi":4,"s":1},{"n":"block","xi":1,"yi":0},{"n":"red","xi":2,"yi":1},{"n":"red","xi":8,"yi":7},{"n":"block","xi":3,"yi":4},{"n":"block","xi":4,"yi":8},{"n":"block","xi":3,"yi":9}],"params":{"colors":[0,1,2,3],"steps":20,"isBomb":true,"isBonus":true}},{"cellCountX":9,"cellCountY":6,"objects":[{"n":"red","xi":0,"yi":0},{"n":"red","xi":1,"yi":0},{"n":"red","xi":2,"yi":0},{"n":"red","xi":2,"yi":1},{"n":"red","xi":1,"yi":1},{"n":"red","xi":0,"yi":1},{"n":"blue","xi":3,"yi":0},{"n":"blue","xi":3,"yi":1},{"n":"blue","xi":4,"yi":1},{"n":"blue","xi":4,"yi":0},{"n":"blue","xi":5,"yi":0},{"n":"blue","xi":5,"yi":1},{"n":"green","xi":6,"yi":1},{"n":"green","xi":6,"yi":0},{"n":"green","xi":7,"yi":0},{"n":"green","xi":7,"yi":1},{"n":"green","xi":8,"yi":1},{"n":"green","xi":8,"yi":0},{"n":"green","xi":0,"yi":2},{"n":"green","xi":1,"yi":2},{"n":"green","xi":2,"yi":2},{"n":"green","xi":2,"yi":3},{"n":"green","xi":1,"yi":3},{"n":"green","xi":0,"yi":3},{"n":"purple","xi":3,"yi":2},{"n":"purple","xi":3,"yi":3},{"n":"purple","xi":4,"yi":3},{"n":"purple","xi":4,"yi":2},{"n":"purple","xi":5,"yi":2},{"n":"purple","xi":5,"yi":3},{"n":"blue","xi":6,"yi":2},{"n":"blue","xi":6,"yi":3},{"n":"blue","xi":7,"yi":3},{"n":"blue","xi":7,"yi":2},{"n":"blue","xi":8,"yi":2},{"n":"blue","xi":8,"yi":3},{"n":"red","xi":0,"yi":4},{"n":"red","xi":0,"yi":5},{"n":"red","xi":1,"yi":4},{"n":"red","xi":2,"yi":4},{"n":"red","xi":2,"yi":5},{"n":"red","xi":5,"yi":5},{"n":"red","xi":5,"yi":4},{"n":"red","xi":6,"yi":4},{"n":"red","xi":7,"yi":4},{"n":"red","xi":7,"yi":5},{"n":"yellow","xi":8,"yi":4},{"n":"yellow","xi":8,"yi":5},{"n":"yellow","xi":3,"yi":4},{"n":"yellow","xi":4,"yi":4},{"n":"yellow","xi":4,"yi":5},{"n":"yellow","xi":3,"yi":5},{"n":"hero2","xi":1,"yi":5,"s":1},{"n":"hero2","xi":6,"yi":5,"s":1}],"params":{"colors":[0,1,2,3,4],"steps":0,"isBomb":false,"isBonus":false}},{"cellCountX":9,"cellCountY":9,"objects":[{"n":"red","xi":0,"yi":0},{"n":"red","xi":1,"yi":0},{"n":"red","xi":2,"yi":0},{"n":"red","xi":2,"yi":1},{"n":"red","xi":0,"yi":1},{"n":"hero2","xi":1,"yi":1,"s":1},{"n":"blue","xi":3,"yi":0},{"n":"blue","xi":3,"yi":1},{"n":"blue","xi":4,"yi":0},{"n":"blue","xi":5,"yi":0},{"n":"blue","xi":5,"yi":1},{"n":"green","xi":6,"yi":0},{"n":"green","xi":6,"yi":1},{"n":"green","xi":7,"yi":0},{"n":"green","xi":8,"yi":0},{"n":"green","xi":8,"yi":1},{"n":"hero2","xi":4,"yi":1,"s":3},{"n":"hero2","xi":7,"yi":1,"s":5}],"params":{"colors":[0,1,2,4],"steps":23,"isBomb":true,"isBonus":true}},{"cellCountX":9,"cellCountY":9,"objects":[{"n":"dirt","xi":0,"yi":1},{"n":"dirt","xi":0,"yi":2},{"n":"dirt","xi":0,"yi":3},{"n":"dirt","xi":0,"yi":4},{"n":"hero2","xi":0,"yi":8,"s":1},{"n":"hero2","xi":8,"yi":8,"s":2},{"n":"block","xi":0,"yi":0},{"n":"block","xi":8,"yi":0},{"n":"block","xi":8,"yi":1},{"n":"block","xi":8,"yi":2},{"n":"block","xi":8,"yi":3},{"n":"block","xi":8,"yi":4}],"params":{"colors":[0,1,2,4],"steps":30,"isBomb":true,"isBonus":true}},{"cellCountX":9,"cellCountY":9,"objects":[{"n":"block","xi":0,"yi":4},{"n":"block","xi":2,"yi":4},{"n":"block","xi":1,"yi":4},{"n":"block","xi":6,"yi":4},{"n":"block","xi":7,"yi":4},{"n":"block","xi":8,"yi":4},{"n":"block","xi":0,"yi":5},{"n":"block","xi":1,"yi":5},{"n":"block","xi":0,"yi":6},{"n":"block","xi":7,"yi":5},{"n":"block","xi":8,"yi":5},{"n":"block","xi":8,"yi":6},{"n":"block","xi":1,"yi":3},{"n":"block","xi":0,"yi":3},{"n":"block","xi":0,"yi":2},{"n":"block","xi":7,"yi":3},{"n":"block","xi":8,"yi":3},{"n":"block","xi":8,"yi":2},{"n":"hero2","xi":4,"yi":4,"s":4},{"n":"hero2","xi":3,"yi":4,"s":3},{"n":"hero2","xi":5,"yi":4,"s":2}],"params":{"colors":[0,1,2,3],"steps":20,"isBomb":true,"isBonus":true}},{"cellCountX":9,"cellCountY":9,"objects":[{"n":"hero","xi":1,"yi":1,"s":1},{"n":"hero","xi":3,"yi":1,"s":1},{"n":"hero","xi":5,"yi":1,"s":1},{"n":"hero","xi":7,"yi":1,"s":1},{"n":"block","xi":1,"yi":2},{"n":"block","xi":3,"yi":2},{"n":"block","xi":5,"yi":2},{"n":"block","xi":7,"yi":2},{"n":"block","xi":0,"yi":0},{"n":"block","xi":2,"yi":0},{"n":"block","xi":4,"yi":0},{"n":"block","xi":6,"yi":0},{"n":"block","xi":8,"yi":0},{"n":"s_bonus","xi":0,"yi":8,"s":1},{"n":"block","xi":2,"yi":5},{"n":"hero2","xi":2,"yi":4,"s":1}],"params":{"colors":[1,2,3,4],"steps":20,"isBomb":true,"isBonus":true}},{"cellCountX":9,"cellCountY":9,"objects":[{"n":"dirt","xi":0,"yi":8},{"n":"dirt","xi":0,"yi":7},{"n":"dirt","xi":1,"yi":7},{"n":"dirt","xi":2,"yi":7},{"n":"dirt","xi":2,"yi":8},{"n":"dirt","xi":4,"yi":8},{"n":"dirt","xi":4,"yi":7},{"n":"dirt","xi":3,"yi":7},{"n":"dirt","xi":5,"yi":7},{"n":"dirt","xi":6,"yi":7},{"n":"dirt","xi":6,"yi":8},{"n":"dirt","xi":7,"yi":7},{"n":"dirt","xi":8,"yi":7},{"n":"dirt","xi":8,"yi":8},{"n":"hero2","xi":1,"yi":8,"s":1},{"n":"dirt","xi":0,"yi":6},{"n":"dirt","xi":1,"yi":6},{"n":"dirt","xi":2,"yi":6},{"n":"dirt","xi":3,"yi":6},{"n":"dirt","xi":4,"yi":6},{"n":"dirt","xi":5,"yi":6},{"n":"dirt","xi":7,"yi":6},{"n":"dirt","xi":8,"yi":6},{"n":"dirt","xi":6,"yi":6},{"n":"hero2","xi":3,"yi":8,"s":2},{"n":"hero2","xi":5,"yi":8,"s":3},{"n":"hero2","xi":7,"yi":8,"s":4}],"params":{"colors":[1,2,3,4],"steps":33,"isBomb":true,"isBonus":true}},{"cellCountX":9,"cellCountY":9,"objects":[{"n":"hero2","xi":8,"yi":7,"s":4},{"n":"hero2","xi":7,"yi":7,"s":4},{"n":"dirt","xi":7,"yi":6},{"n":"dirt","xi":8,"yi":6},{"n":"dirt","xi":8,"yi":5},{"n":"dirt","xi":7,"yi":5},{"n":"dirt","xi":7,"yi":4},{"n":"dirt","xi":8,"yi":4},{"n":"hero2","xi":7,"yi":3,"s":3},{"n":"hero2","xi":8,"yi":3,"s":3},{"n":"hero","xi":7,"yi":2,"s":3}],"params":{"colors":[0,1,3,4],"steps":33,"isBomb":true,"isBonus":true}},{"cellCountX":9,"cellCountY":9,"objects":[{"n":"block","xi":8,"yi":8},{"n":"block","xi":7,"yi":8},{"n":"block","xi":6,"yi":8},{"n":"block","xi":2,"yi":0},{"n":"block","xi":2,"yi":1},{"n":"block","xi":2,"yi":2},{"n":"block","xi":6,"yi":0},{"n":"block","xi":6,"yi":1},{"n":"block","xi":6,"yi":2},{"n":"hero2","xi":3,"yi":2,"s":1},{"n":"hero2","xi":4,"yi":2,"s":2},{"n":"hero2","xi":5,"yi":2,"s":3},{"n":"hero","xi":7,"yi":0,"s":3},{"n":"hero","xi":8,"yi":0,"s":3},{"n":"dirt","xi":5,"yi":8},{"n":"dirt","xi":4,"yi":8},{"n":"dirt","xi":3,"yi":8},{"n":"dirt","xi":2,"yi":8},{"n":"dirt","xi":1,"yi":8},{"n":"dirt","xi":0,"yi":8}],"params":{"colors":[0,1,2,3],"steps":53,"isBomb":true,"isBonus":true}},{"cellCountX":9,"cellCountY":9,"objects":[{"n":"delete","xi":1,"yi":1},{"n":"delete","xi":1,"yi":2},{"n":"delete","xi":1,"yi":3},{"n":"delete","xi":1,"yi":4},{"n":"delete","xi":1,"yi":5},{"n":"delete","xi":1,"yi":6},{"n":"delete","xi":7,"yi":6},{"n":"delete","xi":7,"yi":5},{"n":"delete","xi":7,"yi":4},{"n":"delete","xi":7,"yi":3},{"n":"delete","xi":7,"yi":2},{"n":"delete","xi":7,"yi":1},{"n":"hero2","xi":8,"yi":7,"s":5},{"n":"hero2","xi":8,"yi":4,"s":3},{"n":"hero2","xi":8,"yi":1,"s":2},{"n":"delete","xi":6,"yi":6},{"n":"delete","xi":5,"yi":6},{"n":"delete","xi":4,"yi":6},{"n":"delete","xi":3,"yi":6},{"n":"delete","xi":2,"yi":6},{"n":"hero2","xi":4,"yi":7,"s":3},{"n":"hero2","xi":0,"yi":7,"s":1},{"n":"dirt","xi":8,"yi":2},{"n":"dirt","xi":8,"yi":6},{"n":"dirt","xi":8,"yi":5},{"n":"dirt","xi":8,"yi":3}],"params":{"colors":[1,2,3,4],"steps":37,"isBomb":true,"isBonus":true}},{"cellCountX":9,"cellCountY":9,"objects":[{"n":"block","xi":4,"yi":7},{"n":"block","xi":5,"yi":7},{"n":"block","xi":6,"yi":7},{"n":"block","xi":7,"yi":7},{"n":"block","xi":8,"yi":7},{"n":"block","xi":4,"yi":5},{"n":"block","xi":5,"yi":5},{"n":"block","xi":6,"yi":5},{"n":"block","xi":6,"yi":4},{"n":"block","xi":6,"yi":3},{"n":"block","xi":6,"yi":2},{"n":"block","xi":6,"yi":1},{"n":"block","xi":6,"yi":0},{"n":"block","xi":8,"yi":0},{"n":"block","xi":8,"yi":1},{"n":"block","xi":8,"yi":2},{"n":"block","xi":8,"yi":4},{"n":"block","xi":8,"yi":3},{"n":"block","xi":8,"yi":5},{"n":"block","xi":8,"yi":6},{"n":"block","xi":3,"yi":0},{"n":"block","xi":4,"yi":0},{"n":"hero2","xi":7,"yi":0,"s":1},{"n":"hero2","xi":7,"yi":1,"s":2},{"n":"hero2","xi":7,"yi":2,"s":3},{"n":"dirt","xi":8,"yi":8},{"n":"dirt","xi":7,"yi":8},{"n":"dirt","xi":6,"yi":8}],"params":{"colors":[0,2,3,4],"steps":48,"isBomb":true,"isBonus":true}}]}';
}
PR.CELLW_SCALE=1;
PR.CELL_SCALE=.85;
PR.CELL_SCALE_BACK=.92;
GodStep.SCALE=1/.4;
Games.SCALE=1/.4;
pro.run=function(){
catched(function(){
var t=PR.PetResque.instance;
if(!t.isRunning){
trace('running');
t.isRunning=true;
t.keyboard=new GodStep.Keyboard(t);
t.addFrame(t.dev=new PR.Dev(t));
t.addFrame(t.settings=new PR.Settings(t));
t.addFrame(t.gameplay=new PR.GamePlay(t));
t.addFrame(t.startmenu=new PR.StartMenu(t));
t.addFrame(t.victory=new PR.Victory(t));
t.addFrame(t.fail=new PR.Fail(t));
t.addFrame(t.win=new PR.Win(t));
t.addFrame(t.levelselect=new PR.LevelSelect(t));
t.addFrame(t.transmission=new PR.Transmission(t));
t.addFrame(t.fps=new GodStep.FPS(t,0xff0000,.9));
t.fps.visible=false;
addEvent(t.keyboard,GodStep.KEYPRESS,t.h_keyboard);
t.screenTo([t.startmenu],t.assets);
t.reposition();
t.loadSettings();
t.loadPlayer();
}
},'RUN');
};
pro.saveSettings=function(){
var instance=PR.PetResque.instance;
GodStep.SaveLocal(instance.SETTINGS,instance.SETTINGS_SLOT);
};
pro.loadSettings=function(){
var instance=PR.PetResque.instance;
return instance.SETTINGS=GodStep.LoadLocal(instance.SETTINGS_SLOT)||GodStep.LoadText(PR.DEFAULT_SETTINGS);
};
pro.loadPlayer=function(){
var instance=PR.PetResque.instance;
instance.PLAYER=GodStep.LoadLocal(instance.PLAYER_SLOT)||{levels:[],sound:true,music:true,tutorial:true};
if(instance.PLAYER.levels.length==0){
for(var i=0;i<30;i++){
instance.PLAYER.levels.push([0,0]);
}
}
PR.SOUND=instance.PLAYER.sound;
PR.MUSIC=instance.PLAYER.music;
PR.TUTORIAL=instance.PLAYER.tutorial;
return instance.PLAYER;
};
pro.savePlayer=function(){
var instance=PR.PetResque.instance;
instance.PLAYER.sound=PR.SOUND;
instance.PLAYER.music=PR.MUSIC;
instance.PLAYER.tutorial=PR.TUTORIAL;
GodStep.SaveLocal(instance.PLAYER,instance.PLAYER_SLOT);
};
function pauseGame(){
PR.PAUSE=true;
GodStep.Game.SOUND_MUTE=true;
var instance=PR.MatchThree.instance;
for(var i=0;i<instance.frames.length;i++){
if(instance.frames[i].visible){
instance.frames[i].isVis=true;
instance.frames[i].visible=false;
}
}
trace('MUTED');
GodStep.muteSound(null,0);
}
function resumeGame(){
PR.PAUSE=false;
GodStep.Game.SOUND_MUTE=false;
trace('UNMUTED');
GodStep.muteSound(null,1);
var instance=PR.PetResque.instance;
for(var i=0;i<instance.frames.length;i++){
if(instance.frames[i].isVis){
instance.frames[i].isVis=false;
instance.frames[i].visible=true;
}
}
}
pro.h_keyboard=function(e){
switch(e.type){
case GodStep.KEYPRESS:
switch(e.content.data){
case GodStep.KEY_SPACE:
var instance=PR.PetResque.instance;
if(instance.startmenu.visible){
PR.DEVMODE=true;
instance.screenTo([instance.levelselect],instance.startmenu);
}
break;
}
break;
}
};
function startPetResque(view){
if(!PR.PetResque.instance){
var game=new PR.PetResque(view);
game.div.style.margin='0 auto';
game.div.style['vertical-align']='middle';
game.initResizeEvents();
}
}
