//Mejdu FrameWork powered by PIXI

var PS=PS||{};
/*!
 SoundJS
 Visit http://createjs.com/ for documentation, updates and examples.

 Copyright (c) 2010 gskinner.com, inc.

 Permission is hereby granted, free of charge, to any person
 obtaining a copy of this software and associated documentation
 files (the "Software"), to deal in the Software without
 restriction, including without limitation the rights to use,
 copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the
 Software is furnished to do so, subject to the following
 conditions:

 The above copyright notice and this permission notice shall be
 included in all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
 OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
 HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
 WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
 OTHER DEALINGS IN THE SOFTWARE.
*/
this.createjs=this.createjs||{};
(function(){
var s=createjs.SoundJS=createjs.SoundJS||{};
s.version="NEXT";
s.buildDate="Thu, 11 Dec 2014 23:16:15 GMT";
})();
this.createjs=this.createjs||{};
createjs.extend=function(subclass,superclass){
"use strict";
function o(){this.constructor=subclass;}
o.prototype=superclass.prototype;
return(subclass.prototype=new o());
};
this.createjs=this.createjs||{};
createjs.promote=function(subclass,prefix){
"use strict";
var subP=subclass.prototype,supP=(Object.getPrototypeOf&&Object.getPrototypeOf(subP))||subP.__proto__;
if(supP){
subP[(prefix+="_")+"constructor"]=supP.constructor;
for(var n in supP){
if(subP.hasOwnProperty(n)&&(typeof supP[n]=="function")){subP[prefix+n]=supP[n];}
}
}
return subclass;
};
this.createjs=this.createjs||{};
createjs.indexOf=function(array,searchElement){
"use strict";
for(var i=0,l=array.length;i<l;i++){
if(searchElement===array[i]){
return i;
}
}
return-1;
};
this.createjs=this.createjs||{};
(function(){
"use strict";
createjs.proxy=function(method,scope){
var aArgs=Array.prototype.slice.call(arguments,2);
return function(){
return method.apply(scope,Array.prototype.slice.call(arguments,0).concat(aArgs));
};
}
}());
this.createjs=this.createjs||{};
(function(){
"use strict";
var t=Object.defineProperty?true:false;
var foo={};
try{
Object.defineProperty(foo,"bar",{
get:function(){
return this._bar;
},
set:function(value){
this._bar=value;
}
});
}catch(e){
t=false;
}
createjs.definePropertySupported=t;
}());
this.createjs=this.createjs||{};
(function(){
"use strict";
function BrowserDetect(){
throw"BrowserDetect cannot be instantiated";
};
var agent=BrowserDetect.agent=window.navigator.userAgent;
BrowserDetect.isWindowPhone=(agent.indexOf("IEMobile")>-1)||(agent.indexOf("Windows Phone")>-1);
BrowserDetect.isFirefox=(agent.indexOf("Firefox")>-1);
BrowserDetect.isOpera=(window.opera!=null);
BrowserDetect.isChrome=(agent.indexOf("Chrome")>-1);
BrowserDetect.isIOS=(agent.indexOf("iPod")>-1||agent.indexOf("iPhone")>-1||agent.indexOf("iPad")>-1)&&!BrowserDetect.isWindowPhone;
BrowserDetect.isAndroid=(agent.indexOf("Android")>-1)&&!BrowserDetect.isWindowPhone;
BrowserDetect.isBlackberry=(agent.indexOf("Blackberry")>-1);
createjs.BrowserDetect=BrowserDetect;
}());
this.createjs=this.createjs||{};
(function(){
"use strict";
function EventDispatcher(){
this._listeners=null;
this._captureListeners=null;
}
var p=EventDispatcher.prototype;
EventDispatcher.initialize=function(target){
target.addEventListener=p.addEventListener;
target.on=p.on;
target.removeEventListener=target.off=p.removeEventListener;
target.removeAllEventListeners=p.removeAllEventListeners;
target.hasEventListener=p.hasEventListener;
target.dispatchEvent=p.dispatchEvent;
target._dispatchEvent=p._dispatchEvent;
target.willTrigger=p.willTrigger;
};
p.addEventListener=function(type,listener,useCapture){
var listeners;
if(useCapture){
listeners=this._captureListeners=this._captureListeners||{};
}else{
listeners=this._listeners=this._listeners||{};
}
var arr=listeners[type];
if(arr){this.removeEventListener(type,listener,useCapture);}
arr=listeners[type];
if(!arr){listeners[type]=[listener];}
else{arr.push(listener);}
return listener;
};
p.on=function(type,listener,scope,once,data,useCapture){
if(listener.handleEvent){
scope=scope||listener;
listener=listener.handleEvent;
}
scope=scope||this;
return this.addEventListener(type,function(evt){
listener.call(scope,evt,data);
once&&evt.remove();
},useCapture);
};
p.removeEventListener=function(type,listener,useCapture){
var listeners=useCapture?this._captureListeners:this._listeners;
if(!listeners){return;}
var arr=listeners[type];
if(!arr){return;}
for(var i=0,l=arr.length;i<l;i++){
if(arr[i]==listener){
if(l==1){delete(listeners[type]);}
else{arr.splice(i,1);}
break;
}
}
};
p.off=p.removeEventListener;
p.removeAllEventListeners=function(type){
if(!type){this._listeners=this._captureListeners=null;}
else{
if(this._listeners){delete(this._listeners[type]);}
if(this._captureListeners){delete(this._captureListeners[type]);}
}
};
p.dispatchEvent=function(eventObj){
if(typeof eventObj=="string"){
var listeners=this._listeners;
if(!listeners||!listeners[eventObj]){return false;}
eventObj=new createjs.Event(eventObj);
}else if(eventObj.target&&eventObj.clone){
eventObj=eventObj.clone();
}
try{eventObj.target=this;}catch(e){}
if(!eventObj.bubbles||!this.parent){
this._dispatchEvent(eventObj,2);
}else{
var top=this,list=[top];
while(top.parent){list.push(top=top.parent);}
var i,l=list.length;
for(i=l-1;i>=0&&!eventObj.propagationStopped;i--){
list[i]._dispatchEvent(eventObj,1+(i==0));
}
for(i=1;i<l&&!eventObj.propagationStopped;i++){
list[i]._dispatchEvent(eventObj,3);
}
}
return eventObj.defaultPrevented;
};
p.hasEventListener=function(type){
var listeners=this._listeners,captureListeners=this._captureListeners;
return!!((listeners&&listeners[type])||(captureListeners&&captureListeners[type]));
};
p.willTrigger=function(type){
var o=this;
while(o){
if(o.hasEventListener(type)){return true;}
o=o.parent;
}
return false;
};
p.toString=function(){
return"[EventDispatcher]";
};
p._dispatchEvent=function(eventObj,eventPhase){
var l,listeners=(eventPhase==1)?this._captureListeners:this._listeners;
if(eventObj&&listeners){
var arr=listeners[eventObj.type];
if(!arr||!(l=arr.length)){return;}
try{eventObj.currentTarget=this;}catch(e){}
try{eventObj.eventPhase=eventPhase;}catch(e){}
eventObj.removed=false;
arr=arr.slice();
for(var i=0;i<l&&!eventObj.immediatePropagationStopped;i++){
var o=arr[i];
if(o.handleEvent){o.handleEvent(eventObj);}
else{o(eventObj);}
if(eventObj.removed){
this.off(eventObj.type,o,eventPhase==1);
eventObj.removed=false;
}
}
}
};
createjs.EventDispatcher=EventDispatcher;
}());
this.createjs=this.createjs||{};
(function(){
"use strict";
function Event(type,bubbles,cancelable){
this.type=type;
this.target=null;
this.currentTarget=null;
this.eventPhase=0;
this.bubbles=!!bubbles;
this.cancelable=!!cancelable;
this.timeStamp=(new Date()).getTime();
this.defaultPrevented=false;
this.propagationStopped=false;
this.immediatePropagationStopped=false;
this.removed=false;
}
var p=Event.prototype;
p.preventDefault=function(){
this.defaultPrevented=this.cancelable&&true;
};
p.stopPropagation=function(){
this.propagationStopped=true;
};
p.stopImmediatePropagation=function(){
this.immediatePropagationStopped=this.propagationStopped=true;
};
p.remove=function(){
this.removed=true;
};
p.clone=function(){
return new Event(this.type,this.bubbles,this.cancelable);
};
p.set=function(props){
for(var n in props){this[n]=props[n];}
return this;
};
p.toString=function(){
return"[Event (type="+this.type+")]";
};
createjs.Event=Event;
}());
this.createjs=this.createjs||{};
(function(){
"use strict";
function ErrorEvent(title,message,data){
this.Event_constructor("error");
this.title=title;
this.message=message;
this.data=data;
}
var p=createjs.extend(ErrorEvent,createjs.Event);
p.clone=function(){
return new createjs.ErrorEvent(this.title,this.message,this.data);
};
createjs.ErrorEvent=createjs.promote(ErrorEvent,"Event");
}());
this.createjs=this.createjs||{};
(function(scope){
"use strict";
function ProgressEvent(loaded,total){
this.Event_constructor("progress");
this.loaded=loaded;
this.total=(total==null)?1:total;
this.progress=(total==0)?0:this.loaded/this.total;
};
var p=createjs.extend(ProgressEvent,createjs.Event);
p.clone=function(){
return new createjs.ProgressEvent(this.loaded,this.total);
};
createjs.ProgressEvent=createjs.promote(ProgressEvent,"Event");
}(window));
this.createjs=this.createjs||{};
(function(){
"use strict";
function LoadItem(){
this.src=null;
this.type=null;
this.id=null;
this.maintainOrder=false;
this.callback=null;
this.data=null;
this.method=createjs.LoadItem.GET;
this.values=null;
this.headers=null;
this.withCredentials=false;
this.mimeType=null;
this.crossOrigin="Anonymous";
this.loadTimeout=8000;
};
var p=LoadItem.prototype={};
var s=LoadItem;
s.create=function(value){
if(typeof value=="string"){
var item=new LoadItem();
item.src=value;
return item;
}else if(value instanceof s){
return value;
}else if(value instanceof Object){
return value;
}else{
throw new Error("Type not recognized.");
}
};
p.set=function(props){
for(var n in props){this[n]=props[n];}
return this;
};
createjs.LoadItem=s;
}());
(function(){
var s={};
s.ABSOLUTE_PATT=/^(?:\w+:)?\/{2}/i;
s.RELATIVE_PATT='';
s.EXTENSION_PATT=/\/?[^/]+\.(\w{1,5})$/i;
s.parseURI=function(path){
var info={absolute:false,relative:false};
if(path==null){return info;}
var queryIndex=path.indexOf("?");
if(queryIndex>-1){
path=path.substr(0,queryIndex);
}
var match;
if(s.ABSOLUTE_PATT.test(path)){
info.absolute=true;
}else if(s.RELATIVE_PATT.test(path)){
info.relative=true;
}
if(match=path.match(s.EXTENSION_PATT)){
info.extension=match[1].toLowerCase();
}
return info;
};
s.formatQueryString=function(data,query){
if(data==null){
throw new Error('You must specify data.');
}
var params=[];
for(var n in data){
params.push(n+'='+escape(data[n]));
}
if(query){
params=params.concat(query);
}
return params.join('&');
};
s.buildPath=function(src,data){
if(data==null){
return src;
}
var query=[];
var idx=src.indexOf('?');
if(idx!=-1){
var q=src.slice(idx+1);
query=query.concat(q.split('&'));
}
if(idx!=-1){
return src.slice(0,idx)+'?'+this._formatQueryString(data,query);
}else{
return src+'?'+this._formatQueryString(data,query);
}
};
s.isCrossDomain=function(item){
var target=document.createElement("a");
target.href=item.src;
var host=document.createElement("a");
host.href=location.href;
var crossdomain=(target.hostname!="")&&
(target.port!=host.port||
target.protocol!=host.protocol||
target.hostname!=host.hostname);
return crossdomain;
};
s.isLocal=function(item){
var target=document.createElement("a");
target.href=item.src;
return target.hostname==""&&target.protocol=="file:";
};
s.isBinary=function(type){
switch(type){
case createjs.AbstractLoader.IMAGE:
case createjs.AbstractLoader.BINARY:
return true;
default:
return false;
}
};
s.isImageTag=function(item){
return item instanceof HTMLImageElement;
};
s.isAudioTag=function(item){
if(window.HTMLAudioElement){
return item instanceof HTMLAudioElement;
}else{
return false;
}
};
s.isVideoTag=function(item){
if(window.HTMLVideoElement){
return item instanceof HTMLVideoElement;
}else{
false;
}
};
s.isText=function(type){
switch(type){
case createjs.AbstractLoader.TEXT:
case createjs.AbstractLoader.JSON:
case createjs.AbstractLoader.MANIFEST:
case createjs.AbstractLoader.XML:
case createjs.AbstractLoader.CSS:
case createjs.AbstractLoader.SVG:
case createjs.AbstractLoader.JAVASCRIPT:
return true;
default:
return false;
}
};
s.getTypeByExtension=function(extension){
if(extension==null){
return createjs.AbstractLoader.TEXT;
}
switch(extension.toLowerCase()){
case"jpeg":
case"jpg":
case"gif":
case"png":
case"webp":
case"bmp":
return createjs.AbstractLoader.IMAGE;
case"ogg":
case"mp3":
case"webm":
return createjs.AbstractLoader.SOUND;
case"mp4":
case"webm":
case"ts":
return createjs.AbstractLoader.VIDEO;
case"json":
return createjs.AbstractLoader.JSON;
case"xml":
return createjs.AbstractLoader.XML;
case"css":
return createjs.AbstractLoader.CSS;
case"js":
return createjs.AbstractLoader.JAVASCRIPT;
case'svg':
return createjs.AbstractLoader.SVG;
default:
return createjs.AbstractLoader.TEXT;
}
};
createjs.RequestUtils=s;
}());
this.createjs=this.createjs||{};
(function(){
"use strict";
function AbstractLoader(loadItem,preferXHR,type){
this.EventDispatcher_constructor();
this.loaded=false;
this.canceled=false;
this.progress=0;
this.type=type;
this.resultFormatter=null;
if(loadItem){
this._item=createjs.LoadItem.create(loadItem);
}else{
this._item=null;
}
this._preferXHR=preferXHR;
this._result=null;
this._rawResult=null;
this._loadedItems=null;
this._tagSrcAttribute=null;
this._tag=null;
};
var p=createjs.extend(AbstractLoader,createjs.EventDispatcher);
var s=AbstractLoader;
s.POST="POST";
s.GET="GET";
s.BINARY="binary";
s.CSS="css";
s.IMAGE="image";
s.JAVASCRIPT="javascript";
s.JSON="json";
s.JSONP="jsonp";
s.MANIFEST="manifest";
s.SOUND="sound";
s.VIDEO="video";
s.SPRITESHEET="spritesheet";
s.SVG="svg";
s.TEXT="text";
s.XML="xml";
p.getItem=function(){
return this._item;
};
p.getResult=function(raw){
return raw?this._rawResult:this._result;
};
p.getTag=function(){
return this._tag;
};
p.setTag=function(tag){
this._tag=tag;
};
p.load=function(){
this._createRequest();
this._request.on("complete",this,this);
this._request.on("progress",this,this);
this._request.on("loadStart",this,this);
this._request.on("abort",this,this);
this._request.on("timeout",this,this);
this._request.on("error",this,this);
var evt=new createjs.Event("initialize");
evt.loader=this._request;
this.dispatchEvent(evt);
this._request.load();
};
p.cancel=function(){
this.canceled=true;
this.destroy();
};
p.destroy=function(){
if(this._request){
this._request.removeAllEventListeners();
this._request.destroy();
}
this._request=null;
this._item=null;
this._rawResult=null;
this._result=null;
this._loadItems=null;
this.removeAllEventListeners();
};
p.getLoadedItems=function(){
return this._loadedItems;
};
p._createRequest=function(){
if(!this._preferXHR){
this._request=new createjs.TagRequest(this._item,this._tag||this._createTag(),this._tagSrcAttribute);
}else{
this._request=new createjs.XHRRequest(this._item);
}
};
p._createTag=function(src){return null;};
p._sendLoadStart=function(){
if(this._isCanceled()){return;}
this.dispatchEvent("loadstart");
};
p._sendProgress=function(value){
if(this._isCanceled()){return;}
var event=null;
if(typeof(value)=="number"){
this.progress=value;
event=new createjs.ProgressEvent(this.progress);
}else{
event=value;
this.progress=value.loaded/value.total;
event.progress=this.progress;
if(isNaN(this.progress)||this.progress==Infinity){this.progress=0;}
}
this.hasEventListener("progress")&&this.dispatchEvent(event);
};
p._sendComplete=function(){
if(this._isCanceled()){return;}
this.loaded=true;
var event=new createjs.Event("complete");
event.rawResult=this._rawResult;
if(this._result!=null){
event.result=this._result;
}
this.dispatchEvent(event);
};
p._sendError=function(event){
if(this._isCanceled()||!this.hasEventListener("error")){return;}
if(event==null){
event=new createjs.ErrorEvent("PRELOAD_ERROR_EMPTY");
}
this.dispatchEvent(event);
};
p._isCanceled=function(){
if(window.createjs==null||this.canceled){
return true;
}
return false;
};
p.resultFormatter=null;
p.handleEvent=function(event){
switch(event.type){
case"complete":
this._rawResult=event.target._response;
var result=this.resultFormatter&&this.resultFormatter(this);
var _this=this;
if(result instanceof Function){
result(function(result){
_this._result=result;
_this._sendComplete();
});
}else{
this._result=result||this._rawResult;
this._sendComplete();
}
break;
case"progress":
this._sendProgress(event);
break;
case"error":
this._sendError(event);
break;
case"loadstart":
this._sendLoadStart();
break;
case"abort":
case"timeout":
if(!this._isCanceled()){
this.dispatchEvent(event.type);
}
break;
}
};
p.buildPath=function(src,data){
return createjs.RequestUtils.buildPath(src,data);
};
p.toString=function(){
return"[PreloadJS AbstractLoader]";
};
createjs.AbstractLoader=createjs.promote(AbstractLoader,"EventDispatcher");
}());
this.createjs=this.createjs||{};
(function(){
"use strict";
function AbstractMediaLoader(loadItem,preferXHR,type){
this.AbstractLoader_constructor(loadItem,preferXHR,type);
this.resultFormatter=this._formatResult;
this._tagSrcAttribute="src";
};
var p=createjs.extend(AbstractMediaLoader,createjs.AbstractLoader);
p.load=function(){
if(!this._tag){
this._tag=this._createTag(this._item.src);
}
this._tag.preload="auto";
this._tag.load();
this.AbstractLoader_load();
};
p._createTag=function(){};
p._createRequest=function(){
if(!this._preferXHR){
this._request=new createjs.MediaTagRequest(this._item,this._tag||this._createTag(),this._tagSrcAttribute);
}else{
this._request=new createjs.XHRRequest(this._item);
}
};
p._formatResult=function(loader){
this._tag.removeEventListener&&this._tag.removeEventListener("canplaythrough",this._loadedHandler);
this._tag.onstalled=null;
if(this._preferXHR){
loader.getTag().src=loader.getResult(true);
}
return loader.getTag();
};
createjs.AbstractMediaLoader=createjs.promote(AbstractMediaLoader,"AbstractLoader");
}());
this.createjs=this.createjs||{};
(function(){
"use strict";
var AbstractRequest=function(item){
this._item=item;
};
var p=createjs.extend(AbstractRequest,createjs.EventDispatcher);
p.load=function(){};
p.destroy=function(){};
p.cancel=function(){};
createjs.AbstractRequest=createjs.promote(AbstractRequest,"EventDispatcher");
}());
this.createjs=this.createjs||{};
(function(){
"use strict";
function TagRequest(loadItem,tag,srcAttribute){
this.AbstractRequest_constructor(loadItem);
this._tag=tag;
this._tagSrcAttribute=srcAttribute;
this._loadedHandler=createjs.proxy(this._handleTagComplete,this);
this._addedToDOM=false;
this._startTagVisibility=null;
};
var p=createjs.extend(TagRequest,createjs.AbstractRequest);
p.load=function(){
if(this._tag.parentNode==null){
window.document.body.appendChild(this._tag);
this._addedToDOM=true;
}
this._tag.onload=createjs.proxy(this._handleTagComplete,this);
this._tag.onreadystatechange=createjs.proxy(this._handleReadyStateChange,this);
var evt=new createjs.Event("initialize");
evt.loader=this._tag;
this.dispatchEvent(evt);
this._hideTag();
this._tag[this._tagSrcAttribute]=this._item.src;
};
p.destroy=function(){
this._clean();
this._tag=null;
this.AbstractRequest_destroy();
};
p._handleReadyStateChange=function(){
clearTimeout(this._loadTimeout);
var tag=this._tag;
if(tag.readyState=="loaded"||tag.readyState=="complete"){
this._handleTagComplete();
}
};
p._handleTagComplete=function(){
this._rawResult=this._tag;
this._result=this.resultFormatter&&this.resultFormatter(this)||this._rawResult;
this._clean();
this._showTag();
this.dispatchEvent("complete");
};
p._clean=function(){
this._tag.onload=null;
this._tag.onreadystatechange=null;
if(this._addedToDOM&&this._tag.parentNode!=null){
this._tag.parentNode.removeChild(this._tag);
}
};
p._hideTag=function(){
this._startTagVisibility=this._tag.style.visibility;
this._tag.style.visibility="hidden";
};
p._showTag=function(){
this._tag.style.visibility=this._startTagVisibility;
};
p._handleStalled=function(){
};
createjs.TagRequest=createjs.promote(TagRequest,"AbstractRequest");
}());
this.createjs=this.createjs||{};
(function(){
"use strict";
function MediaTagRequest(loadItem,tag,srcAttribute){
this.AbstractRequest_constructor(loadItem);
this._tag=tag;
this._tagSrcAttribute=srcAttribute;
this._loadedHandler=createjs.proxy(this._handleTagComplete,this);
};
var p=createjs.extend(MediaTagRequest,createjs.TagRequest);
var s=MediaTagRequest;
p.load=function(){
this._tag.onstalled=createjs.proxy(this._handleStalled,this);
this._tag.onprogress=createjs.proxy(this._handleProgress,this);
this._tag.addEventListener&&this._tag.addEventListener("canplaythrough",this._loadedHandler,false);
this.TagRequest_load();
};
p._handleReadyStateChange=function(){
clearTimeout(this._loadTimeout);
var tag=this._tag;
if(tag.readyState=="loaded"||tag.readyState=="complete"){
this._handleTagComplete();
}
};
p._handleStalled=function(){
};
p._handleProgress=function(event){
if(!event||event.loaded>0&&event.total==0){
return;
}
var newEvent=new createjs.ProgressEvent(event.loaded,event.total);
this.dispatchEvent(newEvent);
};
p._clean=function(){
this._tag.removeEventListener&&this._tag.removeEventListener("canplaythrough",this._loadedHandler);
this._tag.onstalled=null;
this._tag.onprogress=null;
this.TagRequest__clean();
};
createjs.MediaTagRequest=createjs.promote(MediaTagRequest,"TagRequest");
}());
this.createjs=this.createjs||{};
(function(){
"use strict";
function XHRRequest(item){
this.AbstractRequest_constructor(item);
this._request=null;
this._loadTimeout=null;
this._xhrLevel=1;
this._response=null;
this._rawResponse=null;
this._canceled=false;
this._handleLoadStartProxy=createjs.proxy(this._handleLoadStart,this);
this._handleProgressProxy=createjs.proxy(this._handleProgress,this);
this._handleAbortProxy=createjs.proxy(this._handleAbort,this);
this._handleErrorProxy=createjs.proxy(this._handleError,this);
this._handleTimeoutProxy=createjs.proxy(this._handleTimeout,this);
this._handleLoadProxy=createjs.proxy(this._handleLoad,this);
this._handleReadyStateChangeProxy=createjs.proxy(this._handleReadyStateChange,this);
if(!this._createXHR(item)){
}
};
var p=createjs.extend(XHRRequest,createjs.AbstractRequest);
XHRRequest.ACTIVEX_VERSIONS=[
"Msxml2.XMLHTTP.6.0",
"Msxml2.XMLHTTP.5.0",
"Msxml2.XMLHTTP.4.0",
"MSXML2.XMLHTTP.3.0",
"MSXML2.XMLHTTP",
"Microsoft.XMLHTTP"
];
p.getResult=function(raw){
if(raw&&this._rawResponse){
return this._rawResponse;
}
return this._response;
};
p.cancel=function(){
this.canceled=true;
this._clean();
this._request.abort();
};
p.load=function(){
if(this._request==null){
this._handleError();
return;
}
this._request.addEventListener("loadstart",this._handleLoadStartProxy,false);
this._request.addEventListener("progress",this._handleProgressProxy,false);
this._request.addEventListener("abort",this._handleAbortProxy,false);
this._request.addEventListener("error",this._handleErrorProxy,false);
this._request.addEventListener("timeout",this._handleTimeoutProxy,false);
this._request.addEventListener("load",this._handleLoadProxy,false);
this._request.addEventListener("readystatechange",this._handleReadyStateChangeProxy,false);
if(this._xhrLevel==1){
this._loadTimeout=setTimeout(createjs.proxy(this._handleTimeout,this),this._item.loadTimeout);
}
try{
if(!this._item.values||this._item.method==createjs.AbstractLoader.GET){
this._request.send();
}else if(this._item.method==createjs.AbstractLoader.POST){
this._request.send(createjs.RequestUtils.formatQueryString(this._item.values));
}
}catch(error){
this.dispatchEvent(new createjs.ErrorEvent("XHR_SEND",null,error));
}
};
p.setResponseType=function(type){
this._request.responseType=type;
};
p.getAllResponseHeaders=function(){
if(this._request.getAllResponseHeaders instanceof Function){
return this._request.getAllResponseHeaders();
}else{
return null;
}
};
p.getResponseHeader=function(header){
if(this._request.getResponseHeader instanceof Function){
return this._request.getResponseHeader(header);
}else{
return null;
}
};
p._handleProgress=function(event){
if(!event||event.loaded>0&&event.total==0){
return;
}
var newEvent=new createjs.ProgressEvent(event.loaded,event.total);
this.dispatchEvent(newEvent);
};
p._handleLoadStart=function(event){
clearTimeout(this._loadTimeout);
this.dispatchEvent("loadstart");
};
p._handleAbort=function(event){
this._clean();
this.dispatchEvent(new createjs.ErrorEvent("XHR_ABORTED",null,event));
};
p._handleError=function(event){
this._clean();
this.dispatchEvent(new createjs.ErrorEvent(event.message));
};
p._handleReadyStateChange=function(event){
if(this._request.readyState==4){
this._handleLoad();
}
};
p._handleLoad=function(event){
if(this.loaded){
return;
}
this.loaded=true;
var error=this._checkError();
if(error){
this._handleError(error);
return;
}
this._response=this._getResponse();
this._clean();
this.dispatchEvent(new createjs.Event("complete"));
};
p._handleTimeout=function(event){
this._clean();
this.dispatchEvent(new createjs.ErrorEvent("PRELOAD_TIMEOUT",null,event));
};
p._checkError=function(){
var status=parseInt(this._request.status);
switch(status){
case 404:
case 0:
return new Error(status);
}
return null;
};
p._getResponse=function(){
if(this._response!=null){
return this._response;
}
if(this._request.response!=null){
return this._request.response;
}
try{
if(this._request.responseText!=null){
return this._request.responseText;
}
}catch(e){
}
try{
if(this._request.responseXML!=null){
return this._request.responseXML;
}
}catch(e){
}
return null;
};
p._createXHR=function(item){
var crossdomain=createjs.RequestUtils.isCrossDomain(item);
var headers={};
var req=null;
if(window.XMLHttpRequest){
req=new XMLHttpRequest();
if(crossdomain&&req.withCredentials===undefined&&window.XDomainRequest){
req=new XDomainRequest();
}
}else{
for(var i=0,l=s.ACTIVEX_VERSIONS.length;i<l;i++){
var axVersion=s.ACTIVEX_VERSIONS[i];
try{
req=new ActiveXObject(axVersions);
break;
}catch(e){}
}
if(req==null){return false;}
}
if(item.mimeType&&req.overrideMimeType){
req.overrideMimeType(item.mimeType);
}
this._xhrLevel=(typeof req.responseType==="string")?2:1;
var src=null;
if(item.method==createjs.AbstractLoader.GET){
src=createjs.RequestUtils.buildPath(item.src,item.values);
}else{
src=item.src;
}
req.open(item.method||createjs.AbstractLoader.GET,src,true);
if(crossdomain&&req instanceof XMLHttpRequest&&this._xhrLevel==1){
headers["Origin"]=location.origin;
}
if(item.values&&item.method==createjs.AbstractLoader.POST){
headers["Content-Type"]="application/x-www-form-urlencoded";
}
if(!crossdomain&&!headers["X-Requested-With"]){
headers["X-Requested-With"]="XMLHttpRequest";
}
if(item.headers){
for(var n in item.headers){
headers[n]=item.headers[n];
}
}
for(n in headers){
req.setRequestHeader(n,headers[n])
}
if(req instanceof XMLHttpRequest&&item.withCredentials!==undefined){
req.withCredentials=item.withCredentials;
}
this._request=req;
return true;
};
p._clean=function(){
clearTimeout(this._loadTimeout);
this._request.removeEventListener("loadstart",this._handleLoadStartProxy);
this._request.removeEventListener("progress",this._handleProgressProxy);
this._request.removeEventListener("abort",this._handleAbortProxy);
this._request.removeEventListener("error",this._handleErrorProxy);
this._request.removeEventListener("timeout",this._handleTimeoutProxy);
this._request.removeEventListener("load",this._handleLoadProxy);
this._request.removeEventListener("readystatechange",this._handleReadyStateChangeProxy);
};
p.toString=function(){
return"[PreloadJS XHRRequest]";
};
createjs.XHRRequest=createjs.promote(XHRRequest,"AbstractRequest");
}());
this.createjs=this.createjs||{};
(function(){
"use strict";
function SoundLoader(loadItem,preferXHR){
this.AbstractMediaLoader_constructor(loadItem,preferXHR,createjs.AbstractLoader.SOUND);
if(createjs.RequestUtils.isAudioTag(loadItem)){
this._tag=loadItem;
}else if(createjs.RequestUtils.isAudioTag(loadItem.src)){
this._tag=loadItem;
}else if(createjs.RequestUtils.isAudioTag(loadItem.tag)){
this._tag=createjs.RequestUtils.isAudioTag(loadItem)?loadItem:loadItem.src;
}
if(this._tag!=null){
this._preferXHR=false;
}
};
var p=createjs.extend(SoundLoader,createjs.AbstractMediaLoader);
var s=SoundLoader;
s.canLoadItem=function(item){
return item.type==createjs.AbstractLoader.SOUND;
};
p._createTag=function(src){
var tag=document.createElement("audio");
tag.autoplay=false;
tag.preload="none";
tag.src=src;
return tag;
};
createjs.SoundLoader=createjs.promote(SoundLoader,"AbstractMediaLoader");
}());
this.createjs=this.createjs||{};
(function(){
"use strict";
function Sound(){
throw"Sound cannot be instantiated";
}
var s=Sound;
s.INTERRUPT_ANY="any";
s.INTERRUPT_EARLY="early";
s.INTERRUPT_LATE="late";
s.INTERRUPT_NONE="none";
s.PLAY_INITED="playInited";
s.PLAY_SUCCEEDED="playSucceeded";
s.PLAY_INTERRUPTED="playInterrupted";
s.PLAY_FINISHED="playFinished";
s.PLAY_FAILED="playFailed";
s.SUPPORTED_EXTENSIONS=["mp3","ogg","mpeg","wav","m4a","mp4","aiff","wma","mid"];
s.EXTENSION_MAP={
m4a:"mp4"
};
s.FILE_PATTERN=/^(?:(\w+:)\/{2}(\w+(?:\.\w+)*\/?))?([/.]*?(?:[^?]+)?\/)?((?:[^/?]+)\.(\w+))(?:\?(\S+)?)?$/;
s.defaultInterruptBehavior=s.INTERRUPT_NONE;
s.alternateExtensions=[];
s.activePlugin=null;
s._pluginsRegistered=false;
s._lastID=0;
s._masterVolume=1;
s._masterMute=false;
s._instances=[];
s._idHash={};
s._preloadHash={};
s.addEventListener=null;
s.removeEventListener=null;
s.removeAllEventListeners=null;
s.dispatchEvent=null;
s.hasEventListener=null;
s._listeners=null;
createjs.EventDispatcher.initialize(s);
s.getPreloadHandlers=function(){
return{
callback:createjs.proxy(s.initLoad,s),
types:["sound"],
extensions:s.SUPPORTED_EXTENSIONS
};
};
s._handleLoadComplete=function(event){
var src=event.target.getItem().src;
if(!s._preloadHash[src]){return;}
for(var i=0,l=s._preloadHash[src].length;i<l;i++){
var item=s._preloadHash[src][i];
s._preloadHash[src][i]=true;
if(!s.hasEventListener("fileload")){continue;}
var event=new createjs.Event("fileload");
event.src=item.src;
event.id=item.id;
event.data=item.data;
event.sprite=item.sprite;
s.dispatchEvent(event);
}
};
s._handleLoadError=function(event){
var src=event.target.getItem().src;
if(!s._preloadHash[src]){return;}
for(var i=0,l=s._preloadHash[src].length;i<l;i++){
var item=s._preloadHash[src][i];
s._preloadHash[src][i]=false;
if(!s.hasEventListener("fileerror")){continue;}
var event=new createjs.Event("fileerror");
event.src=item.src;
event.id=item.id;
event.data=item.data;
event.sprite=item.sprite;
s.dispatchEvent(event);
}
};
s._registerPlugin=function(plugin){
if(plugin.isSupported()){
s.activePlugin=new plugin();
return true;
}
return false;
};
s.registerPlugins=function(plugins){
s._pluginsRegistered=true;
for(var i=0,l=plugins.length;i<l;i++){
if(s._registerPlugin(plugins[i])){
return true;
}
}
return false;
};
s.initializeDefaultPlugins=function(){
if(s.activePlugin!=null){return true;}
if(s._pluginsRegistered){return false;}
if(s.registerPlugins([createjs.WebAudioPlugin,createjs.HTMLAudioPlugin])){return true;}
return false;
};
s.isReady=function(){
return(s.activePlugin!=null);
};
s.getCapabilities=function(){
if(s.activePlugin==null){return null;}
return s.activePlugin._capabilities;
};
s.getCapability=function(key){
if(s.activePlugin==null){return null;}
return s.activePlugin._capabilities[key];
};
s.initLoad=function(loadItem){
return s._registerSound(loadItem);
};
s._registerSound=function(loadItem){
if(!s.initializeDefaultPlugins()){return false;}
var details=s._parsePath(loadItem.src);
if(details==null){return false;}
loadItem.src=details.src;
loadItem.type="sound";
var data=loadItem.data;
var numChannels=s.activePlugin.defaultNumChannels||null;
if(data!=null){
if(!isNaN(data.channels)){
numChannels=parseInt(data.channels);
}else if(!isNaN(data)){
numChannels=parseInt(data);
}
if(data.audioSprite){
var sp;
for(var i=data.audioSprite.length;i--;){
sp=data.audioSprite[i];
s._idHash[sp.id]={src:loadItem.src,startTime:parseInt(sp.startTime),duration:parseInt(sp.duration)};
}
}
}
if(loadItem.id!=null){s._idHash[loadItem.id]={src:loadItem.src}};
var loader=s.activePlugin.register(loadItem,numChannels);
SoundChannel.create(loadItem.src,numChannels);
if(data==null||!isNaN(data)){
loadItem.data=numChannels||SoundChannel.maxPerChannel();
}else{
loadItem.data.channels=numChannels||SoundChannel.maxPerChannel();
}
if(loader.type){loadItem.type=loader.type;}
return loader;
};
s.registerSound=function(src,id,data,basePath){
var loadItem={src:src,id:id,data:data};
if(src instanceof Object){
basePath=id;
loadItem=src;
}
loadItem=createjs.LoadItem.create(loadItem);
if(basePath!=null){loadItem.src=basePath+src;}
var loader=s._registerSound(loadItem);
if(!loader){return false;}
if(!s._preloadHash[loadItem.src]){s._preloadHash[loadItem.src]=[];}
s._preloadHash[loadItem.src].push(loadItem);
if(s._preloadHash[loadItem.src].length==1){
loader.on("complete",createjs.proxy(this._handleLoadComplete,this));
loader.on("error",createjs.proxy(this._handleLoadError,this));
s.activePlugin.preload(loader);
}else{
if(s._preloadHash[loadItem.src][0]==true){return true;}
}
return loadItem;
};
s.registerSounds=function(sounds,basePath){
var returnValues=[];
if(sounds.path){
if(!basePath){
basePath=sounds.path;
}else{
basePath=basePath+sounds.path;
}
}
for(var i=0,l=sounds.length;i<l;i++){
returnValues[i]=createjs.Sound.registerSound(sounds[i].src,sounds[i].id,sounds[i].data,basePath);
}
return returnValues;
};
s.registerManifest=function(manifest,basePath){
try{
console.log("createjs.Sound.registerManifest is deprecated, please use createjs.Sound.registerSounds.")
}catch(error){
};
return this.registerSounds(manifest,basePath);
};
s.removeSound=function(src,basePath){
if(s.activePlugin==null){return false;}
if(src instanceof Object){src=src.src;}
src=s._getSrcById(src).src;
if(basePath!=null){src=basePath+src;}
var details=s._parsePath(src);
if(details==null){return false;}
src=details.src;
for(var prop in s._idHash){
if(s._idHash[prop].src==src){
delete(s._idHash[prop]);
}
}
SoundChannel.removeSrc(src);
delete(s._preloadHash[src]);
s.activePlugin.removeSound(src);
return true;
};
s.removeSounds=function(sounds,basePath){
var returnValues=[];
if(sounds.path){
if(!basePath){
basePath=sounds.path;
}else{
basePath=basePath+sounds.path;
}
}
for(var i=0,l=sounds.length;i<l;i++){
returnValues[i]=createjs.Sound.removeSound(sounds[i].src,basePath);
}
return returnValues;
};
s.removeManifest=function(manifest,basePath){
try{
console.log("createjs.Sound.removeManifest is deprecated, please use createjs.Sound.removeSounds.");
}catch(error){
};
return s.removeSounds(manifest,basePath);
};
s.removeAllSounds=function(){
s._idHash={};
s._preloadHash={};
SoundChannel.removeAll();
if(s.activePlugin){s.activePlugin.removeAllSounds();}
};
s.loadComplete=function(src){
if(!s.isReady()){return false;}
var details=s._parsePath(src);
if(details){
src=s._getSrcById(details.src).src;
}else{
src=s._getSrcById(src).src;
}
return(s._preloadHash[src][0]==true);
};
s._parsePath=function(value){
if(typeof(value)!="string"){value=value.toString();}
var match=value.match(s.FILE_PATTERN);
if(match==null){return false;}
var name=match[4];
var ext=match[5];
var c=s.getCapabilities();
var i=0;
while(!c[ext]){
ext=s.alternateExtensions[i++];
if(i>s.alternateExtensions.length){return null;}
}
value=value.replace("."+match[5],"."+ext);
var ret={name:name,src:value,extension:ext};
return ret;
};
s.play=function(src,interrupt,delay,offset,loop,volume,pan,startTime,duration){
if(interrupt instanceof Object){
delay=interrupt.delay;
offset=interrupt.offset;
loop=interrupt.loop;
volume=interrupt.volume;
pan=interrupt.pan;
startTime=interrupt.startTime;
duration=interrupt.duration;
interrupt=interrupt.interrupt;
}
var instance=s.createInstance(src,startTime,duration);
var ok=s._playInstance(instance,interrupt,delay,offset,loop,volume,pan);
if(!ok){instance._playFailed();}
return instance;
};
s.createInstance=function(src,startTime,duration){
if(!s.initializeDefaultPlugins()){return new createjs.DefaultSoundInstance(src,startTime,duration);}
src=s._getSrcById(src);
var details=s._parsePath(src.src);
var instance=null;
if(details!=null&&details.src!=null){
SoundChannel.create(details.src);
if(startTime==null){startTime=src.startTime;}
instance=s.activePlugin.create(details.src,startTime,duration||src.duration);
}else{
instance=new createjs.DefaultSoundInstance(src,startTime,duration);;
}
instance.uniqueId=s._lastID++;
return instance;
};
s.setVolume=function(value){
if(Number(value)==null){return false;}
value=Math.max(0,Math.min(1,value));
s._masterVolume=value;
if(!this.activePlugin||!this.activePlugin.setVolume||!this.activePlugin.setVolume(value)){
var instances=this._instances;
for(var i=0,l=instances.length;i<l;i++){
instances[i].setMasterVolume(value);
}
}
};
s.getVolume=function(){
return s._masterVolume;
};
s.setMute=function(value){
if(value==null){return false;}
this._masterMute=value;
if(!this.activePlugin||!this.activePlugin.setMute||!this.activePlugin.setMute(value)){
var instances=this._instances;
for(var i=0,l=instances.length;i<l;i++){
instances[i].setMasterMute(value);
}
}
return true;
};
s.getMute=function(){
return this._masterMute;
};
s.stop=function(){
var instances=this._instances;
for(var i=instances.length;i--;){
instances[i].stop();
}
};
s._playInstance=function(instance,interrupt,delay,offset,loop,volume,pan){
if(interrupt instanceof Object){
delay=interrupt.delay;
offset=interrupt.offset;
loop=interrupt.loop;
volume=interrupt.volume;
pan=interrupt.pan;
interrupt=interrupt.interrupt;
}
interrupt=interrupt||s.defaultInterruptBehavior;
if(delay==null){delay=0;}
if(offset==null){offset=instance.getPosition();}
if(loop==null){loop=instance.loop;}
if(volume==null){volume=instance.volume;}
if(pan==null){pan=instance.pan;}
if(delay==0){
var ok=s._beginPlaying(instance,interrupt,offset,loop,volume,pan);
if(!ok){return false;}
}else{
var delayTimeoutId=setTimeout(function(){
s._beginPlaying(instance,interrupt,offset,loop,volume,pan);
},delay);
instance.delayTimeoutId=delayTimeoutId;
}
this._instances.push(instance);
return true;
};
s._beginPlaying=function(instance,interrupt,offset,loop,volume,pan){
if(!SoundChannel.add(instance,interrupt)){
return false;
}
var result=instance._beginPlaying(offset,loop,volume,pan);
if(!result){
var index=createjs.indexOf(this._instances,instance);
if(index>-1){this._instances.splice(index,1);}
return false;
}
return true;
};
s._getSrcById=function(value){
return s._idHash[value]||{src:value};
};
s._playFinished=function(instance){
SoundChannel.remove(instance);
var index=createjs.indexOf(this._instances,instance);
if(index>-1){this._instances.splice(index,1);}
};
createjs.Sound=Sound;
function SoundChannel(src,max){
this.init(src,max);
}
SoundChannel.channels={};
SoundChannel.create=function(src,max){
var channel=SoundChannel.get(src);
if(channel==null){
SoundChannel.channels[src]=new SoundChannel(src,max);
return true;
}
return false;
};
SoundChannel.removeSrc=function(src){
var channel=SoundChannel.get(src);
if(channel==null){return false;}
channel._removeAll();
delete(SoundChannel.channels[src]);
return true;
};
SoundChannel.removeAll=function(){
for(var channel in SoundChannel.channels){
SoundChannel.channels[channel]._removeAll();
}
SoundChannel.channels={};
};
SoundChannel.add=function(instance,interrupt){
var channel=SoundChannel.get(instance.src);
if(channel==null){return false;}
return channel._add(instance,interrupt);
};
SoundChannel.remove=function(instance){
var channel=SoundChannel.get(instance.src);
if(channel==null){return false;}
channel._remove(instance);
return true;
};
SoundChannel.maxPerChannel=function(){
return p.maxDefault;
};
SoundChannel.get=function(src){
return SoundChannel.channels[src];
};
var p=SoundChannel.prototype;
p.constructor=SoundChannel;
p.src=null;
p.max=null;
p.maxDefault=100;
p.length=0;
p.init=function(src,max){
this.src=src;
this.max=max||this.maxDefault;
if(this.max==-1){this.max=this.maxDefault;}
this._instances=[];
};
p._get=function(index){
return this._instances[index];
};
p._add=function(instance,interrupt){
if(!this._getSlot(interrupt,instance)){return false;}
this._instances.push(instance);
this.length++;
return true;
};
p._remove=function(instance){
var index=createjs.indexOf(this._instances,instance);
if(index==-1){return false;}
this._instances.splice(index,1);
this.length--;
return true;
};
p._removeAll=function(){
for(var i=this.length-1;i>=0;i--){
this._instances[i].stop();
}
};
p._getSlot=function(interrupt,instance){
var target,replacement;
if(interrupt!=Sound.INTERRUPT_NONE){
replacement=this._get(0);
if(replacement==null){
return true;
}
}
for(var i=0,l=this.max;i<l;i++){
target=this._get(i);
if(target==null){
return true;
}
if(target.playState==Sound.PLAY_FINISHED||
target.playState==Sound.PLAY_INTERRUPTED||
target.playState==Sound.PLAY_FAILED){
replacement=target;
break;
}
if(interrupt==Sound.INTERRUPT_NONE){
continue;
}
if((interrupt==Sound.INTERRUPT_EARLY&&target.getPosition()<replacement.getPosition())||
(interrupt==Sound.INTERRUPT_LATE&&target.getPosition()>replacement.getPosition())){
replacement=target;
}
}
if(replacement!=null){
replacement._interrupt();
this._remove(replacement);
return true;
}
return false;
};
p.toString=function(){
return"[Sound SoundChannel]";
};
}());
this.createjs=this.createjs||{};
(function(){
"use strict";
var AbstractSoundInstance=function(src,startTime,duration,playbackResource){
this.EventDispatcher_constructor();
this.src=src;
this.uniqueId=-1;
this.playState=null;
this.delayTimeoutId=null;
this._startTime=Math.max(0,startTime||0);
this._volume=1;
if(createjs.definePropertySupported){
Object.defineProperty(this,"volume",{
get:this.getVolume,
set:this.setVolume
});
}
this._pan=0;
if(createjs.definePropertySupported){
Object.defineProperty(this,"pan",{
get:this.getPan,
set:this.setPan
});
}
this._duration=Math.max(0,duration||0);
if(createjs.definePropertySupported){
Object.defineProperty(this,"duration",{
get:this.getDuration,
set:this.setDuration
});
}
this._playbackResource=null;
if(createjs.definePropertySupported){
Object.defineProperty(this,"playbackResource",{
get:this.getPlaybackResource,
set:this.setPlaybackResource
});
}
if(playbackResource!==false&&playbackResource!==true){this.setPlaybackResource(playbackResource);}
this._position=0;
if(createjs.definePropertySupported){
Object.defineProperty(this,"position",{
get:this.getPosition,
set:this.setPosition
});
}
this._loop=0;
if(createjs.definePropertySupported){
Object.defineProperty(this,"loop",{
get:this.getLoop,
set:this.setLoop
});
}
this._muted=false;
if(createjs.definePropertySupported){
Object.defineProperty(this,"muted",{
get:this.getMuted,
set:this.setMuted
});
}
this._paused=false;
if(createjs.definePropertySupported){
Object.defineProperty(this,"paused",{
get:this.getPaused,
set:this.setPaused
});
}
};
var p=createjs.extend(AbstractSoundInstance,createjs.EventDispatcher);
p.play=function(interrupt,delay,offset,loop,volume,pan){
if(this.playState==createjs.Sound.PLAY_SUCCEEDED){
if(interrupt instanceof Object){
offset=interrupt.offset;
loop=interrupt.loop;
volume=interrupt.volume;
pan=interrupt.pan;
}
if(offset!=null){this.setPosition(offset)}
if(loop!=null){this.setLoop(loop);}
if(volume!=null){this.setVolume(volume);}
if(pan!=null){this.setPan(pan);}
if(this._paused){this.setPaused(false);}
return;
}
this._cleanUp();
createjs.Sound._playInstance(this,interrupt,delay,offset,loop,volume,pan);
return this;
};
p.pause=function(){
if(this._paused||this.playState!=createjs.Sound.PLAY_SUCCEEDED){return false;}
this.setPaused(true);
return true;
};
p.resume=function(){
if(!this._paused){return false;}
this.setPaused(false);
return true;
};
p.stop=function(){
this._position=0;
this._paused=false;
this._handleStop();
this._cleanUp();
this.playState=createjs.Sound.PLAY_FINISHED;
return this;
};
p.destroy=function(){
this._cleanUp();
this.src=null;
this.playbackResource=null;
this.removeAllEventListeners();
};
p.toString=function(){
return"[AbstractSoundInstance]";
};
p.getPaused=function(){
return this._paused;
};
p.setPaused=function(value){
if((value!==true&&value!==false)||this._paused==value){return;}
if(value==true&&this.playState!=createjs.Sound.PLAY_SUCCEEDED){return;}
this._paused=value;
if(value){
this._pause();
}else{
this._resume();
}
clearTimeout(this.delayTimeoutId);
return this;
};
p.setVolume=function(value){
if(value==this._volume){return this;}
this._volume=Math.max(0,Math.min(1,value));
if(!this._muted){
this._updateVolume();
}
return this;
};
p.getVolume=function(){
return this._volume;
};
p.setMute=function(value){
this.setMuted(value);
};
p.getMute=function(){
return this._muted;
};
p.setMuted=function(value){
if(value!==true&&value!==false){return;}
this._muted=value;
this._updateVolume();
return this;
};
p.getMuted=function(){
return this._muted;
};
p.setPan=function(value){
if(value==this._pan){return this;}
this._pan=Math.max(-1,Math.min(1,value));
this._updatePan();
return this;
};
p.getPan=function(){
return this._pan;
};
p.getPosition=function(){
if(!this._paused&&this.playState==createjs.Sound.PLAY_SUCCEEDED){
return this._calculateCurrentPosition();
}
return this._position;
};
p.setPosition=function(value){
this._position=Math.max(0,value);
if(this.playState==createjs.Sound.PLAY_SUCCEEDED){
this._updatePosition();
}
return this;
};
p.getDuration=function(){
return this._duration;
};
p.setDuration=function(value){
if(value==this._duration){return this;}
this._duration=Math.max(0,value||0);
this._updateDuration();
return this;
};
p.setPlaybackResource=function(value){
this._playbackResource=value;
if(this._duration==0){this._setDurationFromSource();}
return this;
};
p.getPlaybackResource=function(){
return this._playbackResource;
};
p.getLoop=function(){
return this._loop;
};
p.setLoop=function(value){
if(this._playbackResource!=null){
if(this._loop!=0&&value==0){
this._removeLooping(value);
}
if(this._loop==0&&value!=0){
this._addLooping(value);
}
}
this._loop=value;
};
p._sendEvent=function(type){
var event=new createjs.Event(type);
this.dispatchEvent(event);
};
p._cleanUp=function(){
clearTimeout(this.delayTimeoutId);
this._handleCleanUp();
this._paused=false;
createjs.Sound._playFinished(this);
};
p._interrupt=function(){
this._cleanUp();
this.playState=createjs.Sound.PLAY_INTERRUPTED;
this._sendEvent("interrupted");
};
p._beginPlaying=function(offset,loop,volume,pan){
this.setPosition(offset);
this.setLoop(loop);
this.setVolume(volume);
this.setPan(pan);
if(this._playbackResource!=null&&this._position<this._duration){
this._paused=false;
this._handleSoundReady();
this.playState=createjs.Sound.PLAY_SUCCEEDED;
this._sendEvent("succeeded");
return true;
}else{
this._playFailed();
return false;
}
};
p._playFailed=function(){
this._cleanUp();
this.playState=createjs.Sound.PLAY_FAILED;
this._sendEvent("failed");
};
p._handleSoundComplete=function(event){
this._position=0;
if(this._loop!=0){
this._loop--;
this._handleLoop();
this._sendEvent("loop");
return;
}
this._cleanUp();
this.playState=createjs.Sound.PLAY_FINISHED;
this._sendEvent("complete");
};
p._handleSoundReady=function(){
};
p._updateVolume=function(){
};
p._updatePan=function(){
};
p._updateDuration=function(){
};
p._setDurationFromSource=function(){
};
p._calculateCurrentPosition=function(){
};
p._updatePosition=function(){
};
p._removeLooping=function(){
};
p._addLooping=function(){
};
p._pause=function(){
};
p._resume=function(){
};
p._handleStop=function(){
};
p._handleCleanUp=function(){
};
p._handleLoop=function(){
};
createjs.AbstractSoundInstance=createjs.promote(AbstractSoundInstance,"EventDispatcher");
createjs.DefaultSoundInstance=createjs.AbstractSoundInstance;
}());
this.createjs=this.createjs||{};
(function(){
"use strict";
var AbstractPlugin=function(){
this._capabilities=null;
this._loaders={};
this._audioSources={};
this._soundInstances={};
this._loaderClass;
this._soundInstanceClass;
};
var p=AbstractPlugin.prototype;
AbstractPlugin._capabilities=null;
AbstractPlugin.isSupported=function(){
return true;
};
p.register=function(loadItem,instances){
this._audioSources[loadItem.src]=true;
this._soundInstances[loadItem.src]=[];
if(this._loaders[loadItem.src]){return this._loaders[loadItem.src];}
var loader=new this._loaderClass(loadItem);
loader.on("complete",createjs.proxy(this._handlePreloadComplete,this));
this._loaders[loadItem.src]=loader;
return loader;
};
p.preload=function(loader){
loader.on("error",createjs.proxy(this._handlePreloadError,this));
loader.load();
};
p.isPreloadStarted=function(src){
return(this._audioSources[src]!=null);
};
p.isPreloadComplete=function(src){
return(!(this._audioSources[src]==null||this._audioSources[src]==true));
};
p.removeSound=function(src){
if(!this._soundInstances[src]){return;}
for(var i=this._soundInstances[src].length;i--;){
var item=this._soundInstances[src][i];
item.destroy();
}
delete(this._soundInstances[src]);
delete(this._audioSources[src]);
if(this._loaders[src]){this._loaders[src].destroy();}
delete(this._loaders[src]);
};
p.removeAllSounds=function(){
for(var key in this._audioSources){
this.removeSound(key);
}
};
p.create=function(src,startTime,duration){
if(!this.isPreloadStarted(src)){
this.preload(this.register(src));
}
var si=new this._soundInstanceClass(src,startTime,duration,this._audioSources[src]);
this._soundInstances[src].push(si);
return si;
};
p.setVolume=function(value){
this._volume=value;
this._updateVolume();
return true;
};
p.getVolume=function(){
return this._volume;
};
p.setMute=function(value){
this._updateVolume();
return true;
};
p.toString=function(){
return"[AbstractPlugin]";
};
p._handlePreloadComplete=function(event){
var src=event.target.getItem().src;
this._audioSources[src]=event.result;
for(var i=0,l=this._soundInstances[src].length;i<l;i++){
var item=this._soundInstances[src][i];
item.setPlaybackResource(this._audioSources[src]);
}
};
p._handlePreloadError=function(event){
};
p._updateVolume=function(){
};
createjs.AbstractPlugin=AbstractPlugin;
}());
this.createjs=this.createjs||{};
(function(){
"use strict";
function Loader(loadItem){
this.AbstractLoader_constructor(loadItem,true,createjs.AbstractLoader.SOUND);
};
var p=createjs.extend(Loader,createjs.AbstractLoader);
Loader.context=null;
p.toString=function(){
return"[WebAudioLoader]";
};
p._createRequest=function(){
this._request=new createjs.XHRRequest(this._item,false);
this._request.setResponseType("arraybuffer");
};
p._sendComplete=function(event){
Loader.context.decodeAudioData(this._rawResult,
createjs.proxy(this._handleAudioDecoded,this),
createjs.proxy(this._handleError,this));
};
p._handleAudioDecoded=function(decodedAudio){
this._result=decodedAudio;
this.AbstractLoader__sendComplete();
};
createjs.WebAudioLoader=createjs.promote(Loader,"AbstractLoader");
}());
this.createjs=this.createjs||{};
(function(){
"use strict";
function WebAudioSoundInstance(src,startTime,duration,playbackResource){
this.AbstractSoundInstance_constructor(src,startTime,duration,playbackResource);
this.gainNode=s.context.createGain();
this.panNode=s.context.createPanner();
this.panNode.panningModel=s._panningModel;
this.panNode.connect(this.gainNode);
this.sourceNode=null;
this._soundCompleteTimeout=null;
this._sourceNodeNext=null;
this._playbackStartTime=0;
this._endedHandler=createjs.proxy(this._handleSoundComplete,this);
};
var p=createjs.extend(WebAudioSoundInstance,createjs.AbstractSoundInstance);
var s=WebAudioSoundInstance;
s.context=null;
s.destinationNode=null;
s._panningModel="equalpower";
p.destroy=function(){
this.AbstractSoundInstance_destroy();
this.panNode.disconnect(0);
this.panNode=null;
this.gainNode.disconnect(0);
this.gainNode=null;
};
p.toString=function(){
return"[WebAudioSoundInstance]";
};
p._updatePan=function(){
this.panNode.setPosition(this._pan,0,-0.5);
};
p._removeLooping=function(){
this._sourceNodeNext=this._cleanUpAudioNode(this._sourceNodeNext);
};
p._addLooping=function(){
if(this.playState!=createjs.Sound.PLAY_SUCCEEDED){return;}
this._sourceNodeNext=this._createAndPlayAudioNode(this._playbackStartTime,0);
};
p._setDurationFromSource=function(){
this._duration=this.playbackResource.duration*1000;
};
p._handleCleanUp=function(){
if(this.sourceNode&&this.playState==createjs.Sound.PLAY_SUCCEEDED){
this.sourceNode=this._cleanUpAudioNode(this.sourceNode);
this._sourceNodeNext=this._cleanUpAudioNode(this._sourceNodeNext);
}
if(this.gainNode.numberOfOutputs!=0){this.gainNode.disconnect(0);}
clearTimeout(this._soundCompleteTimeout);
this._playbackStartTime=0;
};
p._cleanUpAudioNode=function(audioNode){
if(audioNode){
audioNode.stop(0);
audioNode.disconnect(0);
audioNode=null;
}
return audioNode;
};
p._handleSoundReady=function(event){
this.gainNode.connect(s.destinationNode);
var dur=this._duration*0.001;
var pos=this._position*0.001;
this.sourceNode=this._createAndPlayAudioNode((s.context.currentTime-dur),pos);
this._playbackStartTime=this.sourceNode.startTime-pos;
this._soundCompleteTimeout=setTimeout(this._endedHandler,(dur-pos)*1000);
if(this._loop!=0){
this._sourceNodeNext=this._createAndPlayAudioNode(this._playbackStartTime,0);
}
};
p._createAndPlayAudioNode=function(startTime,offset){
var audioNode=s.context.createBufferSource();
audioNode.buffer=this.playbackResource;
audioNode.connect(this.panNode);
var dur=this._duration*0.001;
audioNode.startTime=startTime+dur;
audioNode.start(audioNode.startTime,offset+(this._startTime*0.001),dur-offset);
return audioNode;
};
p._pause=function(){
this._position=(s.context.currentTime-this._playbackStartTime)*1000;
this.sourceNode=this._cleanUpAudioNode(this.sourceNode);
this._sourceNodeNext=this._cleanUpAudioNode(this._sourceNodeNext);
if(this.gainNode.numberOfOutputs!=0){this.gainNode.disconnect(0);}
clearTimeout(this._soundCompleteTimeout);
};
p._resume=function(){
this._handleSoundReady();
};
p._updateVolume=function(){
var newVolume=this._muted?0:this._volume;
if(newVolume!=this.gainNode.gain.value){
this.gainNode.gain.value=newVolume;
}
};
p._calculateCurrentPosition=function(){
return((s.context.currentTime-this._playbackStartTime)*1000);
};
p._updatePosition=function(){
this.sourceNode=this._cleanUpAudioNode(this.sourceNode);
this._sourceNodeNext=this._cleanUpAudioNode(this._sourceNodeNext);
clearTimeout(this._soundCompleteTimeout);
if(!this._paused){this._handleSoundReady();}
};
p._handleLoop=function(){
this._cleanUpAudioNode(this.sourceNode);
this.sourceNode=this._sourceNodeNext;
this._playbackStartTime=this.sourceNode.startTime;
this._sourceNodeNext=this._createAndPlayAudioNode(this._playbackStartTime,0);
this._soundCompleteTimeout=setTimeout(this._endedHandler,this._duration);
};
p._updateDuration=function(){
this._pause();
this._resume();
};
createjs.WebAudioSoundInstance=createjs.promote(WebAudioSoundInstance,"AbstractSoundInstance");
}());
this.createjs=this.createjs||{};
(function(){
"use strict";
function WebAudioPlugin(){
this.AbstractPlugin_constructor();
this._panningModel=s._panningModel;;
this._volume=1;
this.context=s.context;
this.dynamicsCompressorNode=this.context.createDynamicsCompressor();
this.dynamicsCompressorNode.connect(this.context.destination);
this.gainNode=this.context.createGain();
this.gainNode.connect(this.dynamicsCompressorNode);
createjs.WebAudioSoundInstance.destinationNode=this.gainNode;
this._capabilities=s._capabilities;
this._loaderClass=createjs.WebAudioLoader;
this._soundInstanceClass=createjs.WebAudioSoundInstance;
this._addPropsToClasses();
}
var p=createjs.extend(WebAudioPlugin,createjs.AbstractPlugin);
var s=WebAudioPlugin;
s._capabilities=null;
s._panningModel="equalpower";
s.context=null;
s.isSupported=function(){
var isMobilePhoneGap=createjs.BrowserDetect.isIOS||createjs.BrowserDetect.isAndroid||createjs.BrowserDetect.isBlackberry;
if(location.protocol=="file:"&&!isMobilePhoneGap&&!this._isFileXHRSupported()){return false;}
s._generateCapabilities();
if(s.context==null){return false;}
return true;
};
s.playEmptySound=function(){
var source=s.context.createBufferSource();
source.buffer=s.context.createBuffer(1,1,22050);
source.connect(s.context.destination);
source.start(0,0,0);
};
s._isFileXHRSupported=function(){
var supported=true;
var xhr=new XMLHttpRequest();
try{
xhr.open("GET","WebAudioPluginTest.fail",false);
}catch(error){
supported=false;
return supported;
}
xhr.onerror=function(){supported=false;};
xhr.onload=function(){supported=this.status==404||(this.status==200||(this.status==0&&this.response!=""));};
try{
xhr.send();
}catch(error){
supported=false;
}
return supported;
};
s._generateCapabilities=function(){
if(s._capabilities!=null){return;}
var t=document.createElement("audio");
if(t.canPlayType==null){return null;}
if(s.context==null){
if(window.AudioContext){
s.context=new AudioContext();
}else if(window.webkitAudioContext){
s.context=new webkitAudioContext();
}else{
return null;
}
}
s._compatibilitySetUp();
s.playEmptySound();
s._capabilities={
panning:true,
volume:true,
tracks:-1
};
var supportedExtensions=createjs.Sound.SUPPORTED_EXTENSIONS;
var extensionMap=createjs.Sound.EXTENSION_MAP;
for(var i=0,l=supportedExtensions.length;i<l;i++){
var ext=supportedExtensions[i];
var playType=extensionMap[ext]||ext;
s._capabilities[ext]=(t.canPlayType("audio/"+ext)!="no"&&t.canPlayType("audio/"+ext)!="")||(t.canPlayType("audio/"+playType)!="no"&&t.canPlayType("audio/"+playType)!="");
}
if(s.context.destination.numberOfChannels<2){
s._capabilities.panning=false;
}
};
s._compatibilitySetUp=function(){
s._panningModel="equalpower";
if(s.context.createGain){return;}
s.context.createGain=s.context.createGainNode;
var audioNode=s.context.createBufferSource();
audioNode.__proto__.start=audioNode.__proto__.noteGrainOn;
audioNode.__proto__.stop=audioNode.__proto__.noteOff;
s._panningModel=0;
};
p.toString=function(){
return"[WebAudioPlugin]";
};
p._addPropsToClasses=function(){
var c=this._soundInstanceClass;
c.context=this.context;
c.destinationNode=this.gainNode;
c._panningModel=this._panningModel;
this._loaderClass.context=this.context;
};
p._updateVolume=function(){
var newVolume=createjs.Sound._masterMute?0:this._volume;
if(newVolume!=this.gainNode.gain.value){
this.gainNode.gain.value=newVolume;
}
};
createjs.WebAudioPlugin=createjs.promote(WebAudioPlugin,"AbstractPlugin");
}());
this.createjs=this.createjs||{};
(function(){
"use strict";
function TagPool(src){
this.src=src;
this.length=0;
this.available=0;
this.tags=[];
this.duration=0;
};
var p=TagPool.prototype;
p.constructor=TagPool;
var s=TagPool;
s.tags={};
s.get=function(src){
var channel=s.tags[src];
if(channel==null){
channel=s.tags[src]=new TagPool(src);
}
return channel;
};
s.remove=function(src){
var channel=s.tags[src];
if(channel==null){return false;}
channel.removeAll();
delete(s.tags[src]);
return true;
};
s.getInstance=function(src){
var channel=s.tags[src];
if(channel==null){return null;}
return channel.get();
};
s.setInstance=function(src,tag){
var channel=s.tags[src];
if(channel==null){return null;}
return channel.set(tag);
};
s.getDuration=function(src){
var channel=s.tags[src];
if(channel==null){return 0;}
return channel.getDuration();
};
p.add=function(tag){
this.tags.push(tag);
this.length++;
this.available++;
};
p.removeAll=function(){
var tag;
while(this.length--){
tag=this.tags[this.length];
if(tag.parentNode){
tag.parentNode.removeChild(tag);
}
delete(this.tags[this.length]);
}
this.src=null;
this.tags.length=0;
};
p.get=function(){
if(this.tags.length==0){return null;}
this.available=this.tags.length;
var tag=this.tags.pop();
if(tag.parentNode==null){document.body.appendChild(tag);}
return tag;
};
p.set=function(tag){
var index=createjs.indexOf(this.tags,tag);
if(index==-1){this.tags.push(tag);}
this.available=this.tags.length;
};
p.getDuration=function(){
if(!this.duration){this.duration=this.tags[this.tags.length-1].duration*1000;}
return this.duration;
};
p.toString=function(){
return"[HTMLAudioTagPool]";
};
createjs.HTMLAudioTagPool=TagPool;
}());
this.createjs=this.createjs||{};
(function(){
"use strict";
function HTMLAudioSoundInstance(src,startTime,duration,playbackResource){
this.AbstractSoundInstance_constructor(src,startTime,duration,playbackResource);
this._audioSpriteStopTime=null;
this._delayTimeoutId=null;
this._endedHandler=createjs.proxy(this._handleSoundComplete,this);
this._readyHandler=createjs.proxy(this._handleTagReady,this);
this._stalledHandler=createjs.proxy(this.playFailed,this);
this._audioSpriteEndHandler=createjs.proxy(this._handleAudioSpriteLoop,this);
this._loopHandler=createjs.proxy(this._handleSoundComplete,this);
if(duration){
this._audioSpriteStopTime=(startTime+duration)*0.001;
}else{
this._duration=createjs.HTMLAudioTagPool.getDuration(this.src);
}
}
var p=createjs.extend(HTMLAudioSoundInstance,createjs.AbstractSoundInstance);
p.setMasterVolume=function(value){
this._updateVolume();
};
p.setMasterMute=function(isMuted){
this._updateVolume();
};
p.toString=function(){
return"[HTMLAudioSoundInstance]";
};
p._removeLooping=function(){
if(this._playbackResource==null){return;}
this._playbackResource.loop=false;
this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,false);
};
p._addLooping=function(){
if(this._playbackResource==null||this._audioSpriteStopTime){return;}
this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,false);
this._playbackResource.loop=true;
};
p._handleCleanUp=function(){
var tag=this._playbackResource;
if(tag!=null){
tag.pause();
tag.loop=false;
tag.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_ENDED,this._endedHandler,false);
tag.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_READY,this._readyHandler,false);
tag.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_STALLED,this._stalledHandler,false);
tag.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,false);
tag.removeEventListener(createjs.HTMLAudioPlugin._TIME_UPDATE,this._audioSpriteEndHandler,false);
try{
tag.currentTime=this._startTime;
}catch(e){
}
createjs.HTMLAudioTagPool.setInstance(this.src,tag);
this._playbackResource=null;
}
};
p._beginPlaying=function(offset,loop,volume,pan){
this._playbackResource=createjs.HTMLAudioTagPool.getInstance(this.src);
return this.AbstractSoundInstance__beginPlaying(offset,loop,volume,pan);
};
p._handleSoundReady=function(event){
if(this._playbackResource.readyState!==4){
var tag=this._playbackResource;
tag.addEventListener(createjs.HTMLAudioPlugin._AUDIO_READY,this._readyHandler,false);
tag.addEventListener(createjs.HTMLAudioPlugin._AUDIO_STALLED,this._stalledHandler,false);
tag.preload="auto";
tag.load();
return;
}
this._updateVolume();
this._playbackResource.currentTime=(this._startTime+this._position)*0.001;
if(this._audioSpriteStopTime){
this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._TIME_UPDATE,this._audioSpriteEndHandler,false);
}else{
this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._AUDIO_ENDED,this._endedHandler,false);
if(this._loop!=0){
this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,false);
this._playbackResource.loop=true;
}
}
this._playbackResource.play();
};
p._handleTagReady=function(event){
this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_READY,this._readyHandler,false);
this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_STALLED,this._stalledHandler,false);
this._handleSoundReady();
};
p._pause=function(){
this._playbackResource.pause();
};
p._resume=function(){
this._playbackResource.play();
};
p._updateVolume=function(){
if(this._playbackResource!=null){
var newVolume=(this._muted||createjs.Sound._masterMute)?0:this._volume*createjs.Sound._masterVolume;
if(newVolume!=this._playbackResource.volume){this._playbackResource.volume=newVolume;}
}
};
p._calculateCurrentPosition=function(){
return(this._playbackResource.currentTime*1000)-this._startTime;
};
p._updatePosition=function(){
this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,false);
this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._handleSetPositionSeek,false);
try{
this._playbackResource.currentTime=(this._position+this._startTime)*0.001;
}catch(error){
this._handleSetPositionSeek(null);
}
};
p._handleSetPositionSeek=function(event){
if(this._playbackResource==null){return;}
this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._handleSetPositionSeek,false);
this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,false);
};
p._handleAudioSpriteLoop=function(event){
if(this._playbackResource.currentTime<=this._audioSpriteStopTime){return;}
this._playbackResource.pause();
if(this._loop==0){
this._handleSoundComplete(null);
}else{
this._position=0;
this._loop--;
this._playbackResource.currentTime=this._startTime*0.001;
if(!this._paused){this._playbackResource.play();}
this._sendEvent("loop");
}
};
p._handleLoop=function(event){
if(this._loop==0){
this._playbackResource.loop=false;
this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,false);
}
};
p._updateDuration=function(){
this._audioSpriteStopTime=(startTime+duration)*0.001;
if(this.playState==createjs.Sound.PLAY_SUCCEEDED){
this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_ENDED,this._endedHandler,false);
this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._TIME_UPDATE,this._audioSpriteEndHandler,false);
}
};
createjs.HTMLAudioSoundInstance=createjs.promote(HTMLAudioSoundInstance,"AbstractSoundInstance");
}());
this.createjs=this.createjs||{};
(function(){
"use strict";
function HTMLAudioPlugin(){
this.AbstractPlugin_constructor();
this.defaultNumChannels=2;
this._capabilities=s._capabilities;
this._loaderClass=createjs.SoundLoader;
this._soundInstanceClass=createjs.HTMLAudioSoundInstance;
}
var p=createjs.extend(HTMLAudioPlugin,createjs.AbstractPlugin);
var s=HTMLAudioPlugin;
s.MAX_INSTANCES=30;
s._AUDIO_READY="canplaythrough";
s._AUDIO_ENDED="ended";
s._AUDIO_SEEKED="seeked";
s._AUDIO_STALLED="stalled";
s._TIME_UPDATE="timeupdate";
s._capabilities=null;
s.enableIOS=false;
s.isSupported=function(){
s._generateCapabilities();
if(s._capabilities==null){return false;}
return true;
};
s._generateCapabilities=function(){
if(s._capabilities!=null){return;}
var t=document.createElement("audio");
if(t.canPlayType==null){return null;}
s._capabilities={
panning:true,
volume:true,
tracks:-1
};
var supportedExtensions=createjs.Sound.SUPPORTED_EXTENSIONS;
var extensionMap=createjs.Sound.EXTENSION_MAP;
for(var i=0,l=supportedExtensions.length;i<l;i++){
var ext=supportedExtensions[i];
var playType=extensionMap[ext]||ext;
s._capabilities[ext]=(t.canPlayType("audio/"+ext)!="no"&&t.canPlayType("audio/"+ext)!="")||(t.canPlayType("audio/"+playType)!="no"&&t.canPlayType("audio/"+playType)!="");
}
};
p.register=function(loadItem,instances){
var channel=createjs.HTMLAudioTagPool.get(loadItem.src);
var tag=null;
for(var i=0;i<instances;i++){
tag=this._createTag(loadItem.src);
channel.add(tag);
}
var loader=this.AbstractPlugin_register(loadItem,instances);
loader.setTag(tag);
return loader;
};
p.removeSound=function(src){
this.AbstractPlugin_removeSound(src);
createjs.HTMLAudioTagPool.remove(src);
};
p.create=function(src,startTime,duration){
var si=this.AbstractPlugin_create(src,startTime,duration);
si.setPlaybackResource(null);
return si;
};
p.toString=function(){
return"[HTMLAudioPlugin]";
};
p.setVolume=p.getVolume=p.setMute=null;
p._createTag=function(src){
var tag=document.createElement("audio");
tag.autoplay=false;
tag.preload="none";
tag.src=src;
return tag;
};
createjs.HTMLAudioPlugin=createjs.promote(HTMLAudioPlugin,"AbstractPlugin");
}());
GodStep.FPS=function(soul,color,alpha){
GodStep.Frame.call(this,'FPS',soul.W,soul.H);
this.addChild(this.text=new GodStep.Text('0',55*this.startS,'Arial','left',color||0x000000));
this.startTime=Date.now();
this.addString((soul.CANVAS)?'C':'W');
this.alpha=alpha;
this.soul=soul;
this.prevTime=this.startTime;
this.msMin=Infinity;
this.msMax=0;
this.fpsMin=Infinity;
this.fpsMax=0;
this.frames=0;
this.lastValue=0;
if(alpha==0)visible=false;
};
extend(GodStep.FPS,GodStep.Frame);
pro.addString=function(v){
this.plusString=v;
};
pro.end=function(){
var time=Date.now();
var ms=time-this.startTime;
this.msMin=Math.min(this.msMin,ms);
this.msMax=Math.max(this.msMax,ms);
if(time>this.prevTime+100){
var fps=Math.round((this.frames*1000)/(time-this.prevTime));
this.lastValue+=(fps-this.lastValue)*.3;
this.fpsMin=Math.min(this.fpsMin,this.lastValue);
this.fpsMax=Math.max(this.fpsMax,this.lastValue);
this.text.setText(Math.round(this.lastValue)+" "+this.plusString);
this.prevTime=time;
this.frames=0;
}
this.frames++;
};
pro.begin=function(){
this.startTime=Date.now();
};
Object.defineProperty(pro,'Scale',{
get:function(){
return this.scale.x;
},
set:function(value){
this.scale.x=this.scale.y=1;
this.text.updateText();
this.y=this.soul.H-this.text.height+(this.soul.OH-this.soul.H)+this.soul.H*.015*this.soul.startS;
this.x=this.soul.W*.02*this.soul.startS;
}
});
GodStep.Text=function(t,size,font,align,color){
this.font=font||'Arial';
this.size=size||15;
this.align=(align||"center");
PIXI.Text.call(this,t,{font:this.size+"px "+this.font,align:this.align,fill:(color)?('#'+color.toString(16)):'#000000'});
};
extend(GodStep.Text,PIXI.Text);
pro.place=function(x,y){
this.x=x;
this.y=y;
};
pro.centerX=function(w,y){
this.y=y;
this.x=w/2-this.width/2;
};
pro.setColor=function(color){
this.style.fill='#'+color.toString(16);
};
pro.setFont=function(font){
this.font=font;
this.style.font=this.size+'px '+this.font;
this.updateText();
};
pro.setSize=function(size){
this.size=size;
this.style.font=this.size+'px '+this.font;
this.updateText();
};
GodStep.LocalStorage=function(){
GodStep.LocalStorage.instance=this;
try{
if('localStorage'in window&&window['localStorage']!==null){
this.storage=window['localStorage'];
window.addEventListener("storage",this.h_storage,false);
this.isAvailable=true;
}
}catch(e){
this.isAvailable=false;
}
};
extend(GodStep.LocalStorage,Object);
pro.getData=function(slot){
if(!this.isAvailable){
return null;
}
var data=this.storage.getItem(slot||"data");
if(data!=null)return JSON.parse(data);
else{
trace('no data');
return null;
}
};
pro.setData=function(data,slot){
if(!this.isAvailable)return;
var d=JSON.stringify(data);
trace('local storage ['+(slot||'data')+']');
trace(d);
try{
this.storage.setItem(slot||"data",d);
}catch(e){
trace('LOCAL STORAGE ERROR');
}
};
GodStep.Clear=function(slot){
GodStep.LocalStorage.instance.setData(null,slot);
};
GodStep.SaveLocal=function(data,slot){
GodStep.LocalStorage.instance.setData(data,slot);
};
GodStep.LoadText=function(text){
return JSON.parse(text);
};
GodStep.LoadLocal=function(slot){
return GodStep.LocalStorage.instance.getData(slot);
};
pro.h_storage=function(e){
trace('storage'+e);
};
Games.Cell=function(xi,yi,w,h){
this.xi=xi;
this.yi=yi;
this.guests=[];
GodStep.Frame.call(this,'Cell['+xi+", "+yi+']',w,h);
GodStep.IDownUp.call(this,w,h);
addEvent(this,GodStep.FRAME_UP,this.h_mouse);
addEvent(this,GodStep.FRAME_DOWN,this.h_mouse);
};
Games.CELL_UP='cellup';
Games.CELL_DOWN='celldown';
Games.CELL_CLICK='cellclick';
extend(Games.Cell,GodStep.Frame);
pro.h_mouse=function(e){
var t=e.target;
switch(e.type){
case GodStep.FRAME_UP:
dispatch(t,Games.CELL_UP);
break;
case GodStep.FRAME_DOWN:
dispatch(t,Games.CELL_DOWN);
break;
}
};
Games.CellField=function(xc,yc,w,h,cellClass,startS){
GodStep.Frame.call(this,'CellField',w,h);
GodStep.IDownUp.call(this,w,h);
this.startS=startS;
this.cellCountX=xc;
this.cellCountY=yc;
this.cellClass=cellClass;
this.addChild(this.cellContainer=new PIXI.DisplayObjectContainer());
this.addChild(this.objectContainer=new PIXI.DisplayObjectContainer());
this.initField();
};extend(Games.CellField,GodStep.Frame);
pro.initField=function(countX,countY,cW,cH){
var row;
this.cells=[];
this.cellsXY=[];
var cellW=this.cellW=cW||this.W/this.cellCountX;
var cellH=this.cellH=cH||this.H/this.cellCountY;
this.cellCountX=countX||this.cellCountX;
this.cellCountY=countY||this.cellCountY;
var maxW=0,maxH=0;
for(var i=0;i<this.cellCountY;i++){
this.cellsXY.push(row=[]);
for(var j=0;j<this.cellCountX;j++){
if(this.cellClass){
var cell=new this.cellClass(j,i,cellW,cellH,this.startS);
this.addCell(cell,cellW,cellH);
maxW=Math.max(cell.x,maxW);
maxH=Math.max(cell.y,maxH);
addEvent(cell,Games.CELL_UP,this.h_cells);
addEvent(cell,Games.CELL_DOWN,this.h_cells);
}
}
}
};
pro.addCell=function(cell,cellW,cellH){
this.cells.push(cell);this.cellsXY[cell.yi][cell.xi]=cell;
this.addFrame(cell,this.cellContainer);
cell.x=cell.xi*cellW;
cell.y=cell.yi*cellH;
};
pro.getCell=function(xi,yi){
return this.cells[xi+yi*this.cellCountX];
};
pro.h_cells=function(e){
var t=e.target;
var p=t.parent.parent;
switch(e.type){
case Games.CELL_DOWN:
dispatch(p,Games.CELL_DOWN,t);
break;
case Games.CELL_UP:
dispatch(p,Games.CELL_UP,t);
break;
}
};
Games.Transmission=function(soul,speed,color){
this.soul=soul;
this.color=color||GodStep.COLOR_STAGE;
GodStep.Frame.call(this,'Transmission',soul.SW,soul.SH);
this.startS=this.soul.startS;
this.create();
this.timerCache=-1;
this.speed=speed||0.1;
this.cacheAsBitmap=true;
this.visible=false;
this.graphics.scale.y=this.graphics.oS=this.soul.SH/this.graphics.height*soul.assets.Scale;
};
extend(Games.Transmission,GodStep.Frame);
pro.create=function(){
this.createGraphics();
this.rect(this.W,this.H,this.color,1,0,0);
};
pro.start=function(screenArr,outScreen){
if(!this.isStarted){
this.screens=screenArr;
this.outScreen=outScreen;
this.isStarted=true;
this.isGoesUp=true;
this.alpha=0;
this.visible=true;
}
};
pro.update=function(){
if(this.timerCache--==0){
this.timerCache=-1;
var vis=this.visible;
var a=this.alpha;
this.cacheAsBitmap=false;
this.visible=true;
this.alpha=1;
this.cacheAsBitmap=true;
this.visible=vis;
this.alpha=a;
}
if(this.isStarted){
if(this.isGoesUp){
this.alpha+=this.speed;
if(this.alpha>1){
this.alpha=1;
this.isGoesUp=false;
if(this.outScreen.isOnlyOneView){
this.outScreen.destrukt();
}
this.outScreen.visible=false;
for(var s in this.screens){
this.screens[s].init();
}
}
}else{
this.alpha-=this.speed;
if(this.alpha<=0){
this.alpha=0;
this.visible=false;
this.isStarted=false;
}
}
}
};
pro.reskin=function(c){
this.cacheAsBitmap=false;
var vis=this.visible;
this.visible=true;
var a=this.alpha;
this.alpha=1;
this.graphics.clear();
this.rect(this.W,this.H,c,1,0,0);
this.cacheAsBitmap=true;
this.visible=vis;
this.alpha=a;
};
Object.defineProperty(pro,'Scale',{
get:function(){
return this.scale.x;
},
set:function(value){
this.scale.x=this.scale.y=value;
this.cacheAsBitmap=false;
this.timerCache=25;
this.graphics.y=(this.FULLRESIZE)?0:-(this.soul.OH-this.soul.H)*.5/value;
this.graphics.scale.y=this.graphics.oS*this.soul.OH/this.soul.H;
this.graphics.scale.x=this.graphics.oS*(this.soul.FULLRESIZE?(this.soul.OW/this.soul.W):1);
}
});
PS.Cell=function(xi,yi,w,h,s){
Games.Cell.call(this,xi,yi,w,h);
this.xi=xi;
this.yi=yi;
this.guests=[];
this.addChild(this.img=new PS.Img('squares_game',s*PS.CELL_SCALE,this.W*.5,this.H*.5,.5));
};
extend(PS.Cell,Games.Cell);
pro.pushGuest=function(o){
this.guests.push(o);
};
pro.delGuest=function(o){
this.guests.splice(this.guests.indexOf(o),1);
};
pro.setAsGuest=function(o){
if(o.name=='player'){
this.guests.push(o);
}else{
this.guests.splice(0,0,o);
}
o.cell.guests.splice(o.cell.guests.indexOf(o),1);
o.cell=this;
};
PS.CellObject=function(name,S,alias,cell,rotate,isShadow){
var type=(name=='playerB'||name=='playerR')?'player':name;
GodStep.Frame.call(this,type);
this.typeName=name;
this.startS=S*PS.CELL_SCALE;
trace(name+" "+alias);
var aid=alias+1;
this.nextRotation=this.rotateAngle=rotate||0;
var cID,pers;
if(name=='player'||name=='playerB'||name=='playerR'){
cID=parseInt(Math.random()*PS.CellObject.PERS.length);
pers=PS.CellObject.PERS[cID];PS.CellObject.PERS.splice(cID,1);
}
switch(name){
case'star':
this.addFrame(this.img=new PS.Img('key_'+aid,this.startS,cell.W/2,cell.H/2,.5));
break;
case'player':
this.addFrame(this.img=new PS.Img('box_'+aid,this.startS,cell.W/2,cell.H/2,.5));
this.addFrame(this.character=new PS.Img(pers,this.startS,cell.W/2,cell.H/2,.5));
this.addFrame(this.doors=new PS.MovieClip(aid,this.startS,cell.W/2,cell.H/2,.5));
this.addFrame(this.icon=new PS.Img('arrow'+aid+"_"+(this.rotateAngle+1),this.startS,cell.W/2,cell.H/2,.5));
this.addFrame(this.keyhole=new PS.Img('keyhole_'+aid,this.startS,cell.W/2,cell.H/2,.5));
break;
case'playerR':
this.addFrame(this.img=new PS.Img('box_'+aid,this.startS,cell.W/2,cell.H/2,.5));
this.addFrame(this.character=new PS.Img(pers,this.startS,cell.W/2,cell.H/2,.5));
this.addFrame(this.doors=new PS.MovieClip(aid,this.startS,cell.W/2,cell.H/2,.5));
this.addFrame(this.icon=new PS.Img('reaktiw_'+(this.rotateAngle+1),this.startS,cell.W/2,cell.H/2,.5));
this.addFrame(this.keyhole=new PS.Img('keyhole_'+aid,this.startS,cell.W/2,cell.H/2,.5));
break;
case'playerB':
this.addFrame(this.img=new PS.Img('box_'+aid,this.startS,cell.W/2,cell.H/2,.5));
this.addFrame(this.character=new PS.Img(pers,this.startS,cell.W/2,cell.H/2,.5));
this.addFrame(this.doors=new PS.MovieClip(aid,this.startS,cell.W/2,cell.H/2,.5));
this.addFrame(this.keyhole=new PS.Img('keyhole_'+aid,this.startS,cell.W/2,cell.H/2,.5));
break;
case'arrow':
this.addFrame(this.img=new PS.Img('turn1_'+(this.rotateAngle+1),this.startS,cell.W/2,cell.H/2,.5));
break;
case'teleport':
this.addFrame(this.img=new PS.Img('teleport',this.startS,cell.W/2,cell.H/2,.5));
break;
}
trace('char '+cID);
this.animatePhase2=0;
this.animatePhase1=0;
this.animatePhase3=0;
this.alias=alias;
this.cell=cell;
this.countTeleportations=0;
if(this.keyhole){
this.doors.visible=this.character.visible=this.keyhole.visible=false;
}
if(isShadow==null){
cell.guests.push(this);
}
this.applyCellPostion(true);
};
extend(PS.CellObject,GodStep.Frame);
PS.CellObject.COLORS=[0x0000ff,0xff0000,0x00ff00,0xffff88,0xff00ff];
pro.animate2=function(){
if(this.isFinished){
this.animatePhase3++;
if(this.animatePhase3<50){
this.keyhole.visible=true;
if(this.icon)this.icon.visible=false;
}else{
this.keyhole.visible=false;
if(this.icon)this.icon.visible=true;
}
if(this.animatePhase3>100){
this.animatePhase3=0;
}
}
};
pro.animate=function(){
if(this.icon)this.icon.visible=false;
this.keyhole.alpha=Math.max(0,1-this.animatePhase1/45);
if(this.animatePhase1++>45){
if(!this.startPos){
this.startPos=new PIXI.Point(this.x,this.y);
}
this.scale.x=this.scale.y+=(1.15-this.scale.x)*.05;
this.x=this.startPos.x-this.doors.width*.5*(this.scale.x-1);
this.y=this.startPos.y-this.doors.width*.5*(this.scale.x-1);
if(this.animatePhase2==5){
this.animatePhase2=0;
if(this.doors.currentFrame<this.doors.frames.length-1){
this.doors.nextFrame();
this.doors.visible=true;
}else{
this.doors.visible=false;
}
}
if(this.doors.currentFrame<this.doors.frames.length){
this.animatePhase2++;
}
}
};
pro.applyRotation=function(){
switch(this.typeName){
case'player':
this.icon.setTexture('arrow'+(this.alias+1)+"_"+(this.nextRotation+1));
break;
case'playerR':
this.icon.setTexture('reaktiw_'+(this.nextRotation+1));
break;
case'arrow':
this.img.setTexture('turn1_'+(this.nextRotation+1));
break;
}
};
pro.setAsFinished=function(isOk){
this.isFinished=isOk;
if(this.keyhole){
this.doors.visible=this.character.visible=this.keyhole.visible=isOk;
}
if(this.icon){
this.icon.visible=!isOk;
}
};
pro.applyCellPostion=function(now){
this.nextPlace=new PIXI.Point(this.cell.x,this.cell.y);
if(now){
this.Place=this.nextPlace;
}
if(this.tpCell){
this.Place=new PIXI.Point(this.tpCell.x,this.tpCell.y);
}
this.rotateAngle=this.nextRotation;
trace(this.rotateAngle);
};
pro.destroy=function(){
if(this.character){
this.removeChild(this.character);
}
if(this.keyhole){
this.removeChild(this.keyhole);
}
if(this.icon){
this.removeChild(this.icon);
}
this.cell.guests.splice(this.cell.guests.indexOf(this),1);
this.removeChild(this.img);
return this;
};
PS.Field=function(soul,xc,yc){
Games.CellField.call(this,xc,yc,soul.W*.95,soul.W*.95,PS.Cell,soul.startS);
this.cellObjects=[];
this.soul=soul;
this.players=[];
this.shadows=[];
this.teleports=[];
this.stars=[];
this.arrows=[];
};extend(PS.Field,Games.CellField);
pro.rotateCellObject=function(cell){
var o;
for(var i=0;i<this.cellObjects.length;i++){
o=this.cellObjects[i];
if(o.cell.name==cell.name){
if(o.name=='player'||o.name=='arrow'){
o.rotateAngle++;
if(o.rotateAngle>3)o.rotateAngle=0;
o.applyRotation();
}
}
}
};
pro.clear=function(){
while(this.shadows.length){
this.objectContainer.removeChild(this.shadows[0].destroy());
this.shadows.splice(0,1);
}
this.players=[];
this.teleports=[];
this.stars=[];
this.arrows=[];
while(this.cellObjects.length){
this.delFrame(this.cellObjects[0].destroy());
this.cellObjects.splice(0,1);
}
trace('objects'+this.cellObjects.length);
};
pro.setData=function(d){
this.clear();
if(d){
var S=this.soul.startS;
for(var i=0;i<d.length;i++){
var o=d[i];
if(o.id){
}else{
this.addCellObject(new PS.CellObject(o.name,this.soul.startS,o.alias,this.cells[o.xi+o.yi*this.cellCountY],o.rotate));
}
}
}
};
pro.getData=function(){
var objects=[];
for(var i=0;i<this.cellObjects.length;i++){
var o=this.cellObjects[i];
var od={name:o.typeName,xi:o.cell.xi,yi:o.cell.yi,rotate:o.rotateAngle,alias:o.alias};
objects.push(od);
}
return objects;
};
pro.initTutor=function(ok){
for(var i=0;i<5;i++){
for(var j=0;j<5;j++){
if(i>0&&i<4&&j==2){
}else{
this.cellsXY[i][j].visible=!ok;
}
}
}
};
pro.delCellObject=function(cell){
var o;
for(var i=0;i<this.cellObjects.length;i++){
o=this.cellObjects[i];
if(o.cell.name==cell.name){
if(o.name=='teleport'){
this.teleports.splice(this.teleports.indexOf(o),1);
}
this.cellObjects.splice(this.cellObjects.indexOf(o),1);
this.delFrame(o);
i--;
}
}
};
pro.addCellObject=function(ob){
var o;
var isFound;
switch(ob.name){
case'player':
case'playerR':
case'playerB':
this.players.push(ob);
break;
case'arrow':
this.arrows.push(ob);
break;
case'teleport':
this.teleports.push(ob);
break;
case'star':
this.stars.push(ob);
break;
}
for(var i=0;i<this.cellObjects.length;i++){
o=this.cellObjects[i];
if(o.cell.name==ob.cell.name){
isFound=true;
}
}
if(!isFound){
if(ob.name=='player'||ob.name=='playerR'||ob.name=='playerB'){
this.cellObjects.push(ob);
}else{
this.cellObjects.splice(0,0,ob);
}
if(ob.name=='teleport'){
this.addFrameAt(ob,this.objectContainer,0);
}else{
if(ob.name=='arrow'||ob.name=='star'){
this.addFrameAt(ob,this.objectContainer,0);
}else{
this.addFrameAt(ob,this.objectContainer,this.objectContainer.children.length);
}
}
}
};
pro.delShadow=function(player){
var shadow=player.shadow;
this.objectContainer.removeChild(shadow);
this.shadows.splice(this.shadows.indexOf(shadow),1);
player.shadow=null;
};
pro.addShadow=function(player,teleport){
var shadow=new PS.CellObject(player.typeName,this.soul.startS,player.alias,player.lastCell,player.rotateAngle,true);
player.shadow=shadow;
player.countTeleportations++;
shadow.teleport=teleport;
this.objectContainer.addChildAt(shadow,this.objectContainer.children.length-this.teleports.length-1);
this.shadows.push(shadow);
};
pro.h_cells=function(e){
var t=e.target;
var p=t.parent.parent;
switch(e.type){
case Games.CELL_DOWN:
dispatch(p,Games.CELL_CLICK,t);
break;
}
};
PS.Preloader=function(soul){
GodStep.Preloader.call(this,soul);
this.fontLoaderClass=PS.FontLoader;
};
extend(PS.Preloader,GodStep.Preloader);
pro.load=function(){
this.addChild(this.back=GodStep.Image.fromImage(PS.IMAGE_PATH+'back_fundemic1.jpg',this.h_preload));
this.addChild(this.logo=GodStep.Image.fromImage(PS.IMAGE_PATH+'fundemic_logo.png',this.h_preload));
this.addChild(this.loading=GodStep.Image.fromImage(PS.IMAGE_PATH+'loading.png',this.h_preload));
this.maxCountLoaded=3;
if(PS.SOFT_GAMES){
this.maxCountLoaded++;
this.addChild(this.logo_soft=GodStep.Image.fromImage(PS.IMAGE_PATH+'logo_soft.png',this.h_preload));
}
var countLoaded=0;
if(this.back.texture.baseTexture.hasLoaded){
this.back.Scale=this.startS;
this.back.anchor=new PIXI.Point(0.5,0.5);
this.back.place(this.W/2,this.H*.58);
this.back.scale.y=this.soul.OH/this.soul.H*this.startS;
countLoaded++;
}
if(this.logo.texture.baseTexture.hasLoaded){
this.logo.Scale=this.startS;
this.logo.anchor=new PIXI.Point(0.5,0.5);
this.logo.place(this.W/2,this.H*.3);
countLoaded++;
}
if(this.loading.texture.baseTexture.hasLoaded){
this.loading.Scale=this.startS;
this.loading.anchor=new PIXI.Point(0.5,0.5);
this.loading.place(this.W/2,this.H*.75);
var d=parseInt(this.loading.texture.height/10);
this.loading.texture.setFrame(new PIXI.Rectangle(0,d*this.soul.lang.lang,this.loading.texture.width,d));
if(countLoaded==this.maxCountLoaded){
this.init();
}
}
if(PS.SOFT_GAMES){
if(this.logo_soft.texture.baseTexture.hasLoaded){
this.logo_soft.Scale=this.startS;
this.logo_soft.anchor=new PIXI.Point(0.5,0.5);
this.logo_soft.place(this.W/2,this.H*.5);
if(countLoaded==this.maxCountLoaded){
this.init();
}
}
}
};
pro.init=function(){
var pngs=['Font2','galka','cell_arrow','cell_teleport','cell_player','cell_star','cell_color','cell_rotate','cell_playerR','cell_playerB','music','sound','header_level',
'arrow_left','arrow_right','back','background_game','background_game_over','background_loading_1','background_loading_2','background_loading_3','level_background','star',
'button_developed','button_more_games','button_off','header_tutorial','button_on','header','button_options','end_1','end_2','end_3','end_4','end_level_1','end_level_2','end_level_3','end_level_4',
'field','field_off','key_tutorial','line','logo','menu_background','next','options_background','play','reaktiw_1','reaktiw_2','reaktiw_3','reaktiw_4','replay','score_field',
'square_tutorial','squares_game','step_back','teleport','c1','c2','c3','c4','c5','c6','c7','c8','c9','c10','b_pause','field_pause','b_menu',
'device_1','device_2','face','back_o'];
for(var i=1;i<6;i++){
pngs.push('arrow'+i+'_1');
pngs.push('arrow'+i+'_2');
pngs.push('arrow'+i+'_3');
pngs.push('arrow'+i+'_4');
pngs.push('b'+i+'_1');
pngs.push('b'+i+'_2');
pngs.push('b'+i+'_3');
pngs.push('b'+i+'_4');
pngs.push('box_'+i);
pngs.push('field_'+i);
pngs.push('field_'+i+'_ok');
pngs.push('key_'+i);
pngs.push('keyhole_'+i);
pngs.push('turn'+i+'_1');
pngs.push('turn'+i+'_2');
pngs.push('turn'+i+'_3');
pngs.push('turn'+i+'_4');
}
GodStep.Preloader.prototype.loadAll.call(this,
PS.IMAGE_PATH,pngs,[],
PS.SOUND_PATH,['button','win','fast','move','theme2','start_screen','open','portal'],['Font2.fnt']);
};
pro.h_preload=function(e){
var img=this.image;
var p=img.parent;
img.Scale=p.startS;
img.anchor=new PIXI.Point(0.5,0.5);
p.preloadState++;
switch(img){
case p.back:
p.back.scale.y=p.soul.OH/p.soul.H*p.startS;
p.back.place(p.W/2,p.H*.5);
break;
case p.logo:
p.logo.place(p.W/2,p.H*.3);
break;
case p.logo_soft:
p.logo_soft.place(p.W/2,p.H*.58);
break;
case p.loading:
var d=parseInt(p.loading.texture.height/10);
p.loading.texture.setFrame(new PIXI.Rectangle(0,d*p.soul.lang.lang,p.loading.texture.width,d));
p.loading.place(p.W/2,p.H*.75);
break;
}
if(p.preloadState==p.maxCountLoaded){
p.init();
}
};
PS.ImgButton=function(img,scaleS,px,py,text,textSize,tdx,tdy,tint){
var tex=GodStep.textures[img];
var startS=scaleS;
GodStep.Frame.call(this,null,tex.width*startS,tex.height*startS);
GodStep.IOverOut.call(this,this.W,this.H);
GodStep.IDownUp.call(this,this.W,this.H);
this.addChild(this.img=new GodStep.Image(tex));this.img.Scale=startS;
this.img.anchor=new PIXI.Point(0.5,0.5);
this.setHitArea(-this.W/2,-this.H/2,this.W,this.H);
if(text){
this.addChild(this.label=new PS.Text(text,(textSize||100),0,0,'center',tint));
this.label.x-=this.label.width/2+(tdx||0);
this.label.y-=this.label.height/2+(tdy||0);
this.label.tdx=tdx||0;
this.label.tdy=tdy||0;
this.label.HW=-this.label.width/2;
this.label.HH=-this.label.height/2;
}
this.downScale=.95;
this.place(px,py);
addEvent(this,GodStep.FRAME_DOWN,this.h_mouse);
addEvent(this,GodStep.FRAME_OUT,this.h_mouse);
addEvent(this,GodStep.FRAME_OVER,this.h_mouse);
addEvent(this,GodStep.FRAME_UP,this.h_mouse);
};
extend(PS.ImgButton,GodStep.Frame);
PS.ImgButton.CLICK='clickImg';
PS.ImgButton.COLORS=[0xe77719,0xb1321e,0x608b28,0xc22929,0xc1282c];
pro.setAsComplete=function(){
var id=this.ID-parseInt(this.ID/5)*5+1;
this.img.setTexture(GodStep.textures['field_'+id+'_ok']);
this.label.tint=0;
this.isDisabled=false;
this.label.tint=PS.ImgButton.COLORS[id-1];
this.label.updateText();
};
pro.setAsActive=function(){
var id=this.ID-parseInt(this.ID/5)*5+1;
this.img.setTexture(GodStep.textures['field_'+id]);
this.label.tint=0xffffff;
this.label.updateText();
this.isDisabled=false;
};
pro.destroy=function(){
this.removeChild(this.img);
delEvent(this,GodStep.FRAME_DOWN,this.h_mouse);
delEvent(this,GodStep.FRAME_OUT,this.h_mouse);
delEvent(this,GodStep.FRAME_OVER,this.h_mouse);
delEvent(this,GodStep.FRAME_UP,this.h_mouse);
if(this.label)this.removeChild(this.label);
return this;
};
pro.h_mouse=function(e){
var t=e.content.t;
switch(e.type){
case GodStep.FRAME_DOWN:
this.Scale=this.downScale;
this.isClicked=true;
break;
case GodStep.FRAME_UP:
if(this.isClicked){
dispatch(t,PS.ImgButton.CLICK);
}
this.isClicked=false;
break;
case GodStep.FRAME_OUT:
this.Scale=1;
break;
case GodStep.FRAME_OVER:
if(this.isDown){
this.Scale=this.downScale;
}
break;
}
};
PS.TextButton=function(text,size,color,parent,scaleS,px,py){
var startS=scaleS;
GodStep.Frame.call(this,null,0,0);
this.color=color;
this.addChild(this.back=new PIXI.Graphics());
this.addChild(this.text=new GodStep.Text(text,size*scaleS*2,'Arial','left',0xffffff));
this.text.x=-this.text.width/2;
this.text.y=-this.text.height/2;
this.W=this.text.width*1.5;
this.H=this.text.height*1.5;
GodStep.IOverOut.call(this,this.W,this.H);
GodStep.IDownUp.call(this,this.W,this.H);
this.setHitArea(-this.W/2,-this.H/2,this.W,this.H);
this.redraw();
this.place(px,py);
addEvent(this,GodStep.FRAME_DOWN,this.h_mouse);
addEvent(this,GodStep.FRAME_OUT,this.h_mouse);
addEvent(this,GodStep.FRAME_OVER,this.h_mouse);
addEvent(this,GodStep.FRAME_UP,this.h_mouse);
};
extend(PS.TextButton,GodStep.Frame);
pro.destroy=function(){
this.removeChild(this.back);
this.removeChild(this.text);
return this;
}
pro.redraw=function(){
var g=this.back;
g.clear();
g.beginFill(this.color,1);
g.drawRect(-this.W/2,-this.H/2,this.W,this.H);
g.endFill();
};
pro.h_mouse=function(e){
var t=e.content.t;
switch(e.type){
case GodStep.FRAME_DOWN:
this.Scale=.9;
this.isClicked=true;
break;
case GodStep.FRAME_UP:
if(this.isClicked){
dispatch(t,PS.ImgButton.CLICK);
}
this.isClicked=false;
break;
case GodStep.FRAME_OUT:
this.Scale=1;
break;
case GodStep.FRAME_OVER:
if(this.isDown){
this.Scale=.9;
}
break;
}
};
PS.Text=function(text,size,x,y,align,tint){
PIXI.BitmapText.call(this,text,{font:parseInt(size)+"px Font2",align:align||"left"});
this.x=x;
this.y=y;
if(tint)this.tint=tint;
this.updateText();
};
extend(PS.Text,PIXI.BitmapText);
PS.MovieClip=function(alias,scale,px,py,anchor){
if(alias=='end_level'||alias=='end'){
this.frames=[alias+'_1',alias+'_2',alias+'_3',alias+'_4'];
}else{
this.frames=['b'+alias+'_1','b'+alias+'_2','b'+alias+'_3','b'+alias+'_4'];
}
var tex=GodStep.textures[this.frames[0]];
GodStep.Image.call(this,tex);
this.Scale=this.startS=scale*1;
this.currentFrame=0;
if(anchor==0.5){
this.anchor=new PIXI.Point(.5,.5);
}else{
if(anchor){
this.anchor=anchor;
}
}
this.place(px,py);
};
extend(PS.MovieClip,GodStep.Image);
pro.setToFrame=function(frame){
this.currentFrame=frame;
this.setTexture(GodStep.textures[this.frames[frame]]);
};
pro.nextFrame=function(){
this.currentFrame++;
if(this.currentFrame==this.frames.length){
this.currentFrame=0;
}
this.setTexture(GodStep.textures[this.frames[this.currentFrame]]);
};
PS.Img=function(name,scale,px,py,anchor){
GodStep.Image.call(this,GodStep.textures[name]);
this.Scale=scale;
if(anchor==0.5){
this.anchor=new PIXI.Point(.5,.5);
}else{
if(anchor){
this.anchor=anchor;
}
}
this.place(px,py);
};
extend(PS.Img,GodStep.Image);
pro.setTexture=function(name){
PIXI.Sprite.prototype.setTexture.call(this,GodStep.textures[name]);
};
PS.Background=function(parent,name){
this.soul=parent.soul;
this.p=parent;
GodStep.Frame.call(this,'Background',parent.W,parent.H);
this.addChild(this.img=new PS.Img(name,parent.startS,this.W*.5,this.H*.5,.5));
};
extend(PS.Background,GodStep.Frame);
pro.rescale=function(s){
this.scale.x=this.scale.y=this.soul.OH/this.soul.H;
this.x=+(this.soul.W-this.soul.W*this.scale.x)/2;
this.y=-(this.soul.OH-this.soul.H)*.5/s;
};
PS.Settings=function(soul){
this.soul=soul;
GodStep.Frame.call(this,'Settings',soul.W,soul.H);
GodStep.IDownUp.call(this,soul.W,soul.H);
var S=this.startS=soul.startS;
this.addChild(this.back=new PS.Background(this,'options_background'));
this.addChild(this.field=new PS.Img('field',S,this.W*.5,this.H*.5,.5));
this.addChild(this.header=new PS.Img('header',S,this.W,this.H*.12,new PIXI.Point(1,.5)));
this.addChild(this.musicLabel=new PS.Img('music',S,this.W*.25,this.H*.555,.5));
this.addChild(this.soundLabel=new PS.Img('sound',S,this.W*.25,this.H*.34,.5));
var oText=PS.S('Options');var c=Math.min(1,7/oText.length);
this.addChild(this.optLabel=new PS.Text(oText,250*S*c,this.W*.3,this.H*.2+this.H*.15*(1-c),'left',0xffffff));
var on=PS.S('on');c=Math.min(1,3/on.length);
this.addChild(this.musicLabel=new PS.Text(on,250*S*c,this.W*.44,this.H*.58-this.musicLabel.height/2,'left',0xffffff));
this.addChild(this.soundLabel=new PS.Text(on,250*S*c,this.W*.44,this.H*.36-this.soundLabel.height/2,'left',0xffffff));
this.soundLabel.updateText();
this.musicLabel.updateText();
this.soundLabel.x=(this.W-this.soundLabel.width)/2;
this.musicLabel.x=(this.W-this.musicLabel.width)/2;
this.addChild(this.b_music_on=new PS.ImgButton('button_on',S,this.W*.74,this.H*.555));
this.addChild(this.b_music_off=new PS.ImgButton('button_off',S,this.W*.74,this.H*.555));
this.addChild(this.b_sound_on=new PS.ImgButton('button_on',S,this.W*.74,this.H*.34));
this.addChild(this.b_sound_off=new PS.ImgButton('button_off',S,this.W*.74,this.H*.34));
this.b_music_off.downScale=
this.b_sound_on.downScale=
this.b_music_on.downScale=
this.b_sound_off.downScale=1;
var dev=PS.S('developed');c=Math.min(1,21/dev.length);
this.addChild(this.b_back=new PS.ImgButton('back',S,this.W*.13,this.H*.12));
this.addChild(this.b_developer=new PS.ImgButton('button_developed',S,this.W*.5,this.H*.8,dev,109*S*c,0,this.H*.01));
this.addFrame(this.b_clear=new PS.TextButton('clear data',35,0x562466,this,S,soul.W*.5,soul.H*.1));
this.b_clear.visible=false;
this.visible=false;
this.b_sound_off.visible=this.b_music_off.visible=false;
addEvent(this.b_sound_on,PS.ImgButton.CLICK,this.h_buttons);
addEvent(this.b_music_off,PS.ImgButton.CLICK,this.h_buttons);
addEvent(this.b_music_on,PS.ImgButton.CLICK,this.h_buttons);
addEvent(this.b_sound_off,PS.ImgButton.CLICK,this.h_buttons);
addEvent(this.b_back,PS.ImgButton.CLICK,this.h_buttons);
addEvent(this.b_clear,PS.ImgButton.CLICK,this.h_buttons);
addEvent(this,GodStep.FRAME_UP,this.h_mouse);
};
extend(PS.Settings,GodStep.Frame);
pro.init=function(){
this.visible=true;
this.b_music_off.visible=!PS.MUSIC;
this.b_music_on.visible=PS.MUSIC;
this.b_sound_off.visible=!PS.SOUND;
this.b_sound_on.visible=PS.SOUND;
if(PS.MUSIC){
this.musicLabel.setText(PS.S('on'));this.musicLabel.updateText();
}else{
this.musicLabel.setText(PS.S('off'));this.musicLabel.updateText();
}
if(PS.SOUND){
this.soundLabel.setText(PS.S('on'));this.soundLabel.updateText();
}else{
this.soundLabel.setText(PS.S('off'));this.soundLabel.updateText();
}
};
pro.h_mouse=function(e){
if(e.content.target.soul){
var t=e.content.target;
t.b_developer.isDown=t.b_clear.isDown=t.b_back.isDown=false;
t.b_developer.Scale=t.b_clear.Scale=t.b_back.Scale=1;
}
};
pro.h_buttons=function(e){
var t=e.content.t;
var p=t.parent;
var s=p.soul;
switch(t){
case p.b_developer:
break;
case p.b_music_on:
PS.MUSIC=false;
GodStep.playSound('button',0,PS.SOUND);
if(createjs){
if(createjs.Sound)createjs.Sound.stop();
}
p.b_music_on.visible=false;
p.b_music_off.visible=true;
p.musicLabel.setText(PS.S('off'));p.musicLabel.updateText();
p.musicLabel.x=(p.W-p.musicLabel.width)/2;
break;
case p.b_music_off:
PS.MUSIC=true;
GodStep.playSound('button',0,PS.SOUND);
GodStep.playSound('theme2',null,PS.MUSIC);
p.b_music_on.visible=true;
p.b_music_off.visible=false;
p.musicLabel.setText(PS.S('on'));p.musicLabel.updateText();
p.musicLabel.x=(p.W-p.musicLabel.width)/2;
break;
case p.b_sound_on:
PS.SOUND=false;
GodStep.playSound('button',0,PS.SOUND);
p.b_sound_on.visible=false;
p.b_sound_off.visible=true;
p.soundLabel.setText(PS.S('off'));p.soundLabel.updateText();
p.soundLabel.x=(p.W-p.soundLabel.width)/2;
break;
case p.b_sound_off:
PS.SOUND=true;
GodStep.playSound('button',0,PS.SOUND);
p.b_sound_on.visible=true;
p.b_sound_off.visible=false;
p.soundLabel.setText(PS.S('on'));p.soundLabel.updateText();
p.soundLabel.x=(p.W-p.soundLabel.width)/2;
break;
case p.b_clear:
GodStep.Clear(p.soul.playerDATA);
break;
case p.b_back:
GodStep.playSound('button',0,PS.SOUND);
s.screenTo([s.startmenu],p);
break;
}
};
Object.defineProperty(pro,'Scale',{
get:function(){
return this.scale.x;
},
set:function(value){
this.scale.x=this.scale.y=value;
this.header.y=this.optLabel.y=this.b_back.y=-(this.soul.OH-this.soul.H)*.5/value+this.soul.H*.1/value;
this.optLabel.y+=-this.soul.H*.015/value-this.optLabel.height/2;
this.back.rescale(value);
}
});
PS.StartMenu=function(soul){
this.soul=soul;
GodStep.Frame.call(this,'StartMenu',soul.W,soul.H);
GodStep.IDownUp.call(this,soul.W,soul.H);
var S=this.startS=soul.startS;
this.isFirstTime=true;
this.addChild(this.back=new PS.Background(this,'menu_background'));
this.addChild(this.logo=new PS.Img('logo',S,this.W*.5,this.H*.32,.5));
this.addChild(this.b_play=new PS.ImgButton('play',S,this.W*.5,this.H*.78));
this.addChild(this.b_more=new PS.ImgButton('button_more_games',S,this.W*.21,this.H*.87));
this.addChild(this.b_settings=new PS.ImgButton('button_options',S,this.W*.79,this.H*.87));
this.addChild(this.b_dev=new PS.TextButton('dev',33*S,0xfa66466,soul.W*.9,soul.H*.05));
this.b_dev.visible=false;
addEvent(this.b_dev,PS.ImgButton.CLICK,this.h_buttons);
addEvent(this.b_play,PS.ImgButton.CLICK,this.h_buttons);
addEvent(this.b_settings,PS.ImgButton.CLICK,this.h_buttons);
addEvent(this.b_more,PS.ImgButton.CLICK,this.h_buttons);
this.visible=false;
addEvent(this,GodStep.FRAME_UP,this.h_mouse);
};
extend(PS.StartMenu,GodStep.Frame);
pro.update=function(){
if(this.visible){
}
};
pro.init=function(){
if(this.isFirstTime){
this.isFirstTime=false;
}
this.visible=true;
};
pro.h_mouse=function(e){
if(e.content.target.soul){
var t=e.content.target;
t.b_play.isDown=
t.b_settings.isDown=
t.b_dev.isDown=
t.b_more.isDown=false;
t.b_more.Scale=
t.b_settings.Scale=
t.b_dev.Scale=
t.b_play.Scale=1;
}
};
pro.h_buttons=function(e){
var t=e.content.t;
var p=t.parent;
var s=p.soul;
switch(t){
case p.b_dev:
GodStep.playSound('button',0,PS.SOUND);
PS.DEVMODE=true;
s.screenTo([s.levelselect],p);
break;
case p.b_settings:
GodStep.playSound('button',0,PS.SOUND);
s.screenTo([s.settings],p);
break;
case p.b_more:
if(PS.SOFT_GAMES){
window.open('http://www.softgames.de','_blank');
}
break;
case p.b_play:
GodStep.playSound('button',0,PS.SOUND);
PS.DEVMODE=false;
s.screenTo([s.levelselect],p);
break;
}
};
Object.defineProperty(pro,'Scale',{
get:function(){
return this.scale.x;
},
set:function(value){
this.scale.x=this.scale.y=value;
this.back.rescale(value);
}
});
PS.GamePlay=function(soul){
this.soul=soul;
GodStep.Frame.call(this,'GamePlay',soul.W,soul.H);
GodStep.IDownUp.call(this,soul.W,soul.H);
this.visible=false;
this.OW=soul.OW;
this.OH=soul.OH;
var S=this.startS=soul.startS;
this.overTimer=0;
this.isTutorial=true;
this.addChild(this.back=new PS.Background(this,'background_game'));
this.addChild(this.tutorback=new PS.Background(this,'options_background'));this.tutorback.visible=false;
this.addChild(this.header_tutorial=new PS.Img('header_tutorial',S,this.W,this.H*.11,new PIXI.Point(1,.5)));
this.addChild(this.header=new PS.Img('score_field',S,this.W*1,this.H*.12,new PIXI.Point(1,.5)));
this.addChild(this.headerLabel=new PS.Text('0',170*S,this.W*.91,this.H*.0,'right',0xffffff));
var howText=PS.S('How to play');var c=Math.min(1,11/howText.length);
this.addChild(this.header_tutorialLabel=new PS.Text(howText,S*280*c,this.W*.12,this.H*.04+(1-c)*this.H*.03,'left',0xffffff));
this.header_tutorialLabel.x=(this.W-this.header_tutorialLabel.width)/2;
var c=.21;
var dd=.07;
this.addChild(this.b_back=new PS.ImgButton('b_pause',S,this.W*(c*1-dd),this.H*.12));
this.addChild(this.b_restart=new PS.ImgButton('replay',S,this.W*(c*2-dd),this.H*.12));
this.addChild(this.b_stepBack=new PS.ImgButton('step_back',S,this.W*(c*3-dd),this.H*.12));
this.addChild(this.leftCont=new PIXI.DisplayObjectContainer());
this.addChild(this.rightCont=new PIXI.DisplayObjectContainer());
this.leftCont.addChild(new PS.Img('arrow_left',S,0,0,.5));
var tapString=PS.S('Tap');
var l=Math.max(.52,3/tapString.length);
trace("   "+3/tapString.length);
this.leftCont.addChild(new PS.Text(tapString,180*S*l,-this.W*.08-this.W*.03*(1-l),-this.H*.047*l,'right',0xffffff));
this.rightCont.addChild(new PS.Img('arrow_right',S,0,0,.5));
this.rightCont.addChild(new PS.Text(tapString,180*S*l,-this.W*.06-this.W*.05*(1-l),-this.H*.047*l,'right',0xffffff));
this.leftCont.x=this.rightCont.x=this.W*.5;
this.leftCont.y=this.rightCont.y=this.H*.42;
this.leftCont.phase=this.rightCont.phase=0;
this.addFrame(this.field=new PS.Field(soul,5,5));this.field.gameplay=this;
this.field.x=(this.W-this.field.W)*.5;
this.field.y=this.H-this.field.x-this.field.H;
addEvent(this.field,Games.CELL_CLICK,this.h_cells);
addEvent(this.b_stepBack,PS.ImgButton.CLICK,this.h_buttons);
addEvent(this.b_back,PS.ImgButton.CLICK,this.h_buttons);
addEvent(this.b_restart,PS.ImgButton.CLICK,this.h_buttons);
this.addFrame(this.pause=new PS.Pause(soul));
addEvent(this,GodStep.FRAME_UP,this.h_mouse);
};
extend(PS.GamePlay,GodStep.Frame);
PS.FRAME_RATE=1/60;
pro.initTutor=function(ok){
this.b_back.visible=this.b_restart.visible=this.b_stepBack.visible=this.header.visible=this.headerLabel.visible=!ok;
this.tutorback.visible=this.header_tutorial.visible=this.header_tutorialLabel.visible=ok;
if(ok){
this.isFirstClick=false;
PS.LAST_LEVEL_DATA=JSON.parse(PS.TUTOR_LEVEL);
PS.LAST_LEVEL_SELECTED=1;
}else{
this.rightCont.visible=this.leftCont.visible=false;
}
this.field.initTutor(ok);
};
pro.update=function(){
if(this.visible){
if(this.isTutorial){
var w=this.W*.045;
if(this.isFirstClick){
this.leftCont.alpha=this.rightCont.alpha+=(0-this.leftCont.alpha)*.1;
}
this.leftCont.x=this.W*.23+Math.sin(this.leftCont.phase)*w;
this.rightCont.x=this.W*.77+Math.sin(-this.rightCont.phase)*w;
this.rightCont.phase=this.leftCont.phase+=0.08;
}
var players=this.field.players;
var d=this.W*.015;
var i,player;
for(i=0;i<players.length;i++){
player=players[i];
player.x+=Math.min(Math.max(-d,(player.nextPlace.x-player.x)*.5),d);
player.y+=Math.min(Math.max(-d,(player.nextPlace.y-player.y)*.5),d);
if(player.shadow){
var shadow=player.shadow;
shadow.x+=Math.min(Math.max(-d,(shadow.teleport.cell.x-shadow.x)*.5),d);
shadow.y+=Math.min(Math.max(-d,(shadow.teleport.cell.y-shadow.y)*.5),d);
if(GodStep.Point.distance(shadow.Place,shadow.teleport.cell.Place)<1){
this.field.delShadow(player);
}
}
}
if(this.lastPlayer){
if(GodStep.Point.distance(this.lastPlayer.Place,this.lastPlayer.nextPlace)<10){
if(!this.canNextStep){
this.canNextStep=true;
}
if(this.lastPlayer.typeName=='playerR'){
if(this.isCollide){
this.isCollide=false;
this.lastPlayer=false;
this.canNextStep=true;
}else{
if(this.lastPlayer.countTeleportations<2){
var result=this.clickBlock(this.lastPlayer,false);
if(!result){
this.lastPlayer=false;
this.canNextStep=true;
}
}else{
this.lastPlayer.countTeleportations=0;
this.lastPlayer=false;
this.canNextStep=true;
}
}
}
}
}
if(this.isFinished){
if(this.playSoundFinishTimer--==0){
GodStep.playSound('open',0,PS.SOUND);
}else{
if(this.playSoundFinishTimer<-10){
this.playSoundFinishTimer=-10;
}
}
for(i=0;i<players.length;i++){
players[i].animate();
}
if(this.overTimer++==170){
if(this.isTutorial){
this.isTutorial=false;
this.offTutor=true;
this.soul.screenTo([this.soul.startmenu],this);
}else{
this.soul.screenTo([this.soul.outro],this);
if(PS.SOFT_GAMES){
if(window['SG_Hooks']){
SG_Hooks.levelUp(PS.LAST_LEVEL_SELECTED,null);
}
}
}
}
}else{
for(i=0;i<players.length;i++){
players[i].animate2();
}
}
}
};
pro.destroy=function(){
createjs.Sound.stop();
};
pro.init=function(){
this.b_stepBack.alpha=.5;
this.pause.visible=false;
if(this.offTutor){
this.offTutor=false;
this.initTutor(false);
}
this.headerLabel.setText(PS.LAST_LEVEL_SELECTED+'');
this.headerLabel.x=this.W*.83-this.headerLabel.width/2;
this.history=[];
this.overTimer=0;
this.canNextStep=true;
this.visible=true;
this.isFinished=false;
this.playSoundFinishTimer=50;
this.isCollide=false;
this.playerDATA=GodStep.LoadLocal(this.soul.PLAYER_SLOT);
if(this.playerDATA){
}else{
this.playerDATA={};
trace('default save');
}
if(PS.LAST_LEVEL_DATA){
var coef=PS.LAST_LEVEL_SELECTED/30+.15;
PS.CellObject.PERS=[];
for(var i=0;i<Math.min(11*coef,11);i++){
PS.CellObject.PERS.push('c'+(i+1));
}
this.field.setData(PS.LAST_LEVEL_DATA);
this.updatePlayers();
}
};
pro.over=function(){
GodStep.SaveLocal(this.playerDATA,this.soul.PLAYER_SLOT);
};
pro.h_mouse=function(e){
var t=e.content.target;
if(t){
switch(e.type){
case GodStep.FRAME_UP:
t.b_stepBack.isDown=t.b_back.isDown=
t.b_restart.isDown=false;
t.b_back.Scale=
t.b_stepBack.Scale=t.b_restart.Scale=1;
break;
}
}
};
pro.backHistory=function(){
if(this.history.length>0){
var players=this.field.players;
var lastStep=this.history[this.history.length-1];
for(var i=players.length-1;i>=0;i--){
players[i].cell.delGuest(players[i]);
players[i].cell=this.field.getCell(lastStep[i].x,lastStep[i].y);
players[i].applyCellPostion(true);
players[i].cell.pushGuest(players[i]);
players[i].rotateAngle=players[i].nextRotation=lastStep[i].r;
players[i].applyRotation();
}
this.history.splice(this.history.length-1,1);
if(this.history.length==0){
this.b_stepBack.alpha=.5;
}
}
this.updatePlayers();
};
pro.addHistory=function(){
this.b_stepBack.alpha=1;
var playerPos=[];
var players=this.field.players;
for(var i=0;i<players.length;i++){
playerPos.push({x:players[i].cell.xi,y:players[i].cell.yi,r:players[i].rotateAngle});
}
this.history.push(playerPos);
};
pro.clickBlock=function(player,safeHistory){
this.isFirstClick=true;
var field=this.field;
var dx=(player.rotateAngle==0)?1:((player.rotateAngle==2)?-1:0);
var dy=(player.rotateAngle==1)?1:((player.rotateAngle==3)?-1:0);
if(safeHistory)this.addHistory();
this.lastPlayer=player;
this.canNextStep=false;
this.isCollide=false;
var result;
if(player.typeName!='playerB'){
result=this.movePlayer(player,player.cell,dx,dy,field);
}
if(result){
if(player.typeName=='player'){
GodStep.playSound('move',0,PS.SOUND);
}else{
if(player.typeName=='playerR'){
if(safeHistory)
GodStep.playSound('fast',0,PS.SOUND);
}
}
}
this.updatePlayers();
return result;
};
pro.h_cells=function(e){
var cell=e.content.data;
var t=e.target;
var p=t.parent;
var players=t.players;
var cells=t.cells;
if(p.canNextStep&&!p.isFinished){
switch(e.type){
case Games.CELL_CLICK:
for(var i=0;i<players.length;i++){
var player=players[i];
if(player.cell==cell){
p.clickBlock(player,true);
return;
}
}
break;
}
}
};
pro.updatePlayers=function(){
if(!this.isFinished){
var players=this.field.players;
var finishCount=0;
for(var i=0;i<players.length;i++){
var player=players[i];
player.tpCell=player.goToCell=null;
player.isWaitForTeleport=false;
player.setAsFinished(false);
var stars=this.field.stars;
for(var s=0;s<stars.length;s++){
var star=stars[s];
var guests=star.cell.guests;
for(var g=0;g<guests.length;g++){
var guest=guests[g];
if(guest.name=='player'){
if(guest.alias==star.alias){
finishCount++;
guest.setAsFinished(true);
}else{
guest.setAsFinished(false);
}
}else{
guest.setAsFinished(false);
}
}
}
}
if(finishCount==this.field.stars.length*this.field.stars.length){
this.isFinished=true;
}
}
};
pro.getOtherTP=function(teleport,field){
var teleports=field.teleports;
for(var i=0;i<teleports.length;i++){
if(teleports[i]!=teleport)return teleports[i];
}
};
pro.movePlayer=function(player,cell,dx,dy,field){
var gameplay=field.gameplay;
var isHaveCell=!((cell.xi+dx>field.cellCountX-1||cell.xi+dx<0)||(cell.yi+dy>field.cellCountY-1||cell.yi+dy<0));
var result;
if(isHaveCell){
var nextCell=field.getCell(cell.xi+dx,cell.yi+dy);
player.goToCell=nextCell;
for(var i=0;i<nextCell.guests.length;i++){
var object=nextCell.guests[i];
switch(object.name){
case'player':
if(object.goToCell!=null){
player.goToCell.setAsGuest(player);
player.applyCellPostion();
return true;
}
result=gameplay.movePlayer(object,nextCell,dx,dy,field);
gameplay.isCollide=true;
if(result){
nextCell.setAsGuest(player);
player.applyCellPostion();
return true;
}else{
return false;
}
break;
case'teleport':
var otherTP=gameplay.getOtherTP(object,field);
var tpCell=otherTP.cell;
player.isWaitForTeleport=true;
player.lastCell=player.cell;
result=gameplay.movePlayer(player,otherTP.cell,dx,dy,field);
GodStep.playSound('portal',0,PS.SOUND);
if(result){
var nextTPCell=field.getCell(tpCell.xi+dx,tpCell.yi+dy);
field.addShadow(player,object);
nextTPCell.setAsGuest(player);
player.tpCell=tpCell;
player.applyCellPostion();
return true;
}else{
return false;
}
break;
case'star':
break;
case'arrow':
player.nextRotation=object.rotateAngle;
player.applyRotation();
break;
}
}
nextCell.setAsGuest(player);
player.applyCellPostion();
return true;
}else{
return false;
}
return false;
};
pro.h_buttons=function(e){
var t=e.content.t;
var p=t.parent;
var s=p.soul;
switch(t){
case p.b_stepBack:
GodStep.playSound('button',0,PS.SOUND);
if(!p.isFinished){
p.backHistory();
}
break;
case p.b_back:
GodStep.playSound('button',0,PS.SOUND);
p.pause.init();
break;
case p.b_restart:
if(PS.SOFT_GAMES){
if(SG_Hooks){
SG_Hooks.gameOver(PS.LAST_LEVEL_SELECTED,null);
}
}
GodStep.playSound('button',0,PS.SOUND);
s.screenTo([s.intro],p);
break;
}
};
Object.defineProperty(pro,'Scale',{
get:function(){
return this.scale.x;
},
set:function(value){
this.scale.x=this.scale.y=value;
this.header.y=this.headerLabel.y=this.b_restart.y=this.b_stepBack.y=this.b_back.y=-(this.soul.OH-this.soul.H)*.5/value+this.soul.H*.1/value;
this.headerLabel.y-=this.soul.H*.04/value;
this.back.rescale(value);
this.pause.Scale=value;
this.tutorback.rescale(value);
}
});
GodStep.Slider=function(w,h,s,type,min,max,val,n){
GodStep.Frame.call(this,'Slider');
GodStep.IOverOut.call(this);
GodStep.IDownUp.call(this);
this.CW=20;
this.min=min||0;
this.max=max||1;
this.delta=this.max-this.min;
this.W=w;
this.H=h*s;
this.type=type;
this.isFloat=(type>0&&type<1);
this.back=this.createGraphics('back');
this.cursor=this.createGraphics('cursor');
this.label=this.addFrame(new GodStep.Text(n||'',h*s,'Arial','left',0x0));
this.valueText=this.addFrame(new GodStep.Text(val||'',h*s,'Arial','left',0x0));
this.valueText.y=this.label.y=-this.H;
GodStep.IDownUp.call(this.cursor);
GodStep.addEvent(this,GodStep.FRAME_OUT,this.h_back);
GodStep.addEvent(this,GodStep.FRAME_OVER,this.h_back);
GodStep.addEvent(this,GodStep.FRAME_UP,this.h_cursor);
GodStep.addEvent(this,GodStep.FRAME_MOVE,this.h_move);
GodStep.addEvent(this.cursor,GodStep.FRAME_DOWN,this.h_cursor);
this.setHitArea(0,0,this.W,this.H);
this.setHitArea(0,0,this.CW,this.H,this.cursor);
this.redrawBack();
this.redraw();
this.Value=val;
};
extend(GodStep.Slider,GodStep.Frame);
pro.redrawBack=function(){
if(!this.cursor.IsDown){
this.back.clear();
this.rect(this.W,this.H,(this.IsOver)?0xff4444:0xffaaaa,.8,0,0,this.back);
}
};
pro.redraw=function(){
this.cursor.clear();
this.rect(this.CW,this.H,(this.cursor.IsDown)?0x00ff00:0xffffff,.8,0,0,this.cursor);
};
pro.h_back=function(e){
e.target.redrawBack();
};
pro.h_move=function(e){
var t=e.content.t;
var power;
var dv;
if(e.content.getLocalPosition){
var point=e.content.getLocalPosition(t);
if(t.cursor.IsDown){
power=1;
t.cursor.position.x=Math.max(0,Math.min(point.x-t.cursor.downPoint.x,t.W-t.CW));
dv=(t.cursor.position.x/(t.W-t.CW))*(t.delta)+t.min-t.lastValue;
t.value=t.lastValue+dv*power;
GodStep.dispatch(t,GodStep.FRAME_CHANGED);
if(t.type=='int'){
t.value=parseInt(t.value);
}else{
if(t.isFloat){
t.value=parseInt(t.value/t.type)*t.type;
}else{
t.value=parseInt(t.value/t.type)*t.type;
}
}
t.valueText.setText(t.value);
t.valueText.updateText();
t.valueText.x=t.W-t.valueText.width;
t.updateCursor();
}
}
};
pro.h_cursor=function(e){
if(e.content.t instanceof GodStep.Slider){
e.content.t.cursor.IsDown=false;
e.content.t.redraw();
e.content.t.lastValue=e.content.t.value;
}else{
e.content.t.parent.redraw();
e.content.t.lastValue=e.content.t.value;
}
};
pro.updateCursor=function(){
this.cursor.x=((this.value-this.min)/(this.delta))*(this.W-this.CW);
};
Object.defineProperty(GodStep.Slider.prototype,'IsDown',{
set:function(value){
this.cursor.IsDown=false;
this.redraw();
this.redrawBack();
}
});
Object.defineProperty(GodStep.Slider.prototype,'Value',{
get:function(){
return this.value;
},
set:function(value){
this.value=value;
if(this.type=='int'){
this.value=parseInt(this.value);
}else{
if(this.isFloat){
this.value=parseInt(this.value/this.type)*this.type;
}else{
this.value=parseInt(this.value/this.type)*this.type;
}
}
this.lastValue=this.value;
this.valueText.setText(this.value);
this.valueText.updateText();
this.valueText.x=this.W-this.valueText.width;
this.updateCursor();
}
});
PS.Dev=function(soul){
this.soul=soul;
GodStep.Frame.call(this,'Dev',soul.W,soul.H);
GodStep.IDownUp.call(this,soul.W,soul.H);
var S=this.startS=soul.startS;
this.addFrame(this.b_back=new PS.TextButton('back',35,0x562466,soul.W*.1,soul.H*.05));
this.addFrame(this.b_save=new PS.TextButton('save',35,0x562466,soul.W*.9,soul.H*.05));
this.addChild(this.text=new GodStep.Text('Level ID: ',60*S,'Arial','left',0xffffff));
this.text.y=this.H*.02;
this.addFrame(this.field=new PS.Field(soul,5,5));
this.field.x=(this.W-this.field.W)*.5;
this.field.y=this.H-this.field.x-this.field.H;
addEvent(this.b_save,PS.ImgButton.CLICK,this.h_buttons);
addEvent(this.b_back,PS.ImgButton.CLICK,this.h_buttons);
addEvent(this,GodStep.FRAME_UP,this.h_mouse);
this.visible=false;
var yy=.13;
var s=S*2;
var dx=this.W*.1;
this.addFrame(this.b_addPlayerB=new PS.ImgButton('cell_playerB',s,dx,this.H*yy));
this.addFrame(this.b_addPlayer=new PS.ImgButton('cell_player',s,dx*2,this.H*yy));
this.addFrame(this.b_addPlayerR=new PS.ImgButton('cell_playerR',s,dx*3,this.H*yy));
this.addFrame(this.b_addArrow=new PS.ImgButton('cell_arrow',s,dx*4,this.H*yy));
this.addFrame(this.b_addTeleport=new PS.ImgButton('cell_teleport',s,dx*5,this.H*yy));
this.addFrame(this.b_addStar=new PS.ImgButton('cell_star',s,dx*6,this.H*yy));
this.addFrame(this.b_addRotate=new PS.ImgButton('cell_rotate',s,dx*7,this.H*yy));
this.addFrame(this.b_addColor=new PS.ImgButton('cell_color',s,dx*8,this.H*yy));
this.colors=PS.CellObject.COLORS;
this.b_addColor.color_id=0;this.b_addColor.img.tint=this.colors[this.b_addColor.color_id];
addEvent(this.b_addArrow,GodStep.FRAME_DOWN,this.h_instrument);
addEvent(this.b_addPlayerR,GodStep.FRAME_DOWN,this.h_instrument);
addEvent(this.b_addPlayerB,GodStep.FRAME_DOWN,this.h_instrument);
addEvent(this.b_addPlayer,GodStep.FRAME_DOWN,this.h_instrument);
addEvent(this.b_addTeleport,GodStep.FRAME_DOWN,this.h_instrument);
addEvent(this.b_addStar,GodStep.FRAME_DOWN,this.h_instrument);
addEvent(this.b_addRotate,GodStep.FRAME_DOWN,this.h_instrument);
addEvent(this.b_addColor,GodStep.FRAME_DOWN,this.h_instrument);
addEvent(this.field,Games.CELL_CLICK,this.h_cells);
this.editLevel=0;
this.instrument='';
};
extend(PS.Dev,GodStep.Frame);
pro.update=function(){
};
pro.init=function(){
this.visible=true;
var data=GodStep.LoadLocal(this.soul.SETTINGS_SLOT);
this.clearSelectionInstruments();
this.instrument='';
this.text.setText('Level '+PS.LAST_LEVEL_SELECTED);
this.text.updateText();
this.text.x=(this.W-this.text.width)/2;
this.field.setData(data.levels[PS.LAST_LEVEL_SELECTED-1]);
};
pro.clearSelectionInstruments=function(){
this.b_addStar.alpha=
this.b_addTeleport.alpha=
this.b_addPlayer.alpha=
this.b_addRotate.alpha=
this.b_addPlayerR.alpha=
this.b_addPlayerB.alpha=
this.b_addArrow.alpha=.5;
this.instrument='';
};
pro.h_cells=function(e){
var t=e.target;
var p=t.parent;
var cell=e.content.data;
var object;
switch(e.type){
case Games.CELL_CLICK:
switch(p.instrument){
case'reaktive':
p.field.addCellObject(new PS.CellObject('playerR',p.startS,p.b_addColor.color_id,cell));
break;
case'block':
p.field.addCellObject(new PS.CellObject('playerB',p.startS,p.b_addColor.color_id,cell));
break;
case'player':
p.field.addCellObject(new PS.CellObject('player',p.startS,p.b_addColor.color_id,cell));
break;
case'teleport':
p.field.addCellObject(new PS.CellObject('teleport',p.startS,-1,cell));
break;
case'arrow':
p.field.addCellObject(new PS.CellObject('arrow',p.startS,-1,cell));
break;
case'star':
p.field.addCellObject(new PS.CellObject('star',p.startS,p.b_addColor.color_id,cell));
break;
case'rotate':
p.field.rotateCellObject(cell);
break;
case'':
p.field.delCellObject(cell);
break;
}
break;
}
};
pro.h_instrument=function(e){
var t=e.target;
var p=t.parent;
switch(t){
case p.b_addPlayerB:
if(p.b_addPlayerB.alpha==1){
p.clearSelectionInstruments();
}else{
p.clearSelectionInstruments();
p.instrument='block';
p.b_addPlayerB.alpha=1;
}
break;
case p.b_addPlayerR:
if(p.b_addPlayerR.alpha==1){
p.clearSelectionInstruments();
}else{
p.clearSelectionInstruments();
p.instrument='reaktive';
p.b_addPlayerR.alpha=1;
}
break;
case p.b_addArrow:
if(p.b_addArrow.alpha==1){
p.clearSelectionInstruments();
}else{
p.clearSelectionInstruments();
p.instrument='arrow';
p.b_addArrow.alpha=1;
}
break;
case p.b_addPlayer:
if(p.b_addPlayer.alpha==1){
p.clearSelectionInstruments();
}else{
p.clearSelectionInstruments();
p.instrument='player';
p.b_addPlayer.alpha=1;
}
break;
case p.b_addTeleport:
if(p.b_addTeleport.alpha==1){
p.clearSelectionInstruments();
}else{
p.clearSelectionInstruments();
p.instrument='teleport';
p.b_addTeleport.alpha=1;
}
break;
case p.b_addStar:
if(p.b_addStar.alpha==1){
p.clearSelectionInstruments();
}else{
p.clearSelectionInstruments();
p.instrument='star';
p.b_addStar.alpha=1;
}
break;
case p.b_addColor:
p.b_addColor.color_id++;
if(p.b_addColor.color_id>=p.colors.length){
p.b_addColor.color_id=0;
}
p.b_addColor.img.tint=p.colors[p.b_addColor.color_id];
break;
case p.b_addRotate:
if(p.b_addRotate.alpha==1){
p.clearSelectionInstruments();
}else{
p.clearSelectionInstruments();
p.instrument='rotate';
p.b_addRotate.alpha=1;
}
break;
}
};
pro.h_buttons=function(e){
var t=e.content.t;
var p=t.parent;
var s=p.soul;
switch(t){
case p.b_save:
var data=GodStep.LoadLocal(s.SETTINGS_SLOT);
if(!data.levels){
data.levels=[];
}
var d=p.field.getData();
data.levels[PS.LAST_LEVEL_SELECTED-1]=d;
for(var i=0;i<data.levels.length;i++){
var lev=data.levels[i];
var val=lev[lev.length-1];
if(val.id){
data.levels[i][lev.length-1]={id:i+1};
}else{
data.levels[i][lev.length]={id:i+1};
}
trace(val);
}
GodStep.SaveLocal(data,s.SETTINGS_SLOT);
break;
case p.b_back:
s.screenTo([s.levelselect],p);
break;
}
};
pro.h_mouse=function(e){
var t=e.content.target;
if(e.content.target){
switch(e.type){
case GodStep.FRAME_UP:
if(e.content.target.soul){
t.b_addPlayer.isDown=
t.b_addArrow.isDown=
t.b_addTeleport.isDown=
t.b_addStar.isDown=
t.b_back.isDown=
t.b_addRotate.isDown=
t.b_addColor.isDown=
t.b_save.isDown=
t.b_addPlayerR.isDown=
t.b_addPlayerB.isDown=false;
t.b_addPlayer.Scale=
t.b_addArrow.Scale=
t.b_addTeleport.Scale=
t.b_addStar.Scale=
t.b_back.Scale=
t.b_addRotate.Scale=
t.b_addColor.Scale=
t.b_addPlayerR.Scale=
t.b_addPlayerB.Scale=
t.b_save.Scale=1;
}
break;
}
}
};
PS.GameOver=function(soul){
this.soul=soul;
GodStep.Frame.call(this,'GameOver',soul.W,soul.H);
GodStep.IDownUp.call(this,soul.W,soul.H);
var S=soul.startS;
this.startS=soul.startS;
this.addChild(this.b_startmenu=new AG.TextButton('main menu',33,0xfa66466,this,S,soul.W*.2,soul.H*.81));
this.addChild(this.b_restart=new AG.TextButton('restart',33,0xfa66466,this,S,soul.W*.54,soul.H*.81));
this.addChild(this.b_shop=new AG.TextButton('shop',33,0xfa66466,this,S,soul.W*.75,soul.H*.81));
this.addChild(this.totalMoney=new GodStep.Text('total',55*S,'Arial','left',0xffffff));
this.addChild(this.roundMoney=new GodStep.Text('round',55*S,'Arial','left',0xffffff));
this.addChild(this.bestMoney=new GodStep.Text('money',55*S,'Arial','left',0xffffff));
this.addChild(this.level=new GodStep.Text('level',55*S,'Arial','left',0xffffff));
this.addChild(this.till=new GodStep.Text('till',55*S,'Arial','left',0xffffff));
this.addFrame(this.progress=new PS.ProgressBar(this));
addEvent(this.b_startmenu,PS.ImgButton.CLICK,this.h_buttons);
addEvent(this.b_restart,PS.ImgButton.CLICK,this.h_buttons);
addEvent(this.b_shop,PS.ImgButton.CLICK,this.h_buttons);
addEvent(this,GodStep.FRAME_UP,this.h_mouse);
this.levels=[];
this.levels[0]=0;
this.levels[1]=100;
for(var i=2;i<100;i++){
this.levels[i]=this.levels[i-1]*1.05+100;
}
this.visible=false;
};
extend(PS.GameOver,GodStep.Frame);
pro.update=function(){
if(this.visible){
}
};
pro.init=function(){
var player=GodStep.LoadLocal('player');
this.totalMoney.setText('total: '+player.totalMoney);
this.bestMoney.setText('best: '+player.bestScore);
this.roundMoney.setText('money: '+this.soul.gameplay.roundMoney);
var levelID=0;
for(var i=1;i<this.levels.length;i++){
if(this.levels[i]>player.totalScore){
levelID=i-1;
break;
}
}
this.level.setText('level: '+levelID);
this.till.setText(Math.floor(this.levels[levelID+1]-player.totalScore)+'$ till next prize');
this.progress.drawProgress(1-((this.levels[levelID+1]-player.totalScore)/(this.levels[levelID+1]-this.levels[levelID])));
this.progress.x=(this.W-this.progress.W)/2;
this.roundMoney.y=this.H*.2;
this.totalMoney.y=this.H*.3;
this.bestMoney.y=this.H*.4;
this.level.y=this.H*.5;
this.till.y=this.H*.6;
this.progress.y=this.H*.7;
this.till.x=
this.level.x=
this.roundMoney.x=
this.totalMoney.x=
this.bestMoney.x=this.W*.2;
this.visible=true;
};
pro.h_buttons=function(e){
var t=e.content.t;
var p=t.parent;
var s=p.soul;
if(!p.isGameOver){
switch(t){
case p.b_startmenu:
s.screenTo([s.startmenu],p);
break;
case p.b_shop:
s.screenTo([s.shop],p);
break;
case p.b_restart:
s.screenTo([s.gameplay],p);
break;
}
}
};
pro.h_mouse=function(e){
var t=e.content.target;
switch(e.type){
case GodStep.FRAME_UP:
if(e.content.target.soul){
t.b_startmenu.isDown=
t.b_restart.isDown=
t.b_shop.isDown=false;
t.b_shop.Scale=
t.b_startmenu.Scale=
t.b_restart.Scale=1;
}
break;
}
};
PS.Transmission=function(soul){
this.soul=soul;
Games.Transmission.call(this,soul,.09,0xffffff);
};
extend(PS.Transmission,Games.Transmission);
PS.LevelSelect=function(soul){
this.soul=soul;
var S=this.startS=soul.startS;
GodStep.Frame.call(this,'LevelSelect',soul.W,soul.H);
GodStep.IDownUp.call(this,soul.W,soul.H);
this.addChild(this.back=new PS.Background(this,'level_background'));
this.addChild(this.maska=new PIXI.Graphics());
this.addChild(this.container=new GodStep.Frame('Container',soul.W,soul.H));
GodStep.IDownUp.call(this.container,this.soul.W,this.soul.H);
this.addChild(this.header=new PS.Img('header_level',S,this.W,this.H*.12,new PIXI.Point(1,.5)));
var oText=PS.S('Levels');var c=Math.min(1,7/oText.length);
this.addChild(this.headerLabel=new PS.Text(oText,300*S*c,this.W*.3,this.H*.01,'left',0xffffff));
this.addChild(this.b_back=new PS.ImgButton('back',S,this.W*.13,this.H*.12));
addEvent(this.b_back,PS.ImgButton.CLICK,this.h_buttons);
this.visible=false;
this.levels=[];
this.container.MY=this.container.y=soul.H*.2;
this.maska.beginFill(0,.1);
this.maska.drawRect(0,this.container.y,this.W,this.H);
this.container.mask=this.maska;
addEvent(this.container,GodStep.FRAME_MOVE,this.h_container);
addEvent(this.container,GodStep.FRAME_DOWN,this.h_container);
addEvent(this.b_back,PS.ImgButton.CLICK,this.h_buttons);
addEvent(this,GodStep.FRAME_UP,this.h_mouse);
};
extend(PS.LevelSelect,GodStep.Frame);
PS.ISMUSICSTARTED=false;
pro.init=function(data){
this.visible=true;
this.settingsDATA=data||GodStep.LoadLocal(this.soul.SETTINGS_SLOT);
if(this.settingsDATA==null){
this.settingsDATA=GodStep.LoadText(this.soul.defaultSettings);
}
var player=GodStep.LoadLocal(this.soul.PLAYER_SLOT)||{count:PS.LAST_LEVEL_SELECTED-1||0};
while(this.levels.length){
this.container.removeChild(this.levels[0].destroy());
this.levels.splice(0,1);
}
PS.LEVELS=this.levels=[];
var S=this.startS;
var w=this.W/4.3;
var x,y;
var maxY=0;
var levels=this.settingsDATA.levels;
for(var i=0;i<levels.length;i++){
y=parseInt(i/4);
x=i-y*4;
var level=new PS.ImgButton('field_off',S,x*w+w*.66,y*w+w/2,''+(i+1),175*S,0,this.H*.022,0x36818A);
maxY=Math.max(maxY,level.y+level.H/2);
this.container.addChild(level);
level.ID=i+1;
level.isDisabled=true;
if(i<player.count){
level.isDisabled=false;
level.setAsComplete();
}
if(i==player.count){
level.isDisabled=false;
level.setAsActive();
}
this.levels.push(level);
level.levelData=levels[i];
addEvent(level,PS.ImgButton.CLICK,this.h_levels);
}
if(this.newLevel){
this.container.addChild(this.newLevel.destroy());
this.newLevel=null;
}
if(PS.DEVMODE){
if(!this.b_loadDef){
this.addFrame(this.b_loadDef=new PS.TextButton('Load Default',35,0x562466,this,S,this.soul.W*.5,this.soul.H*.05));
addEvent(this.b_loadDef,PS.ImgButton.CLICK,this.h_buttons);
}
this.b_loadDef.visible=true;
y=parseInt(this.levels.length/4);
x=this.levels.length-y*4;
var newLevel=this.newLevel=new PS.TextButton('add',60,0x555555,this,S,x*w+w/2,y*w+w/2);
newLevel.ID=this.levels.length+1;
addEvent(newLevel,GodStep.FRAME_DOWN,this.h_newLevels);
this.container.addChild(newLevel);
}else{
if(this.b_loadDef){
this.b_loadDef.visible=false;
}
}
this.container.setHitArea(0,0,this.W,maxY);
this.container.MH=maxY+this.H*.06;
this.container.LH=level.H;
};
pro.h_levels=function(e){
var t=e.target;
var p=t.parent.parent;
var s=p.soul;
switch(e.type){
case PS.ImgButton.CLICK:
PS.LAST_LEVEL_SELECTED=t.ID;
PS.LAST_LEVEL_DATA=t.levelData;
if(PS.DEVMODE){
s.screenTo([s.dev],p);
}else{
GodStep.playSound('button',0,PS.SOUND);
s.screenTo([s.intro],p);
}
break;
}
};
pro.h_newLevels=function(e){
var t=e.target;
var p=t.parent.parent;
var s=p.soul;
switch(e.type){
case GodStep.FRAME_DOWN:
PS.LAST_LEVEL_SELECTED=t.ID;
s.screenTo([s.dev],p);
break;
}
};
pro.h_container=function(e){
var t=e.target;
var parent=t.parent;
var s=parent.soul;
if(t.name=='Container'){
switch(e.type){
case GodStep.FRAME_MOVE:
if(t.isDown){
var p=e.content.getLocalPosition(t.parent);
var hy=(s.OH-s.H)*.5;
t.y=p.y-t.downPoint.y;
t.y=Math.max(Math.min(t.y,t.MY-hy/parent.scale.x),(s.OH-hy)/parent.scale.x-t.MH);
}
break;
}
}
};
pro.h_mouse=function(e){
var t=e.content.target;
switch(e.type){
case GodStep.FRAME_UP:
if(e.content.target.soul){
t.b_back.Scale=1;
t.b_back.isDown=false;
if(t.b_loadDef){
t.b_loadDef.isDown=false;
t.b_loadDef.Scale=1;
}
for(var i=0;i<t.levels.length;i++){
t.levels[i].Scale=1;
t.levels[i].isDown=false;
}
}
break;
}
};
pro.h_buttons=function(e){
var t=e.content.t;
var p=t.parent;
var s=p.soul;
switch(t){
case p.b_loadDef:
p.init(GodStep.LoadText(PS.DEFAULT_SETTINGS));
break;
case p.b_back:
GodStep.playSound('button',0,PS.SOUND);
s.screenTo([s.startmenu],p);
break;
}
};
Object.defineProperty(pro,'Scale',{
get:function(){
return this.scale.x;
},
set:function(value){
this.scale.x=this.scale.y=value;
this.maska.y=this.container.y=this.header.y=this.headerLabel.y=this.b_back.y=-(this.soul.OH-this.soul.H)*.5/value+this.soul.H*.1/value;
this.headerLabel.y-=this.soul.H*.025/value+this.headerLabel.height/2;
this.container.y-=-this.container.MY+this.soul.H*.13/value;
this.maska.y+=this.soul.H*.07/value;
this.maska.clear();
this.maska.beginFill(0,.1);
this.maska.drawRect(0,0,this.W,this.soul.OH/value-this.container.y);
this.back.rescale(value);
}
});
PS.LevelOutro=function(soul){
this.soul=soul;
var S=this.startS=soul.startS;
GodStep.Frame.call(this,'LevelOutro',soul.W,soul.H);
this.addChild(this.back=new PS.Background(this,'background_game_over'));
this.addChild(this.star=new PS.Img('star',this.startS,this.W/2,this.H*.4,.5));
this.addChild(this.label=new PS.Text('55',400*S,this.W*.5,this.H*.27,'center',0xffffff));
this.addChild(this.endLevel=new PS.MovieClip('end_level',this.startS,this.W/2,this.H/2,.5));
this.addChild(this.endGame=new PS.MovieClip('end',this.startS,this.W/2,this.H*.44,.5));
this.addChild(this.b_back=new PS.ImgButton('back',S,this.W*.13,this.H*.12));
this.addChild(this.b_next=new PS.ImgButton('next',S,this.W*.5,this.H*.9));
this.timer=50;
this.b_back.visible=false;
this.animateTimer=0;
this.visible=false;
addEvent(this.b_back,PS.ImgButton.CLICK,this.h_buttons);
addEvent(this.b_next,PS.ImgButton.CLICK,this.h_buttons);
addEvent(this,GodStep.FRAME_UP,this.h_mouse);
};
extend(PS.LevelOutro,GodStep.Frame);
pro.init=function(){
GodStep.playSound('win',0,PS.SOUND);
this.timer=100;
this.visible=true;
this.label.setText(''+PS.LAST_LEVEL_SELECTED);
this.label.visible=this.star.visible=this.endLevel.visible=false;
this.endGame.visible=!this.star.visible;
this.label.updateText();
this.label.x=(this.W-this.label.width)/2;
PS.LAST_LEVEL_SELECTED++;
var player=GodStep.LoadLocal(this.soul.PLAYER_SLOT)||{count:0};
if(player.count<PS.LAST_LEVEL_SELECTED-1){
GodStep.SaveLocal({count:PS.LAST_LEVEL_SELECTED-1},this.soul.PLAYER_SLOT);
}
if(PS.LAST_LEVEL_SELECTED<PS.LEVELS.length){
PS.LAST_LEVEL_DATA=PS.LEVELS[PS.LAST_LEVEL_SELECTED].levelData;
}
};
pro.update=function(){
if(this.visible){
if(this.timer--==0){
}
if(this.animateTimer++==5){
this.animateTimer=0;
if(this.endLevel)this.endLevel.nextFrame();
if(this.endGame)this.endGame.nextFrame();
}
}
};
pro.h_mouse=function(e){
var t=e.content.target;
switch(e.type){
case GodStep.FRAME_UP:
if(e.content.target.soul){
t.b_back.Scale=1;
t.b_back.isDown=false;
t.b_next.Scale=1;
t.b_next.isDown=false;
}
break;
}
};
pro.h_buttons=function(e){
var t=e.content.t;
var p=t.parent;
var s=p.soul;
switch(t){
case p.b_next:
GodStep.playSound('button',0,PS.SOUND);
if(PS.LAST_LEVEL_SELECTED==PS.LEVELS.length+1){
s.screenTo([s.startmenu],p);
}else{
s.screenTo([s.intro],p);
}
break;
case p.b_back:
GodStep.playSound('button',0,PS.SOUND);
s.screenTo([s.levelselect],p);
break;
}
};
Object.defineProperty(pro,'Scale',{
get:function(){
return this.scale.x;
},
set:function(value){
this.scale.x=this.scale.y=value;
this.b_back.y=-(this.soul.OH-this.soul.H)*.5/value+this.soul.H*.1/value;
this.back.rescale(value);
}
});
PS.LevelIntro=function(soul){
this.soul=soul;
var S=this.startS=soul.startS;
GodStep.Frame.call(this,'LevelIntro',soul.W,soul.H);
this.addChild(this.back=new PS.Background(this,'background_loading_3'));
this.addChild(this.header=new PS.Img('line',S,this.W*.5,this.H*.5,.5));
this.addChild(this.headerLabel=new PS.Text('',400*S,0,this.H*.73,'center',0xffffff));
this.soundTimer=0;
this.timer=-1;
this.visible=false;
};
extend(PS.LevelIntro,GodStep.Frame);
PS.LevelIntro.tex=['background_loading_3','background_loading_1','background_loading_2','menu_background','options_background'];
pro.update=function(){
if(this.visible){
if(this.soundTimer++==15){
GodStep.playSound('start_screen',0,PS.SOUND);
}
if(this.timer--==0){
if(PS.ISMUSICSTARTED==false){
PS.ISMUSICSTARTED=true;
GodStep.playSound('theme2',null,PS.MUSIC);
}
this.soul.screenTo([this.soul.gameplay],this);
}
}
};
pro.init=function(){
this.soundTimer=0;
var id=PS.LAST_LEVEL_SELECTED-parseInt(PS.LAST_LEVEL_SELECTED/5)*5+1;
this.back.img.setTexture(PS.LevelIntro.tex[id-1]);
this.visible=true;
this.timer=50;
this.headerLabel.setText(PS.S('Level')+' '+PS.LAST_LEVEL_SELECTED);
this.headerLabel.updateText();
this.headerLabel.x=(this.W-this.headerLabel.width)/2;
this.headerLabel.y=(this.H-this.headerLabel.height)/2-this.H*.015;
};
Object.defineProperty(pro,'Scale',{
get:function(){
return this.scale.x;
},
set:function(value){
this.scale.x=this.scale.y=value;
this.back.rescale(value);
}
});
PS.Lang=function(lang){
PS.langs=this;
switch(lang.toUpperCase()){
case'EN':
this.lang=0;
break;
case'DE':
this.lang=1;
break;
case'ES':
this.lang=2;
break;
case'FR':
this.lang=3;
break;
case'IT':
this.lang=4;
break;
case'PT':
this.lang=5;
break;
case'RU':
this.lang=6;
break;
case'TR':
this.lang=7;
break;
case'NL':
this.lang=8;
break;
case'PL':
this.lang=9;
break;
default:
this.lang=0;
break;
}
var s=this.S=[];
var newSymbols=''+''+'';
s['Loading']=['Loading','Laden','Cargando','Chargement','Caricamento in corso','A carregar','','Ykleniyor','Laden','Pobieranie'];
s['How to play']=['How to play',"So geht's",'Cmo jugar','Comment jouer','Come giocare','Como jogar',' ','Nasl oynanr','Hoe te spelen','Jak gra'];
s['Tap']=['TAP','Antippen','Tocar','Tapotez','Tocca','Toque','','Dokun','Tikken','Stuknij'];
s['Options']=['Options','Optionen','Opciones','Options','Opzioni','Opes','','Seenekler','Opties','Opcje'];
s['on']=['on','an','con','allum','on','lig.','.','ak','aan','wcz'];
s['off']=['off','aus','desc','teint','off','deslig.','.','kapal','uit','wycz'];
s['developed']=['Developed by Fundemic','Entwickelt von Fundemic','Desarrollado por Fundemic','Dvelopp par Fundemic','Sviluppato da Fundemic','Desenvolvido por Fundemic',' Fundemic','Fundemic tarafndan gelitirilmitir','Ontwikkeld door Fundemic','Opracowane przez Fundemic'];
s['Levels']=['Levels','Level','Niveles','Niveaux','Livelli','Nveis','','Seviyeler','Niveaus','Poziomy'];
s['Level']=['Level','Level','Nivel','Niveau','Livello','Nvei','','Seviye','Niveau','Poziom'];
s['Pause']=['Pause','Pause','Pause','Pause','Pause','Pause','Pause','Pause','Pause','Pause'];
};extend(PS.Lang,Object);
PS.S=function(v){
return PS.langs.S[v][PS.langs.lang];
};
PS.FontLoader=function(assetURLs,crossorigin){
new PS.BitmapFontLoader();
};
extend(PS.FontLoader,PIXI.AssetLoader);
PS.FontString='<font>'+
'<info face="Font2" size="86" />'+
'<common lineHeight="62" scaleW="707" scaleH="713" pages="1" />'+
'<pages>'+
'<page id="0" file="Font2.png" />'+
'</pages>'+
'<chars count="192">'+
'<char id="33" x="685" y="59" width="7" height="45" xoffset="0" yoffset="17" xadvance="10" /><!-- ! -->'+
'<char id="34" x="74" y="46" width="12" height="12" xoffset="0" yoffset="17" xadvance="15" /><!-- " -->'+
'<char id="35" x="278" y="118" width="33" height="46" xoffset="0" yoffset="16" xadvance="36" /><!-- # -->'+
'<char id="36" x="587" y="0" width="26" height="56" xoffset="0" yoffset="11" xadvance="29" /><!-- $ -->'+
'<char id="37" x="0" y="437" width="47" height="45" xoffset="0" yoffset="17" xadvance="50" /><!-- % -->'+
'<char id="38" x="176" y="426" width="37" height="46" xoffset="0" yoffset="16" xadvance="40" /><!-- & -->'+
'<char id="39" x="100" y="46" width="5" height="11" xoffset="0" yoffset="17" xadvance="8" /><!--  -->'+
'<char id="40" x="663" y="462" width="12" height="59" xoffset="0" yoffset="17" xadvance="15" /><!-- ( -->'+
'<char id="41" x="660" y="119" width="12" height="60" xoffset="0" yoffset="16" xadvance="15" /><!-- ) -->'+
'<char id="42" x="226" y="604" width="18" height="16" xoffset="0" yoffset="17" xadvance="21" /><!-- * -->'+
'<char id="43" x="176" y="545" width="28" height="27" xoffset="0" yoffset="26" xadvance="31" /><!-- + -->'+
'<char id="44" x="627" y="325" width="7" height="13" xoffset="0" yoffset="56" xadvance="10" /><!-- , -->'+
'<char id="45" x="0" y="692" width="18" height="4" xoffset="0" yoffset="44" xadvance="21" /><!-- - -->'+
'<char id="46" x="95" y="164" width="7" height="6" xoffset="0" yoffset="56" xadvance="10" /><!-- . -->'+
'<char id="47" x="627" y="260" width="23" height="51" xoffset="0" yoffset="16" xadvance="26" /><!-- / -->'+
'<char id="48" x="505" y="552" width="28" height="46" xoffset="0" yoffset="16" xadvance="31" /><!-- 0 -->'+
'<char id="49" x="662" y="0" width="11" height="45" xoffset="0" yoffset="17" xadvance="14" /><!-- 1 -->'+
'<char id="50" x="545" y="0" width="28" height="46" xoffset="0" yoffset="16" xadvance="31" /><!-- 2 -->'+
'<char id="51" x="545" y="60" width="28" height="46" xoffset="0" yoffset="16" xadvance="31" /><!-- 3 -->'+
'<char id="52" x="369" y="614" width="32" height="45" xoffset="0" yoffset="17" xadvance="35" /><!-- 4 -->'+
'<char id="53" x="460" y="397" width="30" height="46" xoffset="0" yoffset="16" xadvance="33" /><!-- 5 -->'+
'<char id="54" x="546" y="285" width="28" height="45" xoffset="0" yoffset="17" xadvance="31" /><!-- 6 -->'+
'<char id="55" x="546" y="344" width="28" height="46" xoffset="0" yoffset="16" xadvance="31" /><!-- 7 -->'+
'<char id="56" x="546" y="180" width="28" height="46" xoffset="0" yoffset="16" xadvance="31" /><!-- 8 -->'+
'<char id="57" x="545" y="612" width="28" height="46" xoffset="0" yoffset="16" xadvance="31" /><!-- 9 -->'+
'<char id="58" x="664" y="381" width="7" height="32" xoffset="0" yoffset="30" xadvance="10" /><!-- : -->'+
'<char id="59" x="685" y="381" width="7" height="39" xoffset="0" yoffset="30" xadvance="10" /><!-- ; -->'+
'<char id="60" x="371" y="338" width="28" height="31" xoffset="0" yoffset="26" xadvance="31" /><!-- < -->'+
'<char id="61" x="416" y="516" width="25" height="19" xoffset="0" yoffset="32" xadvance="28" /><!-- = -->'+
'<char id="62" x="546" y="240" width="28" height="31" xoffset="0" yoffset="26" xadvance="31" /><!-- > -->'+
'<char id="63" x="545" y="120" width="28" height="46" xoffset="0" yoffset="16" xadvance="31" /><!-- ? -->'+
'<char id="64" x="0" y="0" width="60" height="58" xoffset="0" yoffset="17" xadvance="63" /><!-- @ -->'+
'<char id="65" x="176" y="486" width="37" height="45" xoffset="0" yoffset="17" xadvance="40" /><!-- A -->'+
'<char id="66" x="547" y="463" width="27" height="45" xoffset="0" yoffset="17" xadvance="30" /><!-- B -->'+
'<char id="67" x="125" y="249" width="38" height="45" xoffset="0" yoffset="17" xadvance="41" /><!-- C -->'+
'<char id="68" x="231" y="0" width="34" height="45" xoffset="0" yoffset="17" xadvance="37" /><!-- D -->'+
'<char id="69" x="279" y="0" width="32" height="45" xoffset="0" yoffset="17" xadvance="35" /><!-- E -->'+
'<char id="70" x="371" y="220" width="32" height="45" xoffset="0" yoffset="17" xadvance="35" /><!-- F -->'+
'<char id="71" x="125" y="308" width="38" height="45" xoffset="0" yoffset="17" xadvance="41" /><!-- G -->'+
'<char id="72" x="324" y="496" width="32" height="45" xoffset="0" yoffset="17" xadvance="35" /><!-- H -->'+
'<char id="73" x="687" y="0" width="4" height="45" xoffset="0" yoffset="17" xadvance="7" /><!-- I -->'+
'<char id="74" x="587" y="568" width="27" height="45" xoffset="0" yoffset="17" xadvance="30" /><!-- J -->'+
'<char id="75" x="417" y="0" width="30" height="45" xoffset="0" yoffset="17" xadvance="33" /><!-- K -->'+
'<char id="76" x="461" y="0" width="30" height="45" xoffset="0" yoffset="17" xadvance="33" /><!-- L -->'+
'<char id="77" x="65" y="368" width="46" height="45" xoffset="0" yoffset="17" xadvance="49" /><!-- M -->'+
'<char id="78" x="180" y="0" width="37" height="45" xoffset="0" yoffset="17" xadvance="40" /><!-- N -->'+
'<char id="79" x="61" y="437" width="46" height="45" xoffset="0" yoffset="17" xadvance="49" /><!-- O -->'+
'<char id="80" x="587" y="404" width="26" height="45" xoffset="0" yoffset="17" xadvance="29" /><!-- P -->'+
'<char id="81" x="60" y="615" width="46" height="45" xoffset="0" yoffset="17" xadvance="49" /><!-- Q -->'+
'<char id="82" x="417" y="115" width="30" height="45" xoffset="0" yoffset="17" xadvance="33" /><!-- R -->'+
'<char id="83" x="505" y="0" width="26" height="45" xoffset="0" yoffset="17" xadvance="29" /><!-- S -->'+
'<char id="84" x="275" y="604" width="34" height="45" xoffset="0" yoffset="17" xadvance="37" /><!-- T -->'+
'<char id="85" x="415" y="608" width="32" height="45" xoffset="0" yoffset="17" xadvance="35" /><!-- U -->'+
'<char id="86" x="227" y="448" width="37" height="45" xoffset="0" yoffset="17" xadvance="40" /><!-- V -->'+
'<char id="87" x="0" y="190" width="51" height="45" xoffset="0" yoffset="17" xadvance="54" /><!-- W -->'+
'<char id="88" x="173" y="648" width="37" height="45" xoffset="0" yoffset="17" xadvance="40" /><!-- X -->'+
'<char id="89" x="325" y="0" width="32" height="45" xoffset="0" yoffset="17" xadvance="35" /><!-- Y -->'+
'<char id="90" x="177" y="262" width="37" height="45" xoffset="0" yoffset="17" xadvance="40" /><!-- Z -->'+
'<char id="91" x="659" y="628" width="14" height="60" xoffset="0" yoffset="16" xadvance="17" /><!-- [ -->'+
'<char id="92" x="627" y="398" width="23" height="50" xoffset="0" yoffset="17" xadvance="26" /><!--  -->'+
'<char id="93" x="659" y="554" width="14" height="60" xoffset="0" yoffset="16" xadvance="17" /><!-- ] -->'+
'<char id="94" x="46" y="674" width="23" height="17" xoffset="0" yoffset="17" xadvance="26" /><!-- ^ -->'+
'<char id="95" x="0" y="674" width="32" height="4" xoffset="0" yoffset="62" xadvance="35" /><!-- _ -->'+
'<char id="96" x="69" y="164" width="12" height="10" xoffset="0" yoffset="17" xadvance="15" /><!-- ` -->'+
'<char id="97" x="370" y="443" width="32" height="32" xoffset="0" yoffset="30" xadvance="35" /><!-- a -->'+
'<char id="98" x="371" y="59" width="32" height="45" xoffset="0" yoffset="17" xadvance="35" /><!-- b -->'+
'<char id="99" x="504" y="447" width="28" height="32" xoffset="0" yoffset="30" xadvance="31" /><!-- c -->'+
'<char id="100" x="325" y="118" width="32" height="45" xoffset="0" yoffset="17" xadvance="35" /><!-- d -->'+
'<char id="101" x="275" y="663" width="32" height="32" xoffset="0" yoffset="30" xadvance="35" /><!-- e -->'+
'<char id="102" x="627" y="0" width="21" height="46" xoffset="0" yoffset="16" xadvance="24" /><!-- f -->'+
'<char id="103" x="370" y="383" width="32" height="46" xoffset="0" yoffset="30" xadvance="35" /><!-- g -->'+
'<char id="104" x="461" y="608" width="30" height="45" xoffset="0" yoffset="17" xadvance="33" /><!-- h -->'+
'<char id="105" x="687" y="224" width="5" height="42" xoffset="0" yoffset="20" xadvance="8" /><!-- i -->'+
'<char id="106" x="628" y="554" width="16" height="56" xoffset="0" yoffset="20" xadvance="19" /><!-- j -->'+
'<char id="107" x="503" y="119" width="28" height="45" xoffset="0" yoffset="17" xadvance="31" /><!-- k -->'+
'<char id="108" x="664" y="252" width="9" height="45" xoffset="0" yoffset="17" xadvance="12" /><!-- l -->'+
'<char id="109" x="65" y="190" width="46" height="32" xoffset="0" yoffset="30" xadvance="49" /><!-- m -->'+
'<char id="110" x="461" y="562" width="30" height="32" xoffset="0" yoffset="30" xadvance="33" /><!-- n -->'+
'<char id="111" x="371" y="118" width="32" height="32" xoffset="0" yoffset="30" xadvance="35" /><!-- o -->'+
'<char id="112" x="323" y="565" width="32" height="46" xoffset="0" yoffset="30" xadvance="35" /><!-- p -->'+
'<char id="113" x="370" y="489" width="32" height="46" xoffset="0" yoffset="30" xadvance="35" /><!-- q -->'+
'<char id="114" x="588" y="352" width="24" height="32" xoffset="0" yoffset="30" xadvance="27" /><!-- r -->'+
'<char id="115" x="505" y="612" width="26" height="32" xoffset="0" yoffset="30" xadvance="29" /><!-- s -->'+
'<char id="116" x="628" y="194" width="18" height="45" xoffset="0" yoffset="17" xadvance="21" /><!-- t -->'+
'<char id="117" x="461" y="516" width="30" height="32" xoffset="0" yoffset="30" xadvance="33" /><!-- u -->'+
'<char id="118" x="459" y="667" width="30" height="32" xoffset="0" yoffset="30" xadvance="33" /><!-- v -->'+
'<char id="119" x="74" y="0" width="42" height="32" xoffset="0" yoffset="30" xadvance="45" /><!-- w -->'+
'<char id="120" x="503" y="667" width="28" height="32" xoffset="0" yoffset="30" xadvance="31" /><!-- x -->'+
'<char id="121" x="503" y="59" width="28" height="46" xoffset="0" yoffset="30" xadvance="31" /><!-- y -->'+
'<char id="122" x="504" y="401" width="28" height="32" xoffset="0" yoffset="30" xadvance="31" /><!-- z -->'+
'<char id="123" x="627" y="627" width="18" height="60" xoffset="0" yoffset="16" xadvance="21" /><!-- { -->'+
'<char id="124" x="687" y="280" width="4" height="59" xoffset="0" yoffset="17" xadvance="7" /><!-- | -->'+
'<char id="125" x="628" y="120" width="18" height="60" xoffset="0" yoffset="16" xadvance="21" /><!-- } -->'+
'<char id="126" x="83" y="674" width="23" height="8" xoffset="0" yoffset="36" xadvance="26" /><!-- ~ -->'+
'<char id="199" x="125" y="118" width="39" height="58" xoffset="0" yoffset="17" xadvance="42" /><!--  -->'+
'<char id="213" x="60" y="543" width="46" height="58" xoffset="0" yoffset="4" xadvance="49" /><!--  -->'+
'<char id="211" x="65" y="295" width="46" height="59" xoffset="0" yoffset="3" xadvance="49" /><!--  -->'+
'<char id="231" x="461" y="59" width="28" height="45" xoffset="0" yoffset="30" xadvance="31" /><!--  -->'+
'<char id="237" x="660" y="193" width="12" height="45" xoffset="0" yoffset="17" xadvance="15" /><!--  -->'+
'<char id="227" x="277" y="507" width="33" height="44" xoffset="0" yoffset="18" xadvance="36" /><!--  -->'+
'<char id="243" x="416" y="338" width="32" height="45" xoffset="0" yoffset="17" xadvance="35" /><!--  -->'+
'<char id="234" x="415" y="549" width="32" height="45" xoffset="0" yoffset="17" xadvance="35" /><!--  -->'+
'<char id="233" x="371" y="279" width="32" height="45" xoffset="0" yoffset="17" xadvance="35" /><!--  -->'+
'<char id="228" x="278" y="237" width="33" height="42" xoffset="0" yoffset="20" xadvance="36" /><!--  -->'+
'<char id="223" x="461" y="118" width="28" height="46" xoffset="0" yoffset="16" xadvance="31" /><!--  -->'+
'<char id="246" x="371" y="164" width="32" height="42" xoffset="0" yoffset="20" xadvance="35" /><!--  -->'+
'<char id="252" x="417" y="59" width="30" height="42" xoffset="0" yoffset="20" xadvance="33" /><!--  -->'+
'<char id="241" x="416" y="397" width="30" height="44" xoffset="0" yoffset="18" xadvance="33" /><!--  -->'+
'<char id="161" x="686" y="118" width="7" height="46" xoffset="0" yoffset="22" xadvance="10" /><!--  -->'+
'<char id="191" x="462" y="284" width="28" height="46" xoffset="0" yoffset="21" xadvance="31" /><!--  -->'+
'<char id="200" x="278" y="363" width="33" height="59" xoffset="0" yoffset="3" xadvance="36" /><!--  -->'+
'<char id="195" x="177" y="190" width="37" height="58" xoffset="0" yoffset="4" xadvance="40" /><!--  -->'+
'<char id="350" x="588" y="129" width="26" height="58" xoffset="0" yoffset="17" xadvance="29" /><!--  -->'+
'<char id="220" x="278" y="293" width="33" height="56" xoffset="0" yoffset="6" xadvance="36" /><!--  -->'+
'<char id="351" x="587" y="70" width="26" height="45" xoffset="0" yoffset="30" xadvance="29" /><!--  -->'+
'<char id="287" x="325" y="310" width="32" height="59" xoffset="0" yoffset="17" xadvance="35" /><!--  -->'+
'<char id="280" x="325" y="237" width="32" height="59" xoffset="0" yoffset="17" xadvance="35" /><!--  -->'+
'<char id="281" x="325" y="177" width="32" height="46" xoffset="0" yoffset="30" xadvance="35" /><!--  -->'+
'<char id="261" x="175" y="589" width="37" height="45" xoffset="0" yoffset="30" xadvance="40" /><!--  -->'+
'<char id="321" x="228" y="237" width="36" height="45" xoffset="0" yoffset="17" xadvance="39" /><!--  -->'+
'<char id="322" x="627" y="60" width="18" height="46" xoffset="0" yoffset="16" xadvance="21" /><!--  -->'+
'<char id="324" x="416" y="455" width="30" height="45" xoffset="0" yoffset="17" xadvance="33" /><!--  -->'+
'<char id="323" x="178" y="105" width="37" height="59" xoffset="0" yoffset="3" xadvance="40" /><!--  -->'+
'<char id="347" x="588" y="201" width="26" height="45" xoffset="0" yoffset="17" xadvance="29" /><!--  -->'+
'<char id="1072" x="180" y="59" width="33" height="32" xoffset="0" yoffset="30" xadvance="36" /><!--  -->'+
'<char id="1073" x="323" y="625" width="32" height="46" xoffset="0" yoffset="16" xadvance="35" /><!--  -->'+
'<char id="1074" x="588" y="260" width="25" height="32" xoffset="0" yoffset="30" xadvance="28" /><!--  -->'+
'<char id="1075" x="627" y="508" width="21" height="32" xoffset="0" yoffset="30" xadvance="24" /><!--  -->'+
'<char id="1076" x="324" y="436" width="32" height="46" xoffset="0" yoffset="30" xadvance="35" /><!--  -->'+
'<char id="1077" x="121" y="495" width="32" height="32" xoffset="0" yoffset="30" xadvance="35" /><!--  -->'+
'<char id="1078" x="61" y="496" width="46" height="32" xoffset="0" yoffset="30" xadvance="49" /><!--  -->'+
'<char id="1079" x="627" y="462" width="22" height="32" xoffset="0" yoffset="30" xadvance="25" /><!--  -->'+
'<char id="1080" x="417" y="292" width="30" height="32" xoffset="0" yoffset="30" xadvance="33" /><!--  -->'+
'<char id="1082" x="588" y="509" width="25" height="32" xoffset="0" yoffset="30" xadvance="28" /><!--  -->'+
'<char id="1083" x="325" y="383" width="30" height="33" xoffset="0" yoffset="30" xadvance="33" /><!--  -->'+
'<char id="1084" x="120" y="542" width="42" height="33" xoffset="0" yoffset="30" xadvance="45" /><!--  -->'+
'<char id="1085" x="547" y="522" width="27" height="32" xoffset="0" yoffset="30" xadvance="30" /><!--  -->'+
'<char id="1086" x="177" y="321" width="32" height="32" xoffset="0" yoffset="30" xadvance="35" /><!--  -->'+
'<char id="1087" x="415" y="667" width="30" height="32" xoffset="0" yoffset="30" xadvance="33" /><!--  -->'+
'<char id="1088" x="278" y="436" width="32" height="46" xoffset="0" yoffset="30" xadvance="35" /><!--  -->'+
'<char id="1089" x="461" y="178" width="28" height="32" xoffset="0" yoffset="30" xadvance="31" /><!--  -->'+
'<char id="1090" x="69" y="72" width="46" height="32" xoffset="0" yoffset="30" xadvance="49" /><!--  -->'+
'<char id="1091" x="461" y="224" width="28" height="46" xoffset="0" yoffset="30" xadvance="31" /><!--  -->'+
'<char id="1092" x="0" y="309" width="51" height="59" xoffset="0" yoffset="17" xadvance="54" /><!--  -->'+
'<char id="1093" x="504" y="355" width="28" height="32" xoffset="0" yoffset="30" xadvance="31" /><!--  -->'+
'<char id="1094" x="229" y="59" width="35" height="41" xoffset="0" yoffset="30" xadvance="38" /><!--  -->'+
'<char id="1095" x="588" y="463" width="25" height="32" xoffset="0" yoffset="30" xadvance="28" /><!--  -->'+
'<char id="1096" x="0" y="496" width="47" height="33" xoffset="0" yoffset="30" xadvance="50" /><!--  -->'+
'<char id="1097" x="0" y="382" width="51" height="41" xoffset="0" yoffset="30" xadvance="54" /><!--  -->'+
'<char id="1100" x="626" y="352" width="24" height="32" xoffset="0" yoffset="30" xadvance="27" /><!--  -->'+
'<char id="1099" x="130" y="0" width="32" height="32" xoffset="0" yoffset="30" xadvance="35" /><!--  -->'+
'<char id="1101" x="462" y="344" width="28" height="32" xoffset="0" yoffset="30" xadvance="31" /><!--  -->'+
'<char id="1102" x="69" y="118" width="42" height="32" xoffset="0" yoffset="30" xadvance="45" /><!--  -->'+
'<char id="1103" x="588" y="306" width="25" height="32" xoffset="0" yoffset="30" xadvance="28" /><!--  -->'+
'<char id="1052" x="0" y="249" width="51" height="46" xoffset="0" yoffset="16" xadvance="54" /><!--  -->'+
'<char id="1040" x="224" y="648" width="37" height="45" xoffset="0" yoffset="17" xadvance="40" /><!--  -->'+
'<char id="1043" x="417" y="174" width="30" height="45" xoffset="0" yoffset="17" xadvance="33" /><!--  -->'+
'<char id="1047" x="587" y="627" width="26" height="45" xoffset="0" yoffset="17" xadvance="29" /><!--  -->'+
'<char id="1048" x="129" y="46" width="37" height="45" xoffset="0" yoffset="17" xadvance="40" /><!--  -->'+
'<char id="1053" x="278" y="178" width="33" height="45" xoffset="0" yoffset="17" xadvance="36" /><!--  -->'+
'<char id="1051" x="125" y="367" width="37" height="45" xoffset="0" yoffset="17" xadvance="40" /><!--  -->'+
'<char id="1062" x="227" y="380" width="37" height="54" xoffset="0" yoffset="17" xadvance="40" /><!--  -->'+
'<char id="1059" x="227" y="321" width="37" height="45" xoffset="0" yoffset="17" xadvance="40" /><!--  -->'+
'<char id="1050" x="460" y="457" width="30" height="45" xoffset="0" yoffset="17" xadvance="33" /><!--  -->'+
'<char id="1041" x="503" y="178" width="28" height="45" xoffset="0" yoffset="17" xadvance="31" /><!--  -->'+
'<char id="1061" x="176" y="367" width="37" height="45" xoffset="0" yoffset="17" xadvance="40" /><!--  -->'+
'<char id="1063" x="325" y="59" width="32" height="45" xoffset="0" yoffset="17" xadvance="35" /><!--  -->'+
'<char id="1044" x="121" y="427" width="41" height="54" xoffset="0" yoffset="17" xadvance="44" /><!--  -->'+
'<char id="1042" x="504" y="237" width="28" height="45" xoffset="0" yoffset="17" xadvance="31" /><!--  -->'+
'<char id="1055" x="369" y="555" width="32" height="45" xoffset="0" yoffset="17" xadvance="35" /><!--  -->'+
'<char id="1057" x="120" y="648" width="39" height="45" xoffset="0" yoffset="17" xadvance="42" /><!--  -->'+
'<char id="1056" x="546" y="404" width="27" height="45" xoffset="0" yoffset="17" xadvance="30" /><!--  -->'+
'<char id="1058" x="229" y="114" width="35" height="45" xoffset="0" yoffset="17" xadvance="38" /><!--  -->'+
'<char id="1054" x="65" y="236" width="46" height="45" xoffset="0" yoffset="17" xadvance="49" /><!--  -->'+
'<char id="304" x="664" y="311" width="9" height="56" xoffset="0" yoffset="6" xadvance="12" /><!--  -->'+
'<char id="1068" x="504" y="296" width="28" height="45" xoffset="0" yoffset="17" xadvance="31" /><!--  -->'+
'<char id="1046" x="0" y="131" width="55" height="45" xoffset="0" yoffset="17" xadvance="58" /><!--  -->'+
'<char id="1045" x="371" y="0" width="32" height="45" xoffset="0" yoffset="17" xadvance="35" /><!--  -->'+
'<char id="224" x="278" y="59" width="33" height="45" xoffset="0" yoffset="17" xadvance="36" /><!--  -->'+
'<char id="236" x="659" y="60" width="12" height="45" xoffset="0" yoffset="17" xadvance="15" /><!--  -->'+
'<char id="1060" x="0" y="543" width="46" height="45" xoffset="0" yoffset="17" xadvance="49" /><!--  -->'+
'<char id="1064" x="120" y="589" width="41" height="45" xoffset="0" yoffset="17" xadvance="44" /><!--  -->'+
'<char id="1065" x="0" y="602" width="46" height="54" xoffset="0" yoffset="17" xadvance="49" /><!--  -->'+
'<char id="1066" x="228" y="178" width="36" height="45" xoffset="0" yoffset="17" xadvance="39" /><!--  -->'+
'<char id="1067" x="226" y="545" width="37" height="45" xoffset="0" yoffset="17" xadvance="40" /><!--  -->'+
'<char id="1069" x="125" y="190" width="38" height="45" xoffset="0" yoffset="17" xadvance="41" /><!--  -->'+
'<char id="1070" x="0" y="72" width="55" height="45" xoffset="0" yoffset="17" xadvance="58" /><!--  -->'+
'<char id="1071" x="417" y="233" width="30" height="45" xoffset="0" yoffset="17" xadvance="33" /><!--  -->'+
'<char id="305" x="686" y="178" width="5" height="32" xoffset="0" yoffset="30" xadvance="8" /><!--  -->'+
'<char id="263" x="505" y="493" width="28" height="45" xoffset="0" yoffset="17" xadvance="31" /><!--  -->'+
'<char id="32" x="0" y="0" width="0" height="0" xoffset="0" yoffset="0" xadvance="20" /><!--   -->'+
'<char id="9" x="0" y="0" width="0" height="0" xoffset="0" yoffset="0" xadvance="160" /><!--   -->'+
'</chars>'+
'<kernings count="0">'+
'</kernings>'+
'</font>';
PS.BitmapFontLoader=function(){
var xmlDoc;
if(window.DOMParser)
{
var parser=new DOMParser();
xmlDoc=parser.parseFromString(PS.FontString,"text/xml");
}
else
{
xmlDoc=new ActiveXObject("Microsoft.XMLDOM");
xmlDoc.async=false;
xmlDoc.loadXML(PS.FontString);
}
var responseXML=xmlDoc;
var textureUrl=this.baseUrl+responseXML.getElementsByTagName('page')[0].getAttribute('file');
this.texture=GodStep.textures['Font2'].baseTexture;
var data={};
var info=responseXML.getElementsByTagName('info')[0];
var common=responseXML.getElementsByTagName('common')[0];
data.font=info.getAttribute('face');
data.size=parseInt(info.getAttribute('size'),10);
data.lineHeight=parseInt(common.getAttribute('lineHeight'),10);
data.chars={};
var letters=responseXML.getElementsByTagName('char');
for(var i=0;i<letters.length;i++)
{
var charCode=parseInt(letters[i].getAttribute('id'),10);
var textureRect=new PIXI.Rectangle(
parseInt(letters[i].getAttribute('x'),10),
parseInt(letters[i].getAttribute('y'),10),
parseInt(letters[i].getAttribute('width'),10),
parseInt(letters[i].getAttribute('height'),10)
);
data.chars[charCode]={
xOffset:parseInt(letters[i].getAttribute('xoffset'),10),
yOffset:parseInt(letters[i].getAttribute('yoffset'),10)-2,
xAdvance:parseInt(letters[i].getAttribute('xadvance'),10),
kerning:{},
texture:PIXI.TextureCache[charCode]=new PIXI.Texture(this.texture,textureRect)
};
}
var kernings=responseXML.getElementsByTagName('kerning');
for(i=0;i<kernings.length;i++)
{
var first=parseInt(kernings[i].getAttribute('first'),10);
var second=parseInt(kernings[i].getAttribute('second'),10);
var amount=parseInt(kernings[i].getAttribute('amount'),10);
data.chars[second].kerning[first]=amount;
}
PIXI.BitmapText.fonts[data.font]=data;
};
extend(PS.BitmapFontLoader,PIXI.BitmapFontLoader);
PS.Pause=function(soul){
this.soul=soul;
GodStep.Frame.call(this,'Pause',soul.W,soul.H);
GodStep.IDownUp.call(this,soul.W,soul.H);
var S=this.startS=soul.startS;
this.addChild(this.back=new PS.Background(this,'options_background'));
this.addChild(this.field=new PS.Img('field',S,this.W*.5,this.H*.5,.5));
this.addChild(this.header=new PS.Img('field_pause',S,this.W*.5,this.H*.12,new PIXI.Point(.5,.5)));
this.addChild(this.musicLabel=new PS.Img('music',S,this.W*.25,this.H*.555,.5));
this.addChild(this.soundLabel=new PS.Img('sound',S,this.W*.25,this.H*.34,.5));
var oText=PS.S('Pause');var c=Math.min(1,7/oText.length);
this.addChild(this.optLabel=new PS.Text(oText,250*S*c,this.W*.36,this.H*.2+this.H*.15*(1-c),'left',0xffffff));
var on=PS.S('on');c=Math.min(1,3/on.length);
this.addChild(this.musicLabel=new PS.Text(on,250*S*c,this.W*.44,this.H*.58-this.musicLabel.height/2,'left',0xffffff));
this.addChild(this.soundLabel=new PS.Text(on,250*S*c,this.W*.44,this.H*.36-this.soundLabel.height/2,'left',0xffffff));
this.soundLabel.updateText();
this.musicLabel.updateText();
this.soundLabel.x=(this.W-this.soundLabel.width)/2;
this.musicLabel.x=(this.W-this.musicLabel.width)/2;
this.addChild(this.b_music_on=new PS.ImgButton('button_on',S,this.W*.74,this.H*.555));
this.addChild(this.b_music_off=new PS.ImgButton('button_off',S,this.W*.74,this.H*.555));
this.addChild(this.b_sound_on=new PS.ImgButton('button_on',S,this.W*.74,this.H*.34));
this.addChild(this.b_sound_off=new PS.ImgButton('button_off',S,this.W*.74,this.H*.34));
this.b_music_off.downScale=
this.b_sound_on.downScale=
this.b_music_on.downScale=
this.b_sound_off.downScale=1;
var dev=PS.S('developed');c=Math.min(1,21/dev.length);
this.addChild(this.b_back=new PS.ImgButton('back',S,this.W*.13,this.H*.12));
this.addChild(this.b_menu=new PS.ImgButton('b_menu',S,this.W*.87,this.H*.12));
this.addChild(this.b_developer=new PS.ImgButton('button_developed',S,this.W*.5,this.H*.8,dev,109*S*c,0,this.H*.01));
this.addFrame(this.b_clear=new PS.TextButton('clear data',35,0x562466,this,S,soul.W*.5,soul.H*.1));
this.b_clear.visible=false;
this.visible=false;
this.b_sound_off.visible=this.b_music_off.visible=false;
addEvent(this.b_sound_on,PS.ImgButton.CLICK,this.h_buttons);
addEvent(this.b_music_off,PS.ImgButton.CLICK,this.h_buttons);
addEvent(this.b_music_on,PS.ImgButton.CLICK,this.h_buttons);
addEvent(this.b_sound_off,PS.ImgButton.CLICK,this.h_buttons);
addEvent(this.b_menu,PS.ImgButton.CLICK,this.h_buttons);
addEvent(this.b_back,PS.ImgButton.CLICK,this.h_buttons);
addEvent(this.b_clear,PS.ImgButton.CLICK,this.h_buttons);
addEvent(this,GodStep.FRAME_UP,this.h_mouse);
};
extend(PS.Pause,GodStep.Frame);
pro.init=function(){
this.visible=true;
this.b_music_off.visible=!PS.MUSIC;
this.b_music_on.visible=PS.MUSIC;
this.b_sound_off.visible=!PS.SOUND;
this.b_sound_on.visible=PS.SOUND;
if(PS.MUSIC){
this.musicLabel.setText(PS.S('on'));this.musicLabel.updateText();
}else{
this.musicLabel.setText(PS.S('off'));this.musicLabel.updateText();
}
if(PS.SOUND){
this.soundLabel.setText(PS.S('on'));this.soundLabel.updateText();
}else{
this.soundLabel.setText(PS.S('off'));this.soundLabel.updateText();
}
};
pro.h_mouse=function(e){
if(e.content.target.soul){
var t=e.content.target;
t.b_back.isDown=t.b_developer.isDown=t.b_clear.isDown=t.b_back.isDown=false;
t.b_back.Scale=t.b_developer.Scale=t.b_clear.Scale=t.b_back.Scale=1;
}
};
pro.h_buttons=function(e){
var t=e.content.t;
var p=t.parent;
var s=p.soul;
switch(t){
case p.b_developer:
break;
case p.b_music_on:
PS.MUSIC=false;
GodStep.playSound('button',0,PS.SOUND);
if(createjs){
if(createjs.Sound)createjs.Sound.stop();
}
p.b_music_on.visible=false;
p.b_music_off.visible=true;
p.musicLabel.setText(PS.S('off'));p.musicLabel.updateText();
p.musicLabel.x=(p.W-p.musicLabel.width)/2;
break;
case p.b_music_off:
PS.MUSIC=true;
GodStep.playSound('button',0,PS.SOUND);
GodStep.playSound('theme2',null,PS.MUSIC);
p.b_music_on.visible=true;
p.b_music_off.visible=false;
p.musicLabel.setText(PS.S('on'));p.musicLabel.updateText();
p.musicLabel.x=(p.W-p.musicLabel.width)/2;
break;
case p.b_sound_on:
PS.SOUND=false;
GodStep.playSound('button',0,PS.SOUND);
p.b_sound_on.visible=false;
p.b_sound_off.visible=true;
p.soundLabel.setText(PS.S('off'));p.soundLabel.updateText();
p.soundLabel.x=(p.W-p.soundLabel.width)/2;
break;
case p.b_sound_off:
PS.SOUND=true;
GodStep.playSound('button',0,PS.SOUND);
p.b_sound_on.visible=true;
p.b_sound_off.visible=false;
p.soundLabel.setText(PS.S('on'));p.soundLabel.updateText();
p.soundLabel.x=(p.W-p.soundLabel.width)/2;
break;
case p.b_clear:
GodStep.Clear(p.soul.playerDATA);
break;
case p.b_menu:
GodStep.playSound('button',0,PS.SOUND);
s.screenTo([s.levelselect],p.parent);
break;
case p.b_back:
GodStep.playSound('button',0,PS.SOUND);
p.visible=false;
break;
}
};
Object.defineProperty(pro,'Scale',{
get:function(){
return this.scale.x;
},
set:function(value){
this.scale.x=this.scale.y=1;
this.header.y=this.optLabel.y=this.b_menu.y=this.b_back.y=-(this.soul.OH-this.soul.H)*.5/value+this.soul.H*.1/value;
this.optLabel.y+=-this.soul.H*.015/value-this.optLabel.height/2;
this.back.rescale(value);
}
});
PS.Orientation=function(soul){
this.soul=soul;
GodStep.Frame.call(this,'Orientation',soul.W,soul.H);
this.addChild(this.back=new PS.Img('back_o',soul.startS,this.W/2,this.H/2,.5));
this.addChild(this.face=new PS.Img('face',soul.startS,this.W/2,this.H*.35,.5));
this.addChild(this.device=new PS.Img('device_1',soul.startS,this.W/2,this.H*.75,.5));
GodStep.IDownUp.call(this,this.W,this.H);
this.visible=false;
if(window.orientation==90||window.orientation==-90){
this.visible=true;
}
};
extend(PS.Orientation,GodStep.Frame);
pro.init=function(){
this.visible=true;
};
Object.defineProperty(pro,'Scale',{
get:function(){
return this.scale.x;
},
set:function(value){
this.scale.x=this.scale.y=value;
this.back.scale.x=this.soul.OW/this.back.texture.width/value;
this.back.scale.y=this.soul.OH/this.back.texture.height/value;
}
});
PS.ZippyBoxes=function(lang){
if(PS.SOFT_GAMES){
this.lang=new PS.Lang(lang);
}else{
this.lang=new PS.Lang('EN');
}
GodStep.Game.TRANSPARENT=true;
GodStep.Game.call(this,'ZippyBoxes',0xff00ff,PS.Preloader,'ps_settings12','ps_player222',PS.DEFAULT_SETTINGS);
PS.ZippyBoxes.instance=this;
PS.SOUND=PS.MUSIC=true;
this.MW=1536;
this.MH=1854;
};
extend(PS.ZippyBoxes,GodStep.Game);
PS.CELL_SCALE=1.115;
PS.IMAGE_PATH='src/zippyboxes/img123456/';
PS.SOUND_PATH='src/zippyboxes/sounds/';
PS.DEFAULT_SETTINGS='{"levels":[[{"name":"star","xi":4,"yi":1,"rotate":0,"alias":2},{"name":"star","xi":4,"yi":0,"rotate":0,"alias":0},{"name":"player","xi":1,"yi":0,"rotate":0,"alias":0},{"name":"player","xi":1,"yi":1,"rotate":0,"alias":2},{"id":1}],[{"name":"star","xi":1,"yi":4,"rotate":0,"alias":0},{"name":"star","xi":3,"yi":0,"rotate":0,"alias":2},{"name":"player","xi":0,"yi":0,"rotate":0,"alias":2},{"name":"player","xi":4,"yi":4,"rotate":2,"alias":0},{"id":2}],[{"name":"star","xi":2,"yi":4,"rotate":0,"alias":2},{"name":"star","xi":2,"yi":3,"rotate":0,"alias":0},{"name":"player","xi":2,"yi":0,"rotate":1,"alias":0},{"name":"player","xi":2,"yi":2,"rotate":1,"alias":2},{"id":3}],[{"name":"star","xi":4,"yi":0,"rotate":0,"alias":2},{"name":"star","xi":3,"yi":2,"rotate":0,"alias":1},{"name":"player","xi":2,"yi":2,"rotate":0,"alias":1},{"name":"player","xi":3,"yi":3,"rotate":3,"alias":2},{"id":4}],[{"name":"star","xi":3,"yi":0,"rotate":0,"alias":2},{"name":"star","xi":3,"yi":2,"rotate":0,"alias":0},{"name":"star","xi":2,"yi":2,"rotate":0,"alias":1},{"name":"player","xi":1,"yi":2,"rotate":0,"alias":0},{"name":"player","xi":2,"yi":3,"rotate":3,"alias":1},{"name":"player","xi":3,"yi":3,"rotate":3,"alias":2},{"id":5}],[{"name":"star","xi":4,"yi":1,"rotate":0,"alias":2},{"name":"star","xi":3,"yi":0,"rotate":0,"alias":0},{"name":"player","xi":0,"yi":1,"rotate":0,"alias":2},{"name":"player","xi":2,"yi":4,"rotate":3,"alias":0},{"id":6}],[{"name":"star","xi":1,"yi":0,"rotate":0,"alias":1},{"name":"star","xi":2,"yi":1,"rotate":0,"alias":0},{"name":"star","xi":3,"yi":2,"rotate":0,"alias":2},{"name":"player","xi":4,"yi":2,"rotate":2,"alias":2},{"name":"player","xi":3,"yi":3,"rotate":3,"alias":0},{"name":"player","xi":3,"yi":1,"rotate":2,"alias":1},{"id":7}],[{"name":"star","xi":2,"yi":0,"rotate":0,"alias":2},{"name":"star","xi":2,"yi":1,"rotate":0,"alias":0},{"name":"player","xi":2,"yi":4,"rotate":3,"alias":0},{"name":"playerB","xi":2,"yi":2,"rotate":0,"alias":2},{"id":8}],[{"name":"star","xi":4,"yi":3,"rotate":0,"alias":2},{"name":"star","xi":3,"yi":2,"rotate":0,"alias":0},{"name":"star","xi":2,"yi":3,"rotate":0,"alias":3},{"name":"star","xi":2,"yi":0,"rotate":0,"alias":1},{"name":"player","xi":0,"yi":2,"rotate":0,"alias":0},{"name":"player","xi":1,"yi":3,"rotate":3,"alias":1},{"name":"playerB","xi":2,"yi":2,"rotate":0,"alias":3},{"name":"player","xi":2,"yi":1,"rotate":1,"alias":2},{"id":9}],[{"name":"star","xi":2,"yi":4,"rotate":0,"alias":1},{"name":"star","xi":2,"yi":2,"rotate":0,"alias":2},{"name":"star","xi":3,"yi":3,"rotate":0,"alias":0},{"name":"star","xi":4,"yi":3,"rotate":0,"alias":3},{"name":"player","xi":2,"yi":0,"rotate":1,"alias":1},{"name":"player","xi":0,"yi":3,"rotate":0,"alias":0},{"name":"player","xi":4,"yi":2,"rotate":2,"alias":2},{"name":"playerB","xi":3,"yi":2,"rotate":0,"alias":3},{"id":10}], [{"name":"star","xi":4,"yi":3,"rotate":0,"alias":2},{"name":"star","xi":4,"yi":0,"rotate":0,"alias":0},{"name":"playerR","xi":0,"yi":3,"rotate":0,"alias":2},{"name":"playerR","xi":3,"yi":3,"rotate":3,"alias":0},{"id":11}],[{"name":"star","xi":2,"yi":2,"rotate":0,"alias":0},{"name":"star","xi":1,"yi":1,"rotate":0,"alias":2},{"name":"star","xi":1,"yi":2,"rotate":0,"alias":1},{"name":"playerR","xi":1,"yi":4,"rotate":3,"alias":1},{"name":"player","xi":2,"yi":1,"rotate":1,"alias":2},{"name":"playerR","xi":4,"yi":2,"rotate":2,"alias":0},{"id":12}],[{"name":"star","xi":0,"yi":0,"rotate":0,"alias":1},{"name":"star","xi":0,"yi":2,"rotate":0,"alias":3},{"name":"star","xi":1,"yi":1,"rotate":0,"alias":2},{"name":"star","xi":2,"yi":0,"rotate":0,"alias":0},{"name":"playerR","xi":2,"yi":4,"rotate":3,"alias":0},{"name":"playerR","xi":4,"yi":1,"rotate":2,"alias":1},{"name":"playerB","xi":2,"yi":1,"rotate":0,"alias":2},{"name":"player","xi":1,"yi":0,"rotate":1,"alias":3},{"id":13}],[{"name":"star","xi":4,"yi":0,"rotate":0,"alias":1},{"name":"star","xi":0,"yi":1,"rotate":0,"alias":0},{"name":"star","xi":4,"yi":1,"rotate":0,"alias":2},{"name":"star","xi":3,"yi":2,"rotate":0,"alias":3},{"name":"playerR","xi":3,"yi":4,"rotate":3,"alias":3},{"name":"playerR","xi":3,"yi":3,"rotate":3,"alias":1},{"name":"playerR","xi":4,"yi":2,"rotate":2,"alias":0},{"name":"playerR","xi":0,"yi":2,"rotate":0,"alias":2},{"id":14}],[{"name":"star","xi":4,"yi":0,"rotate":0,"alias":2},{"name":"arrow","xi":2,"yi":0,"rotate":0,"alias":-1},{"name":"playerR","xi":2,"yi":3,"rotate":3,"alias":2},{"id":15}],[{"name":"arrow","xi":3,"yi":3,"rotate":3,"alias":-1},{"name":"arrow","xi":3,"yi":1,"rotate":2,"alias":-1},{"name":"star","xi":0,"yi":1,"rotate":0,"alias":2},{"name":"star","xi":0,"yi":0,"rotate":0,"alias":0},{"name":"playerR","xi":0,"yi":3,"rotate":0,"alias":2},{"name":"playerR","xi":3,"yi":2,"rotate":2,"alias":0},{"id":16}],[{"name":"arrow","xi":2,"yi":3,"rotate":3,"alias":-1},{"name":"arrow","xi":2,"yi":1,"rotate":2,"alias":-1},{"name":"arrow","xi":1,"yi":1,"rotate":1,"alias":-1},{"name":"star","xi":1,"yi":2,"rotate":0,"alias":1},{"name":"star","xi":0,"yi":1,"rotate":0,"alias":0},{"name":"player","xi":0,"yi":2,"rotate":0,"alias":0},{"name":"player","xi":1,"yi":0,"rotate":1,"alias":1},{"id":17}],[{"name":"arrow","xi":1,"yi":0,"rotate":1,"alias":-1},{"name":"arrow","xi":2,"yi":0,"rotate":2,"alias":-1},{"name":"arrow","xi":1,"yi":3,"rotate":0,"alias":-1},{"name":"arrow","xi":2,"yi":3,"rotate":3,"alias":-1},{"name":"arrow","xi":2,"yi":4,"rotate":3,"alias":-1},{"name":"star","xi":1,"yi":2,"rotate":0,"alias":0},{"name":"star","xi":2,"yi":1,"rotate":0,"alias":2},{"name":"star","xi":2,"yi":2,"rotate":0,"alias":1},{"name":"player","xi":1,"yi":4,"rotate":3,"alias":0},{"name":"player","xi":1,"yi":1,"rotate":1,"alias":1},{"name":"player","xi":3,"yi":0,"rotate":2,"alias":2},{"id":18}],[{"name":"star","xi":1,"yi":3,"rotate":0,"alias":3},{"name":"arrow","xi":0,"yi":2,"rotate":0,"alias":-1},{"name":"arrow","xi":4,"yi":2,"rotate":2,"alias":-1},{"name":"star","xi":2,"yi":3,"rotate":0,"alias":2},{"name":"star","xi":2,"yi":2,"rotate":0,"alias":1},{"name":"star","xi":2,"yi":1,"rotate":0,"alias":0},{"name":"arrow","xi":2,"yi":4,"rotate":3,"alias":-1},{"name":"player","xi":3,"yi":4,"rotate":3,"alias":0},{"name":"player","xi":4,"yi":1,"rotate":2,"alias":1},{"name":"player","xi":1,"yi":0,"rotate":1,"alias":2},{"name":"playerB","xi":1,"yi":2,"rotate":0,"alias":3},{"id":19}],[{"name":"star","xi":2,"yi":4,"rotate":0,"alias":2},{"name":"star","xi":0,"yi":2,"rotate":0,"alias":0},{"name":"arrow","xi":2,"yi":0,"rotate":1,"alias":-1},{"name":"arrow","xi":4,"yi":2,"rotate":2,"alias":-1},{"name":"arrow","xi":4,"yi":1,"rotate":2,"alias":-1},{"name":"star","xi":1,"yi":4,"rotate":0,"alias":1},{"name":"arrow","xi":0,"yi":1,"rotate":3,"alias":-1},{"name":"arrow","xi":0,"yi":0,"rotate":0,"alias":-1},{"name":"arrow","xi":1,"yi":0,"rotate":1,"alias":-1},{"name":"arrow","xi":3,"yi":0,"rotate":1,"alias":-1},{"name":"player","xi":3,"yi":3,"rotate":3,"alias":2},{"name":"player","xi":2,"yi":2,"rotate":0,"alias":0},{"name":"playerR","xi":3,"yi":2,"rotate":0,"alias":1},{"id":20}], '+
'[{"name":"star","xi":4,"yi":2,"rotate":0,"alias":2},{"name":"teleport","xi":0,"yi":2,"rotate":0,"alias":-1},{"name":"teleport","xi":4,"yi":0,"rotate":0,"alias":-1},{"name":"playerR","xi":0,"yi":0,"rotate":0,"alias":2},{"id":21}],[{"name":"star","xi":3,"yi":0,"rotate":0,"alias":1},{"name":"arrow","xi":0,"yi":1,"rotate":3,"alias":-1},{"name":"arrow","xi":4,"yi":0,"rotate":2,"alias":-1},{"name":"star","xi":4,"yi":1,"rotate":0,"alias":2},{"name":"teleport","xi":2,"yi":0,"rotate":0,"alias":-1},{"name":"star","xi":0,"yi":0,"rotate":0,"alias":0},{"name":"teleport","xi":2,"yi":1,"rotate":0,"alias":-1},{"name":"player","xi":1,"yi":0,"rotate":0,"alias":0},{"name":"player","xi":3,"yi":2,"rotate":3,"alias":1},{"name":"player","xi":3,"yi":1,"rotate":2,"alias":2},{"id":22}],[{"name":"arrow","xi":4,"yi":1,"rotate":2,"alias":-1},{"name":"arrow","xi":0,"yi":1,"rotate":0,"alias":-1},{"name":"teleport","xi":2,"yi":4,"rotate":0,"alias":-1},{"name":"teleport","xi":1,"yi":0,"rotate":0,"alias":-1},{"name":"star","xi":1,"yi":2,"rotate":0,"alias":2},{"name":"star","xi":2,"yi":2,"rotate":0,"alias":0},{"name":"star","xi":3,"yi":2,"rotate":0,"alias":1},{"name":"player","xi":1,"yi":4,"rotate":3,"alias":0},{"name":"player","xi":3,"yi":3,"rotate":2,"alias":2},{"name":"player","xi":2,"yi":1,"rotate":0,"alias":1},{"id":23}],[{"name":"star","xi":3,"yi":2,"rotate":0,"alias":1},{"name":"star","xi":0,"yi":1,"rotate":0,"alias":2},{"name":"teleport","xi":1,"yi":1,"rotate":0,"alias":-1},{"name":"star","xi":2,"yi":2,"rotate":0,"alias":1},{"name":"teleport","xi":1,"yi":3,"rotate":0,"alias":-1},{"name":"star","xi":0,"yi":3,"rotate":0,"alias":0},{"name":"player","xi":4,"yi":1,"rotate":2,"alias":2},{"name":"player","xi":4,"yi":3,"rotate":2,"alias":0},{"name":"player","xi":2,"yi":4,"rotate":3,"alias":1},{"name":"player","xi":3,"yi":0,"rotate":1,"alias":1},{"id":24}],[{"name":"star","xi":0,"yi":1,"rotate":0,"alias":3},{"name":"arrow","xi":2,"yi":4,"rotate":3,"alias":-1},{"name":"star","xi":3,"yi":2,"rotate":0,"alias":2},{"name":"star","xi":1,"yi":2,"rotate":0,"alias":0},{"name":"star","xi":2,"yi":2,"rotate":0,"alias":1},{"name":"player","xi":1,"yi":4,"rotate":0,"alias":1},{"name":"player","xi":3,"yi":4,"rotate":2,"alias":2},{"name":"player","xi":2,"yi":3,"rotate":1,"alias":0},{"name":"player","xi":3,"yi":3,"rotate":2,"alias":3},{"id":25}],[{"name":"star","xi":4,"yi":4,"rotate":0,"alias":3},{"name":"teleport","xi":1,"yi":4,"rotate":0,"alias":-1},{"name":"star","xi":1,"yi":2,"rotate":0,"alias":1},{"name":"star","xi":2,"yi":2,"rotate":0,"alias":0},{"name":"star","xi":0,"yi":1,"rotate":0,"alias":2},{"name":"teleport","xi":2,"yi":0,"rotate":0,"alias":-1},{"name":"player","xi":2,"yi":4,"rotate":3,"alias":0},{"name":"player","xi":0,"yi":3,"rotate":0,"alias":1},{"name":"player","xi":3,"yi":2,"rotate":2,"alias":2},{"name":"playerR","xi":0,"yi":0,"rotate":0,"alias":3},{"id":26}],[{"name":"star","xi":4,"yi":2,"rotate":0,"alias":0},{"name":"teleport","xi":1,"yi":3,"rotate":0,"alias":-1},{"name":"teleport","xi":3,"yi":1,"rotate":0,"alias":-1},{"name":"arrow","xi":3,"yi":3,"rotate":3,"alias":-1},{"name":"arrow","xi":2,"yi":2,"rotate":0,"alias":-1},{"name":"star","xi":1,"yi":1,"rotate":0,"alias":1},{"name":"star","xi":1,"yi":0,"rotate":0,"alias":3},{"name":"player","xi":2,"yi":4,"rotate":3,"alias":0},{"name":"player","xi":2,"yi":0,"rotate":1,"alias":1},{"name":"player","xi":2,"yi":3,"rotate":3,"alias":3},{"id":27}],[{"name":"arrow","xi":1,"yi":0,"rotate":1,"alias":-1},{"name":"arrow","xi":2,"yi":1,"rotate":2,"alias":-1},{"name":"teleport","xi":2,"yi":2,"rotate":0,"alias":-1},{"name":"teleport","xi":1,"yi":3,"rotate":0,"alias":-1},{"name":"star","xi":0,"yi":3,"rotate":0,"alias":0},{"name":"star","xi":0,"yi":2,"rotate":0,"alias":2},{"name":"star","xi":0,"yi":1,"rotate":0,"alias":1},{"name":"arrow","xi":2,"yi":4,"rotate":3,"alias":-1},{"name":"arrow","xi":3,"yi":4,"rotate":2,"alias":-1},{"name":"player","xi":4,"yi":3,"rotate":2,"alias":2},{"name":"player","xi":3,"yi":2,"rotate":1,"alias":0},{"name":"player","xi":2,"yi":3,"rotate":0,"alias":1},{"id":28}],[{"name":"arrow","xi":0,"yi":2,"rotate":1,"alias":-1},{"name":"star","xi":0,"yi":4,"rotate":0,"alias":1},{"name":"star","xi":2,"yi":2,"rotate":0,"alias":0},{"name":"star","xi":2,"yi":3,"rotate":0,"alias":1},{"name":"star","xi":2,"yi":4,"rotate":0,"alias":3},{"name":"arrow","xi":1,"yi":2,"rotate":0,"alias":-1},{"name":"arrow","xi":3,"yi":2,"rotate":2,"alias":-1},{"name":"arrow","xi":2,"yi":1,"rotate":1,"alias":-1},{"name":"arrow","xi":4,"yi":2,"rotate":1,"alias":-1},{"name":"star","xi":4,"yi":3,"rotate":0,"alias":2},{"name":"player","xi":1,"yi":1,"rotate":1,"alias":0},{"name":"player","xi":3,"yi":1,"rotate":1,"alias":1},{"name":"player","xi":1,"yi":3,"rotate":3,"alias":2},{"name":"player","xi":3,"yi":3,"rotate":3,"alias":3},{"name":"player","xi":0,"yi":3,"rotate":3,"alias":1},{"id":29}],[{"name":"arrow","xi":4,"yi":1,"rotate":2,"alias":-1},{"name":"arrow","xi":3,"yi":0,"rotate":1,"alias":-1},{"name":"arrow","xi":0,"yi":2,"rotate":0,"alias":-1},{"name":"arrow","xi":3,"yi":4,"rotate":3,"alias":-1},{"name":"star","xi":1,"yi":3,"rotate":0,"alias":0},{"name":"star","xi":2,"yi":3,"rotate":0,"alias":1},{"name":"star","xi":3,"yi":3,"rotate":0,"alias":2},{"name":"star","xi":0,"yi":1,"rotate":0,"alias":3},{"name":"player","xi":4,"yi":2,"rotate":3,"alias":1},{"name":"player","xi":1,"yi":0,"rotate":1,"alias":2},{"name":"player","xi":0,"yi":0,"rotate":1,"alias":0},{"name":"playerB","xi":3,"yi":1,"rotate":0,"alias":3},{"id":30}]]}';
PS.TUTOR_LEVEL='[{"name":"star","xi":2,"yi":3,"rotate":0,"alias":2},{"name":"player","xi":2,"yi":1,"rotate":1,"alias":2},{"id":1}]';
pro.update=function(){
this.beginFps();
GodStep.Mejdu.prototype.update.call(this);
this.endFps();
};
pro.run=function(){
if(!this.isRunning){
trace('running');
this.isRunning=true;
this.delFrame(this.assets);
this.addFrame(this.startmenu=new PS.StartMenu(this));
this.addFrame(this.settings=new PS.Settings(this));
this.addFrame(this.gameplay=new PS.GamePlay(this));
this.addFrame(this.levelselect=new PS.LevelSelect(this));
this.addFrame(this.intro=new PS.LevelIntro(this));
this.addFrame(this.outro=new PS.LevelOutro(this));
this.addFrame(this.dev=new PS.Dev(this));
this.addFrame(this.fps=new GodStep.FPS(this,0x22aa00,.0));
this.addFrame(this.transmission=new PS.Transmission(this));
this.addFrame(this.orientation=new PS.Orientation(this));
var p=GodStep.LoadLocal(this.PLAYER_SLOT);
if(p){
this.gameplay.initTutor(false);
this.screenTo([this.startmenu],this.assets);
}else{
this.gameplay.initTutor(true);
this.screenTo([this.gameplay],this.assets);
}
this.resizeWindow(this.OW,this.OH);
this.reposition();
}
};
function startZippyBoxes(lang){
if(!PS.ZippyBoxes.instance){
var game=new PS.ZippyBoxes(lang);
game.div.style.margin='0 auto';
game.div.style['vertical-align']='middle';
game.initResizeEvents();
}
}
